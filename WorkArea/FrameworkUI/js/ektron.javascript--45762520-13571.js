(function(){function t(){var i,n;for(n=arguments[0]||{},this.jQuery=arguments[1]||{},this.config={},this.config.elements=n.elements?n.elements:[],this.config.attributes=n.attributes?n.attributes:{},this.config.attributes[t.ALL]=this.config.attributes[t.ALL]?this.config.attributes[t.ALL]:[],this.config.allow_comments=n.allow_comments?n.allow_comments:!1,this.allowed_elements={},this.config.protocols=n.protocols?n.protocols:{},this.config.add_attributes=n.add_attributes?n.add_attributes:{},this.dom=n.dom?n.dom:document,i=0;i<this.config.elements.length;i++)this.allowed_elements[this.config.elements[i]]=!0;if(this.config.remove_element_contents={},this.config.remove_all_contents=!1,n.remove_contents)if(n.remove_contents instanceof Array)for(i=0;i<n.remove_contents.length;i++)this.config.remove_element_contents[n.remove_contents[i]]=!0;else this.config.remove_all_contents=!0;this.transformers=n.transformers?n.transformers:[],this.filters=n.filters?n.filters:[]}var n;n||(n={}),function(){function r(n){return n<10?"0"+n:n}function s(n){return o.lastIndex=0,o.test(n)?'"'+n.replace(o,function(n){var t=h[n];return typeof t=="string"?t:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function f(n,r){var o,l,h,a,v=t,c,e=r[n];e&&typeof e=="object"&&typeof e.toJSON=="function"&&(e=e.toJSON(n)),typeof i=="function"&&(e=i.call(r,n,e));switch(typeof e){case"string":return s(e);case"number":return isFinite(e)?String(e):"null";case"boolean":case"null":return String(e);case"object":if(!e)return"null";if(t+=u,c=[],Object.prototype.toString.apply(e)==="[object Array]"){for(a=e.length,o=0;o<a;o+=1)c[o]=f(o,e)||"null";return h=c.length===0?"[]":t?"[\n"+t+c.join(",\n"+t)+"\n"+v+"]":"["+c.join(",")+"]",t=v,h}if(i&&typeof i=="object")for(a=i.length,o=0;o<a;o+=1)typeof i[o]=="string"&&(l=i[o],h=f(l,e),h&&c.push(s(l)+(t?": ":":")+h));else for(l in e)Object.prototype.hasOwnProperty.call(e,l)&&(h=f(l,e),h&&c.push(s(l)+(t?": ":":")+h));return h=c.length===0?"{}":t?"{\n"+t+c.join(",\n"+t)+"\n"+v+"}":"{"+c.join(",")+"}",t=v,h}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+r(this.getUTCMonth()+1)+"-"+r(this.getUTCDate())+"T"+r(this.getUTCHours())+":"+r(this.getUTCMinutes())+":"+r(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,t,u,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;typeof n.stringify!="function"&&(n.stringify=function(n,r,e){var o;if(t="",u="",typeof e=="number")for(o=0;o<e;o+=1)u+=" ";else typeof e=="string"&&(u=e);if(i=r,r&&typeof r!="function"&&(typeof r!="object"||typeof r.length!="number"))throw new Error("JSON.stringify");return f("",{"":n})}),typeof n.parse!="function"&&(n.parse=function(text,reviver){function walk(n,t){var r,u,i=n[t];if(i&&typeof i=="object")for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(u=walk(i,r),u!==undefined?i[r]=u:delete i[r]);return reviver.call(n,t,i)}var j;if(text=String(text),e.lastIndex=0,e.test(text)&&(text=text.replace(e,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse");})}(),define("util/json2",[],function(){return n}),function(){var n=function(){function t(n,t){var i=typeof n[t];return i==k||!!(i==p&&n[t])||i=="unknown"}function f(n,t){return!!(typeof n[t]==p&&n[t])}function w(n,t){return typeof n[t]!=r}function s(n){return function(t,i){for(var r=i.length;r--;)if(!n(t,i[r]))return!1;return!0}}function b(n){return n&&h(n,tt)&&c(n,nt)}function i(t){window.alert("Rangy not supported in your browser. Reason: "+t),n.initialized=!0,n.supported=!1}function rt(t){var i="Rangy warning: "+t;n.config.alertOnWarn?window.alert(i):typeof window.console!=r&&typeof window.console.log!=r&&window.console.log(i)}function v(){var r,u,e,o,v,s,y;if(!n.initialized)for(u=!1,e=!1,t(document,"createRange")&&(r=document.createRange(),h(r,g)&&c(r,d)&&(u=!0),r.detach()),o=f(document,"body")?document.body:document.getElementsByTagName("body")[0],o&&t(o,"createTextRange")&&(r=o.createTextRange(),b(r)&&(e=!0)),u||e||i("Neither Range nor TextRange are implemented"),n.initialized=!0,n.features={implementsDomRange:u,implementsTextRange:e},v=a.concat(l),s=0,y=v.length;s<y;++s)try{v[s](n)}catch(p){f(window,"console")&&t(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",p)}}function ut(n){n=n||window,v();for(var t=0,i=e.length;t<i;++t)e[t](n)}function u(n){this.name=n,this.initialized=!1,this.supported=!1}var p="object",k="function",r="undefined",d=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],g=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],nt=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],tt=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],h=s(t),it=s(f),c=s(w),n={version:"1.2.1",initialized:!1,supported:!0,util:{isHostMethod:t,isHostObject:f,isHostProperty:w,areHostMethods:h,areHostObjects:it,areHostProperties:c,isTextRange:b},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!0}},l,a,e,y,o;if(n.fail=i,n.warn=rt,{}.hasOwnProperty?n.util.extend=function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])}:i("hasOwnProperty not supported"),l=[],a=[],n.init=v,n.addInitListener=function(t){n.initialized?t(n):l.push(t)},e=[],n.addCreateMissingNativeApiListener=function(n){e.push(n)},n.createMissingNativeApi=ut,u.prototype.fail=function(n){this.initialized=!0,this.supported=!1;throw new Error("Module '"+this.name+"' failed to load: "+n);},u.prototype.warn=function(t){n.warn("Module "+this.name+": "+t)},u.prototype.createError=function(n){return new Error("Error in Rangy "+this.name+" module: "+n)},n.createModule=function(t,i){var r=new u(t);n.modules[t]=r,a.push(function(n){i(n,r),r.initialized=!0,r.supported=!0})},n.requireModules=function(t){for(var f=0,e=t.length,i,r;f<e;++f){if(r=t[f],i=n.modules[r],!i||!(i instanceof u))throw new Error("Module '"+r+"' not found");if(!i.supported)throw new Error("Module '"+r+"' not supported");}},y=!1,o=function(){y||(y=!0,n.initialized||v())},typeof window==r){i("No window found");return}if(typeof document==r){i("No document found");return}return t(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",o,!1),t(window,"addEventListener")?window.addEventListener("load",o,!1):t(window,"attachEvent")?window.attachEvent("onload",o):i("Window does not have required addEventListener or attachEvent method"),n}();n.createModule("DomUtil",function(n,t){function k(n){var t;return typeof n.namespaceURI==i||(t=n.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function d(n){var t=n.parentNode;return t.nodeType==1?t:null}function h(n){for(var t=0;n=n.previousSibling;)t++;return t}function g(n){var t;return c(n)?n.length:(t=n.childNodes)?t.length:0}function a(n,t){for(var r=[],i=n;i;i=i.parentNode)r.push(i);for(i=t;i;i=i.parentNode)if(s(r,i))return i;return null}function nt(n,t,i){for(var r=i?t:t.parentNode;r;){if(r===n)return!0;r=r.parentNode}return!1}function f(n,t,i){for(var u,r=i?n:n.parentNode;r;){if(u=r.parentNode,u===t)return r;r=u}return null}function c(n){var t=n.nodeType;return t==3||t==4||t==8}function v(n,t){var i=t.nextSibling,r=t.parentNode;return i?r.insertBefore(n,i):r.appendChild(n),n}function tt(n,t){var i=n.cloneNode(!1);return i.deleteData(0,t),n.deleteData(t,n.length-t),v(i,n),i}function e(n){if(n.nodeType==9)return n;if(typeof n.ownerDocument!=i)return n.ownerDocument;if(typeof n.document!=i)return n.document;if(n.parentNode)return e(n.parentNode);throw new Error("getDocument: no document found for node");}function it(n){var t=e(n);if(typeof t.defaultView!=i)return t.defaultView;if(typeof t.parentWindow!=i)return t.parentWindow;throw new Error("Cannot get a window object for node");}function rt(n){if(typeof n.contentDocument!=i)return n.contentDocument;if(typeof n.contentWindow!=i)return n.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element");}function ut(n){if(typeof n.contentWindow!=i)return n.contentWindow;if(typeof n.contentDocument!=i)return n.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element");}function ft(n){return r.isHostObject(n,"body")?n.body:n.getElementsByTagName("body")[0]}function et(n){for(var t;t=n.parentNode;)n=t;return n}function y(n){if(n)return n.previousSibling?n.previousSibling.nextSibling:n.nextSibling?n.nextSibling.previousSibling:n.parentNode?n.parentNode.firstChild:n}function ot(n,t,i,r){n=y(n),i=y(i);var o,u,s,c,e;if(n==i)return t===r?0:t<r?-1:1;if(o=f(i,n,!0))return t<=h(o)?-1:1;if(o=f(n,i,!0))return h(o)<r?-1:1;if(u=a(n,i),s=n===u?u:f(n,u,!0),c=i===u?u:f(i,u,!0),s===c)throw new Error("comparePoints got to case 4 and childA and childB are the same!");else{for(e=u.firstChild;e;){if(e===s)return-1;if(e===c)return 1;e=e.nextSibling}throw new Error("Should not be here!");}}function st(n){for(var t=e(n).createDocumentFragment(),i;i=n.firstChild;)t.appendChild(i);return t}function p(n){if(!n)return"[No node]";if(c(n))return'"'+n.data+'"';if(n.nodeType==1){var t=n.id?' id="'+n.id+'"':"";return"<"+n.nodeName+t+">["+n.childNodes.length+"]"}return n.nodeName}function w(n){this.root=n,this._next=n}function ht(n){return new w(n)}function b(n,t){this.node=n,this.offset=t}function l(n){this.code=this[n],this.codeName=n,this.message="DOMException: "+this.codeName}var i="undefined",r=n.util,u,o,s;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method"),u=document.createElement("div"),r.areHostMethods(u,["insertBefore","appendChild","cloneNode"]||!r.areHostObjects(u,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),r.isHostProperty(u,"innerHTML")||t.fail("Element is missing innerHTML property"),o=document.createTextNode("test"),r.areHostMethods(o,["splitText","deleteData","insertData","appendData","cloneNode"]||!r.areHostObjects(u,["previousSibling","nextSibling","childNodes","parentNode"])||!r.areHostProperties(o,["data"]))||t.fail("Incomplete Text Node implementation"),s=function(n,t){for(var i=n.length;i--;)if(n[i]===t)return!0;return!1},w.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var n=this._current=this._next,t,i;if(this._current)if(t=n.firstChild,t)this._next=t;else{for(i=null;n!==this.root&&!(i=n.nextSibling);)n=n.parentNode;this._next=i}return this._current},detach:function(){this._current=this._next=this.root=null}},b.prototype={equals:function(n){return this.node===n.node&this.offset==n.offset},inspect:function(){return"[DomPosition("+p(this.node)+":"+this.offset+")]"}},l.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},l.prototype.toString=function(){return this.message},n.dom={arrayContains:s,isHtmlNamespace:k,parentElement:d,getNodeIndex:h,getNodeLength:g,getCommonAncestor:a,isAncestorOf:nt,getClosestAncestorIn:f,isCharacterDataNode:c,insertAfter:v,splitDataNode:tt,getDocument:e,getWindow:it,getIframeWindow:ut,getIframeDocument:rt,getBody:ft,getRootContainer:et,comparePoints:ot,inspectNode:p,fragmentFromNodeChildren:st,createIterator:ht,DomPosition:b},n.DOMException=l}),n.createModule("DomRange",function(n){function c(n,i){return n.nodeType!=3&&(t.isAncestorOf(n,i.startContainer,!0)||t.isAncestorOf(n,i.endContainer,!0))}function r(n){return t.getDocument(n.startContainer)}function ot(n,t,i){var u=n._listeners[t],r,f;if(u)for(r=0,f=u.length;r<f;++r)u[r].call(n,{target:n,args:i})}function st(n){return new et(n.parentNode,t.getNodeIndex(n))}function b(n){return new et(n.parentNode,t.getNodeIndex(n)+1)}function ht(n,i,r){var u=n.nodeType==11?n.firstChild:n;return t.isCharacterDataNode(i)?r==i.length?t.insertAfter(n,i):i.parentNode.insertBefore(n,r==0?i:t.splitDataNode(i,r)):r>=i.childNodes.length?i.appendChild(n):i.insertBefore(n,i.childNodes[r]),u}function ct(n){for(var i,t,e,u=r(n.range).createDocumentFragment();t=n.next();){if(i=n.isPartiallySelectedSubtree(),t=t.cloneNode(!i),i&&(e=n.getSubtreeIterator(),t.appendChild(ct(e)),e.detach(!0)),t.nodeType==10)throw new f("HIERARCHY_REQUEST_ERR");u.appendChild(t)}return u}function y(n,i,r){var e,o,u,f;for(r=r||{stop:!1};u=n.next();)if(n.isPartiallySelectedSubtree()){if(i(u)===!1){r.stop=!0;return}if(f=n.getSubtreeIterator(),y(f,i,r),f.detach(!0),r.stop)return}else for(e=t.createIterator(u);o=e.next();)if(i(o)===!1){r.stop=!0;return}}function lt(n){for(var t;n.next();)n.isPartiallySelectedSubtree()?(t=n.getSubtreeIterator(),lt(t),t.detach(!0)):n.remove()}function at(n){for(var t,u=r(n.range).createDocumentFragment(),i;t=n.next();){if(n.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),i=n.getSubtreeIterator(),t.appendChild(at(i)),i.detach(!0)):n.remove(),t.nodeType==10)throw new f("HIERARCHY_REQUEST_ERR");u.appendChild(t)}return u}function vt(n,t,i){var u=!!(t&&t.length),f,e=!!i,r;return u&&(f=new RegExp("^("+t.join("|")+")$")),r=[],y(new o(n,!1),function(n){(!u||f.test(n.nodeType))&&(!e||i(n))&&r.push(n)}),r}function yt(n){var i=typeof n.getName=="undefined"?"Range":n.getName();return"["+i+"("+t.inspectNode(n.startContainer)+":"+n.startOffset+", "+t.inspectNode(n.endContainer)+":"+n.endOffset+")]"}function o(n,i){if(this.range=n,this.clonePartiallySelectedTextNodes=i,!n.collapsed){this.sc=n.startContainer,this.so=n.startOffset,this.ec=n.endContainer,this.eo=n.endOffset;var r=n.commonAncestorContainer;this.sc===this.ec&&t.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===r&&!t.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:t.getClosestAncestorIn(this.sc,r,!0),this._last=this.ec===r&&!t.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:t.getClosestAncestorIn(this.ec,r,!0))}}function s(n){this.code=this[n],this.codeName=n,this.message="RangeException: "+this.codeName}function pt(n,t,i){this.nodes=vt(n,t,i),this._next=this.nodes[0],this._position=0}function k(n){return function(i,r){for(var f,u=r?i:i.parentNode;u;){if(f=u.nodeType,t.arrayContains(n,f))return u;u=u.parentNode}return null}}function a(n,t){if(vi(n,t))throw new s("INVALID_NODE_TYPE_ERR");}function e(n){if(!n.startContainer)throw new f("INVALID_STATE_ERR");}function v(n,i){if(!t.arrayContains(i,n.nodeType))throw new s("INVALID_NODE_TYPE_ERR");}function g(n,i){if(i<0||i>(t.isCharacterDataNode(n)?n.length:n.childNodes.length))throw new f("INDEX_SIZE_ERR");}function nt(n,t){if(d(n,!0)!==d(t,!0))throw new f("WRONG_DOCUMENT_ERR");}function h(n){if(ai(n,!0))throw new f("NO_MODIFICATION_ALLOWED_ERR");}function p(n,t){if(!n)throw new f(t);}function kt(n){return!t.arrayContains(bt,n.nodeType)&&!d(n,!0)}function dt(n,i){return i<=(t.isCharacterDataNode(n)?n.length:n.childNodes.length)}function i(n){if(e(n),kt(n.startContainer)||kt(n.endContainer)||!dt(n.startContainer,n.startOffset)||!dt(n.endContainer,n.endOffset))throw new Error("Range error: Range is no longer valid after DOM mutation ("+n.inspect()+")");}function ft(){}function ui(n){n.START_TO_START=rt,n.START_TO_END=gt,n.END_TO_END=pi,n.END_TO_START=ni,n.NODE_BEFORE=ti,n.NODE_AFTER=ii,n.NODE_BEFORE_AND_AFTER=ri,n.NODE_INSIDE=ut}function fi(n){ui(n),ui(n.prototype)}function ei(n,r){return function(){var a;i(this);var u=this.startContainer,e=this.startOffset,c=this.commonAncestorContainer,f=new o(this,!0),l,s;return u!==c&&(l=t.getClosestAncestorIn(u,c,!0),s=b(l),u=s.node,e=s.offset),y(f,h),f.reset(),a=n(f),f.detach(),r(this,u,e,u,e),a}}function oi(r,u,f){function s(n,t){return function(i){e(this),v(i,wt),v(l(i),bt);var r=(n?st:b)(i);(t?y:p)(this,r.node,r.offset)}}function y(n,i,r){var f=n.endContainer,e=n.endOffset;(i!==n.startContainer||r!==this.startOffset)&&((l(i)!=l(f)||t.comparePoints(i,r,f,e)==1)&&(f=i,e=r),u(n,i,r,f,e))}function p(n,i,r){var f=n.startContainer,e=n.startOffset;(i!==n.endContainer||r!==this.endOffset)&&((l(i)!=l(f)||t.comparePoints(i,r,f,e)==-1)&&(f=i,e=r),u(n,f,e,i,r))}function w(n,t,i){(t!==n.startContainer||i!==this.startOffset||t!==n.endContainer||i!==this.endOffset)&&u(n,t,i,t,i)}r.prototype=new ft,n.util.extend(r.prototype,{setStart:function(n,t){e(this),a(n,!0),g(n,t),y(this,n,t)},setEnd:function(n,t){e(this),a(n,!0),g(n,t),p(this,n,t)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(n){i(this),n?u(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):u(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(n){e(this),a(n,!0),u(this,n,0,n,t.getNodeLength(n))},selectNode:function(n){e(this),a(n,!1),v(n,wt);var t=st(n),i=b(n);u(this,t.node,t.offset,i.node,i.offset)},extractContents:ei(at,u),deleteContents:ei(lt,u),canSurroundContents:function(){i(this),h(this.startContainer),h(this.endContainer);var n=new o(this,!0),t=n._first&&c(n._first,this)||n._last&&c(n._last,this);return n.detach(),!t},detach:function(){f(this)},splitBoundaries:function(){i(this);var n=this.startContainer,e=this.startOffset,r=this.endContainer,f=this.endOffset,o=n===r;t.isCharacterDataNode(r)&&f>0&&f<r.length&&t.splitDataNode(r,f),t.isCharacterDataNode(n)&&e>0&&e<n.length&&(n=t.splitDataNode(n,e),o?(f-=e,r=n):r==n.parentNode&&f>=t.getNodeIndex(n)&&f++,e=0),u(this,n,e,r,f)},normalizeBoundaries:function(){var o,s;i(this);var f=this.startContainer,e=this.startOffset,n=this.endContainer,r=this.endOffset,h=function(t){var i=t.nextSibling;i&&i.nodeType==t.nodeType&&(n=t,r=t.length,t.appendData(i.data),i.parentNode.removeChild(i))},c=function(i){var u=i.previousSibling,s,o;u&&u.nodeType==i.nodeType&&(f=i,s=i.length,e=u.length,i.insertData(0,u.data),u.parentNode.removeChild(u),f==n?(r+=e,n=f):n==i.parentNode&&(o=t.getNodeIndex(i),r==o?(n=i,r=s):r>o&&r--))},l=!0;t.isCharacterDataNode(n)?n.length==r&&h(n):(r>0&&(o=n.childNodes[r-1],o&&t.isCharacterDataNode(o)&&h(o)),l=!this.collapsed),l?t.isCharacterDataNode(f)?e==0&&c(f):e<f.childNodes.length&&(s=f.childNodes[e],s&&t.isCharacterDataNode(s)&&c(s)):(f=n,e=r),u(this,f,e,n,r)},collapseToPoint:function(n,t){e(this),a(n,!0),g(n,t),w(this,n,t)}}),fi(r)}function si(n){n.collapsed=n.startContainer===n.endContainer&&n.startOffset===n.endOffset,n.commonAncestorContainer=n.collapsed?n.startContainer:t.getCommonAncestor(n.startContainer,n.endContainer)}function hi(n,t,i,r,u){var f=n.startContainer!==t||n.startOffset!==i,e=n.endContainer!==r||n.endOffset!==u;n.startContainer=t,n.startOffset=i,n.endContainer=r,n.endOffset=u,si(n),ot(n,"boundarychange",{startMoved:f,endMoved:e})}function wi(n){e(n),n.startContainer=n.startOffset=n.endContainer=n.endOffset=null,n.collapsed=n.commonAncestorContainer=null,ot(n,"detach",null),n._listeners=null}function u(n){this.startContainer=n,this.startOffset=0,this.endContainer=n,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},si(this)}var tt,w;n.requireModules(["DomUtil"]);var t=n.dom,et=t.DomPosition,f=n.DOMException;o.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var n=this._current=this._next;return n&&(this._next=n!==this._last?n.nextSibling:null,t.isCharacterDataNode(n)&&this.clonePartiallySelectedTextNodes&&(n===this.ec&&(n=n.cloneNode(!0)).deleteData(this.eo,n.length-this.eo),this._current===this.sc&&(n=n.cloneNode(!0)).deleteData(0,this.so))),n},remove:function(){var n=this._current,i,r;t.isCharacterDataNode(n)&&(n===this.sc||n===this.ec)?(i=n===this.sc?this.so:0,r=n===this.ec?this.eo:n.length,i!=r&&n.deleteData(i,r-i)):n.parentNode&&n.parentNode.removeChild(n)},isPartiallySelectedSubtree:function(){var n=this._current;return c(n,this.range)},getSubtreeIterator:function(){var n;if(this.isSingleCharacterDataNode)n=this.range.cloneRange(),n.collapse();else{n=new u(r(this.range));var i=this._current,f=i,e=0,s=i,h=t.getNodeLength(i);t.isAncestorOf(i,this.sc,!0)&&(f=this.sc,e=this.so),t.isAncestorOf(i,this.ec,!0)&&(s=this.ec,h=this.eo),hi(n,f,e,s,h)}return new o(n,this.clonePartiallySelectedTextNodes)},detach:function(n){n&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},s.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},s.prototype.toString=function(){return this.message},pt.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var wt=[1,3,4,5,7,8,10],bt=[2,9,11],ci=[1,3,4,5,7,8,10,11],li=[1,3,4,5,7,8];var l=t.getRootContainer,d=k([9,11]),ai=k([5,6,10,12]),vi=k([6,10,12]);tt=document.createElement("style"),w=!1;try{tt.innerHTML="<b>x<\/b>",w=tt.firstChild.nodeType==3}catch(bi){}n.features.htmlParsingConforms=w;var yi=w?function(n){var r=this.startContainer,u=t.getDocument(r),i;if(!r)throw new f("INVALID_STATE_ERR");return i=null,r.nodeType==1?i=r:t.isCharacterDataNode(r)&&(i=t.parentElement(r)),i=i===null||i.nodeName=="HTML"&&t.isHtmlNamespace(t.getDocument(i).documentElement)&&t.isHtmlNamespace(i)?u.createElement("body"):i.cloneNode(!1),i.innerHTML=n,t.fragmentFromNodeChildren(i)}:function(n){e(this);var u=r(this),i=u.createElement("body");return i.innerHTML=n,t.fragmentFromNodeChildren(i)},it=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],rt=0,gt=1,pi=2,ni=3,ti=0,ii=1,ri=2,ut=3;ft.prototype={attachListener:function(n,t){this._listeners[n].push(t)},compareBoundaryPoints:function(n,r){i(this),nt(this.startContainer,r.startContainer);var u,f,e,o,s=n==ni||n==rt?"start":"end",h=n==gt||n==rt?"start":"end";return u=this[s+"Container"],f=this[s+"Offset"],e=r[h+"Container"],o=r[h+"Offset"],t.comparePoints(u,f,e,o)},insertNode:function(n){if(i(this),v(n,ci),h(this.startContainer),t.isAncestorOf(n,this.startContainer,!0))throw new f("HIERARCHY_REQUEST_ERR");var r=ht(n,this.startContainer,this.startOffset);this.setStartBefore(r)},cloneContents:function(){var n,u,f;return i(this),this.collapsed?r(this).createDocumentFragment():this.startContainer===this.endContainer&&t.isCharacterDataNode(this.startContainer)?(n=this.startContainer.cloneNode(!0),n.data=n.data.slice(this.startOffset,this.endOffset),u=r(this).createDocumentFragment(),u.appendChild(n),u):(f=new o(this,!0),n=ct(f),f.detach(),n)},canSurroundContents:function(){i(this),h(this.startContainer),h(this.endContainer);var n=new o(this,!0),t=n._first&&c(n._first,this)||n._last&&c(n._last,this);return n.detach(),!t},surroundContents:function(n){if(v(n,li),!this.canSurroundContents())throw new s("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(n.hasChildNodes())while(n.lastChild)n.removeChild(n.lastChild);ht(n,this.startContainer,this.startOffset),n.appendChild(t),this.selectNode(n)},cloneRange:function(){i(this);for(var t=new u(r(this)),f=it.length,n;f--;)n=it[f],t[n]=this[n];return t},toString:function(){var n,r,u;return i(this),n=this.startContainer,n===this.endContainer&&t.isCharacterDataNode(n)?n.nodeType==3||n.nodeType==4?n.data.slice(this.startOffset,this.endOffset):"":(r=[],u=new o(this,!0),y(u,function(n){(n.nodeType==3||n.nodeType==4)&&r.push(n.data)}),u.detach(),r.join(""))},compareNode:function(n){var r,u,o,e;if(i(this),r=n.parentNode,u=t.getNodeIndex(n),!r)throw new f("NOT_FOUND_ERR");return o=this.comparePoint(r,u),e=this.comparePoint(r,u+1),o<0?e>0?ri:ti:e>0?ii:ut},comparePoint:function(n,r){return(i(this),p(n,"HIERARCHY_REQUEST_ERR"),nt(n,this.startContainer),t.comparePoints(n,r,this.startContainer,this.startOffset)<0)?-1:t.comparePoints(n,r,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:yi,toHtml:function(){i(this);var n=r(this).createElement("div");return n.appendChild(this.cloneContents()),n.innerHTML},intersectsNode:function(n,u){var f,e,o,s;return(i(this),p(n,"NOT_FOUND_ERR"),t.getDocument(n)!==r(this))?!1:(f=n.parentNode,e=t.getNodeIndex(n),p(f,"NOT_FOUND_ERR"),o=t.comparePoints(f,e,this.endContainer,this.endOffset),s=t.comparePoints(f,e+1,this.startContainer,this.startOffset),u?o<=0&&s>=0:o<0&&s>0)},isPointInRange:function(n,r){return i(this),p(n,"HIERARCHY_REQUEST_ERR"),nt(n,this.startContainer),t.comparePoints(n,r,this.startContainer,this.startOffset)>=0&&t.comparePoints(n,r,this.endContainer,this.endOffset)<=0},intersectsRange:function(n,u){if(i(this),r(n)!=r(this))throw new f("WRONG_DOCUMENT_ERR");var e=t.comparePoints(this.startContainer,this.startOffset,n.endContainer,n.endOffset),o=t.comparePoints(this.endContainer,this.endOffset,n.startContainer,n.startOffset);return u?e<=0&&o>=0:e<0&&o>0},intersection:function(n){if(this.intersectsRange(n)){var r=t.comparePoints(this.startContainer,this.startOffset,n.startContainer,n.startOffset),u=t.comparePoints(this.endContainer,this.endOffset,n.endContainer,n.endOffset),i=this.cloneRange();return r==-1&&i.setStart(n.startContainer,n.startOffset),u==1&&i.setEnd(n.endContainer,n.endOffset),i}return null},union:function(n){if(this.intersectsRange(n,!0)){var i=this.cloneRange();return t.comparePoints(n.startContainer,n.startOffset,this.startContainer,this.startOffset)==-1&&i.setStart(n.startContainer,n.startOffset),t.comparePoints(n.endContainer,n.endOffset,this.endContainer,this.endOffset)==1&&i.setEnd(n.endContainer,n.endOffset),i}throw new s("Ranges do not intersect");},containsNode:function(n,t){return t?this.intersectsNode(n,!1):this.compareNode(n)==ut},containsNodeContents:function(n){return this.comparePoint(n,0)>=0&&this.comparePoint(n,t.getNodeLength(n))<=0},containsRange:function(n){return this.intersection(n).equals(n)},containsNodeText:function(n){var t=this.cloneRange(),i,r,u;return t.selectNode(n),i=t.getNodes([3]),i.length>0?(t.setStart(i[0],0),r=i.pop(),t.setEnd(r,r.length),u=this.containsRange(t),t.detach(),u):this.containsNodeContents(n)},createNodeIterator:function(n,t){return i(this),new pt(this,n,t)},getNodes:function(n,t){return i(this),vt(this,n,t)},getDocument:function(){return r(this)},collapseBefore:function(n){e(this),this.setEndBefore(n),this.collapse(!1)},collapseAfter:function(n){e(this),this.setStartAfter(n),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(n){return u.rangesEqual(this,n)},inspect:function(){return yt(this)}},oi(u,hi,wi),n.rangePrototype=ft.prototype,u.rangeProperties=it,u.RangeIterator=o,u.copyComparisonConstants=fi,u.createPrototypeRange=oi,u.inspect=yt,u.getRangeDocument=r,u.rangesEqual=function(n,t){return n.startContainer===t.startContainer&&n.startOffset===t.startOffset&&n.endContainer===t.endContainer&&n.endOffset===t.endOffset},n.DomRange=u,n.RangeException=s}),n.createModule("WrappedRange",function(n){function s(n){var e=n.parentElement(),i=n.duplicate(),r,f,u;return i.collapse(!0),r=i.parentElement(),i=n.duplicate(),i.collapse(!1),f=i.parentElement(),u=r==f?r:t.getCommonAncestor(r,f),u==e?u:t.getCommonAncestor(e,u)}function h(n){return n.compareEndPoints("StartToEnd",n)==0}function f(n,i,u,f){var s=n.duplicate(),o,e,p,k,a,y,w,c,v,l,d,h,b;if(s.collapse(u),o=s.parentElement(),t.isAncestorOf(i,o,!0)||(o=i),!o.canHaveHTML)return new r(o.parentNode,t.getNodeIndex(o));e=t.getDocument(o).createElement("span"),e.parentNode&&e.parentNode.removeChild(e),k=u?"StartToStart":"StartToEnd";do o.insertBefore(e,e.previousSibling),s.moveToElementText(e);while((p=s.compareEndPoints(k,n))>0&&e.previousSibling);if(c=e.nextSibling,p==-1&&c&&t.isCharacterDataNode(c)){if(s.setEndPoint(u?"EndToStart":"EndToEnd",n),/[\r\n]/.test(c.data))for(l=s.duplicate(),d=l.text.replace(/\r\n/g,"\r").length,v=l.moveStart("character",d);(p=l.compareEndPoints("StartToEnd",l))==-1;)v++,l.moveStart("character",1);else if(h=s.text.replace(/\u00a0/g," "),b=c.data.replace(/\u00a0/g," "),b.indexOf(h)!==0){while(h.length>0&&b.indexOf(h)!==0)h=h.substr(1);v=h.length}else v=s.text.length;w=new r(c,v)}else a=(f||!u)&&e.previousSibling,y=(f||u)&&e.nextSibling,w=y&&t.isCharacterDataNode(y)?new r(y,0):a&&t.isCharacterDataNode(a)?new r(a,a.length):new r(o,t.getNodeIndex(e));return e.parentNode.removeChild(e),w}function e(n,i){var u,f,o=n.offset,h=t.getDocument(n.node),r,s,e=h.body.createTextRange(),c=t.isCharacterDataNode(n.node);c?(u=n.node,f=u.parentNode):(s=n.node.childNodes,u=o<s.length?s[o]:null,f=n.node),r=h.createElement("span"),r.innerHTML="&#feff;",u?f.insertBefore(r,u):f.appendChild(r);try{e.moveToElementText(r),e.collapse(!i)}catch(l){}return f.removeChild(r),c&&e[i?"moveStart":"moveEnd"]("character",o),e}var o;n.requireModules(["DomUtil","DomRange"]);var i,t=n.dom,r=t.DomPosition,u=n.DomRange;!n.features.implementsDomRange||n.features.implementsTextRange&&n.config.preferTextRange?n.features.implementsTextRange&&(i=function(n){this.textRange=n,this.refresh()},i.prototype=new u(document),i.prototype.refresh=function(){var n,t,i=s(this.textRange);h(this.textRange)?t=n=f(this.textRange,i,!0,!0):(n=f(this.textRange,i,!0,!1),t=f(this.textRange,i,!1,!1)),this.setStart(n.node,n.offset),this.setEnd(t.node,t.offset)},u.copyComparisonConstants(i),o=function(){return this}(),typeof o.Range=="undefined"&&(o.Range=i),n.createNativeRange=function(n){return n=n||document,n.body.createTextRange()}):(function(){function o(n){for(var i=c.length,t;i--;)t=c[i],n[t]=n.nativeRange[t]}function a(n,t,i,r,u){var f=n.startContainer!==t||n.startOffset!=i,e=n.endContainer!==r||n.endOffset!=u;(f||e)&&(n.setEnd(r,u),n.setStart(t,i))}function v(n){n.nativeRange.detach(),n.detached=!0;for(var t=c.length,i;t--;)i=c[t],n[i]=null}var r,c=u.rangeProperties,l,h,e,f,s;i=function(n){if(!n)throw new Error("Range must be specified");this.nativeRange=n,o(this)},u.createPrototypeRange(i,a,v),r=i.prototype,r.selectNode=function(n){this.nativeRange.selectNode(n),o(this)},r.deleteContents=function(){this.nativeRange.deleteContents(),o(this)},r.extractContents=function(){var n=this.nativeRange.extractContents();return o(this),n},r.cloneContents=function(){return this.nativeRange.cloneContents()},r.surroundContents=function(n){this.nativeRange.surroundContents(n),o(this)},r.collapse=function(n){this.nativeRange.collapse(n),o(this)},r.cloneRange=function(){return new i(this.nativeRange.cloneRange())},r.refresh=function(){o(this)},r.toString=function(){return this.nativeRange.toString()},e=document.createTextNode("test"),t.getBody(document).appendChild(e),f=document.createRange(),f.setStart(e,0),f.setEnd(e,0);try{f.setStart(e,1),l=!0,r.setStart=function(n,t){this.nativeRange.setStart(n,t),o(this)},r.setEnd=function(n,t){this.nativeRange.setEnd(n,t),o(this)},h=function(n){return function(t){this.nativeRange[n](t),o(this)}}}catch(y){l=!1,r.setStart=function(n,t){try{this.nativeRange.setStart(n,t)}catch(i){this.nativeRange.setEnd(n,t),this.nativeRange.setStart(n,t)}o(this)},r.setEnd=function(n,t){try{this.nativeRange.setEnd(n,t)}catch(i){this.nativeRange.setStart(n,t),this.nativeRange.setEnd(n,t)}o(this)},h=function(n,t){return function(i){try{this.nativeRange[n](i)}catch(r){this.nativeRange[t](i),this.nativeRange[n](i)}o(this)}}}r.setStartBefore=h("setStartBefore","setEndBefore"),r.setStartAfter=h("setStartAfter","setEndAfter"),r.setEndBefore=h("setEndBefore","setStartBefore"),r.setEndAfter=h("setEndAfter","setStartAfter"),f.selectNodeContents(e),r.selectNodeContents=f.startContainer==e&&f.endContainer==e&&f.startOffset==0&&f.endOffset==e.length?function(n){this.nativeRange.selectNodeContents(n),o(this)}:function(n){this.setStart(n,0),this.setEnd(n,u.getEndOffset(n))},f.selectNodeContents(e),f.setEnd(e,3),s=document.createRange(),s.selectNodeContents(e),s.setEnd(e,4),s.setStart(e,2),r.compareBoundaryPoints=f.compareBoundaryPoints(f.START_TO_END,s)==-1&f.compareBoundaryPoints(f.END_TO_START,s)==1?function(n,t){return t=t.nativeRange||t,n==t.START_TO_END?n=t.END_TO_START:n==t.END_TO_START&&(n=t.START_TO_END),this.nativeRange.compareBoundaryPoints(n,t)}:function(n,t){return this.nativeRange.compareBoundaryPoints(n,t.nativeRange||t)},n.util.isHostMethod(f,"createContextualFragment")&&(r.createContextualFragment=function(n){return this.nativeRange.createContextualFragment(n)}),t.getBody(document).removeChild(e),f.detach(),s.detach()}(),n.createNativeRange=function(n){return n=n||document,n.createRange()}),n.features.implementsTextRange&&(i.rangeToTextRange=function(n){if(n.collapsed)return e(new r(n.startContainer,n.startOffset),!0);var u=e(new r(n.startContainer,n.startOffset),!0),f=e(new r(n.endContainer,n.endOffset),!1),i=t.getDocument(n.startContainer).body.createTextRange();return i.setEndPoint("StartToStart",u),i.setEndPoint("EndToEnd",f),i}),i.prototype.getName=function(){return"WrappedRange"},n.WrappedRange=i,n.createRange=function(t){return t=t||document,new i(n.createNativeRange(t))},n.createRangyRange=function(n){return n=n||document,new u(n)},n.createIframeRange=function(i){return n.createRange(t.getIframeDocument(i))},n.createIframeRangyRange=function(i){return n.createRangyRange(t.getIframeDocument(i))},n.addCreateMissingNativeApiListener(function(t){var i=t.document;typeof i.createRange=="undefined"&&(i.createRange=function(){return n.createRange(this)}),i=t=null})}),n.createModule("WrappedSelection",function(n,t){function ri(n){return(n||window).getSelection()}function yt(n){return(n||window).document.selection}function p(n,t,i){var r=i?"end":"start",u=i?"start":"end";n.anchorNode=t[r+"Container"],n.anchorOffset=t[r+"Offset"],n.focusNode=t[u+"Container"],n.focusOffset=t[u+"Offset"]}function ui(n){var t=n.nativeSelection;n.anchorNode=t.anchorNode,n.anchorOffset=t.anchorOffset,n.focusNode=t.focusNode,n.focusOffset=t.focusOffset}function o(n){n.anchorNode=n.focusNode=null,n.anchorOffset=n.focusOffset=0,n.rangeCount=0,n.isCollapsed=!0,n._ranges.length=0}function st(t){var i;return t instanceof s?(i=t._selectionNativeRange,i||(i=n.createNativeRange(r.getDocument(t.startContainer)),i.setEnd(t.endContainer,t.endOffset),i.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=i,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof k?i=t.nativeRange:n.features.implementsDomRange&&t instanceof r.getWindow(t.startContainer).Range&&(i=t),i}function fi(n){if(!n.length||n[0].nodeType!=1)return!1;for(var t=1,i=n.length;t<i;++t)if(!r.isAncestorOf(n[0],n[t]))return!1;return!0}function ht(n){var t=n.getNodes();if(!fi(t))throw new Error("getSingleElementFromRange: range "+n.inspect()+" did not consist of a single element");return t[0]}function kt(n){return!!n&&typeof n.text!="undefined"}function dt(n,t){var i=new k(t);n._ranges=[i],p(n,i,!1),n.rangeCount=1,n.isCollapsed=i.collapsed}function w(t){var i,f,e,u;if(t._ranges.length=0,t.docSelection.type=="None")o(t);else if(i=t.docSelection.createRange(),kt(i))dt(t,i);else{for(t.rangeCount=i.length,e=r.getDocument(i.item(0)),u=0;u<t.rangeCount;++u)f=n.createRange(e),f.selectNode(i.item(u)),t._ranges.push(f);t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed,p(t,t._ranges[t.rangeCount-1],!1)}}function gt(n,t){for(var u=n.docSelection.createRange(),o=ht(t),s=r.getDocument(u.item(0)),f=r.getBody(s).createControlRange(),i=0,e=u.length;i<e;++i)f.add(u.item(i));try{f.add(o)}catch(h){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}f.select(),w(n)}function rt(n,t,i){this.nativeSelection=n,this.docSelection=t,this._ranges=[],this.win=i,this.refresh()}function ni(n,t){for(var e=r.getDocument(t[0].startContainer),u=r.getBody(e).createControlRange(),f,i=0;i<rangeCount;++i){f=ht(t[i]);try{u.add(f)}catch(o){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}u.select(),w(n)}function ti(n,t){if(n.anchorNode&&r.getDocument(n.anchorNode)!==r.getDocument(t))throw new d("WRONG_DOCUMENT_ERR");}function ii(n){var i=[],u=new vt(n.anchorNode,n.anchorOffset),f=new vt(n.focusNode,n.focusOffset),e=typeof n.getName=="function"?n.getName():"Selection",t,r;if(typeof n.rangeCount!="undefined")for(t=0,r=n.rangeCount;t<r;++t)i[t]=s.inspect(n.getRangeAt(t));return"["+e+"(Ranges: "+i.join(", ")+")(anchor: "+u.inspect()+", focus: "+f.inspect()+"]"}var nt,et,tt,ot,e,bt,it,i,ct,ut,lt,b;n.requireModules(["DomUtil","DomRange","WrappedRange"]),n.config.checkSelectionRanges=!0;var at="boolean",ft="_rangySelection",r=n.dom,f=n.util,s=n.DomRange,k=n.WrappedRange,d=n.DOMException,vt=r.DomPosition,l,g,h="Control";var pt=n.util.isHostMethod(window,"getSelection"),a=n.util.isHostObject(document,"selection"),v=a&&(!pt||n.config.preferTextRange);v?(l=yt,n.isSelectionValid=function(n){var t=(n||window).document,i=t.selection;return i.type!="None"||r.getDocument(i.createRange().parentElement())==t}):pt?(l=ri,n.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),n.getNativeSelection=l;var u=l(),wt=n.createNativeRange(document),y=r.getBody(document),c=f.areHostObjects(u,["anchorNode","focusNode"]&&f.areHostProperties(u,["anchorOffset","focusOffset"]));if(n.features.selectionHasAnchorAndFocus=c,nt=f.isHostMethod(u,"extend"),n.features.selectionHasExtend=nt,et=typeof u.rangeCount=="number",n.features.selectionHasRangeCount=et,tt=!1,ot=!0,f.areHostMethods(u,["addRange","getRangeAt","removeAllRanges"])&&typeof u.rangeCount=="number"&&n.features.implementsDomRange&&function(){var u=document.createElement("iframe"),t,f;y.appendChild(u),t=r.getIframeDocument(u),t.open(),t.write("<html><head><\/head><body>12<\/body><\/html>"),t.close();var i=r.getIframeWindow(u).getSelection(),o=t.documentElement,s=o.lastChild,e=s.firstChild,n=t.createRange();n.setStart(e,1),n.collapse(!0),i.addRange(n),ot=i.rangeCount==1,i.removeAllRanges(),f=n.cloneRange(),n.setStart(e,0),f.setEnd(e,2),i.addRange(n),i.addRange(f),tt=i.rangeCount==2,n.detach(),f.detach(),y.removeChild(u)}(),n.features.selectionSupportsMultipleRanges=tt,n.features.collapsedNonEditableSelectionsSupported=ot,e=!1,y&&f.isHostMethod(y,"createControlRange")&&(bt=y.createControlRange(),f.areHostProperties(bt,["item","add"])&&(e=!0)),n.features.implementsControlRange=e,g=c?function(n){return n.anchorNode===n.focusNode&&n.anchorOffset===n.focusOffset}:function(n){return n.rangeCount?n.getRangeAt(n.rangeCount-1).collapsed:!1},f.isHostMethod(u,"getRangeAt")?it=function(n,t){try{return n.getRangeAt(t)}catch(i){return null}}:c&&(it=function(t){var u=r.getDocument(t.anchorNode),i=n.createRange(u);return i.setStart(t.anchorNode,t.anchorOffset),i.setEnd(t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&(i.setStart(t.focusNode,t.focusOffset),i.setEnd(t.anchorNode,t.anchorOffset)),i}),n.getSelection=function(n){n=n||window;var t=n[ft],i=l(n),r=a?yt(n):null;return t?(t.nativeSelection=i,t.docSelection=r,t.refresh(n)):(t=new rt(i,r,n),n[ft]=t),t},n.getIframeSelection=function(t){return n.getSelection(r.getIframeWindow(t))},i=rt.prototype,!v&&c&&f.areHostMethods(u,["removeAllRanges","addRange"]))i.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),o(this)},ct=function(t,i){var u=s.getRangeDocument(i),r=n.createRange(u);r.collapseToPoint(i.endContainer,i.endOffset),t.nativeSelection.addRange(st(r)),t.nativeSelection.extend(i.startContainer,i.startOffset),t.refresh()},i.addRange=et?function(t,i){var u,r;e&&a&&this.docSelection.type==h?gt(this,t):i&&nt?ct(this,t):(tt?u=this.rangeCount:(this.removeAllRanges(),u=0),this.nativeSelection.addRange(st(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==u+1?(n.config.checkSelectionRanges&&(r=it(this.nativeSelection,this.rangeCount-1),r&&!s.rangesEqual(r,t)&&(t=new k(r))),this._ranges[this.rangeCount-1]=t,p(this,t,b(this.nativeSelection)),this.isCollapsed=g(this)):this.refresh())}:function(n,t){t&&nt?ct(this,n):(this.nativeSelection.addRange(st(n)),this.refresh())},i.setRanges=function(n){if(e&&n.length>1)ni(this,n);else{this.removeAllRanges();for(var t=0,i=n.length;t<i;++t)this.addRange(n[t])}};else if(f.isHostMethod(u,"empty")&&f.isHostMethod(wt,"select")&&e&&v)i.removeAllRanges=function(){try{var n=jQuery.browser.msie&&jQuery.browser.version<8&&typeof document.documentMode=="undefined";n||this.docSelection.empty(),this.docSelection.type!="None"&&n&&this.docSelection.empty()}catch(t){}o(this)},i.addRange=function(n){if(this.docSelection.type==h)gt(this,n);else try{k.rangeToTextRange(n).select(),this._ranges[0]=n,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,p(this,n,!1)}catch(t){}},i.setRanges=function(n){this.removeAllRanges();var t=n.length;t>1?ni(this,n):t&&this.addRange(n[0])};else return t.fail("No means of selecting a Range or TextRange was found"),!1;if(i.getRangeAt=function(n){if(n<0||n>=this.rangeCount)throw new d("INDEX_SIZE_ERR");else return this._ranges[n]},v)ut=function(t){var i;n.isSelectionValid(t.win)?i=t.docSelection.createRange():(i=r.getBody(t.win.document).createTextRange(),i.collapse(!0)),t.docSelection.type==h?w(t):kt(i)?dt(t,i):o(t)};else if(f.isHostMethod(u,"getRangeAt")&&typeof u.rangeCount=="number")ut=function(t){if(e&&a&&t.docSelection.type==h)w(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var i=0,r=t.rangeCount;i<r;++i)t._ranges[i]=new n.WrappedRange(t.nativeSelection.getRangeAt(i));p(t,t._ranges[t.rangeCount-1],b(t.nativeSelection)),t.isCollapsed=g(t)}else o(t)};else if(c&&typeof u.isCollapsed==at&&typeof wt.collapsed==at&&n.features.implementsDomRange)ut=function(n){var t,i=n.nativeSelection;i.anchorNode?(t=it(i,0),n._ranges=[t],n.rangeCount=1,ui(n),n.isCollapsed=g(n)):o(n)};else return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;i.refresh=function(n){var i=n?this._ranges.slice(0):null,t;if(ut(this),n){if(t=i.length,t!=this._ranges.length)return!1;while(t--)if(!s.rangesEqual(i[t],this._ranges[t]))return!1;return!0}},lt=function(n,t){var r=n.getAllRanges(),u=!1,i,f;for(n.removeAllRanges(),i=0,f=r.length;i<f;++i)u||t!==r[i]?n.addRange(r[i]):u=!0;n.rangeCount||o(n)},i.removeRange=e?function(n){var t,o;if(this.docSelection.type==h){var i=this.docSelection.createRange(),s=ht(n),c=r.getDocument(i.item(0)),u=r.getBody(c).createControlRange(),f,e=!1;for(t=0,o=i.length;t<o;++t)f=i.item(t),f!==s||e?u.add(i.item(t)):e=!0;u.select(),w(this)}else lt(this,n)}:function(n){lt(this,n)},!v&&c&&n.features.implementsDomRange?(b=function(n){var t=!1;return n.anchorNode&&(t=r.comparePoints(n.anchorNode,n.anchorOffset,n.focusNode,n.focusOffset)==1),t},i.isBackwards=function(){return b(this)}):b=i.isBackwards=function(){return!1},i.toString=function(){for(var t=[],n=0,i=this.rangeCount;n<i;++n)t[n]=""+this._ranges[n];return t.join("")},i.collapse=function(t,i){ti(this,t);var u=n.createRange(r.getDocument(t));u.collapseToPoint(t,i),this.removeAllRanges(),this.addRange(u),this.isCollapsed=!0},i.collapseToStart=function(){if(this.rangeCount){var n=this._ranges[0];this.collapse(n.startContainer,n.startOffset)}else throw new d("INVALID_STATE_ERR");},i.collapseToEnd=function(){if(this.rangeCount){var n=this._ranges[this.rangeCount-1];this.collapse(n.endContainer,n.endOffset)}else throw new d("INVALID_STATE_ERR");},i.selectAllChildren=function(t){ti(this,t);var i=n.createRange(r.getDocument(t));i.selectNodeContents(t),this.removeAllRanges(),this.addRange(i)},i.deleteFromDocument=function(){var n,t,i,r,u;if(e&&a&&this.docSelection.type==h){for(n=this.docSelection.createRange();n.length;)t=n.item(0),n.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){for(i=this.getAllRanges(),this.removeAllRanges(),r=0,u=i.length;r<u;++r)i[r].deleteContents();this.addRange(i[u-1])}},i.getAllRanges=function(){return this._ranges.slice(0)},i.setSingleRange=function(n){this.setRanges([n])},i.containsNode=function(n,t){for(var i=0,r=this._ranges.length;i<r;++i)if(this._ranges[i].containsNode(n,t))return!0;return!1},i.toHtml=function(){var i="",t,n,r;if(this.rangeCount){for(t=s.getRangeDocument(this._ranges[0]).createElement("div"),n=0,r=this._ranges.length;n<r;++n)t.appendChild(this._ranges[n].cloneContents());i=t.innerHTML}return i},i.getName=function(){return"WrappedSelection"},i.inspect=function(){return ii(this)},i.detach=function(){this.win[ft]=null,this.win=this.anchorNode=this.focusNode=null},rt.inspect=ii,n.Selection=rt,n.selectionPrototype=i,n.addCreateMissingNativeApiListener(function(t){typeof t.getSelection=="undefined"&&(t.getSelection=function(){return n.getSelection(this)}),t=null})}),window.rangy=n}(),define("vendor/rangy-core",function(){}),define("aloha/rangy-core",["jquery","vendor/rangy-core"],function(){return window.rangy}),define("util/class",[],function(){var n=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;return this.Class=function(){},Class.extend=function(){function u(){!n&&this._constructor&&this._constructor.apply(this,arguments)}var o=this.prototype,e,f,r,i;for(n=!0,e=new this,n=!1,f=0;f<arguments.length;f++){r=arguments[f];for(i in r)e[i]=typeof r[i]=="function"&&typeof o[i]=="function"&&t.test(r[i])?function(n,t){return function(){var r=this._super,i;return this._super=o[n],i=t.apply(this,arguments),this._super=r,i}}(i,r[i]):r[i]}return u.prototype=e,u.constructor=u,u.extend=arguments.callee,u},this.Class}),window.GENTICS=window.GENTICS||{},window.GENTICS.Utils=window.GENTICS.Utils||{},define("util/lang",[],function(){}),function(n){var i=n.alohaQuery||n.jQuery,r=i,t=n.GENTICS,u=n.Class,f=n.console;t.Utils.applyProperties=function(n,t){var i;for(i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},t.Utils.uniqeString4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},t.Utils.guid=function(){var n=t.Utils.uniqeString4;return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}}(window),define("aloha/ecma5shims",[],function(){function r(n){var t=null;if(n)do t=n;while(null!=(n=n.parentNode));return t}function u(n,t){return(n.contains(t)&&16)+(t.contains(n)&&8)+(n.sourceIndex>=0&&t.sourceIndex>=0?(n.sourceIndex<t.sourceIndex&&4)+(n.sourceIndex>t.sourceIndex&&2):1)}function f(n){return null!=n.sourceIndex?n:n.parentNode.insertBefore(document.createComment(""),n)}var n,t={bind:function(n){var t=this.obj||this,i=Function.prototype.bind,r=Array.prototype.slice.call(arguments,1);return i?i.apply(t,arguments):function(){return t.apply(n,arguments.length===0?r:r.concat(Array.prototype.slice.call(arguments)))}},trim:function(){var n=this.obj||this,t=String.prototype.trim;return t?t.call(n):n.replace(/^\s+/,"").replace(/\s+$/,"")},indexOf:function(n,t){var i=this.obj||this,r=Array.prototype.indexOf,u;if(r)return r.call(i,n,t);for(t===undefined&&(t=0),t<0&&(t+=i.length),t<0&&(t=0),u=i.length;t<u;t++)if(undefined!==i[t]&&i[t]===n)return t;return-1},forEach:function(n,t){var r=this.obj||this,u=Array.prototype.forEach,i,f;if(u)return u.call(r,n,t);for(i=0,f=r.length;i<f;i++)undefined!==r[i]&&n.call(t,r[i],i,r)},map:function(t,i){var u=this.obj||this,o=Array.prototype.map,h=typeof arguments[arguments.length-1]=="boolean"?Array.prototype.pop.call(arguments):!1,f=[],e,r,s;if(o)f=o.call(u,t,i);else{for(e=[],r=0,s=u.length;r<s;r++)undefined!==u[r]&&(e[r]=t.call(i,u[r],r,u));f=e}return h?n(f):f},filter:function(t,i){var u=this.obj||this,o=Array.prototype.filter,c=typeof arguments[arguments.length-1]=="boolean"?Array.prototype.pop.call(arguments):!1,f=[],e,s,r,h;if(o)f=o.call(u,t,i);else{for(e=[],r=0,h=u.length;r<h;r++)undefined!==u[r]&&t.call(i,s=u[r],r,u)&&e.push(s);f=e}return c?n(f):f},every:function(n,t){var r=this.obj||this,u=Array.prototype.every,i,f;if(u)return u.call(r,n,t);for(i=0,f=r.length;i<f;i++)if(undefined!==r[i]&&!n.call(t,r[i],i,r))return!1;return!0},some:function(n,t){var r=this.obj||this,u=Array.prototype.some,i,f;if(u)return u.call(r,n,t);for(i=0,f=r.length;i<f;i++)if(undefined!==r[i]&&n.call(t,r[i],i,r))return!0;return!1},hasAttribute:function(n){var t=this.obj||this,i=t.hasAttribute;return i?t.hasAttribute(n):!!t.getAttribute(n)}},i;n=function(n){var r=function(){},i;return r.prototype=t,i=new r,i.obj=n,i};for(i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n.Node=typeof window.Node!="undefined"?window.Node:{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,DOCUMENT_POSITION_DISCONNECTED:1,DOCUMENT_POSITION_PRECEDING:2,DOCUMENT_POSITION_FOLLOWING:4,DOCUMENT_POSITION_CONTAINS:8,DOCUMENT_POSITION_CONTAINED_BY:16,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC:32},n.compareDocumentPosition=function(n,t){if(document.documentElement.compareDocumentPosition)return n.compareDocumentPosition(t);if(!document.documentElement.contains)throw"neither compareDocumentPosition nor contains is supported by this browser.";if(n==t)return 0;if(r(n)!=r(t))return 1;if(null!=n.sourceIndex&&null!=t.sourceIndex)return u(n,t);if(n==document)return 20;if(t==document)return 10;var i=f(n),e=f(t),o=u(i,e);return n!=i&&i.parentNode.removeChild(i),t!=e&&e.parentNode.removeChild(e),o},n.getComputedStyle=function(n,t){return window.getComputedStyle?window.getComputedStyle(n,t):n.currentStyle?n.currentStyle:null},n}),window.GENTICS=window.GENTICS||{},window.GENTICS.Utils=window.GENTICS.Utils||{},define("util/dom",["jquery","util/class","aloha/ecma5shims"],function(n,t,i){var r=window.GENTICS,u={P:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,LI:!0},f=t.extend({wordRegex:/[\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,nonWordRegex:/[^\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,mergeableTags:["b","code","del","em","i","ins","strong","sub","sup","#text"],nonWordBoundaryTags:["a","b","code","del","em","i","ins","span","strong","sub","sup","#text"],nonEmptyTags:["br"],tags:{flow:["a","abbr","address","area","article","aside","audio","b","bdi","bdo","blockquote","br","button","canvas","cite","code","command","datalist","del","details","dfn","div","dl","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","menu","meter","nav","noscript","object","ol","output","p","pre","progress","q","ruby","s","samp","script","section","select","small","span","strong","style","sub","sup","svg","table","textarea","time","u","ul","var","video","wbr","#text"],phrasing:["a","abbr","area","audio","b","bdi","bdo","br","button","canvas","cite","code","command","datalist","del","dfn","em","embed","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","meter","noscript","object","output","progress","q","ruby","samp","script","select","small","span","strong","sub","sup","svg","textarea","time","u","var","video","wbr","#text"]},children:{a:"phrasing",abbr:"phrasing",address:"flow",area:"empty",article:"flow",aside:"flow",audio:"source",b:"phrasing",base:"empty",bdo:"phrasing",blockquote:"phrasing",body:"flow",br:"empty",button:"phrasing",canvas:"phrasing",caption:"flow",cite:"phrasing",code:"phrasing",col:"empty",colgroup:"col",command:"empty",datalist:["phrasing","option"],dd:"flow",del:"phrasing",div:"flow",details:["summary","flow"],dfn:"flow",dl:["dt","dd"],dt:"phrasing",em:"phrasing",embed:"empty",fieldset:["legend","flow"],figcaption:"flow",figure:["figcaption","flow"],footer:"flow",form:"flow",h1:"phrasing",h2:"phrasing",h3:"phrasing",h4:"phrasing",h5:"phrasing",h6:"phrasing",header:"flow",hgroup:["h1","h2","h3","h4","h5","h6"],hr:"empty",i:"phrasing",iframe:"#text",img:"empty",input:"empty",ins:"phrasing",kbd:"phrasing",keygen:"empty",label:"phrasing",legend:"phrasing",li:"flow",link:"empty",map:"area",mark:"phrasing",menu:["li","flow"],meta:"empty",meter:"phrasing",nav:"flow",noscript:"phrasing",object:"param",ol:"li",optgroup:"option",option:"#text",output:"phrasing",p:"phrasing",param:"empty",pre:"phrasing",progress:"phrasing",q:"phrasing",rp:"phrasing",rt:"phrasing",ruby:["phrasing","rt","rp"],s:"phrasing",samp:"pharsing",script:"#script",section:"flow",select:["option","optgroup"],small:"phrasing",source:"empty",span:"phrasing",strong:"phrasing",style:"phrasing",sub:"phrasing",summary:"phrasing",sup:"phrasing",table:["caption","colgroup","thead","tbody","tfoot","tr"],tbody:"tr",td:"flow",textarea:"#text",tfoot:"tr",th:"phrasing",thead:"tr",time:"phrasing",title:"#text",tr:["th","td"],track:"empty",u:"phrasing",ul:"li","var":"phrasing",video:"source",wbr:"empty"},blockLevelElements:["p","h1","h2","h3","h4","h5","h6","blockquote","div","pre"],listElements:["li","ol","ul"],split:function(t,i,r){var y=n(t.startContainer),h=t.startOffset,p,f,a,c,l,s,e,w,u,b,k,o,d,v,g;if(r&&(y=n(t.endContainer),h=t.endOffset),i.length<1&&(i=n(document.body)),p=!t.isCollapsed()&&!r,a=y.parents().get(),a.unshift(y.get(0)),n.each(a,function(n,t){var r=i.filter(function(){return this==t}).length;if(r)return n>0&&(f=a.slice(0,n)),!1}),!f)return!0;for(f=f.reverse(),e=0,w=f.length;e<w;++e)if(u=f[e],e===w-1)u.nodeType===3?(s=document.createTextNode(u.data.substring(h,u.data.length)),u.data=u.data.substring(0,h)):(b=n(u),k=b.contents(),o=b.clone(!1).empty(),s=o.append(k.slice(h,k.length)).get(0)),p&&t.endContainer===u&&(t.endContainer=s,t.endOffset-=h,t.clearCaches()),l?l.prepend(s):n(u).after(s);else{for(o=n(u).clone(!1).empty(),c?l.prepend(o):c=o,l=o;;){if(d=f[e+1].nextSibling,!d)break;l.append(d)}if(p&&t.endContainer===u){for(t.endContainer=o.get(0),v=f[e+1],g=0;;){if(v=v.previousSibling,!v)break;g++}t.endOffset-=g,t.clearCaches()}}return n(f[0]).after(c),n([f[0],c?c.get(0):s])},allowsNesting:function(t,i){if(!t||!t.nodeName||!i||!i.nodeName)return!1;var r=t.nodeName.toLowerCase(),u=i.nodeName.toLowerCase();return this.children[r]?this.children[r]==u?!0:n.isArray(this.children[r])&&n.inArray(u,this.children[r])>=0?!0:n.isArray(this.tags[this.children[r]])&&n.inArray(u,this.tags[this.children[r]])>=0?!0:!1:!1},addMarkup:function(t,i,r){t.startContainer.nodeType===3&&t.startOffset>0&&t.startOffset<t.startContainer.data.length&&this.split(t,n(t.startContainer).parent(),!1),t.endContainer.nodeType===3&&t.endOffset>0&&t.endOffset<t.endContainer.data.length&&this.split(t,n(t.endContainer).parent(),!0);var u=t.getRangeTree();this.recursiveAddMarkup(u,i,t,r),this.doCleanup({merge:!0,removeempty:!0},t)},recursiveAddMarkup:function(t,i,u,f){for(var o,e=0,s=t.length;e<s;++e)t[e].type=="full"&&this.allowsNesting(i.get(0),t[e].domobj)?(f||t[e].domobj.nodeName!=i.get(0).nodeName)&&(t[e].domobj.nodeType!==3||n.trim(t[e].domobj.data).length!==0)&&(n(t[e].domobj).wrap(i),f||t[e].domobj.nodeType===3||(o=new r.Utils.RangeObject,o.startContainer=o.endContainer=t[e].domobj.parentNode,o.startOffset=0,o.endOffset=o.endContainer.childNodes.length,this.removeMarkup(o,i,n(t[e].domobj.parentNode)))):(f||t[e].domobj&&t[e].domobj.nodeName!==i.get(0).nodeName)&&t[e].children&&t[e].children.length>0&&this.recursiveAddMarkup(t[e].children,i)},findHighestElement:function(n,t,i){t=t.toLowerCase();for(var u,r=n,f=i?function(){return i.filter(function(){return r==this}).length}:function(){return!1};!f()&&r;)r.nodeName.toLowerCase()===t&&(u=r),r=r.parentNode;return u},removeMarkup:function(t,i,r){var e=i.get(0).nodeName,h=this.findHighestElement(t.startContainer,e,r),o=this.findHighestElement(t.endContainer,e,r),u=!1,s,f,c;h&&t.startOffset>0&&(this.split(t,n(h).parent(),!1),u=!0),o&&(t.endContainer.nodeType===3&&t.endOffset<t.endContainer.data.length&&(this.split(t,n(o).parent(),!0),u=!0),t.endContainer.nodeType===1&&t.endOffset<t.endContainer.childNodes.length&&(this.split(t,n(o).parent(),!0),u=!0)),u&&t.correctRange(),s=this.findHighestElement(t.getCommonAncestorContainer(),e,r),f=s?s.parentNode:t.getCommonAncestorContainer(),f&&(c=t.getRangeTree(f),this.recursiveRemoveMarkup(c,i),this.doCleanup({merge:!0,removeempty:!0},t,f))},recursiveRemoveMarkup:function(t,i){for(var u,r=0,f=t.length;r<f;++r)t[r].type=="full"&&t[r].domobj.nodeName==i.get(0).nodeName&&(u=n(t[r].domobj).contents(),u.length>0?u.first().unwrap():n(t[r].domobj).remove()),t[r].children&&this.recursiveRemoveMarkup(t[r].children,i)},doCleanup:function(t,i,u){var o=this,f,e,s,h,c;return typeof t=="undefined"&&(t={}),typeof t.merge=="undefined"&&(t.merge=!1),typeof t.removeempty=="undefined"&&(t.removeempty=!1),typeof u=="undefined"&&i&&(u=i.getCommonAncestorContainer()),f=!1,e=!1,s=n(u),h=i.startOffset,c=i.endOffset,s.contents().each(function(){var u,v,a,l;try{v=this.nodeType,u=o.getIndexInParent(this)}catch(y){return}switch(v){case 1:f&&f.nodeName==this.nodeName?(i.startContainer===s&&h>u&&(i.startOffset-=1,e=!0),i.endContainer===s&&c>u&&(i.endOffset-=1,e=!0),n(f).append(n(this).contents()),e|=o.doCleanup(t,i,f),n(this).remove()):(e|=o.doCleanup(t,i,this),a=!1,t.removeempty&&(r.Utils.Dom.isBlockLevelElement(this)&&this.childNodes.length===0&&(a=!0),n.inArray(this.nodeName.toLowerCase(),o.mergeableTags)>=0&&n(this).text().length===0&&this.childNodes.length===0&&(a=!0)),a?(i.startContainer===this.parentNode&&h>u&&(i.startOffset=i.startOffset-1,e=!0),i.endContainer===this.parentNode&&c>u&&(i.endOffset=i.endOffset-1,e=!0),n(this).remove()):f=(t.mergeable?t.mergeable(this):n.inArray(this.nodeName.toLowerCase(),o.mergeableTags)>=0)?this:!1);break;case 3:if(f&&f.nodeType===3&&t.merge)i.startContainer===this?(i.startContainer=f,i.startOffset+=f.nodeValue.length,e=!0):i.startContainer===f.parentNode&&i.startOffset===o.getIndexInParent(f)+1&&(i.startContainer=f,i.startOffset=f.nodeValue.length,e=!0),i.endContainer===this?(i.endContainer=f,i.endOffset+=f.nodeValue.length,e=!0):i.endContainer===f.parentNode&&i.endOffset===o.getIndexInParent(f)+1&&(i.endContainer=f,i.endOffset=f.nodeValue.length,e=!0),f.data+=this.data;else if(!(this.nodeValue===""&&t.removeempty)){f=this;break}if(i.startContainer===this.parentNode&&i.startOffset>u&&(i.startOffset=i.startOffset-1,e=!0),i.endContainer===this.parentNode&&i.endOffset>u&&(i.endOffset=i.endOffset-1,e=!0),n(this).remove(),f&&(!f.nextSibling||f.nextSibling.nodeType!==3))for(l=f.data.length-1;l>=0&&f.data.length>1;l--)f.data.charAt(l)==="​"&&(f.deleteData(l,1),i.startContainer===f&&i.startOffset>l&&(i.startOffset--,e=!0),i.endContainer===f&&i.endOffset>l&&(i.endOffset--,e=!0))}}),e&&i.clearCaches(),e},getIndexInParent:function(n){if(!n)return!1;for(var i=0,t=n.previousSibling;t;)i++,t=t.previousSibling;return i},isBlockLevelElement:function(t){return t?t.nodeType===1&&n.inArray(t.nodeName.toLowerCase(),this.blockLevelElements)>=0?!0:!1:!1},isLineBreakElement:function(n){return n?n.nodeType===1&&n.nodeName.toLowerCase()=="br":!1},isListElement:function(t){return t?t.nodeType===1&&n.inArray(t.nodeName.toLowerCase(),this.listElements)>=0:!1},isSplitObject:function(n){return n.nodeType===1&&u.hasOwnProperty(n.nodeName)},searchAdjacentTextNode:function(t,i,r,u){if(!t||t.nodeType!==1||i<0||i>t.childNodes.length)return!1;typeof u=="undefined"&&(u={blocklevel:!0,list:!0,linebreak:!0}),typeof u.blocklevel=="undefined"&&(u.blocklevel=!0),typeof u.list=="undefined"&&(u.list=!0),typeof u.linebreak=="undefined"&&(u.linebreak=!0),typeof r=="undefined"&&(r=!0);var f,e=t;for(r&&i>0&&(f=t.childNodes[i-1]),!r&&i<t.childNodes.length&&(f=t.childNodes[i]);e;){if(f){if(f.nodeType===3&&n.trim(f.data).length>0)return f}else{if(u.blocklevel&&this.isBlockLevelElement(e)||u.list&&this.isListElement(e))return!1;f=r?e.previousSibling:e.nextSibling,e=e.parentNode;continue}if(u.blocklevel&&this.isBlockLevelElement(f)||u.linebreak&&this.isLineBreakElement(f)||u.list&&this.isListElement(f))return!1;f.nodeType===3?f=r?f.previousSibling:f.nextSibling:(e=f,f=r?f.lastChild:f.firstChild)}},insertIntoDOM:function(t,i,r,u,f){var l=i.getContainerParents(r,u),a=this,e,o,s,h,c;return(r||(r=n(document.body)),l.length===0?e=r.get(0):n.each(l,function(n,i){if(a.allowsNesting(i,t.get(0)))return e=i,!1}),typeof e=="undefined"&&r.length>0&&(e=r.get(0)),!this.allowsNesting(e,t.get(0))&&!f)?!1:typeof e!="undefined"?(h=this.split(i,n(e),u),h===!0)?(o=i.startContainer,s=i.startOffset,u&&(o=i.endContainer,s=i.endOffset),s===0)?(c=n(o).contents(),c.length>0?c.eq(0).before(t):n(o).append(t),!0):(n(o).contents().eq(s-1).after(t),!0):h?(h.eq(0).after(t),!0):!1:!1},removeFromDOM:function(t,i,r){if(r){var f=this.getIndexInParent(t),e=n(t).contents().length,u=t.parentNode;i.startContainer==u&&i.startOffset>f?i.startOffset+=e-1:i.startContainer==t&&(i.startContainer=u,i.startOffset=f+i.startOffset),i.endContainer==u&&i.endOffset>f?i.endOffset+=e-1:i.endContainer==t&&(i.endContainer=u,i.endOffset=f+i.endOffset),n(t).contents().unwrap(),this.doCleanup({merge:!0},i,u)}},removeRange:function(t){if(!t||t.isCollapsed())return!1;t.startContainer.nodeType==3&&t.startOffset>0&&t.startOffset<t.startContainer.data.length&&this.split(t,n(t.startContainer).parent(),!1),t.endContainer.nodeType==3&&t.endOffset>0&&t.endOffset<t.endContainer.data.length&&this.split(t,n(t.endContainer).parent(),!0);var i=t.getRangeTree();t.endContainer=t.startContainer,t.endOffset=t.startOffset,this.recursiveRemoveRange(i,t),this.doCleanup({merge:!0},t),t.clearCaches()},recursiveRemoveRange:function(t,i){for(var r=0;r<t.length;++r)t[r].type=="full"?(n(i.startContainer).parents().andSelf().filter(t[r].domobj).length>0&&(i.startContainer=i.endContainer=t[r].domobj.parentNode,i.startOffset=i.endOffset=this.getIndexInParent(t[r].domobj)),n(t[r].domobj).remove()):t[r].type=="partial"&&t[r].children&&this.recursiveRemoveRange(t[r].children,i)},extendToWord:function(n,t){var i=this.searchWordBoundary(n.startContainer,n.startOffset,!0),r=this.searchWordBoundary(n.endContainer,n.endOffset,!1);if(!t){if(n.startContainer==i.container&&n.startOffset==i.offset)return;if(n.endContainer==r.container&&n.endOffset==r.offset)return}n.startContainer=i.container,n.startOffset=i.offset,n.endContainer=r.container,n.endOffset=r.offset,n.correctRange(),n.clearCaches()},isWordBoundaryElement:function(t){return!t||!t.nodeName?!1:n.inArray(t.nodeName.toLowerCase(),this.nonWordBoundaryTags)==-1},searchWordBoundary:function(n,t,i){typeof i=="undefined"&&(i=!0);for(var u=!1,r,f,e;!u;)if(n.nodeType===3)if(i){for(r=n.data.substring(0,t).search(this.nonWordRegex),f=r;f!=-1;)r=f,f=n.data.substring(r+1,t).search(this.nonWordRegex),f!=-1&&(f=f+r+1);r!=-1?(t=r+1,u=!0):(t=this.getIndexInParent(n),n=n.parentNode)}else r=n.data.substring(t).search(this.nonWordRegex),r!=-1?(t=t+r,u=!0):(t=this.getIndexInParent(n)+1,n=n.parentNode);else n.nodeType===1&&(i?t>0?this.isWordBoundaryElement(n.childNodes[t-1])?u=!0:(n=n.childNodes[t-1],t=n.nodeType===3?n.data.length:n.childNodes.length):this.isWordBoundaryElement(n)?u=!0:(t=this.getIndexInParent(n),n=n.parentNode):t<n.childNodes.length?this.isWordBoundaryElement(n.childNodes[t])?u=!0:(n=n.childNodes[t],t=0):this.isWordBoundaryElement(n)?u=!0:(t=this.getIndexInParent(n)+1,n=n.parentNode));return n.nodeType!==3&&(e=this.searchAdjacentTextNode(n,t,!i),e&&(n=e,t=i?0:n.data.length)),{container:n,offset:t}},isEmpty:function(t){if(!t)return!0;if(n.inArray(t.nodeName.toLowerCase(),this.nonEmptyTags)!=-1)return!1;if(t.nodeType===3)return t.data.search(/\S/)==-1;for(var i=0,r=t.childNodes.length;i<r;++i)if(!this.isEmpty(t.childNodes[i]))return!1;return!0},setCursorAfter:function(n){var t=new r.Utils.RangeObject,f=this.getIndexInParent(n),i,u;return n.nodeType==3?(i=n,u=i.nodeValue.length):n.nextSibling&&n.nextSibling.nodeType==3?(i=n.nextSibling,u=0):(i=n.parentNode,u=this.getIndexInParent(n)+1),t.startContainer=t.endContainer=i,t.startOffset=t.endOffset=u,t.select(),t},selectDomNode:function(n){var t=new r.Utils.RangeObject;t.startContainer=t.endContainer=n.parentNode,t.startOffset=this.getIndexInParent(n),t.endOffset=t.startOffset+1,t.select()},setCursorInto:function(n){var t=new r.Utils.RangeObject;t.startContainer=t.endContainer=n,t.startOffset=t.endOffset=0,t.select()},isEditingHost:function(n){return n&&n.nodeType==1&&(n.contentEditable=="true"||n.parentNode&&n.parentNode.nodeType==9&&n.parentNode.designMode=="on")},isEditable:function(n){return n&&!this.isEditingHost(n)&&(n.nodeType!=1||n.contentEditable!="false")&&(this.isEditingHost(n.parentNode)||this.isEditable(n.parentNode))},getEditingHostOf:function(n){if(this.isEditingHost(n))return n;if(this.isEditable(n)){for(var t=n.parentNode;!this.isEditingHost(t);)t=t.parentNode;return t}return null},inSameEditingHost:function(n,t){return this.getEditingHostOf(n)&&this.getEditingHostOf(n)==this.getEditingHostOf(t)},isBlockNode:function(n){return n&&(n.nodeType==i.Node.ELEMENT_NODE&&i(["inline","inline-block","inline-table","none"]).indexOf(i.getComputedStyle(n).display)==-1||n.nodeType==i.Node.DOCUMENT_NODE||n.nodeType==i.Node.DOCUMENT_FRAGMENT_NODE)},getFirstVisibleChild:function(t,r){var u,f;if(!t||t.nodeType==i.Node.TEXT_NODE&&this.isEmpty(t)||t.nodeType==i.Node.ELEMENT_NODE&&t.offsetHeight==0&&n.inArray(t.nodeName.toLowerCase(),this.nonEmptyTags)===-1)return null;if(t.nodeType==i.Node.TEXT_NODE||t.nodeType==i.Node.ELEMENT_NODE&&t.childNodes.length==0||!n(t).contentEditable())return r?t:null;for(u=0;u<t.childNodes.length;++u)if(f=this.getFirstVisibleChild(t.childNodes[u],!0),f!=null)return f;return null},getLastVisibleChild:function(t,r){var u,f;if(!t||t.nodeType==i.Node.TEXT_NODE&&this.isEmpty(t)||t.nodeType==i.Node.ELEMENT_NODE&&t.offsetHeight==0&&n.inArray(t.nodeName.toLowerCase(),this.nonEmptyTags)===-1)return null;if(t.nodeType==i.Node.TEXT_NODE||t.nodeType==i.Node.ELEMENT_NODE&&t.childNodes.length==0||!n(t).contentEditable())return r?t:null;for(u=t.childNodes.length-1;u>=0;--u)if(f=this.getLastVisibleChild(t.childNodes[u],!0),f!=null)return f;return null}});return r.Utils.Dom=new f,r.Utils.Dom}),define("aloha/pluginmanager",["jquery","util/class"],function(n,t){function r(n,t){var i;for(i in t)t.hasOwnProperty(i)&&n[i]&&(n[i].settings=t[i]||{})}function u(n,t){for(var u=[],r,i=0;i<t.length;i++)r=n[t[i]],r&&u.push(r);return u}function f(n,t){for(var e=n.length,f=function(){0==--e&&t&&t()},u,i,r=0;r<n.length;r++)i=n[r],i.settings=i.settings||{},typeof i.settings.enabled=="undefined"&&(i.settings.enabled=!0),i.settings.enabled&&i.checkDependencies()&&(u=i.init(),u&&typeof u.done=="function"?u.done(f):f())}var i=window.Aloha;return new(t.extend({plugins:{},init:function(n,t){var s=this,e=s.plugins,o;if(r(e,i&&i.settings&&i.settings.plugins),e&&0===t.length){t=[];for(o in e)e.hasOwnProperty(o)&&t.push(o)}f(u(e,t),n)},register:function(n){if(!n.name)throw new Error("Plugin does not have an name.");if(this.plugins[n.name])throw new Error('Already registered the plugin "'+n.name+'"!');this.plugins[n.name]=n},makeClean:function(n){var t;for(t in this.plugins)this.plugins.hasOwnProperty(t)&&(i.Log.isDebugEnabled()&&i.Log.debug(this,"Passing contents of HTML Element with id { "+n.attr("id")+" } for cleaning to plugin { "+t+" }"),this.plugins[t].makeClean(n))},toString:function(){return"pluginmanager"}}))}),define("aloha/core",["jquery","aloha/pluginmanager"],function(n,t){function r(){var t=n.browser,i=t.version;return!(t.mozilla&&parseFloat(i)<1.9||t.msie&&i<7||t.opera&&i<11)}function u(t){var i=n(t.target);return i.is(".aloha-dialog")||0<i.closest(".aloha-dialog").length}function f(){n("html").mousedown(function(n){!i.activeEditable||i.eventHandled||u(n)||i.deactivateEditable()}).mouseup(function(){i.eventHandled=!1})}function e(t,u){var e,o;if(!r()){e=window.console,e&&(o=e.error?"error":e.log?"log":null,o);return}n.browser.webkit?n("html").addClass("aloha-webkit"):n.browser.opera?n("html").addClass("aloha-opera"):n.browser.msie?n("html").addClass("aloha-ie"+parseInt(n.browser.version,10)):n.browser.mozilla&&n("html").addClass("aloha-mozilla"),navigator.appVersion.indexOf("Win")!==-1?i.OSName="Win":navigator.appVersion.indexOf("Mac")!==-1?i.OSName="Mac":navigator.appVersion.indexOf("X11")!==-1?i.OSName="Unix":navigator.appVersion.indexOf("Linux")!==-1&&(i.OSName="Linux"),f(),i.settings.base=i.getAlohaUrl(),i.Log.init(),i.settings.errorhandling&&(window.onerror=function(n,t,r){return i.Log.error(i,"Error message: "+n+"\nURL: "+t+"\nLine Number: "+r),!0}),t(),u()}function o(n,t){i.RepositoryManager.init(),n(),t()}function s(n,r){var f,e,u;if(0===i.loadedPlugins.length){f=t.plugins;for(e in f)f.hasOwnProperty(e)&&i.loadedPlugins.push(e)}u=!1,t.init(function(){u||(n(),u=!0),r()},i.loadedPlugins),u||(n(),u=!0)}function h(n,t){for(var r=0;r<i.editables.length;r++)i.editables[r].ready||i.editables[r].init();n(),t()}var i=window.Aloha,c=[{fn:null,event:null,deferred:null},{fn:e,event:null,deferred:null},{fn:o,event:null,deferred:null},{fn:s,event:"aloha-plugins-loaded",deferred:null},{fn:h,event:null,deferred:null},{fn:null,event:"aloha-ready",deferred:null}];return n.extend(!0,i,{version:"0.23.1-commercial",editables:[],activeEditable:null,settings:{},defaults:{},ui:{},OSName:"Unknown",loadedPlugins:[],_pluginBaseUrlByName:{},init:function(){i.initialize(c)},getLoadedPlugins:function(){return this.loadedPlugins},isPluginLoaded:function(t){var i=!1;return n.each(this.loadedPlugins,function(n,r){if(t===r.toString())return i=!0,!1}),i},activateEditable:function(n){for(var r=i.editables,t=0;t<r.length;t++)r[t]!==n&&r[t].isActive&&r[t].blur();i.activeEditable=n},getActiveEditable:function(){return i.activeEditable},deactivateEditable:function(){i.activeEditable&&(i.activeEditable.blur(),i.activeEditable=null)},getEditableById:function(t){var u=n("#"+t),r;for(u.length&&"textarea"===u[0].nodeName.toLowerCase()&&(t=t+"-aloha"),r=0;r<i.editables.length;r++)if(i.editables[r].getId()===t)return i.editables[r];return null},isEditable:function(n){for(var t=0,r=i.editables.length;t<r;t++)if(i.editables[t].originalObj.get(0)===n)return!0;return!1},getEditableHost:function(){var n=function(n){for(var t=0;t<i.editables.length;t++)if(i.editables[t].originalObj[0]===n)return i.editables[t];return null};return function(t){if(!t||0===t.length)return null;var i=n(t[0]);return i||t.parents().each(function(t,r){return i=n(r),i?!1:void 0}),i}}(),log:function(n,t,r){typeof i.Log!="undefined"&&i.Log.log(n,t,r)},registerEditable:function(n){i.editables.push(n)},unregisterEditable:function(t){var r=n.inArray(t,i.editables);r!==-1&&i.editables.splice(r,1)},isModified:function(){for(var n=0;n<i.editables.length;n++)if(i.editables[n].isModified&&i.editables[n].isModified())return!0;return!1},getAlohaUrl:function(){return i.settings.baseUrl||""},getPluginUrl:function(n){if(!n)return null;var t=i.settings._pluginBaseUrlByName[n];return t&&(t.match("^(/|http[s]?:).*")||(t=i.getAlohaUrl()+"/"+t)),t},disableObjectResizing:function(){try{var n;try{n=document.queryCommandSupported("enableObjectResizing")}catch(r){n=!1,i.Log.log("enableObjectResizing is not supported.")}n&&(document.execCommand("enableObjectResizing",!1,!1),i.Log.log("enableObjectResizing disabled."))}catch(t){i.Log.error(t,"Could not disable enableObjectResizing")}},toString:function(){return"Aloha"}}),i}),define("aloha/console",["aloha/core","util/class","jquery"],function(n,t){var i=t.extend({init:function(){typeof n.settings.logLevels!="undefined"&&n.settings.logLevels||(n.settings.logLevels={error:!0,warn:!0}),typeof n.settings.logHistory!="undefined"&&n.settings.logHistory||(n.settings.logHistory={}),n.settings.logHistory.maxEntries||(n.settings.logHistory.maxEntries=100),n.settings.logHistory.highWaterMark||(n.settings.logHistory.highWaterMark=90),n.settings.logHistory.levels||(n.settings.logHistory.levels={error:!0,warn:!0}),this.flushLogHistory(),n.trigger("aloha-logger-ready")},logHistory:[],highWaterMarkReached:!1,log:function(t,i,r){if((typeof i=="undefined"&&(r=t),typeof i!="string"&&i&&i.toString&&(i=i.toString()),typeof r=="undefined"&&(r=i,i=undefined),typeof t!="undefined"&&t||(t="log"),t=t.toLowerCase(),typeof n.settings.logLevels!="undefined")&&n.settings.logLevels[t]){i=i||"Unkown Aloha Component",this.addToLogHistory({level:t,component:i,message:r,date:new Date});var u=window.console;switch(t){case"error":window.console&&u.error&&(i||r?u.error(i+": "+r):u.error("Error occured without message and component"));break;case"warn":window.console&&u.warn&&u.warn(i+": "+r);break;case"info":window.console&&u.info&&u.info(i+": "+r);break;case"debug":window.console&&u.log&&u.log(i+" ["+t+"]: "+r);break;default:window.console&&u.log&&u.log(i+" ["+t+"]: "+r)}}},error:function(n,t){this.log("error",n,t)},warn:function(n,t){this.log("warn",n,t)},info:function(n,t){this.log("info",n,t)},debug:function(n,t){this.log("debug",n,t)},deprecated:function(t,i){if(this.log("warn",t,i),n.settings.logLevels.deprecated)throw new Error(i);},isLogLevelEnabled:function(t){return n.settings&&n.settings.logLevels&&n.settings.logLevels[t]},isErrorEnabled:function(){return this.isLogLevelEnabled("error")},isWarnEnabled:function(){return this.isLogLevelEnabled("warn")},isInfoEnabled:function(){return this.isLogLevelEnabled("info")},isDebugEnabled:function(){return this.isLogLevelEnabled("debug")},addToLogHistory:function(t){if(n.settings.logHistory||this.init(),!(n.settings.logHistory.maxEntries<=0)&&n.settings.logHistory.levels[t.level])for(this.logHistory.push(t),this.highWaterMarkReached||this.logHistory.length>=n.settings.logHistory.maxEntries*n.settings.logHistory.highWaterMark/100&&(n.trigger("aloha-log-full"),this.highWaterMarkReached=!0);this.logHistory.length>n.settings.logHistory.maxEntries;)this.logHistory.shift()},getLogHistory:function(){return this.logHistory},flushLogHistory:function(){this.logHistory=[],this.highWaterMarkReached=!1}});return i=new i,n.Log=n.Console=i,i}),window.GENTICS=window.GENTICS||{},window.GENTICS.Utils=window.GENTICS.Utils||{},define("util/range",["jquery","util/dom","util/class","aloha/console","aloha/rangy-core"],function(n,t,i,r,u){function e(n,t){for(var r=[],i=1===n.nodeType?n:n.parentNode;;){if(!i||i===t||9===i.nodeType)break;1===i.nodeType&&r.push(i),i=i.parentNode}return r}var f=window.GENTICS,o=window.Aloha;return f.Utils.RangeObject=i.extend({_constructor:function(n){typeof n=="object"?(typeof n.startContainer!="undefined"&&(this.startContainer=n.startContainer),typeof n.startOffset!="undefined"&&(this.startOffset=n.startOffset),typeof n.endContainer!="undefined"&&(this.endContainer=n.endContainer),typeof n.endOffset!="undefined"&&(this.endOffset=n.endOffset)):n===!0&&this.initializeFromUserSelection()},startContainer:undefined,startOffset:undefined,endContainer:undefined,endOffset:undefined,deleteContents:function(){t.removeRange(this)},log:function(n){r.deprecated("Utils.RangeObject",'log() is deprecated. use console.log() from module "aloha/console" instead: '+n)},isCollapsed:function(){return!this.endContainer||this.startContainer===this.endContainer&&this.startOffset===this.endOffset},getCommonAncestorContainer:function(){return this.commonAncestorContainer?this.commonAncestorContainer:(this.updateCommonAncestorContainer(),this.commonAncestorContainer)},getContainerParents:function(t,i){var r=i?this.endContainer:this.startContainer;return r?n(e(r,t?t[0]:null)):!1},getStartContainerParents:function(n){return this.getContainerParents(n,!1)},getEndContainerParents:function(n){return this.getContainerParents(n,!0)},updateCommonAncestorContainer:function(n){if(n)this.commonAncestorContainer=n;else{var i=this.getStartContainerParents(),u=this.getEndContainerParents(),t;if(!(i.length>0&&u.length>0))return r.warn("aloha/range","could not find commonAncestorContainer"),!1;for(t=0;t<i.length;t++)if(u.index(i[t])!=-1){this.commonAncestorContainer=i[t];break}}return r.debug(n?"commonAncestorContainer was set successfully":"commonAncestorContainer was calculated successfully"),!0},getCollapsedIERange:function(n,t){var i=document.body.createTextRange(),u,e,f,r;return r=this.searchElementToLeft(n,t),r.element?(u=document.body.createTextRange(),u.moveToElementText(r.element),i.setEndPoint("StartToEnd",u),r.characters!==0?i.moveStart("character",r.characters):(i.moveStart("character",1),i.moveStart("character",-1))):(e=this.searchElementToRight(n,t),f=n.nodeType==3?n.parentNode:n,u=document.body.createTextRange(),u.moveToElementText(f),i.setEndPoint("StartToStart",u),r.characters!==0&&i.moveStart("character",r.characters)),i.collapse(),i},select:function(){var n,t;if(typeof this.startContainer=="undefined"||typeof this.endContainer=="undefined")return r.warn("can not select an empty range"),!1;n=u.createRange(),n.setStart(this.startContainer,this.startOffset),n.setEnd(this.endContainer,this.endOffset),t=u.getSelection(),t.setSingleRange(n)},searchElementToLeft:function(n,t){var i,r=0;for(n.nodeType===3?(r=t,i=n.previousSibling):t>0&&(i=n.childNodes[t-1]);i&&i.nodeType===3;)r+=i.data.length,i=i.previousSibling;return{element:i,characters:r}},searchElementToRight:function(n,t){var i,r=0;for(n.nodeType===3?(r=n.data.length-t,i=n.nextSibling):t<n.childNodes.length&&(i=n.childNodes[t]);i&&i.nodeType===3;)r+=i.data.length,i=i.nextSibling;return{element:i,characters:r}},update:function(n){r.debug("now updating rangeObject"),this.initializeFromUserSelection(n),this.updateCommonAncestorContainer()},initializeFromUserSelection:function(){var t=u.getSelection(),n;if(!t||!t.rangeCount||(n=t.getRangeAt(0),!n))return!1;this.startContainer=n.startContainer,this.endContainer=n.endContainer,this.startOffset=n.startOffset,this.endOffset=n.endOffset,this.correctRange();return},correctRange:function(){var t,r,i,e,u;if(this.clearCaches(),this.isCollapsed()){if(this.startContainer.nodeType===1){if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset-1],this.startOffset=this.startContainer.data.length,this.endContainer=this.startContainer,this.endOffset=this.startOffset;return}if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType===1){if(t=f.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,!0),t){this.startContainer=this.endContainer=t,this.startOffset=this.endOffset=t.data.length;return}if(t=f.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,!1),t){this.startContainer=this.endContainer=t,this.startOffset=this.endOffset=0;return}}if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset],this.startOffset=0,this.endContainer=this.startContainer,this.endOffset=0;return}}this.startContainer.nodeType===3&&this.startOffset===0&&(t=f.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,f.Utils.Dom.getIndexInParent(this.startContainer),!0),t&&n(t).closest(o.activeEditable.obj).length>0&&(this.startContainer=this.endContainer=t,this.startOffset=this.endOffset=t.data.length))}else{if(this.startContainer.nodeType===1)if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===3)this.startContainer=this.startContainer.childNodes[this.startOffset],this.startOffset=0;else if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===1){for(r=!1,i=this.startContainer.childNodes[this.startOffset];r===!1&&i.childNodes&&i.childNodes.length>0;)i=i.childNodes[0],i.nodeType===3&&(r=i);r!==!1&&(this.startContainer=r,this.startOffset=0)}if(this.startContainer.nodeType===3&&this.startOffset===this.startContainer.data.length&&(t=f.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,f.Utils.Dom.getIndexInParent(this.startContainer)+1,!1),t&&(this.startContainer=t,this.startOffset=0)),this.endContainer.nodeType===3&&this.endOffset===0)if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType===3)this.endContainer=this.endContainer.previousSibling,this.endOffset=this.endContainer.data.length;else if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType===1&&this.endContainer.parentNode){for(e=this.endContainer.parentNode,u=0;u<e.childNodes.length;++u)if(e.childNodes[u]==this.endContainer){this.endOffset=u;break}this.endContainer=e}if(this.endContainer.nodeType==1&&this.endOffset===0&&this.endContainer.previousSibling&&(this.endContainer.previousSibling.nodeType===3?(this.endContainer=this.endContainer.previousSibling,this.endOffset=this.endContainer.data.length):this.endContainer.previousSibling.nodeType===1&&this.endContainer.previousSibling.childNodes&&this.endContainer.previousSibling.childNodes.length>0&&(this.endContainer=this.endContainer.previousSibling,this.endOffset=this.endContainer.childNodes.length)),this.endContainer.nodeType==1)if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType===3)this.endContainer=this.endContainer.childNodes[this.endOffset-1],this.endOffset=this.endContainer.data.length;else if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType===1){for(r=!1,i=this.endContainer.childNodes[this.endOffset-1];r===!1&&i.childNodes&&i.childNodes.length>0;)i=i.childNodes[i.childNodes.length-1],i.nodeType===3&&(r=i);r!==!1&&(this.endContainer=r,this.endOffset=this.endContainer.data.length)}}},clearCaches:function(){this.commonAncestorContainer=undefined},getRangeTree:function(n){return typeof n=="undefined"&&(n=this.getCommonAncestorContainer()),this.inselection=!1,this.recursiveGetRangeTree(n)},recursiveGetRangeTree:function(t){var e=n(t),r=0,i=this,u=[];return e.contents().each(function(n){var e="none",o=!1,h=!1,c=!1,l=!1,a=!1,v=!1,s;if(i.isCollapsed()&&t===i.startContainer&&i.startOffset===n&&(u[r]=new f.Utils.RangeTree,u[r].type="collapsed",u[r].domobj=undefined,i.inselection=!1,c=!0,r++),!i.inselection&&!c)switch(this.nodeType){case 3:this===i.startContainer&&(i.inselection=!0,e=i.startOffset>0?"partial":"full",o=i.startOffset,h=this.length);break;case 1:this===i.startContainer&&i.startOffset===0&&(i.inselection=!0,e="full"),t===i.startContainer&&i.startOffset===n&&(i.inselection=!0,e="full")}if(i.inselection&&!c){e=="none"&&(e="full");switch(this.nodeType){case 3:this===i.endContainer&&(i.inselection=!1,i.endOffset<this.length&&(e="partial"),o===!1&&(o=0),h=i.endOffset);break;case 1:this===i.endContainer&&i.endOffset===0&&(i.inselection=!1)}t===i.endContainer&&i.endOffset<=n&&(i.inselection=!1,e="none")}if(u[r]=new f.Utils.RangeTree,u[r].domobj=this,u[r].type=e,e=="partial"&&(u[r].startOffset=o,u[r].endOffset=h),u[r].children=i.recursiveGetRangeTree(this),u[r].children.length>0){for(s=0;s<u[r].children.length;++s)switch(u[r].children[s].type){case"none":l=!0;break;case"full":v=!0;break;case"partial":a=!0}a||v&&l?u[r].type="partial":!v||a||l||(u[r].type="full")}r++}),this.isCollapsed()&&t===this.startContainer&&this.startOffset==t.childNodes.length&&(u[r]=new f.Utils.RangeTree,u[r].type="collapsed",u[r].domobj=undefined),u},findMarkup:function(n,t,i){var f=i?this.endContainer:this.startContainer,u,r,o;if(t=t?t[0]:null,f){for(u=e(f,t),r=0,o=u.length;r<o;r++)if(n.apply(u[r]))return u[r];return!1}},getText:function(){return this.isCollapsed()?"":this.recursiveGetText(this.getRangeTree())},recursiveGetText:function(t){if(!t)return"";var r=this,i="";return n.each(t,function(){this.type=="full"?i+=n(this.domobj).text():this.type=="partial"&&this.domobj.nodeType===3?i+=n(this.domobj).text().substring(this.startOffset,this.endOffset):this.type=="partial"&&this.domobj.nodeType===1&&this.children&&(i+=r.recursiveGetText(this.children))}),i}}),f.Utils.RangeTree=i.extend({domobj:{},type:null,children:[]}),f.Utils.RangeObject}),define("util/arrays",[],function(){function r(n,t){var i;if(t)for(n.sort(t),i=1;i<n.length;i++)0===t(n[i],n[i-1])&&n.splice(i--,1);else for(n.sort(),i=1;i<n.length;i++)n[i]==n[i-1]&&n.splice(i--,1);return n}function u(n,t,i){var r,u=n.length;if(u!==t.length)return!1;if(i){for(r=0;r<u;r++)if(!i(n[r],t[r]))return!1}else for(r=0;r<u;r++)if(n[r]!==t[r])return!1;return!0}function f(n,t){for(var u=[],i=0,r=n.length;i<r;i++)u.push(t(n[i]));return u}function e(n,t){return n.map(t)}function n(n,t){for(var r,f=[],i=0,u=n.length;i<u;i++)r=n[i],t(r)&&f.push(r);return f}function t(n,t){for(var i=0,r=n.length;i<r;i++)if(t===n[i])return i;return-1}function o(n,t,i){for(var r=0,u=n.length;r<u;r++)t=i(t,n[r]);return t}function i(n,i){return-1!==t(n,i)}function s(n,t){return n==null?null:t(n)}function h(n,t){for(var i=0,r=n.length;i<r;i++)t(n[i],i,n)}function c(t,r){return n(t,function(n){return i(r,n)})}return{filter:n,indexOf:t,reduce:o,forEach:h,map:Array.prototype.map?e:f,contains:i,equal:u,applyNotNull:s,sortUnique:r,intersect:c}}),define("util/strings",["jquery"],function(){function t(t){var i=t.split(n);return i.length&&i[0]===""&&i.shift(),i.length&&i[i.length-1]===""&&i.pop(),i}function i(n){return n.replace(/[\-]([a-z])/gi,function(n,t){return t.toUpperCase()})}function r(n){return n.replace(/[A-Z]/g,function(n){return"-"+n.toLowerCase()})}function u(n,t){for(var u=[],i=0,r;null!=(r=t.exec(n));)i<r.index&&(u.push(n.substring(i,r.index)),i=r.index),i+=r[0].length,u.push(r[0]);return i<n.length&&u.push(n.substring(i,n.length)),u}var n=/\s+/;return{words:t,dashesToCamelCase:i,camelCaseToDashes:r,splitIncl:u}}),define("PubSub",[],function(){function r(i){return n[i]&&t[n[i].channel]}function u(i,r){if(!t[i])return 0;r?typeof r!="object"&&(r={data:r}):r={},r.channel=i;for(var f=t[i].slice(),u=0;u<f.length;++u)n[f[u]].callback(r);return u}var t={},n={},i=0;return{sub:function(r,u){if(typeof u!="function")return-1;var f=t[r];return f||(f=t[r]=[]),f.push(++i),n[i]={channel:r,callback:u},i},unsub:function(t){var i,u;if(-1===t||!n[t])return!1;for(i=r(t),delete n[t],u=i.length;u;)if(i[--u]===t)return i.splice(u,1),!0;return!1},pub:function(n,t){for(var r=n.split("."),o=r.length,f="",e=0,i=0;i<o;++i)f+=(0===i?"":".")+r[i],e+=u(f,t);return e}}}),define("util/maps",[],function(){function n(n){var t;for(t in n)if(n.hasOwnProperty(t))return!1;return!0}function t(n,t,i){for(var r=t.length;r--;)n[t[r]]=i;return n}function i(n,t){for(var r=t.length,i;r--;)i=t[r],n[i[0]]=i[1];return n}function r(n){var i=[],t;for(t in n)n.hasOwnProperty(t)&&i.push(t);return i}return{isEmpty:n,fillTuples:i,fillKeys:t,keys:r}}),define("aloha/engine",["aloha/core","aloha/ecma5shims","util/maps","jquery"],function(n,t,i,r){function y(n,t){var i=n.hasAttribute;return i?n.hasAttribute(t):typeof n.attributes[t]!="undefined"}function fi(n){return n===null||!n||n===kf}function b(n,i){return typeof i=="string"&&(i=[i]),typeof i=="object"&&(i=t(i).map(function(n){return n.toUpperCase()})),n&&n.nodeType==1&&fi(n.namespaceURI)&&(typeof i=="undefined"||t(i).indexOf(n.tagName)!=-1)}function ri(n){return n&&n.nodeType==1&&fi(n.namespaceURI)}function f(n,t){return n&&n.nodeType==1&&fi(n.namespaceURI)&&t.toUpperCase()===n.nodeName}function df(n,t){var i,r;for(t=t.toUpperCase(),i=0,r=n.length;i<r;i++)if(n[i].toUpperCase()===t)return!0;return!1}function h(n,t){return n&&n.nodeType==1&&fi(n.namespaceURI)&&df(t,n.nodeName)}function ku(n,t){return n&&n.nodeType==1&&fi(n.namespaceURI)&&t[n.nodeName]}function pi(n){var t,i=0;if(!n||!n.style)return 0;if(typeof n.style.length!="undefined")return n.style.length;for(t in n.style)n.style[t]&&n.style[t]!==0&&n.style[t]!=="false"&&i++;return i}function wt(n){if(!n)return null;for(var i=[],r=n.length,t=r>>>0;t--;)i[t]=n[t];return i}function ct(n){while(n&&!n.nextSibling)n=n.parentNode;return n?n.nextSibling:null}function bt(n){return n.hasChildNodes()?n.firstChild:ct(n)}function su(n){if(n.previousSibling){for(n=n.previousSibling;n.hasChildNodes();)n=n.lastChild;return n}return n.parentNode&&n.parentNode.nodeType==t.Node.ELEMENT_NODE?n.parentNode:null}function wr(n,i){return n&&i&&Boolean(t.compareDocumentPosition(n,i)&t.Node.DOCUMENT_POSITION_CONTAINED_BY)}function gf(n,t){return(n||t)&&(n==t||wr(n,t))}function wi(n,i){return i&&n&&Boolean(t.compareDocumentPosition(i,n)&t.Node.DOCUMENT_POSITION_CONTAINED_BY)}function ur(n,i){return Boolean(t.compareDocumentPosition(n,i)&t.Node.DOCUMENT_POSITION_FOLLOWING)}function kt(n){for(var t=[];n.parentNode;)t.unshift(n.parentNode),n=n.parentNode;return t}function ei(n){for(var t=[],i=ct(n);null!=(n=bt(n))&&n!=i;)t.push(n);return t}function du(n){return{"xx-small":1,small:2,medium:3,large:4,"x-large":5,"xx-large":6,"xxx-large":7}[n]}function hu(n){return n.dir=="ltr"?"ltr":n.dir=="rtl"?"rtl":ri(n.parentNode)?hu(n.parentNode):"ltr"}function s(n){for(var t=0;n.previousSibling;)t++,n=n.previousSibling;return t}function c(n){switch(n.nodeType){case t.Node.PROCESSING_INSTRUCTION_NODE:case t.Node.DOCUMENT_TYPE_NODE:return 0;case t.Node.TEXT_NODE:case t.Node.COMMENT_NODE:return n.length;default:return n.childNodes.length}}function fr(n,i,r,u){var e,o,f;if(n==r){if(i==u)return"equal";if(i<u)return"before";if(i>u)return"after"}if(e=t.compareDocumentPosition(r,n),e&t.Node.DOCUMENT_POSITION_FOLLOWING){if(o=fr(r,u,n,i),o=="before")return"after";if(o=="after")return"before"}if(e&t.Node.DOCUMENT_POSITION_CONTAINS){for(f=r;f.parentNode!=n;)f=f.parentNode;if(s(f)<i)return"after"}return"before"}function gu(n){for(var t=n;t.parentNode!=null;)t=t.parentNode;return t}function br(n,t){var r=fr(n,0,t.startContainer,t.startOffset),i;return r!=="after"?!1:(i=fr(n,c(n),t.endContainer,t.endOffset),i!=="before")?!1:gu(n)==gu(t.startContainer)}function dt(n,t){var i,r,u;for(typeof t=="undefined"&&(t=function(){return!0}),i=n.startContainer,i=i.hasChildNodes()&&n.startOffset<i.childNodes.length?i.childNodes[n.startOffset]:n.startOffset==c(i)?ct(i):bt(i),r=n.endContainer,r=r.hasChildNodes()&&n.endOffset<r.childNodes.length?r.childNodes[n.endOffset]:ct(r),u=[];ur(i,r);){if(br(i,n)&&t(i)){u.push(i),i=ct(i);continue}i=bt(i)}return u}function rt(n,t){var i,r,u;for(typeof t=="undefined"&&(t=function(){return!0}),i=n.startContainer,i=i.hasChildNodes()&&n.startOffset<i.childNodes.length?i.childNodes[n.startOffset]:n.startOffset==c(i)?ct(i):bt(i),r=n.endContainer,r=r.hasChildNodes()&&n.endOffset<r.childNodes.length?r.childNodes[n.endOffset]:ct(r),u=[];ur(i,r);)br(i,n)&&t(i)&&u.push(i),i=bt(i);return u}function li(n){var i,r;return n.toLowerCase()=="currentcolor"?null:(i=document.createElement("span"),document.body.appendChild(i),i.style.color="black",r=document.createElement("span"),i.appendChild(r),r.style.color=n,n=t.getComputedStyle(r).color,n=="rgb(0, 0, 0)"&&(i.color="white",n=t.getComputedStyle(r).color,n!="rgb(0, 0, 0)"))?null:(document.body.removeChild(i),/^rgba\([0-9]+, [0-9]+, [0-9]+, 1\)$/.test(n))?n.replace("rgba","rgb").replace(", 1)",")"):n=="transparent"?"rgba(0, 0, 0, 0)":n}function er(n){if(n=n.toLowerCase(),t(["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]).indexOf(n)!=-1)return n;n=li(n);var i=/^rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)$/.exec(n);return i?"#"+parseInt(i[1],10).toString(16).replace(/^.$/,"0$&")+parseInt(i[2],10).toString(16).replace(/^.$/,"0$&")+parseInt(i[3],10).toString(16).replace(/^.$/,"0$&"):/^#[abcdef0123456789]+$/i.exec(n)?n:null}function tf(n){var r,i;return n=t(n).trim(),/^[\-+]?[0-9]+(\.[0-9]+)?([eE][\-+]?[0-9]+)?$/.test(n)&&(n[0]=="+"?(n=n.slice(1),r="relative-plus"):n[0]=="-"?(n=n.slice(1),r="relative-minus"):r="absolute",i=parseInt(n,10),r=="relative-plus"&&(i+=3),r=="relative-minus"&&(i=3-i),i<1&&(i=1),i>7&&(i=7),n={1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[i]),n}function rf(n){var i,f,u,e,o,s;if(n=tf(n),r.inArray(n,["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"])==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc|px)$/.test(n))return null;for(i=document.createElement("font"),document.body.appendChild(i),n=="xxx-large"?i.size=7:i.style.fontSize=n,f=parseInt(t.getComputedStyle(i).fontSize,10),document.body.removeChild(i),u=1;u<7;){if(i=document.createElement("font"),i.size=u,document.body.appendChild(i),e=parseInt(t.getComputedStyle(i).fontSize,10),i.size=1+u,o=parseInt(t.getComputedStyle(i).fontSize,10),document.body.removeChild(i),s=(o+e)/2,f<s)return String(u);u++}return"7"}function sr(n,t,i,r){var u;or==0&&typeof i!="undefined"?st=i:or==0&&(st=null,st=i),or++;try{u=r()}catch(f){or--,typeof console!="undefined"&&console.log(f)}return or--,u}function gr(n,t){return n=n.toLowerCase(),sr(n,"action",t,function(n){return function(){return r.inArray(n,["copy","cut","paste","selectall","stylewithcss","usecss"])!=-1||t!==null}}(n))}function uf(n){var t=new window.GENTICS.Utils.RangeObject;t.startContainer=n.startContainer,t.startOffset=n.startOffset,t.endContainer=n.endContainer,t.endOffset=n.endOffset,t.select()}function nu(n,t,i,r){var e=n.toLowerCase(),u=t,f=i;return(arguments.length==1||arguments.length>=4&&typeof u=="undefined")&&(u=!1),(arguments.length<=2||arguments.length>=4&&typeof f=="undefined")&&(f=""),sr(e,"action",r,function(n,t,i){return function(){return gr(n)?(o[n].action(i,r),uf(r),!0):!1}}(e,u,f))}function ne(n,t){return n=n.toLowerCase(),sr(n,"indeterm",t,function(n){return function(){return gr(n,t)?o[n].indeterm(t):!1}}(n))}function si(n,t){return n=n.toLowerCase(),sr(n,"state",t,function(n){return function(){return gr(n,t)?typeof bi(n,t)!="undefined"?bi(n,t):o[n].state(t):!1}}(n))}function te(n){return n=n.toLowerCase(),o.hasOwnProperty(n)}function ff(n,t){return n=n.toLowerCase(),sr(n,"value",t,function(){return!o.hasOwnProperty(n)||!o[n].hasOwnProperty("value")?"":n=="fontsize"&&lt("fontsize",t)!==undefined?rf(lt("fontsize",t)):typeof lt(n,t)!="undefined"?lt(n,t):o[n].value(t)})}function hr(n){return ku(n,l)}function nt(n){return n&&(n.nodeType==t.Node.ELEMENT_NODE&&!ie[t.getComputedStyle(n).display]||n.nodeType==t.Node.DOCUMENT_NODE||n.nodeType==t.Node.DOCUMENT_FRAGMENT_NODE)}function a(n){return n&&!nt(n)}function ut(n){return n&&n.nodeType==t.Node.ELEMENT_NODE&&(n.contentEditable=="true"||n.parentNode&&n.parentNode.nodeType==t.Node.DOCUMENT_NODE&&n.parentNode.designMode=="on")}function u(n){return n&&!ut(n)&&(n.nodeType!=t.Node.ELEMENT_NODE||n.contentEditable!="false"||r(n).hasClass("aloha-table-wrapper"))&&(ut(n.parentNode)||u(n.parentNode))}function ef(n){for(var t=0;t<n.childNodes.length;t++)if(u(n.childNodes[t])||ef(n.childNodes[t]))return!0;return!1}function tu(n){if(ut(n))return n;if(u(n)){for(var t=n.parentNode;!ut(t);)t=t.parentNode;return t}return null}function k(n,t){return tu(n)&&tu(n)==tu(t)}function lu(n){var i,u,e,o,s;if(!f(n,"br"))return!1;for(i=n.parentNode;t.getComputedStyle(i).display=="inline";)i=i.parentNode;if(u={height:i.style.height,maxHeight:i.style.maxHeight,minHeight:i.style.minHeight},i.style.height="auto",i.style.maxHeight="none",r.browser.msie&&r.browser.version<8||(i.style.minHeight="0"),e=document.createTextNode("​"),o=i.offsetHeight,o==0)throw"isCollapsedLineBreak: original height is zero, bug?";return n.parentNode.insertBefore(e,n.nextSibling),s=i.offsetHeight,e.parentNode.removeChild(e),i.style.height=u.height,i.style.maxHeight=u.maxHeight,r.browser.msie&&r.browser.version<8||(i.style.minHeight=u.minHeight),o<s-5}function ki(n){var i,u,e,o,s;if(!f(n,"br")||f(n.parentNode,"li")&&n.parentNode.childNodes.length==1)return!1;for(i=n.parentNode;t.getComputedStyle(i).display=="inline";)i=i.parentNode;if(u={height:i.style.height,maxHeight:i.style.maxHeight,minHeight:i.style.minHeight,contentEditable:i.contentEditable},i.style.height="auto",i.style.maxHeight="none",i.style.minHeight="0",r.browser.msie&&r.browser.version<=7&&(i.contentEditable="false"),e=i.offsetHeight,e==0)throw"isExtraneousLineBreak: original height is zero, bug?";return o=n.style.display,n.style.display="none",s=i.offsetHeight,i.style.height=u.height,i.style.maxHeight=u.maxHeight,i.style.minHeight=u.minHeight,r.browser.msie&&r.browser.version<=7&&(i.contentEditable=u.contentEditable),n.style.display=o,e==s}function ai(n){return n&&n.nodeType==t.Node.TEXT_NODE&&(n.data==""||/^[\t\n\r ]+$/.test(n.data)&&n.parentNode&&n.parentNode.nodeType==t.Node.ELEMENT_NODE&&r.inArray(t.getComputedStyle(n.parentNode).whiteSpace,["normal","nowrap"])!=-1||/^[\t\r ]+$/.test(n.data)&&n.parentNode&&n.parentNode.nodeType==t.Node.ELEMENT_NODE&&t.getComputedStyle(n.parentNode).whiteSpace=="pre-line"||/^[\t\n\r ]+$/.test(n.data)&&n.parentNode&&n.parentNode.nodeType==t.Node.DOCUMENT_FRAGMENT_NODE)}function re(n){var r,i,u;if(!ai(n))return!1;if(n.data==""||(r=n.parentNode,!r)||t(kt(n)).some(function(n){return n.nodeType==t.Node.ELEMENT_NODE&&t.getComputedStyle(n).display=="none"}))return!0;while(!nt(r)&&r.parentNode)r=r.parentNode;for(i=n;i!=r;){if(i=su(i),nt(i)||f(i,"br"))return!0;if(i.nodeType==t.Node.TEXT_NODE&&!ai(i)||f(i,"img"))break}for(i=n,u=ct(r);i!=u;){if(i=bt(i),nt(i)||f(i,"br"))return!0;if(i&&i.nodeType==t.Node.TEXT_NODE&&!ai(i)||f(i,"img"))break}return!1}function w(n){var i;if(!n||t(kt(n).concat(n)).filter(function(n){return n.nodeType==t.Node.ELEMENT_NODE},!0).some(function(n){return t.getComputedStyle(n).display=="none"}))return!1;if(nt(n)||n.nodeType==t.Node.TEXT_NODE&&!re(n)||f(n,"img")||f(n,"br")&&!ki(n))return!0;for(i=0;i<n.childNodes.length;i++)if(w(n.childNodes[i]))return!0;return!1}function ht(n){return n&&!w(n)}function di(n){var i,r;if(lu(n)&&!ki(n))return!0;if(!a(n)||n.nodeType!=t.Node.ELEMENT_NODE)return!1;for(r=!1,i=0;i<n.childNodes.length;i++){if(!ht(n.childNodes[i])&&!di(n.childNodes[i]))return!1;di(n.childNodes[i])&&(r=!0)}return r}function e(){var i;if(st)i=st;else if(n.getSelection().rangeCount)i=n.getSelection().getRangeAt(0);else return null;if(r.inArray(i.startContainer.nodeType,[t.Node.TEXT_NODE,t.Node.ELEMENT_NODE])==-1||r.inArray(i.endContainer.nodeType,[t.Node.TEXT_NODE,t.Node.ELEMENT_NODE])==-1||!i.startContainer.ownerDocument||!i.endContainer.ownerDocument||!wi(i.startContainer,i.startContainer.ownerDocument)||!wi(i.endContainer,i.endContainer.ownerDocument))throw"Invalid active range; test bug?";return i}function tt(i,r,u,f){var e,h;u==-1&&(u=r.childNodes.length);for(var a=i.parentNode,c=s(i),l=[f],o=0;o<n.getSelection().rangeCount;o++)l.push(n.getSelection().getRangeAt(o));if(e=[],t(l).forEach(function(n){e.push([n.startContainer,n.startOffset]),e.push([n.endContainer,n.endOffset])}),t(e).forEach(function(n){n[0]==r&&n[1]>u&&n[1]++,n[0]==a&&(n[1]==c||n[1]==c+1)&&(n[0]=r,n[1]+=u-c),n[0]==a&&n[1]>c+1&&n[1]--}),r.childNodes.length==u?r.appendChild(i):r.insertBefore(i,r.childNodes[u]),h=null,e[0][1]>e[0][0].childNodes.length&&e[1][1]>e[1][0].childNodes.length)f.setStart(i,0),f.setEnd(i,0);else{for(f.setStart(e[0][0],e[0][1]),f.setEnd(e[1][0],e[1][1]),n.getSelection().removeAllRanges(),o=1;o<l.length;o++)h=n.createRange(),h.setStart(e[2*o][0],e[2*o][1]),h.setEnd(e[2*o+1][0],e[2*o+1][1]),n.getSelection().addRange(h);h&&(f=h)}}function au(n,t){var f,u,i;for(r.browser.msie&&r.browser.version>=7&&typeof n.attributes[r.expando]!="undefined"&&r(n).removeAttr(r.expando),f=n.attributes,u=0;u<f.length;u++)i=f[u],(typeof i.specified=="undefined"||i.specified)&&(typeof t.setAttributeNS=="function"?t.setAttributeNS(i.namespaceURI,i.name,i.value):t.setAttribute(i.name,i.value))}function gt(n,t,i){if(f(n,t)||!n.parentNode)return n;var r=n.ownerDocument.createElement(t);for(n.parentNode.insertBefore(r,n),au(n,r);n.childNodes.length;)tt(n.firstChild,r,r.childNodes.length,i);return n.parentNode.removeChild(n),i.startContainer===n&&(i.startContainer=r),i.endContainer===n&&(i.endContainer=r),r}function vu(n){var t=n.previousSibling;if(t){while(t.hasChildNodes())t=t.lastChild;while(ht(t)&&!ki(t)&&t!=n.parentNode)t=su(t);u(t)&&ki(t)&&t.parentNode.removeChild(t)}}function yu(n){for(var t=n;t.hasChildNodes();)t=t.lastChild;while(ht(t)&&!ki(t)&&t!=n)t=su(t);u(t)&&ki(t)&&t.parentNode.removeChild(t)}function ue(n){vu(n),yu(n)}function yt(n,t,i,r){var o,e,y;if((typeof t=="undefined"&&(t=function(){return!1}),typeof i=="undefined"&&(i=function(){return null}),!n.length||!u(n[0]))||(a(n[n.length-1])&&!f(n[n.length-1],"br")&&f(n[n.length-1].nextSibling,"br")&&n.push(n[n.length-1].nextSibling),e=u(n[0].previousSibling)&&t(n[0].previousSibling)?n[0].previousSibling:u(n[n.length-1].nextSibling)&&t(n[n.length-1].nextSibling)?n[n.length-1].nextSibling:i(),!e))return null;if(!e.parentNode){n[0].parentNode.insertBefore(e,n[0]);var h=r.startContainer,c=r.startOffset,l=r.endContainer,v=r.endOffset;h==e.parentNode&&c>=s(e)&&r.setStart(h,c+1),l==e.parentNode&&v>=s(e)&&r.setEnd(l,v+1),st&&st!==r&&(h=st.startContainer,c=st.startOffset,l=st.endContainer,v=st.endOffset,h==e.parentNode&&c>=s(e)&&st.setStart(h,c+1),l==e.parentNode&&v>=s(e)&&st.setEnd(l,v+1))}if(y=n[0].parentNode,ur(e,n[0]))for(!a(e)&&a(e.lastChild)&&a(n[0])&&!f(e.lastChild,"BR")&&e.appendChild(e.ownerDocument.createElement("br")),o=0;o<n.length;o++)tt(n[o],e,-1,r);else for(!a(e)&&a(e.firstChild)&&a(n[n.length-1])&&!f(n[n.length-1],"BR")&&e.insertBefore(e.ownerDocument.createElement("br"),e.firstChild),o=n.length-1;o>=0;o--)tt(n[o],e,0,r);if(u(y)&&!y.hasChildNodes()&&y.parentNode.removeChild(y),u(e.nextSibling)&&t(e.nextSibling)){for(!a(e)&&a(e.lastChild)&&a(e.nextSibling.firstChild)&&!f(e.lastChild,"BR")&&e.appendChild(e.ownerDocument.createElement("br"));e.nextSibling.hasChildNodes();)tt(e.nextSibling.firstChild,e,-1,r);e.parentNode.removeChild(e.nextSibling)}return ue(e),e}function he(n){return ku(n,fe)}function d(n,i){var u,e,o;if((ee[i]||h(i,["colgroup","table","tbody","tfoot","thead","tr"]))&&typeof n=="object"&&n.nodeType==t.Node.TEXT_NODE&&!/^[ \t\n\f\r]*$/.test(n.data)||(oe[i]||h(i,["script","style","plaintext","xmp"]))&&(typeof n!="object"||n.nodeType!=t.Node.TEXT_NODE)||typeof n=="object"&&(n.nodeType==t.Node.DOCUMENT_NODE||n.nodeType==t.Node.DOCUMENT_FRAGMENT_NODE||n.nodeType==t.Node.DOCUMENT_TYPE_NODE))return!1;if(ri(n)&&(n=n.tagName.toLowerCase()),typeof n!="string")return!0;if(ri(i)){for(u=i;u;){if(n=="a"&&f(u,"a")||l[n.toUpperCase()]&&he(u)||/^h[1-6]$/.test(n)&&ri(u)&&/^H[1-6]$/.test(u.tagName))return!1;u=u.parentNode}i=i.tagName.toLowerCase()}if(typeof i=="object"&&(i.nodeType==t.Node.ELEMENT_NODE||i.nodeType==t.Node.DOCUMENT_FRAGMENT_NODE))return!0;if(typeof i!="string")return!1;switch(i){case"colgroup":return n=="col";case"table":return r.inArray(n,["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"])!=-1;case"tbody":case"thead":case"tfoot":return r.inArray(n,["td","th","tr"])!=-1;case"tr":return r.inArray(n,["td","th"])!=-1;case"dl":return r.inArray(n,["dt","dd"])!=-1;case"dir":case"ol":case"ul":return r.inArray(n,["dir","li","ol","ul"])!=-1;case"hgroup":return/^h[1-6]$/.test(n)}return r.inArray(n,["body","caption","col","colgroup","frame","frameset","head","html","tbody","td","tfoot","th","thead","tr"])!=-1?!1:r.inArray(n,["dd","dt"])!=-1&&i!="dl"?!1:n=="li"&&i!="ol"&&i!="ul"?!1:(e=se[i.toUpperCase()],e&&(o=e[n.toUpperCase()],o))?!1:!0}function cr(n,i){return i.collapsed?!1:br(n,i)?!0:n==i.startContainer&&n.nodeType==t.Node.TEXT_NODE&&c(n)!=i.startOffset?!0:n==i.endContainer&&n.nodeType==t.Node.TEXT_NODE&&i.endOffset!=0?!0:n.hasChildNodes()&&t(n.childNodes).every(function(n){return cr(n,i)})&&(!wi(i.startContainer,n)||i.startContainer.nodeType!=t.Node.TEXT_NODE||i.startOffset==0)&&(!wi(i.endContainer,n)||i.endContainer.nodeType!=t.Node.TEXT_NODE||i.endOffset==c(i.endContainer))?!0:!1}function it(n,t){var i,u,r;for(typeof t=="undefined"&&(t=function(){return!0}),i=n.startContainer;cr(i.parentNode,n);)i=i.parentNode;for(u=ct(n.endContainer),r=[];ur(i,u);)cr(i,n)&&t(i)&&r.push(i),i=bt(i);return r}function hf(n){if(!ri(n))return!1;if(r.inArray(n.tagName,["B","EM","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"])!=-1&&(n.attributes.length==0||n.attributes.length==1&&y(n,"style")))return!0;if(n.tagName=="FONT"||n.tagName=="A"){var t=n.attributes.length;if(y(n,"style")&&t--,n.tagName=="FONT"&&(y(n,"color")&&t--,y(n,"face")&&t--,y(n,"size")&&t--),n.tagName=="A"&&y(n,"href")&&t--,t==0)return!0}return!1}function iu(n){return ri(n)?r.inArray(n.tagName,["A","B","EM","FONT","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"])==-1?!1:n.attributes.length==0?!0:n.attributes.length>1?!1:y(n,"style")&&pi(n)==0?!0:n.tagName=="A"&&y(n,"href")?!0:n.tagName=="FONT"&&(y(n,"color")||y(n,"face")||y(n,"size"))?!0:(n.tagName=="B"||n.tagName=="STRONG")&&y(n,"style")&&pi(n)==1&&n.style.fontWeight!=""?!0:(n.tagName=="I"||n.tagName=="EM")&&y(n,"style")&&pi(n)==1&&n.style.fontStyle!=""?!0:(n.tagName=="A"||n.tagName=="FONT"||n.tagName=="SPAN")&&y(n,"style")&&pi(n)==1&&n.style.textDecoration==""?!0:r.inArray(n.tagName,["A","FONT","S","SPAN","STRIKE","U"])!=-1&&y(n,"style")&&pi(n)==1&&(n.style.textDecoration=="line-through"||n.style.textDecoration=="underline"||n.style.textDecoration=="overline"||n.style.textDecoration=="none")?!0:!1:!1}function ni(n,t,i){return t===null&&i===null?!0:typeof t=="string"&&typeof i=="string"&&t==i&&!o[n].hasOwnProperty("equivalentValues")?!0:typeof t=="string"&&typeof i=="string"&&o[n].hasOwnProperty("equivalentValues")&&o[n].equivalentValues(t,i)?!0:!1}function ti(n,i,r){var u,f;return ni(n,i,r)?!0:n!="fontsize"||typeof i!="string"||typeof r!="string"?!1:(u=ti,u.sizeMap===undefined&&(u.sizeMap={},f=document.createElement("font"),document.body.appendChild(f),t(["xx-small","small","medium","large","x-large","xx-large","xxx-large"]).forEach(function(n){f.size=du(n),u.sizeMap[n]=t.getComputedStyle(f).fontSize}),document.body.removeChild(f)),i===u.sizeMap[r]||r===u.sizeMap[i])}function v(n,i){var r,u,e;if(n.nodeType!=t.Node.ELEMENT_NODE&&(!n.parentNode||n.parentNode.nodeType!=t.Node.ELEMENT_NODE))return null;if(n.nodeType!=t.Node.ELEMENT_NODE)return v(n.parentNode,i);if(i=="createlink"||i=="unlink"){while(n&&(!ri(n)||n.tagName!="A"||!y(n,"href")))n=n.parentNode;return n?n.getAttribute("href"):null}if(i=="backcolor"||i=="hilitecolor"){while((t.getComputedStyle(n).backgroundColor=="rgba(0, 0, 0, 0)"||t.getComputedStyle(n).backgroundColor===""||t.getComputedStyle(n).backgroundColor=="transparent")&&n.parentNode&&n.parentNode.nodeType==t.Node.ELEMENT_NODE)n=n.parentNode;return t.getComputedStyle(n).backgroundColor=="rgba(0, 0, 0, 0)"||t.getComputedStyle(n).backgroundColor===""||t.getComputedStyle(n).backgroundColor=="transparent"?"rgb(255, 255, 255)":t.getComputedStyle(n).backgroundColor}if(i=="subscript"||i=="superscript"){for(r=!1,u=!1;a(n);)e=t.getComputedStyle(n).verticalAlign,f(n,"sub")?r=!0:f(n,"sup")&&(u=!0),n=n.parentNode;return r&&u?"mixed":r?"subscript":u?"superscript":null}if(i=="strikethrough"){do{if(t.getComputedStyle(n).textDecoration.indexOf("line-through")!=-1)return"line-through";n=n.parentNode}while(n&&n.nodeType==t.Node.ELEMENT_NODE);return null}if(i=="underline"){do{if(t.getComputedStyle(n).textDecoration.indexOf("underline")!=-1)return"underline";n=n.parentNode}while(n&&n.nodeType==t.Node.ELEMENT_NODE);return null}if(!o[i].hasOwnProperty("relevantCssProperty"))throw"Bug: no relevantCssProperty for "+i+" in getEffectiveCommandValue";return t.getComputedStyle(n)[o[i].relevantCssProperty].toString()}function ot(n,i){var r,u;if((i=="backcolor"||i=="hilitecolor")&&t.getComputedStyle(n).display!="inline")return null;if(i=="createlink"||i=="unlink")return ri(n)&&n.tagName=="A"&&y(n,"href")?n.getAttribute("href"):null;if(i=="subscript"||i=="superscript")return f(n,"sup")?"superscript":f(n,"sub")?"subscript":null;if(i=="strikethrough"&&n.style.textDecoration!="")return n.style.textDecoration.indexOf("line-through")!=-1?"line-through":null;if(i=="strikethrough"&&h(n,["S","STRIKE"]))return"line-through";if(i=="underline"&&n.style.textDecoration!="")return n.style.textDecoration.indexOf("underline")!=-1?"underline":null;if(i=="underline"&&f(n,"U"))return"underline";if(r=o[i].relevantCssProperty,r===null)return null;if(n.style[r]!="")return n.style[r];if(fi(n.namespaceURI)&&n.tagName=="FONT"){if(r=="color"&&y(n,"color"))return n.color;if(r=="fontFamily"&&y(n,"face"))return n.face;if(r=="fontSize"&&y(n,"size"))return u=parseInt(n.size,10),u<1&&(u=1),u>7&&(u=7),{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[u]}return r=="fontWeight"&&(n.tagName=="B"||n.tagName=="STRONG")?"bold":r=="fontStyle"&&(n.tagName=="I"||n.tagName=="EM")?"italic":null}function cf(n,t,i,r){for(var u=n;hf(u)&&u.childNodes.length==1&&hf(u.firstChild)&&(!iu(u)||!ni(t,ot(u,t),i));)u=u.firstChild;if(u!=n&&iu(u)&&ni(t,ot(u,t),i)&&ti(t,v(u,t),i)){while(u.hasChildNodes())tt(u.firstChild,u.parentNode,s(u),r);n.parentNode.insertBefore(u,n.nextSibling),tt(n,u,-1,r)}}function at(n){for(var s=[],h=r.makeArray(n),u,f,e,t,o,i=0;i<h.length;i++)for(f=h[i],u=0;u<pu.length;u++){for(e=pu[u],t=f,t.nodeType!=1&&(t=t.parentNode),o=null;t&&t.nodeType==1&&(o=ot(t,e))===null;)t=t.parentNode;s.push([f,e,o])}return s}function wu(n,t,i){if(!u(n))return[];if(ot(n,t)===null)return[];if(iu(n)){for(var e=Array.prototype.slice.call(wt(n.childNodes)),r=0;r<e.length;r++)tt(e[r],n.parentNode,s(n),i);return n.parentNode.removeChild(n),e}return(t=="strikethrough"&&n.style.textDecoration.indexOf("line-through")!=-1&&(n.style.textDecoration=n.style.textDecoration=="line-through"?"":n.style.textDecoration.replace("line-through",""),n.getAttribute("style")==""&&n.removeAttribute("style")),t=="underline"&&n.style.textDecoration.indexOf("underline")!=-1&&(n.style.textDecoration=n.style.textDecoration=="underline"?"":n.style.textDecoration.replace("underline",""),n.getAttribute("style")==""&&n.removeAttribute("style")),o[t].relevantCssProperty!==null&&(n.style[o[t].relevantCssProperty]="",n.getAttribute("style")==""&&n.removeAttribute("style")),fi(n.namespaceURI)&&n.tagName=="FONT"&&(t=="forecolor"&&n.removeAttribute("color"),t=="fontname"&&n.removeAttribute("face"),t=="fontsize"&&n.removeAttribute("size")),f(n,"A")&&(t=="createlink"||t=="unlink")&&n.removeAttribute("href"),ot(n,t)===null)?[]:[gt(n,"span",i)]}function lr(n,i,u,e){var l=[],c,y,h,a,p;if(n.parentNode&&u!==null&&(d(n,"span")&&(cf(n.previousSibling,i,u,e),cf(n.nextSibling,i,u,e),yt([n],function(n){return iu(n)&&ni(i,ot(n,i),u)&&ti(i,v(n,i),u)},function(){return null},e)),!ti(i,v(n,i),u))){if(!d(n,"span")){for(c=0;c<n.childNodes.length;c++)(n.childNodes[c].nodeType!=t.Node.ELEMENT_NODE||(y=ot(n.childNodes[c],i),y===null||ni(i,u,y)))&&l.push(n.childNodes[c]);for(c=0;c<l.length;c++)lr(l[c],i,u,e);return}if(!ti(i,v(n,i),u)){if(h=null,rr||(i=="bold"&&(u=="bold"||u=="700")&&(h=n.ownerDocument.createElement("b")),i=="italic"&&u=="italic"&&(h=n.ownerDocument.createElement("i")),i=="strikethrough"&&u=="line-through"&&(h=n.ownerDocument.createElement("s")),i=="underline"&&u=="underline"&&(h=n.ownerDocument.createElement("u")),i=="forecolor"&&er(u)&&(h=n.ownerDocument.createElement("span"),r(h).css("color",er(u))),i=="fontname"&&(h=n.ownerDocument.createElement("font"),h.face=u)),i=="createlink"||i=="unlink")for(h=n.ownerDocument.createElement("a"),h.setAttribute("href",u),a=n.parentNode;a;)f(a,"A")&&(a=gt(a,"span",e)),a=a.parentNode;if(i!="fontsize"||r.inArray(u,["xx-small","small","medium","large","x-large","xx-large","xxx-large"])==-1||rr&&u!="xxx-large"||(h=n.ownerDocument.createElement("font"),h.size=du(u)),(i=="subscript"||i=="superscript")&&u=="subscript"&&(h=n.ownerDocument.createElement("sub")),(i=="subscript"||i=="superscript")&&u=="superscript"&&(h=n.ownerDocument.createElement("sup")),h||(h=n.ownerDocument.createElement("span")),n.parentNode.insertBefore(h,n),p=o[i].relevantCssProperty,p===null||ti(i,v(h,i),u)||(h.style[p]=u),i=="strikethrough"&&u=="line-through"&&v(h,"strikethrough")!="line-through"&&(h.style.textDecoration="line-through"),i=="underline"&&u=="underline"&&v(h,"underline")!="underline"&&(h.style.textDecoration="underline"),tt(n,h,h.childNodes.length,e),n.nodeType==t.Node.ELEMENT_NODE&&!ni(i,v(n,i),u)){for(tt(n,h.parentNode,s(h),e),h.parentNode.removeChild(h),l=[],c=0;c<n.childNodes.length;c++)(n.childNodes[c].nodeType!=t.Node.ELEMENT_NODE||(y=ot(n.childNodes[c],i),y===null||ni(i,u,y)))&&l.push(n.childNodes[c]);for(c=0;c<l.length;c++)lr(l[c],i,u,e)}}}}function lf(n,i,r,f){var e,o,h,l,c,s;if(n.parentNode&&n.parentNode.nodeType==t.Node.ELEMENT_NODE&&!ti(i,v(n,i),r)){for(e=n.parentNode,o=[];u(e)&&e.nodeType==t.Node.ELEMENT_NODE&&!ti(i,v(e,i),r);)o.push(e),e=e.parentNode;if(o.length&&(h=ot(o[o.length-1],i),h!==null||h==r)&&(r===null||ti(i,v(o[o.length-1].parentNode,i),r)))while(o.length)for(e=o.pop(),ot(e,i)!==null&&(h=ot(e,i)),l=Array.prototype.slice.call(wt(e.childNodes)),ot(e,i)!==null&&wu(e,i,f),c=0;c<l.length;c++)(s=l[c],s!=n)&&(s.nodeType!=t.Node.ELEMENT_NODE||ot(s,i)===null||ni(i,h,ot(s,i)))&&s!=o[o.length-1]&&lr(s,i,h,f)}}function ii(n,i){t(n).forEach(function(n){var e=n[0],u=n[1],f=n[2],r=e;for(r&&r.nodeType==t.Node.ELEMENT_NODE||(r=r.parentNode);r&&r.nodeType==t.Node.ELEMENT_NODE&&ot(r,u)===null;)r=r.parentNode;f===null&&r&&r.nodeType==t.Node.ELEMENT_NODE?lf(e,u,null,i):(!r||r.nodeType!=t.Node.ELEMENT_NODE||ni(u,ot(r,u),f))&&(r&&r.nodeType==t.Node.ELEMENT_NODE||f===null)||lr(e,u,f,i)})}function g(i,r,f){var h,l,a;if(f=f||e(),!t(it(f)).filter(function(n){return n.nodeType==t.Node.TEXT_NODE},!0).some(u)){o[i].hasOwnProperty("inlineCommandActivatedValues")&&kr(i,t(o[i].inlineCommandActivatedValues).indexOf(r)!=-1,f),i=="subscript"&&dr("superscript",f),i=="superscript"&&dr("subscript",f),r===null?nf(i,f):o[i].hasOwnProperty("value")&&cu(i,r,f);return}if(u(f.startContainer)&&f.startContainer.nodeType==t.Node.TEXT_NODE&&f.startOffset!=0&&f.startOffset!=c(f.startContainer)&&(h=f.startContainer.splitText(f.startOffset),l=n.createRange(),f.startContainer==f.endContainer&&(a=f.endOffset-f.startOffset,l.setEnd(h,a),f.setEnd(h,a)),l.setStart(h,0),n.getSelection().removeAllRanges(),n.getSelection().addRange(l),f.setStart(h,0)),u(f.endContainer)&&f.endContainer.nodeType==t.Node.TEXT_NODE&&f.endOffset!=0&&f.endOffset!=c(f.endContainer)){var s=f,v=[s.startContainer,s.startOffset],y=[s.endContainer,s.endOffset];s.endContainer.splitText(s.endOffset),s.setStart(v[0],v[1]),s.setEnd(y[0],y[1]),n.getSelection().removeAllRanges(),n.getSelection().addRange(s)}t(it(e(),function(n){return u(n)&&n.nodeType==t.Node.ELEMENT_NODE})).forEach(function(n){wu(n,i,f)}),t(it(f,u)).forEach(function(n){lf(n,i,r,f),lr(n,i,r,f)})}function ce(n,i){var r;if(n.nodeType===t.Node.TEXT_NODE&&i<n.length)for(r=i;r<n.length;r++)if(n.data.charAt(r)!=="\t"&&n.data.charAt(r)!=="\r"&&n.data.charAt(r)!=="\n"||n.data.charCodeAt(r)===160)return!1;return n.nextSibling&&n.nextSibling.className&&n.nextSibling.className.indexOf("aloha-table-wrapper")>=0?n.nextSibling:n.parentNode&&n.parentNode.nextSibling&&n.parentNode.nextSibling.className&&n.parentNode.nextSibling.className.indexOf("aloha-table-wrapper")>=0?n.parentNode.nextSibling:n.parentNode&&n.parentNode.nextSibling&&ai(n.parentNode.nextSibling)&&n.parentNode.nextSibling.nextSibling&&n.parentNode.nextSibling.nextSibling.className&&n.parentNode.nextSibling.nextSibling.className.indexOf("aloha-table-wrapper")>=0?n.parentNode.nextSibling.nextSibling:void 0}function le(n,i){var r;if(n.nodeType===t.Node.TEXT_NODE&&i>0)for(r=i-1;r>=0;r--)if(n.data.charAt(r)!=="\t"&&n.data.charAt(r)!=="\r"&&n.data.charAt(r)!=="\n"||n.data.charCodeAt(r)===160)return!1;return n.previousSibling&&n.previousSibling.className&&n.previousSibling.className.indexOf("aloha-table-wrapper")>=0?n.previousSibling:n.parentNode&&n.parentNode.previousSibling&&n.parentNode.previousSibling.className&&n.parentNode.previousSibling.className.indexOf("aloha-table-wrapper")>=0?n.parentNode.previousSibling:n.parentNode&&n.parentNode.previousSibling&&ai(n.parentNode.previousSibling)&&n.parentNode.previousSibling.previousSibling&&n.parentNode.previousSibling.previousSibling.className&&n.parentNode.previousSibling.previousSibling.className.indexOf("aloha-table-wrapper")>=0?n.parentNode.previousSibling.previousSibling:!1}function af(n,t){return!n.parentNode&&t==0||0<=t-1&&t-1<n.childNodes.length&&w(n.childNodes[t-1])&&(nt(n.childNodes[t-1])||f(n.childNodes[t-1],"br"))}function vf(n,t){return!n.parentNode&&t==c(n)||t<n.childNodes.length&&w(n.childNodes[t])&&nt(n.childNodes[t])}function ru(n,t){return af(n,t)||vf(n,t)}function uu(n){for(var t=0;!ru(n,t);){if(0<=t-1&&t-1<n.childNodes.length&&w(n.childNodes[t-1]))return!1;t!=0&&n.hasChildNodes()?(n=n.childNodes[t-1],t=c(n)):(t=s(n),n=n.parentNode)}return!0}function ar(n){for(var t=c(n);!ru(n,t);){if(t<n.childNodes.length&&w(n.childNodes[t]))return!1;t!=c(n)&&n.hasChildNodes()?(n=n.childNodes[t],t=0):(t=1+s(n),n=n.parentNode)}return!0}function pt(n,t){var e,i=n[0].parentNode,o;if(u(i)&&i.parentNode){r.inArray(i.firstChild,n)!=-1&&vu(i);var h=r.inArray(i.firstChild,n)!=-1,c=r.inArray(i.lastChild,n)!=-1,v=h&&uu(i),l=c&&ar(i);if(!h&&c){for(e=n.length-1;e>=0;e--)tt(n[e],i.parentNode,1+s(i),t);l&&!ar(n[n.length-1])&&n[n.length-1].parentNode.insertBefore(document.createElement("br"),n[n.length-1].nextSibling),yu(i);return}if(!h)for(o=i.cloneNode(!1),i.removeAttribute("id"),i.parentNode.insertBefore(o,i);n[0].previousSibling;)tt(i.firstChild,o,o.childNodes.length,t);for(e=0;e<n.length;e++)tt(n[e],i.parentNode,s(i),t);v&&!uu(n[0])&&n[0].parentNode.insertBefore(document.createElement("br"),n[0]),a(n[n.length-1])&&!f(n[n.length-1],"br")&&f(i.firstChild,"br")&&!a(i)&&i.removeChild(i.firstChild),i.hasChildNodes()?vu(i):(i.parentNode===t.startContainer&&i.parentNode===t.endContainer&&t.startContainer===t.endContainer&&t.startOffset===t.endOffset&&i.parentNode.childNodes.length===t.startOffset&&(t.startOffset=i.parentNode.childNodes.length-1,t.endOffset=t.startOffset),i.parentNode.removeChild(i),l&&!ar(n[n.length-1])&&n[n.length-1].parentNode.insertBefore(document.createElement("br"),n[n.length-1].nextSibling)),!n[n.length-1].nextSibling&&n[n.length-1].parentNode&&yu(n[n.length-1].parentNode)}}function hi(n){var t,i;if(!ri(n))return!1;if(n.tagName=="BLOCKQUOTE")return!0;if(n.tagName!="DIV")return!1;if(typeof n.style.length!="undefined"){for(t=0;t<n.style.length;t++)if(/^(-[a-z]+-)?margin/.test(n.style[t]))return!0}else for(i in n.style)if(/^(-[a-z]+-)?margin/.test(i)&&n.style[i]&&n.style[i]!==0)return!0;return!1}function vr(n){var t,i;if(!hi(n)||n.tagName!="BLOCKQUOTE"&&n.tagName!="DIV")return!1;for(t=0;t<n.attributes.length;t++)if(!fi(n.attributes[t].namespaceURI)||r.inArray(n.attributes[t].name,["style","class","dir"])==-1)return!1;if(typeof n.style.length!="undefined"){for(t=0;t<n.style.length;t++)if(!/^(-[a-z]+-)?(margin|border|padding)/.test(n.style[t]))return!1}else for(i in n.style)if(!/^(-[a-z]+-)?(margin|border|padding)/.test(i)&&n.style[i]&&n.style[i]!==0&&n.style[i]!=="false")return!1;return!0}function yf(n){return h(n,["address","div","h1","h2","h3","h4","h5","h6","listing","p","pre","xmp"])}function fu(n){return yf(n)||h(n,["li","dt","dd"])}function ae(n){return f(n,"br")&&n.parentNode.lastChild===n}function nr(){return document.createElement("br")}function ui(n){n&&(f(n.lastChild,"br")||t(n.childNodes).some(w)||(r.browser.msie?r.browser.msie&&r.browser.version<=7&&h(n,["p","h1","h2","h3","h4","h5","h6","pre","blockquote"])&&(n.firstChild||n.appendChild(document.createTextNode("​"))):n.appendChild(nr())))}function vt(n,i){var e,l,a,o,c,v;if(u(n)){if(t(kt(n)).every(function(t){return!k(n,t)||!d(n,t)})&&!b(n,vi)){if(h(n,["dd","dt"])){yt([n],function(n){return f(n,"dl")&&!n.attributes.length},function(){return document.createElement("dl")},i);return}if(!hr(n))return;for(n=gt(n,vi,i),ui(n),vt(n,i),l=ei(n),e=0;e<l.length;e++)vt(l[e],i);return}for(a=at([n]);!d(n,n.parentNode);){for(e=n.parentNode.childNodes.length-1;e>=0;--e)n.parentNode.childNodes[e].nodeType==3&&n.parentNode.childNodes[e].data.length==0&&(n.parentNode.removeChild(n.parentNode.childNodes[e]),i.startContainer==n.parentNode&&i.startOffset>e&&i.startOffset--,i.endContainer==n.parentNode&&i.endOffset>e&&i.endOffset--);if(n.parentNode.childNodes.length==1){o=i.startOffset,c=i.endOffset,i.startContainer===n.parentNode&&i.startOffset>s(n)&&(o=i.startOffset+(r(n).contents().length-1)),i.endContainer===n.parentNode&&i.endOffset>s(n)&&(c=i.endOffset+(r(n).contents().length-1)),r(n).contents().unwrap(),i.startOffset=o,i.endOffset=c;break}else if(v=n.parentNode,pt([n],i),v===n.parentNode){o=i.startOffset,c=i.endOffset,i.startContainer===n.parentNode&&i.startOffset>s(n)&&(o=i.startOffset+(r(n).contents().length-1)),i.endContainer===n.parentNode&&i.endOffset>s(n)&&(c=i.endOffset+(r(n).contents().length-1)),r(n).contents().unwrap(),i.startOffset=o,i.endOffset=c;break}}ii(a,i)}}function tr(n,i){function o(n){return h(n,["OL","UL"])}var r,e;if(f(n,"LI")&&u(n)&&u(n.parentNode))for(r=null;t(n.childNodes).some(o);)e=n.lastChild,h(e,["OL","UL"])||!r&&e.nodeType==t.Node.TEXT_NODE&&/^[ \t\n\f\r]*$/.test(e.data)?(r=null,tt(e,n.parentNode,1+s(n),i)):(r||(r=n.ownerDocument.createElement("li"),n.parentNode.insertBefore(r,n.nextSibling)),tt(e,r,0,i))}function ve(n,t){if(h(n,["OL","UL"])&&u(n)){var i=r(n);i.children("ol,ul").each(function(n,i){f(i.previousSibling,"LI")&&tt(i,i.previousSibling,i.previousSibling.childNodes.length,t)})}}function p(i){var u=i.startContainer,e=i.startOffset,r=i.endContainer,o=i.endOffset,h=t(kt(u).concat(u)).filter(function(n){return f(n,"li")}).slice(-1),l;if(h.length&&(e=s(h[0]),u=h[0].parentNode),!af(u,e))do e==0?(e=s(u),u=u.parentNode):e--;while(!ru(u,e));while(e==0&&u.parentNode)e=s(u),u=u.parentNode;if(h=t(kt(r).concat(r)).filter(function(n){return f(n,"li")}).slice(-1),h.length&&(o=1+s(h[0]),r=h[0].parentNode),!vf(r,o))do o==c(r)?(o=1+s(r),r=r.parentNode):o++;while(!ru(r,o));while(o==c(r)&&r.parentNode)o=1+s(r),r=r.parentNode;return l=n.createRange(),l.setStart(u,e),l.setEnd(r,o),l}function yr(){var o=p(e()),n=dt(o,function(n){return u(n)&&!hi(n)&&(h(n,["ol","ul"])||h(n.parentNode,["ol","ul"])||d(n,"li"))}),i,r;return n.length?t(n).every(function(n){return f(n,"ol")||f(n.parentNode,"ol")||f(n.parentNode,"li")&&f(n.parentNode.parentNode,"ol")})&&!t(n).some(function(n){return f(n,"ul")||n.querySelector&&n.querySelector("ul")})?"ol":t(n).every(function(n){return f(n,"ul")||f(n.parentNode,"ul")||f(n.parentNode,"li")&&f(n.parentNode.parentNode,"ul")})&&!t(n).some(function(n){return f(n,"ol")||n.querySelector&&n.querySelector("ol")})?"ul":(i=t(n).some(function(n){return f(n,"ol")||f(n.parentNode,"ol")||n.querySelector&&n.querySelector("ol")||f(n.parentNode,"li")&&f(n.parentNode.parentNode,"ol")}),r=t(n).some(function(n){return f(n,"ul")||f(n.parentNode,"ul")||n.querySelector&&n.querySelector("ul")||f(n.parentNode,"li")&&f(n.parentNode.parentNode,"ul")}),i&&r)?"mixed":i?"mixed ol":r?"mixed ul":"none":"none"}function ft(n){while(n&&n.nodeType!=t.Node.ELEMENT_NODE||n.nodeType==t.Node.ELEMENT_NODE&&r.inArray(t.getComputedStyle(n).display,["inline","none"])!=-1)n=n.parentNode;if(!n||n.nodeType!=t.Node.ELEMENT_NODE)return"left";var i=t.getComputedStyle(n).textAlign.replace(/^-(moz|webkit)-/,"").replace(/^auto$/,"start");return i=="start"?hu(n)=="ltr"?"left":"right":i=="end"?hu(n)=="ltr"?"right":"left":r.inArray(i,["center","justify","left","right"])!=-1?i:"left"}function ye(n){var i=[];return lt("createlink",n)!==undefined&&i.push(["createlink",lt("createlink",n)]),t(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(t){bi(t,n)!==undefined&&i.push([t,bi(t,n)])}),t(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(t){lt(t,n)!==undefined&&i.push([t,lt(t,n)])}),i}function pe(n){var i=[],r=t(it(n)).filter(function(n){return u(n)&&n.nodeType==t.Node.TEXT_NODE})[0];return r?(i.push(["createlink",o.createlink.value(n)]),t(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(n){t(o[n].inlineCommandActivatedValues).indexOf(v(r,n))!=-1?i.push([n,!0]):i.push([n,!1])}),t(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(t){i.push([t,o[t].value(n)])}),i.push(["fontsize",v(r,"fontsize")]),i):i}function ir(n,i){function s(n){return u(n)&&n.nodeType==t.Node.TEXT_NODE}var e,f,r,o=t(it(i)).filter(function(n){return u(n)&&n.nodeType==t.Node.TEXT_NODE})[0];if(o)for(e=0;e<n.length;e++){if(f=n[e][0],r=n[e][1],typeof r=="boolean"&&si(f,i)!=r)nu(f,!1,r,i);else if(typeof r!="string"||f=="fontsize"||ni(f,ff(f,i),r))if(typeof r!="string"||f!="fontsize"||(lt("fontsize",i)===undefined||lt("fontsize",i)===r)&&(lt("fontsize",i)!==undefined||ti(f,v(o,"fontsize"),r)))continue;else nu("fontsize",!1,r,i);else nu(f,!1,r,i);o=t(it(i)).filter(s)[0]||o}else for(e=0;e<n.length;e++)f=n[e][0],r=n[e][1],typeof r=="boolean"&&kr(f,r,i),typeof r=="string"&&cu(f,r,i)}function we(n,t,i){if(n==0)return"";if(n==1&&!t&&!i)return" ";if(n==1)return" ";for(var r="",u=t?"  ":"  ";n>3;)r+=u,n-=2;return r+(n==3?!t&&!i?"   ":t&&!i?"   ":!t&&i?"   ":t&&i?"   ":"impossible":!t&&!i?"  ":t&&!i?"  ":!t&&i?"  ":t&&i?"  ":"impossible")}function ci(n,i){var f,e,l,a;if(u(n)||ut(n)){for(f=n,e=i;;)if(0<=e-1&&k(f,f.childNodes[e-1]))f=f.childNodes[e-1],e=c(f);else if(e==0&&!uu(f)&&k(f,f.parentNode))e=s(f),f=f.parentNode;else if(f.nodeType==t.Node.TEXT_NODE&&r.inArray(t.getComputedStyle(f.parentNode).whiteSpace,["pre","pre-wrap"])==-1&&e!=0&&/[ \xa0]/.test(f.data[e-1]))e--;else break;for(var o=f,h=e,v=0,y=!1;;)if(h<o.childNodes.length&&k(o,o.childNodes[h]))o=o.childNodes[h],h=0;else if(h==c(o)&&!ar(o)&&k(o,o.parentNode))h=1+s(o),o=o.parentNode;else if(o.nodeType==t.Node.TEXT_NODE&&r.inArray(t.getComputedStyle(o.parentNode).whiteSpace,["pre","pre-wrap"])==-1&&h!=c(o)&&/[ \xa0]/.test(o.data[h])){if(y&&" "==o.data[h]){o.deleteData(h,1);continue}y=" "==o.data[h],h++,v++}else break;for(l=we(v,e==0&&uu(f),h==c(o)&&ar(o));fr(f,e,o,h)=="before";)e<f.childNodes.length?(f=f.childNodes[e],e=0):f.nodeType!=t.Node.TEXT_NODE||e==c(f)?(e=1+s(f),f=f.parentNode):(a=l[0],l=l.slice(1),a!=f.data[e]&&(f.insertData(e,a),f.deleteData(e+1,1)),e++)}}function et(i,r,e,o,l){var y,st={},ct,kt,gt,p,v,ht,g,vt,yt,bt,lt,ft,et;if(arguments.length<3?y=i:(y=n.createRange(),y.setStart(i,r),y.setEnd(e,o)),arguments.length==2&&(st=r),arguments.length==5&&(st=l),kt=null!=st.blockMerging?!!st.blockMerging:!0,gt=null!=st.stripWrappers?!!st.stripWrappers:!0,y){for(var b=y.startContainer,rt=y.startOffset,it=y.endContainer,ot=y.endOffset,w;b.hasChildNodes();){if(rt==c(b)&&k(b,b.parentNode)&&a(b)){rt=1+s(b),b=b.parentNode;continue}if(rt==c(b))break;if(w=b.childNodes[rt],nt(w)||w.nodeType==t.Node.ELEMENT_NODE&&!w.hasChildNodes()||w.nodeType!=t.Node.ELEMENT_NODE&&w.nodeType!=t.Node.TEXT_NODE)break;b=w,rt=0}while(it.hasChildNodes()){if(ot==0&&k(it,it.parentNode)&&a(it)){ot=s(it),it=it.parentNode;continue}if(ot==0)break;if(w=it.childNodes[ot-1],nt(w)||w.nodeType==t.Node.ELEMENT_NODE&&!w.hasChildNodes()||w.nodeType!=t.Node.ELEMENT_NODE&&w.nodeType!=t.Node.TEXT_NODE)break;it=w,ot=c(w)}if(fr(it,ot,b,rt)!=="after"){y.setEnd(y.startContainer,y.startOffset);return}for(it.nodeType==t.Node.TEXT_NODE&&ot==c(it)&&b!=it&&(ot=1+s(it),it=it.parentNode),y.setStart(b,rt),y.setEnd(it,ot),p=y.startContainer;k(p,p.parentNode)&&a(p);)p=p.parentNode;for((nt(p)||ut(p))&&d("span",p)&&!h(p,["td","th"])||(p=null),v=y.endContainer;k(v,v.parentNode)&&a(v);)v=v.parentNode;if((nt(v)||ut(v))&&d("span",v)&&!h(v,["td","th"])||(v=null),ht=pe(y),b==it&&u(b)&&b.nodeType==t.Node.TEXT_NODE){g=b.parentNode,b.deleteData(rt,ot-rt),rt>0&&b.data.substr(rt-1,1)===" "&&rt<b.data.length&&b.data.substr(rt,1)===" "&&b.replaceData(rt-1,1," "),ci(b,rt),y.setStart(y.startContainer,y.startOffset),y.setEnd(y.startContainer,y.startOffset),ir(ht,y),(u(g)||ut(g))&&!a(g)&&ui(g);return}for(u(b)&&b.nodeType==t.Node.TEXT_NODE&&b.deleteData(rt,c(b)-rt),vt=dt(y,function(n){return u(n)&&!h(n,["thead","tbody","tfoot","tr","th","td"])}),ct=0;ct<vt.length;ct++){if(yt=vt[ct],g=yt.parentNode,g.removeChild(yt),gt||!wr(g,b)&&g!=b)while(u(g)&&a(g)&&c(g)==0)bt=g.parentNode,bt.removeChild(g),g=bt;(u(g)||ut(g))&&!a(g)&&ui(g)}if(u(it)&&it.nodeType==t.Node.TEXT_NODE&&it.deleteData(0,ot),ci(y.startContainer,y.startOffset),ci(y.endContainer,y.endOffset),!kt||!p||!v||!k(p,v)||p==v){y.setEnd(y.startContainer,y.startOffset),ir(ht,y);return}if(p.children.length==1&&di(p.firstChild)&&p.removeChild(p.firstChild),v.children.length==1&&di(v.firstChild)&&v.removeChild(v.firstChild),wr(p,v)){for(w=v;w.parentNode!=p;)w=w.parentNode;if(y.setStart(p,s(w)),y.setEnd(p,s(w)),!v.hasChildNodes()){while(u(v)&&v.parentNode.childNodes.length==1&&v.parentNode!=p)g=v,g.removeChild(v),v=g;u(v)&&!a(v)&&a(v.previousSibling)&&a(v.nextSibling)&&v.parentNode.insertBefore(document.createElement("br"),v.nextSibling),u(v)&&v.parentNode.removeChild(v),ir(ht,y);return}if(!a(v.firstChild)){ir(ht,y);return}for(ft=[],ft.push(v.firstChild);!f(ft[ft.length-1],"br")&&a(ft[ft.length-1].nextSibling);)ft.push(ft[ft.length-1].nextSibling);for(lt=at(ft);ft[0].parentNode!=p;)pt(ft,y);u(ft[0].previousSibling)&&f(ft[0].previousSibling,"br")&&ft[0].parentNode.removeChild(ft[0].previousSibling)}else if(wi(p,v)){for(y.setStart(p,c(p)),y.setEnd(p,c(p)),w=p;w.parentNode!=v;)w=w.parentNode;a(w.nextSibling)&&f(p.lastChild,"br")&&p.removeChild(p.lastChild),et=[],!w.nextSibling||f(w.nextSibling,"br")||nt(w.nextSibling)||et.push(w.nextSibling),et.length&&et[et.length-1].nextSibling&&!f(et[et.length-1].nextSibling,"br")&&!nt(et[et.length-1].nextSibling)&&et.push(et[et.length-1].nextSibling),lt=at(et),t(et).forEach(function(n){tt(n,p,-1,y)}),f(w.nextSibling,"br")&&w.parentNode.removeChild(w.nextSibling)}else{for(y.setStart(p,c(p)),y.setEnd(p,c(p)),a(v.firstChild)&&f(p.lastChild,"br")&&p.removeChild(p.lastChild),lt=at([].slice.call(wt(v.childNodes)));v.hasChildNodes();)tt(v.firstChild,p,-1,y);while(!v.hasChildNodes())g=v.parentNode,g.removeChild(v),v=g}ii(lt,y),ui(p),ir(ht,y)}}function pr(n,t){n.hasChildNodes()?pt([].slice.call(wt(n.childNodes)),t):n.parentNode.removeChild(n)}function be(n,t){n&&r(n).find("ul,ol,li").each(function(){r(this).contents().each(function(){if(ai(this)){var n=s(this);t.startContainer===this.parentNode&&t.startOffset>n?t.startOffset--:t.startContainer===this&&(t.startContainer=this.parentNode,t.startOffset=n),t.endContainer===this.parentNode&&t.endOffset>n?t.endOffset--:t.endContainer===this&&(t.endContainer=this.parentNode,t.endOffset=n),r(this).remove()}})})}function bu(n,t){var i,r,u;if(n.length){if(i=n[0],h(i.parentNode,["OL","UL"])){r=i.parentNode.tagName,yt(n,function(n){return b(n,r)},function(){return i.ownerDocument.createElement(r)},t);return}u=yt(n,function(n){return vr(n)},function(){return i.ownerDocument.createElement("blockquote")},t),vt(u,t)}}function eu(n,i){var r,e,l,v,c,y,o,p,w;if(u(n)){if(vr(n)){pr(n,i);return}if(hi(n)){n.removeAttribute("class"),n.removeAttribute("dir"),n.style.margin="",n.style.padding="",n.style.border="",n.getAttribute("style")==""&&n.removeAttribute("style"),gt(n,"div",i);return}for(r=n.parentNode,e=[];u(r)&&r.nodeType==t.Node.ELEMENT_NODE&&!vr(r)&&!h(r,["ol","ul"]);)e.push(r),r=r.parentNode;if(!u(r)||!vr(r))for(r=n.parentNode,e=[];u(r)&&r.nodeType==t.Node.ELEMENT_NODE&&!hi(r)&&!h(r,["ol","ul"]);)e.push(r),r=r.parentNode;if(h(n,["OL","UL"])&&(!u(r)||!hi(r))){for(n.removeAttribute("reversed"),n.removeAttribute("start"),n.removeAttribute("type"),l=[].slice.call(wt(n.childNodes)),n.attributes.length&&!h(n.parentNode,["OL","UL"])?gt(n,"div",i):(v=at([].slice.call(wt(n.childNodes))),pr(n,i),ii(v,i)),c=0;c<l.length;c++)vt(l[c],i);return}if(u(r)&&hi(r)){for(e.push(r),y=r;e.length;)r=e.pop(),o=n.parentNode==r?n:e[e.length-1],a(o)&&!f(o,"BR")&&f(o.nextSibling,"BR")&&o.parentNode.removeChild(o.nextSibling),p=[].slice.call(wt(r.childNodes),0,s(o)),w=[].slice.call(wt(r.childNodes),1+s(o)),bu(p,i),bu(w,i);eu(y,i)}}}function pf(n,i){function g(){return document.createElement("li")}function nt(n){return h(n,["ol","ul"])}function k(n){return function(t){return b(t,n)}}function tt(n){return function(){return document.createElement(n)}}function it(n,t,i){return function(){if(!u(t[0].parentNode)||!vr(t[0].parentNode)||!u(t[0].parentNode.previousSibling)||!b(t[0].parentNode.previousSibling,n))return document.createElement(n);var r=t[0].parentNode.previousSibling;return tr(r.lastChild,i),u(r.lastChild)&&b(r.lastChild,n)||r.appendChild(document.createElement(n)),r.lastChild}}var v=yr()==n?"disable":"enable",y,s,w,e,r,c,l,o;if(n=n.toUpperCase(),y=n=="OL"?"UL":"OL",s=[],function(){for(var n=i.endContainer;n!=i.commonAncestorContainer;n=n.parentNode)f(n,"li")&&s.unshift(n);for(n=i.startContainer;n;n=n.parentNode)f(n,"li")&&s.unshift(n)}(),t(s).forEach(function(n){tr(n,i)}),w=p(i),v=="enable"&&t(rt(w,function(n){return u(n)&&b(n,y)})).forEach(function(t){if(u(t.previousSibling)&&b(t.previousSibling,n)||u(t.nextSibling)&&b(t.nextSibling,n)){var r=[].slice.call(wt(t.childNodes)),f=at(r);pt(r,i),yt(r,function(t){return b(t,n)},function(){return null},i),ii(f,i)}else gt(t,n,i)}),e=dt(w,function(n){return u(n)&&!hi(n)&&(h(n,["OL","UL"])||h(n.parentNode,["OL","UL"])||d(n,"li"))}),v=="enable"&&(e=t(e).filter(function(n){return!h(n,["ol","ul"])||h(n.parentNode,["ol","ul"])})),v=="disable")while(e.length){if(r=[],r.push(e.shift()),b(r[0],n)){eu(r[0],i);continue}while(e.length&&e[0]==r[r.length-1].nextSibling&&!b(e[0],n))r.push(e.shift());for(c=at(r),pt(r,i),l=0;l<r.length;l++)vt(r[l],i);ii(c,i)}else while(e.length){for(r=[];!r.length||e.length&&e[0]==r[r.length-1].nextSibling;)if(h(e[0],["p","div"]))r.push(gt(e[0],"li",i)),e.shift();else if(h(e[0],["li","ol","ul"]))r.push(e.shift());else{for(o=[];!o.length||e.length&&e[0]==o[o.length-1].nextSibling&&a(e[0])&&a(o[o.length-1])&&!f(o[o.length-1],"br");)o.push(e.shift());r.push(yt(o,undefined,g,i))}if(!b(r[0].parentNode,n)&&!t(r).every(nt)){if(b(r[0].parentNode,y)){c=at(r),pt(r,i),yt(r,k(n),tt(n),i),ii(c,i);continue}vt(yt(r,k(n),it(n,r,i),i),i)}}}function ou(n,i){function a(n){return function(i){return f(i,"div")&&t(i.attributes).every(function(t){return t.name=="align"&&t.value.toLowerCase()==n||t.name=="style"&&pi(i)==1&&i.style.textAlign==n})}}function v(n){return function(){var t=document.createElement("div");return t.setAttribute("style","text-align: "+n),t}}for(var c=p(i),l=rt(c,function(n){return n.nodeType==t.Node.ELEMENT_NODE&&u(n)&&(y(n,"align")||n.style.textAlign!=""||f(n,"center"))}),r,e,o,s=0;s<l.length;s++)r=l[s],r.removeAttribute("align"),r.style.textAlign="",r.getAttribute("style")==""&&r.removeAttribute("style"),h(r,["div","span","center"])&&!r.attributes.length&&pr(r,i),f(r,"center")&&r.attributes.length&&gt(r,"div",i);for(c=p(st),e=[],e=dt(c,function(t){return u(t)&&d(t,"div")&&ft(t)!=n});e.length;){for(o=[],o.push(e.shift());e.length&&e[0]==o[o.length-1].nextSibling;)o.push(e.shift());yt(o,a(n),v(n),i)}}function wf(n,i){var r;if(n.collapsed){if(r=n.startOffset,i){if(n.startContainer&&n.startContainer.nodeType===t.Node.TEXT_NODE)while(r<n.startContainer.data.length&&n.startContainer.data.charAt(r)==="​")r++}else if(n.startContainer&&n.startContainer.nodeType===t.Node.TEXT_NODE)while(r>0&&n.startContainer.data.charAt(r-1)==="​")r--;r!==n.startOffset&&(n.setStart(n.startContainer,r),n.setEnd(n.startContainer,r))}}var kf="http://www.w3.org/1999/xhtml",rr=!1,st=null,o={},bi,kr,oi,dr,lt,cu,nf,or=0,l={ADDRESS:!0,ARTICLE:!0,ASIDE:!0,BLOCKQUOTE:!0,CAPTION:!0,CENTER:!0,COL:!0,COLGROUP:!0,DD:!0,DETAILS:!0,DIR:!0,DIV:!0,DL:!0,DT:!0,FIELDSET:!0,FIGCAPTION:!0,FIGURE:!0,FOOTER:!0,FORM:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,HEADER:!0,HGROUP:!0,HR:!0,LI:!0,LISTING:!0,MENU:!0,NAV:!0,OL:!0,P:!0,PLAINTEXT:!0,PRE:!0,SECTION:!0,SUMMARY:!0,TABLE:!0,TBODY:!0,TD:!0,TFOOT:!0,TH:!0,THEAD:!0,TR:!0,UL:!0,XMP:!0},ie={inline:!0,"inline-block":!0,"inline-table":!0,none:!0},pu,vi,yi,bf;(function(){var r={},n={},t=null;oi=function(u){return(!t||t.startContainer!=u.startContainer||t.endContainer!=u.endContainer||t.startOffset!=u.startOffset||t.endOffset!=u.endOffset)&&(t={startContainer:u.startContainer,endContainer:u.endContainer,startOffset:u.startOffset,endOffset:u.endOffset},!i.isEmpty(r)||!i.isEmpty(n))?(r={},n={},!0):!1},bi=function(n,t){return oi(t),r[n]},kr=function(n,t,i){oi(i),r[n]=t},dr=function(n,t){oi(t),delete r[n]},lt=function(t,i){return oi(i),n[t]},cu=function(t,i,r){oi(r),n[t]=i,t=="backcolor"?n.hilitecolor=i:t=="hilitecolor"&&(n.backcolor=i)},nf=function(t,i){oi(i),delete n[t],t=="backcolor"?delete n.hilitecolor:t=="hilitecolor"&&delete n.backcolor}})();var fe={A:!0,ABBR:!0,B:!0,BDI:!0,BDO:!0,CITE:!0,CODE:!0,DFN:!0,EM:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,I:!0,KBD:!0,MARK:!0,P:!0,PRE:!0,Q:!0,RP:!0,RT:!0,RUBY:!0,S:!0,SAMP:!0,SMALL:!0,SPAN:!0,STRONG:!0,SUB:!0,SUP:!0,U:!0,VAR:!0,ACRONYM:!0,LISTING:!0,STRIKE:!0,XMP:!0,BIG:!0,BLINK:!0,FONT:!0,MARQUEE:!0,NOBR:!0,TT:!0},ee={colgroup:!0,table:!0,tbody:!0,tfoot:!0,thead:!0,tr:!0},oe={script:!0,style:!0,plaintext:!0,xmp:!0},gi=r.extend({H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0},l),of={CAPTION:!0,COL:!0,COLGROUP:!0,TBODY:!0,TD:!0,TFOOT:!0,TH:!0,THEAD:!0,TR:!0},sf={DD:!0,DT:!0},se={A:r.extend({A:!0},l),DD:sf,DT:sf,LI:{LI:!0},NOBR:r.extend({NOBR:!0},l),H1:gi,H2:gi,H3:gi,H4:gi,H5:gi,H6:gi,TD:of,TH:of,ABBR:l,B:l,BDI:l,BDO:l,CITE:l,CODE:l,DFN:l,EM:l,I:l,KBD:l,MARK:l,P:l,PRE:l,Q:l,RP:l,RT:l,RUBY:l,S:l,SAMP:l,SMALL:l,SPAN:l,STRONG:l,SUB:l,SUP:l,U:l,VAR:l,ACRONYM:l,LISTING:l,STRIKE:l,XMP:l,BIG:l,BLINK:l,FONT:l,MARQUEE:l,TT:l};return pu=["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"],o.backcolor={action:function(n,t){(/^([0-9a-fA-F]{3}){1,2}$/.test(n)&&(n="#"+n),/^(rgba?|hsla?)\(.*\)$/.test(n)||er(n)||n.toLowerCase()=="transparent")&&g("backcolor",n,t)},standardInlineValueCommand:!0,relevantCssProperty:"backgroundColor",equivalentValues:function(n,t){return li(n)===li(t)}},o.bold={action:function(n,t){si("bold",t)?g("bold","normal",t):g("bold","bold",t)},inlineCommandActivatedValues:["bold","600","700","800","900"],relevantCssProperty:"fontWeight",equivalentValues:function(n,t){return n==t||n=="bold"&&t=="700"||n=="700"&&t=="bold"||n=="normal"&&t=="400"||n=="400"&&t=="normal"}},o.createlink={action:function(n,i){n!==""&&(t(it(e())).forEach(function(i){t(kt(i)).forEach(function(t){u(t)&&f(t,"a")&&y(t,"href")&&t.setAttribute("href",n)})}),g("createlink",n,i))},standardInlineValueCommand:!0},o.fontname={action:function(n,t){g("fontname",n,t)},standardInlineValueCommand:!0,relevantCssProperty:"fontFamily"},o.fontsize={action:function(n,t){n!==""&&(n=tf(n),r.inArray(n,["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"])!=-1||/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc)$/.test(n))&&g("fontsize",n,t)},indeterm:function(){return t(it(e(),function(n){return u(n)&&n.nodeType==t.Node.TEXT_NODE})).map(function(n){return v(n,"fontsize")},!0).filter(function(n,i,r){return t(r.slice(0,i)).indexOf(n)==-1}).length>=2},value:function(n){var i=it(n,function(n){return u(n)&&n.nodeType==t.Node.TEXT_NODE})[0],r;return i===undefined&&(i=n.startContainer),r=v(i,"fontsize"),rf(r)},relevantCssProperty:"fontSize"},o.forecolor={action:function(n,t){(/^([0-9a-fA-F]{3}){1,2}$/.test(n)&&(n="#"+n),/^(rgba?|hsla?)\(.*\)$/.test(n)||er(n)||n.toLowerCase()=="transparent")&&g("forecolor",n,t)},standardInlineValueCommand:!0,relevantCssProperty:"color",equivalentValues:function(n,t){return li(n)===li(t)}},o.hilitecolor={action:function(n,t){(/^([0-9a-fA-F]{3}){1,2}$/.test(n)&&(n="#"+n),/^(rgba?|hsla?)\(.*\)$/.test(n)||er(n)||n.toLowerCase()=="transparent")&&g("hilitecolor",n,t)},indeterm:function(){return t(it(e(),function(n){return u(n)&&n.nodeType==t.Node.TEXT_NODE})).map(function(n){return v(n,"hilitecolor")},!0).filter(function(n,i,r){return t(r.slice(0,i)).indexOf(n)==-1}).length>=2},standardInlineValueCommand:!0,relevantCssProperty:"backgroundColor",equivalentValues:function(n,t){return li(n)===li(t)}},o.italic={action:function(n,t){si("italic",t)?g("italic","normal",t):g("italic","italic",t)},inlineCommandActivatedValues:["italic","oblique"],relevantCssProperty:"fontStyle"},o.removeformat={action:function(n,i){function l(n){return u(n)&&h(n,["abbr","acronym","b","bdi","bdo","big","blink","cite","code","dfn","em","font","i","ins","kbd","mark","nobr","q","s","samp","small","span","strike","strong","sub","sup","tt","u","var"])}var r,f,o,a=it(e(),l);t(a).forEach(function(n){while(n.hasChildNodes())tt(n.firstChild,n.parentNode,s(n),e());n.parentNode.removeChild(n)}),u(e().startContainer)&&e().startContainer.nodeType==t.Node.TEXT_NODE&&e().startOffset!=0&&e().startOffset!=c(e().startContainer)&&(e().startContainer==e().endContainer?(r=e().endOffset-e().startOffset,o=e().startContainer.splitText(e().startOffset),e().setStart(o,0),e().setEnd(o,r)):e().setStart(e().startContainer.splitText(e().startOffset),0)),u(e().endContainer)&&e().endContainer.nodeType==t.Node.TEXT_NODE&&e().endOffset!=0&&e().endOffset!=c(e().endContainer)&&(f=[e().startContainer,e().startOffset],r=[e().endContainer,e().endOffset],e().setEnd(document.documentElement,0),r[0].splitText(r[1]),e().setStart(f[0],f[1]),e().setEnd(r[0],r[1])),t(it(e(),u)).forEach(function(n){while(l(n.parentNode)&&k(n.parentNode,n))pt([n],e())}),t(["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"]).forEach(function(n){g(n,null,i)})}},o.strikethrough={action:function(n,t){si("strikethrough",t)?g("strikethrough",null,t):g("strikethrough","line-through",t)},inlineCommandActivatedValues:["line-through"]},o.subscript={action:function(n,t){var i=si("subscript",t);g("subscript",null,t),i||g("subscript","subscript",t)},indeterm:function(){var n=it(e(),function(n){return u(n)&&n.nodeType==t.Node.TEXT_NODE});return t(n).some(function(n){return v(n,"subscript")=="subscript"})&&t(n).some(function(n){return v(n,"subscript")!="subscript"})||t(n).some(function(n){return v(n,"subscript")=="mixed"})},inlineCommandActivatedValues:["subscript"]},o.superscript={action:function(n,t){var i=si("superscript",t);g("superscript",null,t),i||g("superscript","superscript",t)},indeterm:function(){var n=it(e(),function(n){return u(n)&&n.nodeType==t.Node.TEXT_NODE});return t(n).some(function(n){return v(n,"superscript")=="superscript"})&&t(n).some(function(n){return v(n,"superscript")!="superscript"})||t(n).some(function(n){return v(n,"superscript")=="mixed"})},inlineCommandActivatedValues:["superscript"]},o.underline={action:function(n,t){si("underline",t)?g("underline",null,t):g("underline","underline",t)},inlineCommandActivatedValues:["underline"]},o.unlink={action:function(){for(var t=e(),i=[],r,n=t.startContainer;n;n=n.parentNode)f(n,"A")&&y(n,"href")&&i.unshift(n);for(n=t.startContainer;n!=ct(t.endContainer);n=bt(n))f(n,"A")&&y(n,"href")&&(br(n,t)||wr(n,t.endContainer)||n==t.endContainer)&&i.push(n);for(r=0;r<i.length;r++)wu(i[r],"unlink",t)},standardInlineValueCommand:!0},vi="p",o["delete"]={action:function(i,e){var b,ct,ut,g,tt,lt,v,y,it,st,rt,w;if(r.browser.msie&&r.browser.version<=7&&wf(e,!1),!e.collapsed){et(e);return}ci(e.startContainer,e.startOffset);for(var o=e.startContainer,l=e.startOffset,ft=!1,ot=!1;;){if(l>0&&(ft=f(o.childNodes[l-1],"br")||!1,ot=f(o.childNodes[l-1],"hr")||!1),l==0&&u(o.previousSibling)&&ht(o.previousSibling)){o.parentNode.removeChild(o.previousSibling);continue}if(0<=l-1&&l-1<o.childNodes.length&&u(o.childNodes[l-1])&&(ht(o.childNodes[l-1])||ft||ot)){if(o.removeChild(o.childNodes[l-1]),l--,ft||ot){e.setStart(o,l),e.setEnd(o,l);return}continue}if(l==0&&a(o)||ht(o)){l=s(o),o=o.parentNode;continue}if(0<=l-1&&l-1<o.childNodes.length&&u(o.childNodes[l-1])&&f(o.childNodes[l-1],"a")){pr(o.childNodes[l-1],e);return}if(0<=l-1&&l-1<o.childNodes.length&&!nt(o.childNodes[l-1])&&!h(o.childNodes[l-1],["br","img"])){o=o.childNodes[l-1],l=c(o);continue}if(ct=!0,ct)break}if(ut=le(o,l),ut){ut.parentNode.removeChild(ut);return}if(o.nodeType==t.Node.TEXT_NODE&&l!=0){e.setStart(o,l-1),e.setEnd(o,l-1),et(o,l-1,o,l);return}if(o.nodeType==t.Node.TEXT_NODE&&l==0&&r.browser.msie){l=1,e.setStart(o,l),e.setEnd(o,l),e.startOffset=0,et(e);return}if(!a(o)){if(0<=l-1&&l-1<o.childNodes.length&&h(o.childNodes[l-1],["br","hr","img"])){e.setStart(o,l),e.setEnd(o,l),et(e);return}if(h(o,["li","dt","dd"])&&o==o.parentNode.firstChild&&l==0){for(g=[],tt=o.parentNode;tt;tt=tt.parentNode)f(tt,"li")&&g.unshift(tt);for(b=0;b<g.length;b++)tr(g[b],e);for(lt=at([o]),pt([o],e),ii(lt,e),h(o,["dd","dt"])&&t(kt(o)).every(function(n){return!k(o,n)||!d(o,n)})&&(o=gt(o,vi,e)),vt(o,e),b=0;b<g.length;b++)ve(g[b].parentNode,e);return}for(v=o,y=l;;)if(y==0)y=s(v),v=v.parentNode;else if(0<=y-1&&y-1<v.childNodes.length&&u(v.childNodes[y-1])&&ht(v.childNodes[y-1]))v.removeChild(v.childNodes[y-1]),y--;else break;if(l==0&&t(kt(o).concat(o)).filter(function(n){return u(n)&&k(n,o)&&hi(n)}).length){for(it=n.createRange(),it.setStart(o,0),it.setEnd(o,0),it=p(it),st=dt(it,function(n){return u(n)&&!ef(n)}),b=0;b<st.length;b++)eu(st[b],e);return}if(!f(v.childNodes[y],"table")){if(0<=y-1&&y-1<v.childNodes.length&&f(v.childNodes[y-1],"table")){e.setStart(v,y-1),e.setEnd(v,y);return}if(l==0&&(f(v.childNodes[y-1],"hr")||f(v.childNodes[y-1],"br")&&(f(v.childNodes[y-1].previousSibling,"br")||!a(v.childNodes[y-1].previousSibling)))){e.setStart(o,l),e.setEnd(o,l),et(v,y-1,v,y);return}if(h(v.childNodes[y],["li","dt","dd"])&&a(v.childNodes[y].firstChild)&&y!=0&&(rt=v.childNodes[y-1],a(rt.lastChild)&&!f(rt.lastChild,"br")&&rt.appendChild(document.createElement("br")),a(rt.lastChild)&&rt.appendChild(document.createElement("br"))),h(v.childNodes[y],["li","dt","dd"])&&h(v.childNodes[y-1],["li","dt","dd"]))v=v.childNodes[y-1],y=c(v),o=v.nextSibling,l=0;else while(0<=y-1&&y-1<v.childNodes.length)u(v.childNodes[y-1])&&ht(v.childNodes[y-1])?(v.removeChild(v.childNodes[y-1]),y--):(v=v.childNodes[y-1],y=c(v));w=n.createRange(),w.setStart(v,y),w.setEnd(o,l),et(w),gf(document.body,e.startContainer)||(w.startContainer.hasChildNodes()||w.startContainer.nodeType==t.Node.TEXT_NODE?(e.setStart(w.startContainer,w.startOffset),e.setEnd(w.startContainer,w.startOffset)):(e.setStart(w.startContainer.parentNode,s(w.startContainer)),e.setEnd(w.startContainer.parentNode,s(w.startContainer))))}}}},yi=["address","dd","div","dt","h1","h2","h3","h4","h5","h6","p","pre"],o.formatblock={action:function(n){function v(n){return function(i){return u(i)&&k(i,n)&&b(i,yi)&&!t(ei(i)).some(hr)}}function y(n){return function(t){return b(t,n)&&!t.attributes.length}}function w(){return!1}function g(n){return function(){return document.createElement(n)}}var c,l,o;if(/^<.*>$/.test(n)&&(n=n.slice(1,-1)),n=n.toLowerCase(),t(yi).indexOf(n)!=-1){var s=p(e()),i=dt(s,function(n){return u(n)&&(yf(n)||d(n,"p")||h(n,["dd","dt"]))&&!t(ei(n)).some(hr)}),a=at(i);for(c=0;c<i.length;c++)for(l=i[c];t(kt(l)).some(v(l));)pt([l],s);for(ii(a,s);i.length;){if(fu(i[0]))o=[].slice.call(wt(i[0].childNodes)),a=at(o),pr(i[0],s),ii(a,s),i.shift();else for(o=[],o.push(i.shift());i.length&&i[0]==o[o.length-1].nextSibling&&!fu(i[0])&&!f(o[o.length-1],"BR");)o.push(i.shift());vt(yt(o,r.inArray(n,["div","p"])==-1?y(n):w,g(n),s),s)}}},indeterm:function(){var s=p(e()),o=rt(s,function(n){return w(n)&&u(n)&&!n.hasChildNodes()}),i,r,n,f;if(!o.length)return!1;for(i=null,r=0;r<o.length;r++){for(n=o[r];u(n.parentNode)&&k(n,n.parentNode)&&!b(n,yi);)n=n.parentNode;if(f="",u(n)&&b(n,yi)&&!t(ei(n)).some(hr)&&(f=n.tagName),i===null)i=f;else if(i!=f)return!0}return!1},value:function(){var r=p(e()),i=rt(r,function(n){return w(n)&&u(n)&&!n.hasChildNodes()}),n;if(!i.length)return"";for(n=i[0];u(n.parentNode)&&k(n,n.parentNode)&&!b(n,yi);)n=n.parentNode;return u(n)&&b(n,yi)&&!t(ei(n)).some(hr)?n.tagName.toLowerCase():""}},o.forwarddelete={action:function(n,i){var y,l,v;if(r.browser.msie&&r.browser.version<=7&&wf(i,!0),!i.collapsed){et(i);return}ci(i.startContainer,i.startOffset);for(var e=i.startContainer,o=i.startOffset,p=!1,w=!1;;)if(o==c(e)&&u(e.nextSibling)&&ht(e.nextSibling))e.parentNode.removeChild(e.nextSibling);else if(o<e.childNodes.length&&u(e.childNodes[o])&&(ht(e.childNodes[o])||p||w)){if(e.removeChild(e.childNodes[o]),p||w){ui(e),i.setStart(e,o),i.setEnd(e,o);return}}else if(o<e.childNodes.length&&di(e.childNodes[o]))o++;else if(o==c(e)&&a(e)||ht(e))o=1+s(e),e=e.parentNode;else if(o<e.childNodes.length&&!nt(e.childNodes[o])&&!h(e.childNodes[o],["br","img"]))e=e.childNodes[o],o=0;else break;if(ci(i.startContainer,i.startOffset),y=ce(e,o),y){y.parentNode.removeChild(y);return}if(e.nodeType==t.Node.TEXT_NODE&&o!=c(e)){for(i.setStart(e,o),i.setEnd(e,o),l=o+1;l!=e.length&&/^[\u0300-\u036f\u0591-\u05bd\u05c1\u05c2]$/.test(e.data[l]);)l++;et(e,o,e,l);return}if(!a(e)){if(o<e.childNodes.length&&h(e.childNodes[o],["br","hr","img"])){i.setStart(e,o),i.setEnd(e,o),et(e,o,e,o+1);return}for(v=e,l=o;;)if(l==c(v))l=1+s(v),v=v.parentNode;else if(l<v.childNodes.length&&u(v.childNodes[l])&&ht(v.childNodes[l]))v.removeChild(v.childNodes[l]);else break;if(!f(v.childNodes[l-1],"table")){if(f(v.childNodes[l],"table")){i.setStart(v,l),i.setEnd(v,l+1);return}if(o==c(e)&&h(v.childNodes[l],["br","hr"])){i.setStart(e,o),i.setEnd(e,o),et(v,l,v,l+1);return}while(l<v.childNodes.length)u(v.childNodes[l])&&ht(v.childNodes[l])?v.removeChild(v.childNodes[l]):(v=v.childNodes[l],l=0);et(e,o,v,l)}}}},o.indent={action:function(){for(var r=[],o,s,t,i,n=e().endContainer;n!=e().commonAncestorContainer;n=n.parentNode)f(n,"LI")&&r.unshift(n);for(n=e().startContainer;n!=e().commonAncestorContainer;n=n.parentNode)f(n,"LI")&&r.unshift(n);for(n=e().commonAncestorContainer;n;n=n.parentNode)f(n,"LI")&&r.unshift(n);for(o=0;o<r.length;o++)tr(r[o],e());for(s=p(e()),t=[],t=dt(s,function(n){return u(n)&&(d(n,"div")||d(n,"ol"))}),t.length&&f(t[0],"LI")&&h(t[0].parentNode,["OL","UL"])&&f(t[0].previousSibling,"LI")&&tr(t[0].previousSibling,s);t.length;){for(i=[],i.push(t.shift());t.length&&t[0]==i[i.length-1].nextSibling;)i.push(t.shift());bu(i,s)}}},o.inserthorizontalrule={action:function(i,r){while(r.startOffset==0&&r.startContainer.parentNode)r.setStart(r.startContainer.parentNode,s(r.startContainer));while(r.endOffset==c(r.endContainer)&&r.endContainer.parentNode)r.setEnd(r.endContainer.parentNode,1+s(r.endContainer));if(et(r,{blockMerging:!1}),u(e().startContainer)||ut(e().startContainer)){e().startContainer.nodeType==t.Node.TEXT_NODE&&e().startOffset==0&&(e().setStart(e().startContainer.parentNode,s(e().startContainer)),e().collapse(!0)),e().startContainer.nodeType==t.Node.TEXT_NODE&&e().startOffset==c(e().startContainer)&&(e().setStart(e().startContainer.parentNode,1+s(e().startContainer)),e().collapse(!0));var f=document.createElement("hr");r.insertNode(f),vt(f,r),r.setStart(f.parentNode,1+s(f)),r.setEnd(f.parentNode,1+s(f)),n.getSelection().removeAllRanges(),n.getSelection().addRange(r)}}},o.inserthtml={action:function(n,i){var f,r,o,e;if((et(i),u(i.startContainer)||ut(i.startContainer))&&(f=i.createContextualFragment(n),r=f.lastChild,r)){for(o=ei(f),nt(i.startContainer)&&t(i.startContainer.childNodes).filter(function(n,t){return u(n)&&di(n)&&s(n)>=t.startOffset},!0).forEach(function(n){n.parentNode.removeChild(n)}),i.insertNode(f),nt(i.startContainer)&&ui(i.startContainer),i.setStart(r.parentNode,1+s(r)),i.setEnd(r.parentNode,1+s(r)),e=0;e<o.length;e++)vt(o[e],i);uf(i)}}},o.insertimage={action:function(t){var i,r;t!==""&&(i=e(),et(i,{stripWrappers:!1}),u(e().startContainer)||ut(e().startContainer))&&(nt(i.startContainer)&&i.startContainer.childNodes.length==1&&f(i.startContainer.firstChild,"br")&&i.startOffset==0&&i.startContainer.removeChild(i.startContainer.firstChild),r=document.createElement("img"),r.setAttribute("src",t),i.insertNode(r),i.setStart(r.parentNode,1+s(r)),i.setEnd(r.parentNode,1+s(r)),n.getSelection().removeAllRanges(),n.getSelection().addRange(i),r.removeAttribute("width"),r.removeAttribute("height"))}},o.insertlinebreak={action:function(i,f){var o,h,e;(et(f,{stripWrappers:!1}),u(f.startContainer)||ut(f.startContainer))&&(f.startContainer.nodeType!=t.Node.ELEMENT_NODE||d("br",f.startContainer))&&(f.startContainer.nodeType==t.Node.ELEMENT_NODE||d("br",f.startContainer.parentNode))&&(f.startContainer.nodeType==t.Node.TEXT_NODE&&f.startOffset==0&&(o=f.startContainer.parentNode,h=s(f.startContainer),n.getSelection().collapse(o,h),f.setStart(o,h),f.setEnd(o,h)),f.startContainer.nodeType==t.Node.TEXT_NODE&&f.startOffset==c(f.startContainer)&&(o=f.startContainer.parentNode,h=1+s(f.startContainer),n.getSelection().collapse(o,h),f.setStart(o,h),f.setEnd(o,h)),e=document.createElement("br"),f.insertNode(e),n.getSelection().collapse(e.parentNode,1+s(e)),f.setStart(e.parentNode,1+s(e)),f.setEnd(e.parentNode,1+s(e)),lu(e)&&(f.insertNode(nr()),n.getSelection().collapse(e.parentNode,1+s(e)),f.setStart(e.parentNode,1+s(e)),f.setEnd(e.parentNode,1+s(e))),r.browser.msie&&r.browser.version<8&&e.parentNode.removeAttribute("style"))}},o.insertorderedlist={action:function(n,t){pf("ol",t)},indeterm:function(){return/^mixed( ol)?$/.test(yr())},state:function(){return yr()=="ol"}},bf={LI:!0,DT:!0,DD:!0},o.insertparagraph={action:function(i,r){var y,o,a,e,g,nt,ct,tt,wt,l,it,ft,ni,v,st,b,at;if(et(r),be(tu(r.startContainer),r),u(r.startContainer)||ut(r.startContainer)){for(o=r.startContainer,a=r.startOffset,o.nodeType==t.Node.TEXT_NODE&&a!=0&&a!=c(o)&&o.splitText(a),o.nodeType==t.Node.TEXT_NODE&&a==c(o)&&(a=1+s(o),o=o.parentNode),(o.nodeType==t.Node.TEXT_NODE||o.nodeType==t.Node.COMMENT_NODE)&&(a=s(o),o=o.parentNode),n.getSelection().collapse(o,a),r.setStart(o,a),r.setEnd(o,a),e=o;!fu(e)&&u(e.parentNode)&&k(o,e.parentNode);)e=e.parentNode;if(!u(e)||!k(e,o)||!fu(e)){var ht=vi,ti=p(r),w=dt(ti,function(n){return d(n,"p")}).slice(0,1);if(!w.length){if(!d(ht,r.startContainer))return;e=document.createElement(ht),r.insertNode(e),e.appendChild(nr()),n.getSelection().collapse(e,0),r.setStart(e,0),r.setEnd(e,0);return}while(w[w.length-1].nextSibling&&d(w[w.length-1].nextSibling,"p"))w.push(w[w.length-1].nextSibling);e=yt(w,function(){return!1},function(){return document.createElement(ht)},r)}if(e.tagName=="ADDRESS"||e.tagName=="LISTING"||e.tagName=="PRE"){ct=document.createElement("br"),g=e.offsetHeight,r.insertNode(ct),nt=e.offsetHeight,n.getSelection().collapse(o,a+1),r.setStart(o,a+1),r.setEnd(o,a+1),g!=nt||wi(bt(ct),e)||(r.insertNode(nr()),n.getSelection().collapse(o,a+1),r.setEnd(o,a+1));return}if(bf[e.tagName]&&(!e.hasChildNodes()||e.childNodes.length==1&&f(e.firstChild,"br"))){if(pt([e],r),h(e,["dd","dt"])&&t(kt(e)).every(function(n){return!k(e,n)||!d(e,n)})&&(e=gt(e,vi,r)),vt(e,r),f(e,"li")&&f(e.nextSibling,"li")&&h(e.nextSibling.firstChild,["ol","ul"])){for(tt=e.nextSibling,wt=e.nextSibling.childNodes.length,y=0;y<wt;y++)e.appendChild(tt.childNodes[0]);tt.parentNode.removeChild(tt)}return}for(l=n.createRange(),l.setStart(r.startContainer,r.startOffset),l.setEnd(e,c(e));l.startOffset==0&&l.startContainer!=e;)l.setStart(l.startContainer.parentNode,s(l.startContainer));while(l.startOffset==c(l.startContainer)&&l.startContainer!=e)l.setStart(l.startContainer.parentNode,1+s(l.startContainer));it=dt(l),ft=!it.length||it.length==1&&f(it[0],"br"),ni=/^H[1-6]$/.test(e.tagName)&&ft?vi:e.tagName=="DT"&&ft?"dd":e.tagName=="DD"&&ft?"dt":e.tagName.toLowerCase(),v=document.createElement(ni),au(e,v),v.removeAttribute("id"),e.parentNode.insertBefore(v,e.nextSibling);var ii=rt(l),lt=l.extractContents(),ot=ei(lt);for(y=0;y<ot.length;y++)ot[y].nodeType==t.Node.ELEMENT_NODE&&t(ii).indexOf(ot[y])==-1&&ot[y].removeAttribute("id");if(st=[],b=lt.firstChild,b)do ai(b)||st.push(b);while(null!=(b=b.nextSibling));f(v,"li")&&st.length&&h(st[0],["ul","ol"])&&(g=v.offsetHeight,at=nr(),v.appendChild(at),nt=v.offsetHeight,g!==nt&&v.removeChild(at)),v.appendChild(lt),ui(e),ui(v),n.getSelection().collapse(v,0),r.setStart(v,0),r.setEnd(v,0)}}},o.inserttext={action:function(i,f){var l,e,s,a,v,h;if(et(f,{stripWrappers:!1}),u(f.startContainer)||ut(f.startContainer)){if(i.length>1){for(l=0;l<i.length;l++)o.inserttext.action(i[l],f);return}if(i!=""){if(i=="\n"){o.insertparagraph.action("",f);return}e=f.startContainer,s=f.startOffset,0<=s-1&&s-1<e.childNodes.length&&e.childNodes[s-1].nodeType==t.Node.TEXT_NODE&&(e=e.childNodes[s-1],s=c(e)),0<=s&&s<e.childNodes.length&&e.childNodes[s].nodeType==t.Node.TEXT_NODE&&(e=e.childNodes[s],s=0),a=e.nodeType==t.Node.ELEMENT_NODE?e:e.parentNode,i==" "&&a.nodeType==t.Node.ELEMENT_NODE&&r.inArray(t.getComputedStyle(a).whiteSpace,["pre","pre-wrap"])==-1&&(i=" "),v=ye(f),e.nodeType==t.Node.TEXT_NODE?(e.insertData(s,i),n.getSelection().collapse(e,s),f.setStart(e,s),n.getSelection().extend(e,s+1),f.setEnd(e,s+1)):(e.childNodes.length==1&&lu(e.firstChild)&&e.removeChild(e.firstChild),h=document.createTextNode(i),f.insertNode(h),n.getSelection().collapse(h,0),f.setStart(h,0),n.getSelection().extend(h,1),f.setEnd(h,1)),ir(v,f),ci(f.startContainer,f.startOffset),ci(f.endContainer,f.endOffset),n.getSelection().collapseToEnd(),f.collapse(!1)}}}},o.insertunorderedlist={action:function(n,t){pf("ul",t)},indeterm:function(){return/^mixed( ul)?$/.test(yr())},state:function(){return yr()=="ul"}},o.justifycenter={action:function(n,t){ou("center",t)},indeterm:function(){var n=rt(p(e()),function(n){return u(n)&&w(n)&&!n.hasChildNodes()});return t(n).some(function(n){return ft(n)=="center"})&&t(n).some(function(n){return ft(n)!="center"})},state:function(){var n=rt(p(e()),function(n){return u(n)&&w(n)&&!n.hasChildNodes()});return n.length&&t(n).every(function(n){return ft(n)=="center"})},value:function(){var n=rt(p(e()),function(n){return u(n)&&w(n)&&!n.hasChildNodes()});return n.length?ft(n[0]):"left"}},o.justifyfull={action:function(n,t){ou("justify",t)},indeterm:function(){var n=rt(p(e()),function(n){return u(n)&&w(n)&&!n.hasChildNodes()});return t(n).some(function(n){return ft(n)=="justify"})&&t(n).some(function(n){return ft(n)!="justify"})},state:function(){var n=rt(p(e()),function(n){return u(n)&&w(n)&&!n.hasChildNodes()});return n.length&&t(n).every(function(n){return ft(n)=="justify"})},value:function(){var n=rt(p(e()),function(n){return u(n)&&w(n)&&!n.hasChildNodes()});return n.length?ft(n[0]):"left"}},o.justifyleft={action:function(n,t){ou("left",t)},indeterm:function(){var n=rt(p(e()),function(n){return u(n)&&w(n)&&!n.hasChildNodes()});return t(n).some(function(n){return ft(n)=="left"})&&t(n).some(function(n){return ft(n)!="left"})},state:function(){var n=rt(p(e()),function(n){return u(n)&&w(n)&&!n.hasChildNodes()});return n.length&&t(n).every(function(n){return ft(n)=="left"})},value:function(){var n=rt(p(e()),function(n){return u(n)&&w(n)&&!n.hasChildNodes()});return n.length?ft(n[0]):"left"}},o.justifyright={action:function(n,t){ou("right",t)},indeterm:function(){var n=rt(p(e()),function(n){return u(n)&&w(n)&&!n.hasChildNodes()});return t(n).some(function(n){return ft(n)=="right"})&&t(n).some(function(n){return ft(n)!="right"})},state:function(){var n=rt(p(e()),function(n){return u(n)&&w(n)&&!n.hasChildNodes()});return n.length&&t(n).every(function(n){return ft(n)=="right"})},value:function(){var n=rt(p(e()),function(n){return u(n)&&w(n)&&!n.hasChildNodes()});return n.length?ft(n[0]):"left"}},o.outdent={action:function(){var o=[],r,n,i,s;for(function(){for(var n=e().endContainer;n!=e().commonAncestorContainer;n=n.parentNode)f(n,"li")&&o.unshift(n);for(n=e().startContainer;n;n=n.parentNode)f(n,"li")&&o.unshift(n)}(),t(o).forEach(function(n){tr(n,e())}),r=p(e()),n=dt(r,function(n){return u(n)&&(!t(ei(n)).some(u)||h(n,["ol","ul"])||f(n,"li")&&h(n.parentNode,["ol","ul"]))});n.length;){while(n.length&&(h(n[0],["OL","UL"])||!h(n[0].parentNode,["OL","UL"])))eu(n.shift(),r);if(!n.length)break;for(i=[],i.push(n.shift());n.length&&n[0]==i[i.length-1].nextSibling&&!h(n[0],["OL","UL"]);)i.push(n.shift());s=at(i),pt(i,r),t(i).forEach(vt),ii(s,r)}}},o.selectall={action:function(){var t=document.body;t||(t=document.documentElement),t?n.getSelection().selectAllChildren(t):n.getSelection().removeAllRanges()}},o.stylewithcss={action:function(n){rr=String(n).toLowerCase()!="false"},state:function(){return rr}},o.usecss={action:function(n){rr=String(n).toLowerCase()=="false"}},function(){var i=[],n;for(n in o)o.hasOwnProperty(n)&&i.push(n);t(i).forEach(function(n){null==o[n].relevantCssProperty&&(o[n].relevantCssProperty=null),null!=o[n].inlineCommandActivatedValues&&null==o[n].indeterm&&(o[n].indeterm=function(i){var r=t(it(i,function(n){return u(n)&&n.nodeType==t.Node.TEXT_NODE})).map(function(t){return v(t,n)}),f=t(r).filter(function(i){return t(o[n].inlineCommandActivatedValues).indexOf(i)!=-1});return f.length>=1&&r.length-f.length>=1}),null!=o[n].inlineCommandActivatedValues&&(o[n].state=function(i){var r=it(i,function(n){return u(n)&&n.nodeType==t.Node.TEXT_NODE});return r.length==0?t(o[n].inlineCommandActivatedValues).indexOf(v(i.startContainer,n))!=-1:t(r).every(function(i){return t(o[n].inlineCommandActivatedValues).indexOf(v(i,n))!=-1})}),null!=o[n].standardInlineValueCommand&&(o[n].indeterm=function(){for(var r=t(it(e())).filter(function(n){return u(n)&&n.nodeType==t.Node.TEXT_NODE},!0).map(function(t){return v(t,n)}),i=1;i<r.length;i++)if(r[i]!=r[i-1])return!0;return!1},o[n].value=function(i){var r=it(i,function(n){return u(n)&&n.nodeType==t.Node.TEXT_NODE})[0];return typeof r=="undefined"&&(r=i.startContainer),v(r,n)})})}(),{commands:o,execCommand:nu,queryCommandIndeterm:ne,queryCommandState:si,queryCommandValue:ff,queryCommandEnabled:gr,queryCommandSupported:te,copyAttributes:au,createEndBreak:nr,isEndBreak:ae,ensureContainerEditable:ui,isEditingHost:ut,isEditable:u,getStateOverride:bi,setStateOverride:kr,resetOverrides:oi,unsetStateOverride:dr}}),define("aloha/selection",["aloha/core","jquery","util/class","util/range","util/arrays","util/strings","aloha/console","PubSub","aloha/engine","aloha/ecma5shims","aloha/rangy-core"],function(n,t,i,r,u,f,e,o,s,h){function w(n){var t;return n.startContainer!==n.endContainer?!1:n.startContainer.nodeType!=1?!1:(t=n.startContainer.firstChild,!t||!t.nextSibling&&t.nodeName=="BR")}function b(n){return n.startContainer!==n.endContainer?!1:n.startContainer.nodeType!=1?!1:s.isEndBreak(n.startContainer)}function k(n,t){var i=[],r,f,u;for(1===n.nodeType&&n.nodeName!=="BODY"&&n.nodeName!=="HTML"?i.push(n.cloneNode(!1).outerHTML):i.push("#"+n.nodeType),u=0,f=t.length;u<f;u++){if(r=t[u],r.nodeName==="BODY"||r.nodeName==="HTML")break;i.push(r.cloneNode(!1).outerHTML)}return i.join("")}function y(i,r){var o=n.activeEditable?n.activeEditable.obj.parent()[0]:null,f=t(i).parentsUntil(o).get(),e=k(i,f),s=r&&i===r.node&&u.equal(r.parents,f)&&e===r.html;return s?null:{node:i,parents:f,html:e}}function d(n,t){var u=n.startContainer,f=n.endContainer,i,r;if(!u||!f){e.warn("aloha/selection","encountered range object without start or end container");return}(i=y(u,a),r=y(f,v),i||r)&&(a=i,v=r,o.pub("aloha.selection.context-change",{range:n,event:t}))}function nt(n){var i;t.browser.msie&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset&&n.startContainer.nodeType==3&&n.startOffset==n.startContainer.data.length&&n.startContainer.nextSibling&&(i=n.startContainer.nextSibling,("OL"===i.nodeName||"UL"===i.nodeName)&&(n.startContainer.data[n.startContainer.data.length-1]==" "?n.startOffset=n.endOffset=n.startOffset-1:n.startContainer.data=n.startContainer.data+" "))}function p(n){return nt(n),n}var c=window.GENTICS,a=null,v=null,g=i.extend({_constructor:function(){this.rangeObject={},this.preventSelectionChangedFlag=!1,this.tagHierarchy={textNode:{},abbr:{textNode:!0},b:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,a:!0,del:!0,ins:!0,u:!0,cite:!0,q:!0,code:!0,abbr:!0,strong:!0},pre:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,a:!0,del:!0,ins:!0,u:!0,cite:!0,q:!0,code:!0,abbr:!0},blockquote:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,a:!0,del:!0,ins:!0,u:!0,cite:!0,q:!0,code:!0,abbr:!0,p:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0},ins:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,a:!0,u:!0,p:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0},ul:{li:!0},ol:{li:!0},li:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,ul:!0,ol:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,del:!0,ins:!0,u:!0,a:!0},tr:{td:!0,th:!0},table:{tr:!0},div:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,ul:!0,ol:!0,table:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,del:!0,ins:!0,u:!0,p:!0,div:!0,pre:!0,blockquote:!0,a:!0},h1:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,a:!0,del:!0,ins:!0,u:!0}},this.tagHierarchy={textNode:this.tagHierarchy.textNode,abbr:this.tagHierarchy.abbr,br:this.tagHierarchy.textNode,img:this.tagHierarchy.textNode,b:this.tagHierarchy.b,strong:this.tagHierarchy.b,code:this.tagHierarchy.b,q:this.tagHierarchy.b,blockquote:this.tagHierarchy.blockquote,cite:this.tagHierarchy.b,i:this.tagHierarchy.b,em:this.tagHierarchy.b,sup:this.tagHierarchy.b,sub:this.tagHierarchy.b,span:this.tagHierarchy.b,del:this.tagHierarchy.del,ins:this.tagHierarchy.ins,u:this.tagHierarchy.b,p:this.tagHierarchy.b,pre:this.tagHierarchy.pre,a:this.tagHierarchy.b,ul:this.tagHierarchy.ul,ol:this.tagHierarchy.ol,li:this.tagHierarchy.li,td:this.tagHierarchy.li,div:this.tagHierarchy.div,h1:this.tagHierarchy.h1,h2:this.tagHierarchy.h1,h3:this.tagHierarchy.h1,h4:this.tagHierarchy.h1,h5:this.tagHierarchy.h1,h6:this.tagHierarchy.h1,table:this.tagHierarchy.table},this.replacingElements={h1:{p:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,pre:!0,blockquote:!0}},this.replacingElements={h1:this.replacingElements.h1,h2:this.replacingElements.h1,h3:this.replacingElements.h1,h4:this.replacingElements.h1,h5:this.replacingElements.h1,h6:this.replacingElements.h1,pre:this.replacingElements.h1,p:this.replacingElements.h1,blockquote:this.replacingElements.h1},this.allowedToStealElements={h1:{textNode:!0}},this.allowedToStealElements={h1:this.allowedToStealElements.h1,h2:this.allowedToStealElements.h1,h3:this.allowedToStealElements.h1,h4:this.allowedToStealElements.h1,h5:this.allowedToStealElements.h1,h6:this.allowedToStealElements.h1,p:this.tagHierarchy.b}},SelectionTree:function(){this.domobj={},this.selection=undefined,this.children=[]},onChange:function(t,i,r){this.updateSelectionTimeout&&window.clearTimeout(this.updateSelectionTimeout);var u=this;this.updateSelectionTimeout=window.setTimeout(function(){var f=new n.Selection.SelectionRange(!0);if(!f.startContainer||"HTML"===f.startContainer.nodeName||"BODY"===f.startContainer.nodeName){if(!this.updateSelectionTimeout)u.onChange(t,i,10+(r||5)*2);return}n.Selection._updateSelection(i,f)},r||5)},preventSelectionChanged:function(){this.preventSelectionChangedFlag=!0},isSelectionChangedPrevented:function(){var n=this.preventSelectionChangedFlag;return this.preventSelectionChangedFlag=!1,n},isSelectionEditable:function(){return this.rangeObject.commonAncestorContainer&&t(this.rangeObject.commonAncestorContainer).contentEditable()},isFloatingMenuVisible:function(){var i=t(n.Selection.rangeObject.commonAncestorContainer).attr("data-aloha-floatingmenu-visible");return i!=="undefined"?i==="true"?!0:!1:!1},updateSelection:function(n){return this._updateSelection(n,null)},_updateSelection:function(i,r){var u,f,e;return i&&i.originalEvent&&!0===i.originalEvent.stopSelectionUpdate?!1:typeof r=="undefined"?!1:(this.rangeObject=r=r||new n.Selection.SelectionRange(!0),r.update(),r&&r.startContainer&&r.endContainer&&(u=t(r.commonAncestorContainer).closest(".aloha-editable").length>0,u&&(f=!(3===r.startContainer.nodeType&&!t(r.startContainer.parentNode).contentEditable()),e=!(3===r.endContainer.nodeType&&!t(r.endContainer.parentNode).contentEditable()),!f||!e)))?(n.getSelection().removeAllRanges(),!0):this.isSelectionChangedPrevented()?!0:(n.trigger("aloha-selection-changed-before",[this.rangeObject,i]),n.trigger("aloha-selection-changed",[this.rangeObject,i]),d(this.rangeObject,i),n.trigger("aloha-selection-changed-after",[this.rangeObject,i]),!0)},getSelectionTree:function(t){return t?t.commonAncestorContainer?(this.inselection=!1,c.Utils.Dom.doCleanup({merge:!0},t)&&(t.update(),t.select()),this.recursiveGetSelectionTree(t,t.commonAncestorContainer)):(n.Log.error(this,"the rangeObject is missing the commonAncestorContainer"),!1):this.rangeObject.getSelectionTree()},recursiveGetSelectionTree:function(i,r){var o=t(r),u=0,e=this,f=[];return o.contents().each(function(t){var o="none",s=!1,c=!1,l=!1,h,a,v=!1,y=!1,p=!1,w;if(i.isCollapsed()&&r===i.startContainer&&i.startOffset==t&&(f[u]=new n.Selection.SelectionTree,f[u].selection="collapsed",f[u].domobj=undefined,e.inselection=!1,l=!0,u++),!e.inselection&&!l){try{w=this.nodeType}catch(b){return}switch(w){case 3:this===i.startContainer&&(e.inselection=!0,o=i.startOffset>0?"partial":"full",s=i.startOffset,c=this.length);break;case 1:this===i.startContainer&&i.startOffset===0&&(e.inselection=!0,o="full"),r===i.startContainer&&i.startOffset===t&&(e.inselection=!0,o="full")}}if(e.inselection&&!l){o=="none"&&(o="full");switch(this.nodeType){case 3:this===i.endContainer&&(e.inselection=!1,i.endOffset<this.length&&(o="partial"),s===!1&&(s=0),c=i.endOffset);break;case 1:this===i.endContainer&&i.endOffset===0&&(e.inselection=!1)}r===i.endContainer&&i.endOffset<=t&&(e.inselection=!1,o="none")}if(f[u]=new n.Selection.SelectionTree,f[u].domobj=this,f[u].selection=o,o=="partial"&&(f[u].startOffset=s,f[u].endOffset=c),f[u].children=e.recursiveGetSelectionTree(i,this),a=f[u].children.length,a>0){for(h=0;h<a;++h)switch(f[u].children[h].selection){case"none":v=!0;break;case"full":p=!0;break;case"partial":y=!0}y||p&&v?f[u].selection="partial":!p||y||v||(f[u].selection="full")}u++}),i.isCollapsed()&&r===i.startContainer&&i.startOffset==r.childNodes.length&&(f[u]=new n.Selection.SelectionTree,f[u].selection="collapsed",f[u].domobj=undefined),f},getRangeObject:function(){return this.rangeObject},isRangeObjectWithinMarkup:function(i,r,u,f,e){var l=r?i.endContainer:i.startContainer,s=this,h=t(l).parents(),o=!1,c=-1;return typeof f!="undefined"&&typeof f!="function"&&n.Log.error(this,"parameter tagComparator is not a function"),typeof f=="undefined"&&(f=function(n,t){return s.standardTextLevelSemanticsComparator(n,t)}),h.length>0&&h.each(function(){return this===e?(n.Log.debug(s,"reached limit dom obj"),!1):f(this,u)?(o===!1&&(o=[]),n.Log.debug(s,"reached object equal to markup"),c++,o[c]=this,!0):void 0}),o},standardSectionsAndGroupingContentComparator:function(t,i){if(t.nodeType!==1)return n.Log.debug(this,"only element nodes (nodeType == 1) can be compared"),!1;if(!i[0].nodeName)return!1;var r=n.Selection.replacingElements[t.nodeName.toLowerCase()];return r&&r[i[0].nodeName.toLowerCase()]},standardTagNameComparator:function(t,i){return t.nodeType===1?t.nodeName!=i[0].nodeName?!1:!0:(n.Log.debug(this,"only element nodes (nodeType == 1) can be compared"),!1)},standardTextLevelSemanticsComparator:function(t,i){return t.nodeType===1?t.nodeName!=i[0].nodeName?!1:this.standardAttributesComparator(t,i)?!0:!1:(n.Log.debug(this,"only element nodes (nodeType == 1) can be compared"),!1)},standardAttributesComparator:function(n,t){var i=f.words(n&&n.className||""),r=f.words(t.length&&t[0].className||"");return u.sortUnique(i),u.sortUnique(r),u.equal(i,r)},changeMarkup:function(i,r,u){var nt=r[0].tagName.toLowerCase(),k,p,f,v=this.isRangeObjectWithinMarkup(i,!1,r,u,p),c=this.isRangeObjectWithinMarkup(i,!0,r,u,p),d,l,g,o,e,y,a;if(this.replacingElements[nt])f=i,i=new this.SelectionRange(i),k=n.activeEditable?n.activeEditable.obj.get(0):t("body"),i.update(k),r.isReplacingElement=!0;else if(i.isCollapsed())return n.Log.debug(this,"early returning from applying markup because nothing is currently selected"),!1;if(p=n.activeEditable?n.activeEditable.obj[0]:t("body"),r.isReplacingElement||i.startOffset!==0||null!=(g=this.getTextNodeSibling(!1,i.commonAncestorContainer.parentNode,i.startContainer))&&(o=this.isRangeObjectWithinMarkup({startContainer:g,startOffset:0},!1,r,u,p)),r.isReplacingElement||i.endOffset!==i.endContainer.length||null!=(d=this.getTextNodeSibling(!0,i.commonAncestorContainer.parentNode,i.endContainer))&&(l=this.isRangeObjectWithinMarkup({startContainer:d,startOffset:0},!1,r,u,p)),r.isReplacingElement||!v||c){if(!r.isReplacingElement&&v&&c)n.Log.info(this,"markup 2 markup"),this.prepareForRemoval(i.getSelectionTree(),r,u),this.splitRelevantMarkupObject(v,c,i,u);else if(!r.isReplacingElement&&(!v&&c||l||o))n.Log.info(this,"non-markup 2 markup OR with next2markup"),o&&l?(e=new n.Selection.SelectionRange(i),e.startContainer=t(o[o.length-1]).textNodes()[0],e.startOffset=0,e.endContainer=t(l[l.length-1]).textNodes().last()[0],e.endOffset=e.endContainer.length,e.update(),this.applyMarkup(e.getSelectionTree(),i,r,u),n.Log.info(this,"double extending previous markup(previous and after selection), actually wrapping it ...")):!o||l||c?o&&!l&&c?(e=new n.Selection.SelectionRange(i),e.startContainer=t(o[o.length-1]).textNodes()[0],e.startOffset=0,e.endContainer=t(c[c.length-1]).textNodes().last()[0],e.endOffset=e.endContainer.length,e.update(),this.applyMarkup(e.getSelectionTree(),i,r,u),n.Log.info(this,"double extending previous markup(previous and relevant at the end), actually wrapping it ...")):!o&&l?(this.extendExistingMarkupWithSelection(l,i,!0,u),n.Log.info(this,"extending following markup backwards")):this.extendExistingMarkupWithSelection(c,i,!0,u):(this.extendExistingMarkupWithSelection(o,i,!1,u),n.Log.info(this,"extending previous markup"));else if(r.isReplacingElement||!v&&!c&&!o&&!l){if(n.Log.info(this,"non-markup 2 non-markup"),w(i)){a=r.clone(),b(i)&&a[0].appendChild(s.createEndBreak()),n.activeEditable&&t.browser.mozilla&&n.activeEditable.obj.focus(),s.isEditable(i.startContainer)?(s.copyAttributes(i.startContainer,a[0]),t(i.startContainer).after(a[0]).remove()):s.isEditingHost(i.startContainer)&&(t(i.startContainer).append(a[0]),s.ensureContainerEditable(a[0])),f.startContainer=a[0],f.endContainer=a[0],f.startOffset=0,f.endOffset=0;return}this.applyMarkup(i.getSelectionTree(),i,r,u,{setRangeObject2NewMarkup:!0}),f.startContainer=i.startContainer,f.endContainer=i.endContainer,f.startOffset=i.startOffset,f.endOffset=i.endOffset}}else n.Log.info(this,"markup 2 non-markup"),this.prepareForRemoval(i.getSelectionTree(),r,u),t(v).addClass("preparedForRemoval"),this.insertCroppedMarkups(v,i,!1,u);r.isReplacingElement&&(f&&f.startContainer.className&&f.startContainer.className.indexOf("preparedForRemoval")>-1&&(y=t(f.startContainer).parents(r[0].tagName).get(0),f.startContainer=y,i.startContainer=y),f&&f.endContainer.className&&f.endContainer.className.indexOf("preparedForRemoval")>-1&&(y=t(f.endContainer).parents(r[0].tagName).get(0),f.endContainer=y,i.endContainer=y)),t(".preparedForRemoval").zap(),r.isReplacingElement?(h.Node.ELEMENT_NODE===f.startContainer.nodeType&&f.startContainer.childNodes&&f.startContainer.childNodes.length<f.startOffset&&(f.startOffset=f.startContainer.childNodes.length,i.startOffset=f.startContainer.childNodes.length),h.Node.ELEMENT_NODE===f.endContainer.nodeType&&f.endContainer.childNodes&&f.endContainer.childNodes.length<f.endOffset&&(f.endOffset=f.endContainer.childNodes.length,i.endOffset=f.endContainer.childNodes.length),i.endContainer=f.endContainer,i.endOffset=f.endOffset,i.startContainer=f.startContainer,i.startOffset=f.startOffset,f.update(),f.select()):(i.update(),i.select())},areMarkupObjectsAsLongAsRangeObject:function(n,i,r){var u,f,e,o,s;if(r.startOffset!==0)return!1;for(u=0,s=n.length;u<s;u++)if(f=t(n[u]),f.textNodes().first()[0]!==r.startContainer)return!1;for(u=0,o=i.length;u<o;u++)if(f=t(i[u]),e=f.textNodes().last()[0],e!==r.endContainer||e.length!=r.endOffset)return!1;return!0},splitRelevantMarkupObject:function(n,i,r,u){if(t(n).addClass("preparedForRemoval"),t(i).addClass("preparedForRemoval"),this.areMarkupObjectsAsLongAsRangeObject(n,i,r))return!0;var f=this.intersectRelevantMarkupObjects(n,i);return f?(this.insertCroppedMarkups([f],r,!1,u),this.insertCroppedMarkups([f],r,!0,u)):(this.insertCroppedMarkups(n,r,!1,u),this.insertCroppedMarkups(i,r,!0,u)),!0},intersectRelevantMarkupObjects:function(n,t){var u=!1,i,f,r,e,o,s;if(!n||!t)return u;for(o=n.length,s=t.length,i=0;i<o;i++)for(f=n[i],r=0;r<s;r++)e=t[r],f===e&&(u=f);return u},extendExistingMarkupWithSelection:function(n,i,r,u){var h,c,e,f,a,s,o,l;for(r||(h=!0),r&&(c=!0),e=[],f=0,a=n.length;f<a;f++)e[f]=new this.SelectionRange,s=n[f],c&&!h&&(e[f].startContainer=i.startContainer,e[f].startOffset=i.startOffset,o=t(s).textNodes(!0),l=o.length-1,e[f].endContainer=o[l],e[f].endOffset=o[l].length,e[f].update(),this.applyMarkup(e[f].getSelectionTree(),i,this.getClonedMarkup4Wrapping(s),u,{setRangeObject2NewMarkup:!0})),!c&&h&&(o=t(s).textNodes(!0),e[f].startContainer=o[0],e[f].startOffset=0,e[f].endContainer=i.endContainer,e[f].endOffset=i.endOffset,e[f].update(),this.applyMarkup(e[f].getSelectionTree(),i,this.getClonedMarkup4Wrapping(s),u,{setRangeObject2NewMarkup:!0}));return!0},getClonedMarkup4Wrapping:function(n){var i=t(n.outerHTML).removeClass("preparedForRemoval").empty();return i.attr("class").length===0&&i.removeAttr("class"),i},insertCroppedMarkups:function(n,i,r,u){var h,c,s,e,f,o,l;for(r?c=!0:h=!0,e=[],f=0;f<n.length;f++){if(e[f]=new this.SelectionRange,o=n[f],h&&!c){if(l=t(o).textNodes(!0),e[f].startContainer=l[0],e[f].startOffset=0,e[f].startContainer===i.startContainer&&e[f].startOffset===i.startOffset)continue;i.startOffset===0?(e[f].endContainer=this.getTextNodeSibling(!1,o,i.startContainer),e[f].endOffset=e[f].endContainer.length):(e[f].endContainer=i.startContainer,e[f].endOffset=i.startOffset),e[f].update(),this.applyMarkup(e[f].getSelectionTree(),i,this.getClonedMarkup4Wrapping(o),u,{setRangeObject2NextSibling:!0})}!h&&c&&(e[f].startContainer=i.endContainer,e[f].startOffset=i.endOffset,s=t(o).textNodes(!0),e[f].endContainer=s[s.length-1],e[f].endOffset=s[s.length-1].length,e[f].update(),this.applyMarkup(e[f].getSelectionTree(),i,this.getClonedMarkup4Wrapping(o),u,{setRangeObject2PreviousSibling:!0}))}return!0},changeMarkupOnSelection:function(n){var t=this.getRangeObject();this.changeMarkup(t,n,this.getStandardTagComparator(n)),c.Utils.Dom.doCleanup({merge:!0},t),t.update(),t.select(),this.rangeObject=t},applyMarkup:function(t,i,r,u,f){var s,e,o,h;for(f=f||{},this.prepareForRemoval(t,r,u),s=this.optimizeSelectionTree4Markup(t,r,u),h=!0,e=0;e<s.length;e++)o=s[e],o.wrappable?this.wrapMarkupAroundSelectionTree(o.elements,i,r,u,f):(n.Log.debug(this,"dive further into non-wrappable object"),this.applyMarkup(o.element.children,i,r,u,f))},getMarkupType:function(i){var r=t(i)[0].nodeName.toLowerCase();if(i.outerHtml&&n.Log.debug(this,"Node name detected: "+r+" for: "+i.outerHtml()),r=="#text")return"textNode";if(this.replacingElements[r])return"sectionOrGroupingContent";if(this.tagHierarchy[r])return"textLevelSemantics";n.Log.warn(this,"unknown markup passed to this.getMarkupType(...): "+i.outerHtml())},getStandardTagComparator:function(n){var i=this,t;switch(this.getMarkupType(n)){case"textNode":t=function(){return!1};break;case"sectionOrGroupingContent":t=function(n,t){return i.standardSectionsAndGroupingContentComparator(n,t)};break;default:t=function(n,t){return i.standardTextLevelSemanticsComparator(n,t)}}return t},prepareForRemoval:function(i,r,u){var o=this,e,f;for(typeof u!="undefined"&&typeof u!="function"&&n.Log.error(this,"parameter tagComparator is not a function"),typeof u=="undefined"&&(u=this.getStandardTagComparator(r)),e=0;e<i.length;e++)f=i[e],f.domobj&&(f.selection=="full"||f.selection=="partial"&&r.isReplacingElement)&&f.domobj.nodeType===1&&u(f.domobj,r)&&(n.Log.debug(this,"Marking for removal: "+f.domobj.nodeName),t(f.domobj).addClass("preparedForRemoval")),f.selection!="none"&&f.children.length>0&&this.prepareForRemoval(f.children,r,u)},wrapMarkupAroundSelectionTree:function(i,r,u,f,e){var s=[],h=-1,k=!0,y="",p="",a,l,w,c,v,o,b;for(n.Log.debug(this,"The formatting <"+u[0].tagName+"> will be wrapped around the selection"),v=0;v<i.length;v++){if(o=i[v],o.domobj&&!this.canTag1WrapTag2(o.domobj.parentNode.tagName.toLowerCase(),u[0].tagName.toLowerCase())){n.Log.info(this,"Skipping the wrapping of <"+u[0].tagName.toLowerCase()+"> because this tag is not allowed inside <"+o.domobj.parentNode.tagName.toLowerCase()+">");continue}if(!o.domobj||o.domobj.nodeType!==3||t.trim(o.domobj.nodeValue).length!==0){if(o.domobj&&o.selection=="partial"&&!u.isReplacingElement)if(o.startOffset!==undefined&&o.endOffset===undefined)h++,y+=o.domobj.data.substr(0,o.startOffset),o.domobj.data=o.domobj.data.substr(o.startOffset,o.domobj.data.length-o.startOffset),s[h]=o.domobj;else if(o.endOffset!==undefined&&o.startOffset===undefined)h++,p+=o.domobj.data.substr(o.endOffset,o.domobj.data.length-o.endOffset),o.domobj.data=o.domobj.data.substr(0,o.endOffset),s[h]=o.domobj;else if(o.endOffset!==undefined&&o.startOffset!==undefined){if(o.startOffset==o.endOffset){n.Log.debug(this,"skipping empty selection");continue}h++,y+=o.domobj.data.substr(0,o.startOffset),b=o.domobj.data.substr(o.startOffset,o.endOffset-o.startOffset),p+=o.domobj.data.substr(o.endOffset,o.domobj.data.length-o.endOffset),o.domobj.data=b,s[h]=o.domobj}else n.Log.debug(this,"diving into object"),this.applyMarkup(o.children,r,u,f,e);o.domobj&&(o.selection=="full"||o.selection=="partial"&&u.isReplacingElement)&&(h++,s[h]=o.domobj)}}s.length>0&&(s=t(s),t.each(s,function(n,i){t.browser.msie&&i.nodeType==3&&!i.nextSibling&&!i.previousSibling&&i.parentNode&&i.parentNode.nodeName.toLowerCase()=="li"&&(i.data=t.trim(i.data))}),c=s.wrapAll(u).parent(),c.before(y).after(p),e.setRangeObject2NewMarkup&&(w=s.textNodes(),w.index(r.startContainer)!=-1&&(r.startOffset=0),w.index(r.endContainer)!=-1&&(r.endOffset=r.endContainer.length),k=!0),e.setRangeObject2NextSibling&&(a=!0,l=c.textNodes(!0).last()[0],s.index(r.startContainer)!=-1&&(r.startContainer=this.getTextNodeSibling(a,c.parent(),l),r.startOffset=0),s.index(r.endContainer)!=-1&&(r.endContainer=this.getTextNodeSibling(a,c.parent(),l),r.endOffset=r.endOffset-l.length)),e.setRangeObject2PreviousSibling&&(a=!1,l=c.textNodes(!0).first()[0],s.index(r.startContainer)!=-1&&(r.startContainer=this.getTextNodeSibling(a,c.parent(),l),r.startOffset=0),s.index(r.endContainer)!=-1&&(r.endContainer=this.getTextNodeSibling(a,c.parent(),l),r.endOffset=r.endContainer.length)))},getTextNodeSibling:function(n,i,r){var f=t(i).textNodes(!0),e,u;return(u=f.index(r),u==-1)?!1:(e=u+(n?1:-1),f[e]||!1)},optimizeSelectionTree4Markup:function(n,i,r){var f=[],u=0,s=0,l=this,o,e,h,c;for(typeof r=="undefined"&&(r=function(n,t){return l.standardTextLevelSemanticsComparator(t)}),o=0;o<n.length;o++)if(n[o].domobj&&n[o].selection!="none")if(i.isReplacingElement&&r(i[0],t(n[o].domobj)))f[u]!==undefined&&u++,f[u]={},f[u].wrappable=!0,f[u].elements=[],f[u].elements[s]=n[o],u++;else if(this.canMarkupBeApplied2ElementAsWhole([n[o]],i))if(f[u]===undefined&&(f[u]={},f[u].wrappable=!0,f[u].elements=[]),i.isReplacingElement){for(c=o,e=o-1;e>=0;e--)if(this.canMarkupBeApplied2ElementAsWhole([n[e]],i)&&this.isMarkupAllowedToStealSelectionTreeElement(n[e],i))c=e;else break;for(h=o,e=o+1;e<n.length;e++)if(this.canMarkupBeApplied2ElementAsWhole([n[e]],i)&&this.isMarkupAllowedToStealSelectionTreeElement(n[e],i))h=e;else break;for(s=0,e=c;e<=h;e++)f[u].elements[s]=n[e],f[u].elements[s].selection="full",s++;s=0}else f[u].elements[s]=n[o],s++;else f[u]!==undefined&&u++,f[u]={},f[u].wrappable=!1,f[u].element=n[o],s=0,u++;return f},isMarkupAllowedToStealSelectionTreeElement:function(n,t){if(!n.domobj)return!1;var i=n.domobj.nodeName.toLowerCase(),u=i=="#text"?"textNode":i,f=t[0].nodeName.toLowerCase(),r=this.allowedToStealElements[f];return r&&r[u]},canMarkupBeApplied2ElementAsWhole:function(n,t){var u,r,i,f;for(t.jquery&&(u=t[0].tagName),t.tagName&&(u=t.tagName),f=!0,r=0;r<n.length;r++)if(i=n[r],i.domobj&&(i.selection!="none"||t.isReplacingElement)&&(!this.canTag1WrapTag2(u,i.domobj.nodeName)||i.children.length>0&&!this.canMarkupBeApplied2ElementAsWhole(i.children,t)))return!1;return f},canTag1WrapTag2:function(n,t){n=n=="#text"?"textNode":n.toLowerCase(),t=t=="#text"?"textNode":t.toLowerCase();var i=this.tagHierarchy[n];return i?this.tagHierarchy[t]?i[t]:!0:!0},mayInsertTag:function(t){var i;if(typeof this.rangeObject.unmodifiableMarkupAtStart=="object"){for(i=0;i<this.rangeObject.unmodifiableMarkupAtStart.length;++i)if(!this.canTag1WrapTag2(this.rangeObject.unmodifiableMarkupAtStart[i].nodeName,t))return!1;return!0}return n.Log.warn(this,"Unable to determine whether tag "+t+" may be inserted"),!0},toString:function(){return"Aloha.Selection"},SelectionRange:c.Utils.RangeObject.extend({_constructor:function(n){this._super(n),n&&(n.commonAncestorContainer&&(this.commonAncestorContainer=n.commonAncestorContainer),n.selectionTree&&(this.selectionTree=n.selectionTree),n.limitObject&&(this.limitObject=n.limitObject),n.markupEffectiveAtStart&&(this.markupEffectiveAtStart=n.markupEffectiveAtStart),n.unmodifiableMarkupAtStart&&(this.unmodifiableMarkupAtStart=n.unmodifiableMarkupAtStart),n.splitObject&&(this.splitObject=n.splitObject))},commonAncestorContainer:undefined,selectionTree:undefined,markupEffectiveAtStart:[],unmodifiableMarkupAtStart:[],limitObject:undefined,splitObject:undefined,select:function(){this._super(),n.Selection.updateSelection()},update:function(n){this.updatelimitObject(),this.updateMarkupEffectiveAtStart(),this.updateCommonAncestorContainer(n),this.selectionTree=undefined},getSelectionTree:function(){return this.selectionTree||(this.selectionTree=n.Selection.getSelectionTree(this)),this.selectionTree},getSelectedSiblings:function(n){var t=this.getSelectionTree();return this.recursionGetSelectedSiblings(n,t)},recursionGetSelectedSiblings:function(n,t){for(var r=!1,u=!1,i=0;i<t.length;++i)if(t[i].domobj===n)u=!0,r=[];else if(!u&&t[i].children){if(r=this.recursionGetSelectedSiblings(n,t[i].children),r!==!1)break}else if(u&&t[i].domobj&&t[i].selection!="collapsed"&&t[i].selection!="none")r.push(t[i].domobj);else if(u&&t[i].selection=="none")break;return r},updateMarkupEffectiveAtStart:function(){this.markupEffectiveAtStart=[],this.unmodifiableMarkupAtStart=[];for(var r=this.getStartContainerParents(),u=!1,i,n,t=0;t<r.length;t++)n=r[t],u||n===this.limitObject?(u=!0,this.unmodifiableMarkupAtStart.push(n)):(this.markupEffectiveAtStart[t]=n,!i&&c.Utils.Dom.isSplitObject(n)&&(i=!0,this.splitObject=n));i||(this.splitObject=!1);return},updatelimitObject:function(){if(n.editables&&n.editables.length>0)for(var f=this.getStartContainerParents(),e=n.editables,u,r,o,i=0;i<f.length;i++)for(u=f[i],r=0;r<e.length;r++)if(o=e[r].obj[0],u===o)return this.limitObject=u,!0;return this.limitObject=t("body"),!0},toString:function(n){return n?"Aloha.Selection.SelectionRange {start ["+this.startContainer.nodeValue+"] offset "+this.startOffset+", end ["+this.endContainer.nodeValue+"] offset "+this.endOffset+"}":"Aloha.Selection.SelectionRange"}})}),tt=i.extend({_constructor:function(n){this._nativeSelection=n,this.ranges=[],this.preventChange=!1},anchorNode:null,anchorOffset:0,focusNode:null,focusOffset:0,isCollapsed:!1,rangeCount:0,collapse:function(n,t){this._nativeSelection.collapse(n,t)},collapseToStart:function(){throw"NOT_IMPLEMENTED";},extend:function(){},modify:function(){},collapseToEnd:function(){this._nativeSelection.collapseToEnd()},selectAllChildren:function(){throw"NOT_IMPLEMENTED";},deleteFromDocument:function(){throw"NOT_IMPLEMENTED";},getRangeAt:function(n){return p(this._nativeSelection.getRangeAt(n))},addRange:function(t){this._nativeSelection.addRange(t),this._nativeSelection._ranges[0]=p(t),n.Selection.updateSelection()},removeRange:function(){this._nativeSelection.removeRange()},removeAllRanges:function(){this._nativeSelection.removeAllRanges()},refresh:function(){},toString:function(){return"Aloha.Selection"},getRangeCount:function(){return this._nativeSelection.rangeCount}}),l;return n.getSelection=function(n){return n=n!==document||n!==window?window:n,new tt(window.rangy.getSelection(n))},n.createRange=function(n){return window.rangy.createRange(n)},l=new g,n.Selection=l,l}),define("aloha/block-jump",["aloha/core","jquery","aloha/console"],function(n,t,i){function f(n,i){n.deleteData(0,n.length),""!==i&&(n.nextSibling&&3===n.nextSibling.nodeType?n.nextSibling.insertData(0,i):n.previousSibling&&3===n.previousSibling.nodeType?n.previousSibling.insertData(n.previousSibling.length,i):n.insertData(0,i)),setTimeout(function(){0===n.length&&t(n).remove()},0)}function u(){if(r){var n=r.nodeValue.replace(/\u200b/,"");n===r.nodeValue&&i.warn("Expected to remove the zero width text node fix, but couldn't find it"),f(r,n),r=null}}function e(i,f){return u(),r=document.createTextNode("​"),f?t(i).after(r):t(i).before(r),n.bind("aloha-selection-changed",function(t){u(),n.unbind(t)}),r}var r=null;return{removeZeroWidthTextNodeFix:u,insertZeroWidthTextNodeFix:e}}),define("aloha/markup",["aloha/core","util/class","jquery","aloha/ecma5shims","aloha/console","aloha/block-jump"],function(n,t,i,r,u,f){function y(n){return"BR"===n.nodeName}function c(n){return"false"===i(n).attr("contenteditable")}function o(n){return n&&3===n.nodeType}function l(n){return n?o(n)?n.length:n.childNodes.length:0}function p(n){return 0<n.data.replace(/\s+/g,"").length}function s(n){return n?n.nextSibling?o(n.nextSibling)&&!p(n.nextSibling)?s(n.nextSibling):y(n.nextSibling)&&n.nextSibling===n.parentNode.lastChild?s(n.nextSibling):""===n.nextSibling.innerHTML&&!c(n.nextSibling)?s(n.nextSibling):n.nextSibling:n.parentNode?s(n.parentNode):null:null}function h(n){return n?n.previousSibling?o(n.previousSibling)&&!p(n.previousSibling)?h(n.previousSibling):""===n.previousSibling.innerHTML&&!c(n.previousSibling)?h(n.previouSibling):n.previousSibling:n.parentNode?h(n.parentNode):null:null}function b(n,t){return 0===t||t<=n.data.length-n.data.replace(/^\s+/,"").length}function k(n){return n.parent().hasClass("aloha-editable")}function d(n,t){var r=l(n),i;return r===t?!0:(i=o(n),i&&n.data.replace(/\s+$/,"").length===t)?!0:1===r&&!i?y(n.childNodes[0]):!1}function w(n,t){return v?r.compareDocumentPosition(n,t)&16:0<i(n).find(t).length}function g(n){var i=n.startContainer,r=n.endContainer,t=window.$_alohaPlaceholder;return t.is(i)||t.is(r)||w(t[0],i)||w(t[0],r)}function a(n){window.$_alohaPlaceholder&&!g(n)&&(0===window.$_alohaPlaceholder.html().replace(/^(&nbsp;)*$/,"").length&&window.$_alohaPlaceholder.remove(),window.$_alohaPlaceholder=null)}function nt(t,r,u){var o=new e.Utils.RangeObject,y=r?h(t):s(t),v,p,w;!y||c(y)?(v=i("<div>&nbsp;<\/div>"),r?i(t).before(v):i(t).after(v),o.startContainer=o.endContainer=v[0],o.startOffset=o.endOffset=0,a(o),window.$_alohaPlaceholder=v):(p=u.startContainer.nodeType===3&&u.startContainer===u.endContainer&&u.startContainer.nodeValue!==""&&(r?u.startOffset===1:u.endOffset+1===u.endContainer.length)||u.startContainer.nodeType===1&&(!u.startOffset||u.startContainer.childNodes[u.startOffset]&&u.startContainer.childNodes[u.startOffset].nodeType===1),p?(w=f.insertZeroWidthTextNodeFix(t,r),o.startContainer=o.endContainer=w,o.startOffset=o.endOffset=r?1:0):(o.startContainer=o.endContainer=y,o.startOffset=o.endOffset=r?l(y):0,r||f.insertZeroWidthTextNodeFix(t,!0)),a(o)),o.select(),n.trigger("aloha-block-selected",t),n.Selection.preventSelectionChanged()}var e=window.GENTICS,v=!!(i.browser.msie&&9>parseInt(i.browser.version,10));return n.Markup=t.extend({keyHandlers:{},addKeyHandler:function(n,t){this.keyHandlers[n]||(this.keyHandlers[n]=[]),this.keyHandlers[n].push(t)},removeKeyHandler:function(n){this.keyHandlers[n]&&(this.keyHandlers[n]=null)},insertBreak:function(){var t=n.Selection.rangeObject,f,u,r;t.isCollapsed()||this.removeSelectedMarkup(),r=i("<br/>"),e.Utils.Dom.insertIntoDOM(r,t,n.activeEditable.obj),u=e.Utils.Dom.searchAdjacentTextNode(r.parent().get(0),e.Utils.Dom.getIndexInParent(r.get(0))+1,!1),u&&(f=u.data.search(/\S/),f>0&&(u.data=u.data.substring(f))),t.startContainer=t.endContainer=r.get(0).parentNode,t.startOffset=t.endOffset=e.Utils.Dom.getIndexInParent(r.get(0))+1,t.correctRange(),t.clearCaches(),t.select()},preProcessKeyStrokes:function(t){if(t.type!=="keydown")return!1;var u,r,i;if(this.keyHandlers[t.keyCode])for(r=this.keyHandlers[t.keyCode],i=0;i<r.length;++i)if(!r[i](t))return!1;return t.keyCode===37||t.keyCode===39?n.getSelection().getRangeCount()&&(u=n.getSelection().getRangeAt(0),this.processCursor(u,t.keyCode))?(a(n.Selection.rangeObject),!0):!1:t.keyCode===8?(t.preventDefault(),n.execCommand("delete",!1),!1):t.keyCode===46?(n.execCommand("forwarddelete",!1),!1):t.keyCode===13?t.shiftKey?(n.execCommand("insertlinebreak",!1),!1):(n.execCommand("insertparagraph",!1),!1):!0},processCursor:function(t,r){var e,a,y,u,p,g,w,tt;if(!t.collapsed||(f.removeZeroWidthTextNodeFix(),e=t.startContainer,a=n.getSelection(),!e))return!0;if(i.browser.msie&&parseInt(i.browser.version,10)<=7&&o(e))if(r==37){for(u=t.startOffset;u>0&&e.data.charAt(u-1)==="​";)u--;u!=t.startOffset&&(t.setStart(t.startContainer,u),t.setEnd(t.startContainer,u),a=n.getSelection(),a.removeAllRanges(),a.addRange(t))}else if(r==39){for(u=t.startOffset;u<e.data.length&&e.data.charAt(u)==="​";)u++;u!=t.startOffset&&(t.setStart(t.startContainer,u),t.setEnd(t.startContainer,u),a.removeAllRanges(),a.addRange(t))}if(v&&!i(e).contentEditable()&&(p=i(e).parents("[contenteditable=false]"),g=p.length>0,g))if(k(p))y=p[0];else return!0;if(!y){if(w=37===r||38===r,u=t.startOffset,o(e)){if(w){if(tt=1===u,!tt&&!b(e,u))return!0}else if(!d(e,u))return!0}else e=e.childNodes[u===l(e)?u-1:u];y=w?h(e):s(e)}return c(y)?(nt(y,w,t),!1):!0},processShiftEnter:function(n){this.insertHTMLBreak(n.getSelectionTree(),n)},processEnter:function(n){n.splitObject?this.splitRangeObject(n):this.insertHTMLBreak(n.getSelectionTree(),n)},insertHTMLCode:function(t){var r=n.Selection.rangeObject;this.insertHTMLBreak(r.getSelectionTree(),r,i(t))},insertHTMLBreak:function(t,r,u){var s,a,f,h,v,y,c,l,o;for(u=u||i("<br/>"),s=0,a=t.length;s<a;++s)if(f=t[s],h=f.domobj?i(f.domobj):undefined,f.selection!=="none")if(f.selection=="collapsed")s>0?(v=i(t[s-1].domobj),v.after(u)):(y=i(t[1].domobj),y.before(u)),r.startContainer=r.endContainer=u[0].parentNode,r.startOffset=r.endOffset=e.Utils.Dom.getIndexInParent(u[0])+1,r.correctRange();else if(f.domobj&&f.domobj.nodeType===3){if(f.domobj.nextSibling&&f.domobj.nextSibling.nodeType==1&&n.Selection.replacingElements[f.domobj.nextSibling.nodeName.toLowerCase()]&&h.after("<br/>"),this.needEndingBreak()){for(o=f.domobj;o;)if(o.nextSibling)o=!1;else{if(o=o.parentNode,e.Utils.Dom.isBlockLevelElement(o)||e.Utils.Dom.isListElement(o))break;o===r.limitObject&&(o=!1)}o&&i(o).append('<br class="aloha-cleanme" />')}for(h.between(u,f.startOffset),l=0,c=u[0];c;)c=c.previousSibling,++l;r.startContainer=u[0].parentNode,r.endContainer=u[0].parentNode,r.startOffset=l,r.endOffset=l,r.correctRange()}else f.domobj&&f.domobj.nodeType===1&&(h.parent().find("br.aloha-ephemera").length===0&&(i(r.limitObject).find("br.aloha-ephemera").remove(),i(r.commonAncestorContainer).append(this.getFillUpElement(r.splitObject))),h.after(u),r.startContainer=r.commonAncestorContainer,r.endContainer=r.startContainer,r.startOffset=s+2,r.endOffset=s+2,r.update());r.select()},needEndingBreak:function(){return!i.browser.msie},getSelectedText:function(){var t=n.Selection.rangeObject;return t.isCollapsed()?!1:this.getFromSelectionTree(t.getSelectionTree(),!0)},getFromSelectionTree:function(n,t){for(var u="",r,e,f=0,o=n.length;f<o;f++)r=n[f],r.selection=="partial"?r.domobj.nodeType===3?u+=r.domobj.data.substring(r.startOffset,r.endOffset):r.domobj.nodeType===1&&r.children&&(t?u+=this.getFromSelectionTree(r.children,t):(e=i(r.domobj.outerHTML).empty(),e.html(this.getFromSelectionTree(r.children,t)),u+=e.outerHTML())):r.selection=="full"&&(r.domobj.nodeType===3?u+=i(r.domobj).text():r.domobj.nodeType===1&&r.children&&(u+=t?i(r.domobj).text():i(r.domobj).outerHTML()));return u},getSelectedMarkup:function(){var t=n.Selection.rangeObject;return t.isCollapsed()?null:this.getFromSelectionTree(t.getSelectionTree(),!1)},removeSelectedMarkup:function(){var i=n.Selection.rangeObject,t;i.isCollapsed()||(t=new n.Selection.SelectionRange,this.removeFromSelectionTree(i.getSelectionTree(),t),t.update(),e.Utils.Dom.doCleanup({merge:!0,removeempty:!0},n.Selection.rangeObject),n.Selection.rangeObject=t,t.correctRange(),t.update(),t.select(),n.Selection.updateSelection())},removeFromSelectionTree:function(n,t){for(var u,f,r,s,o=0,h=n.length;o<h;o++)r=n[o],r.selection=="partial"?r.domobj.nodeType===3?(f="",r.startOffset>0&&(f+=r.domobj.data.substring(0,r.startOffset)),r.endOffset<r.domobj.data.length&&(f+=r.domobj.data.substring(r.endOffset,r.domobj.data.length)),r.domobj.data=f,t.startContainer||(t.startContainer=t.endContainer=r.domobj,t.startOffset=t.endOffset=r.startOffset)):r.domobj.nodeType===1&&r.children&&(this.removeFromSelectionTree(r.children,t),u?u.nodeName==r.domobj.nodeName&&(i(u).append(i(r.domobj).contents()),i(r.domobj).remove()):u=r.domobj):r.selection=="full"&&(t.startContainer||(s=e.Utils.Dom.searchAdjacentTextNode(r.domobj.parentNode,e.Utils.Dom.getIndexInParent(r.domobj)+1,!1,{blocklevel:!1}),s?(t.startContainer=t.endContainer=s,t.startOffset=t.endOffset=0):(t.startContainer=t.endContainer=r.domobj.parentNode,t.startOffset=t.endOffset=e.Utils.Dom.getIndexInParent(r.domobj)+1)),i(r.domobj).remove())},splitRangeObject:function(t){var s=i(t.splitObject),f,o,r,u;t.update(t.splitObject),f=t.getSelectionTree(),r=this.getSplitFollowUpContainer(t),this.splitRangeObjectHelper(f,t,r),r.hasClass("preparedForRemoval")&&r.removeClass("preparedForRemoval"),o=this.getInsertAfterObject(t,r),i(r).insertAfter(o),t.splitObject.nodeName.toLowerCase()!=="li"||n.Selection.standardTextLevelSemanticsComparator(t.splitObject,r)||i(t.splitObject).remove(),t.startContainer=null,u=r.contents(),u.length>0&&u.get(0).nodeType==1&&u.get(0).nodeName.toLowerCase()==="br"&&(t.startContainer=r.get(0)),t.startContainer||(t.startContainer=r.textNodes(!0,!0).first().get(0)),t.startContainer||(t.startContainer=r.textNodes(!1).first().parent().get(0)),t.startContainer?(t.endContainer=t.startContainer,t.startOffset=0,t.endOffset=0):(t.startContainer=t.endContainer=r.parent().get(0),t.startOffset=t.endOffset=e.Utils.Dom.getIndexInParent(r.get(0))),t.update(),t.select()},getInsertAfterObject:function(t,r){for(var e,f,u=0;u<t.markupEffectiveAtStart.length;u++)if((f=t.markupEffectiveAtStart[u],f===t.splitObject&&(e=!0),e)&&n.Selection.canTag1WrapTag2(i(f).parent()[0].nodeName,r[0].nodeName))return f;return!1},getFillUpElement:function(){return i.browser.msie?!1:i('<br class="aloha-cleanme"/>')},removeElementContentWhitespaceObj:function(n){for(var r=0,i=[],u,f,t=0;t<n.length;++t)u=n[t],u.isElementContentWhitespace&&(i[i.length]=t);for(t=0;t<i.length;++t)f=i[t],n.splice(f-r,1),++r},splitRangeObjectHelper:function(t,r,u,f){u||n.Log.warn(this,"no followUpContainer, no inBetweenMarkup, nothing to do...");var s=this.getFillUpElement(r.splitObject),l=i(r.splitObject),y=!1,o,h,a,w,c,v,p;if(t.length>0)for(c=u.contents(),c.length!==t.length&&this.removeElementContentWhitespaceObj(c),h=0,p=t.length;h<p;++h)if(o=t[h],o.selection==="none"&&y===!1||o.domobj&&o.domobj.nodeType===3&&o===t[t.length-1]&&o.startOffset===o.domobj.data.length){u.textNodes().length>1||o.domobj.nodeType===1&&o.children.length===0?c.eq(h).remove():e.Utils.Dom.isSplitObject(u[0])?s?u.html(s):u.empty():(u.empty(),u.addClass("preparedForRemoval"));continue}else o.selection!=="none"?(o.domobj&&o.domobj.nodeType===3&&o.startOffset!==undefined&&(a=o.domobj.data,o.startOffset>0?o.domobj.data=a.substr(0,o.startOffset):t.length>1?i(o.domobj).remove():(v=i(o.domobj).parent(),e.Utils.Dom.isSplitObject(v[0])?s?v.html(s):v.empty():v.remove()),a.length-o.startOffset>0?c[h].data=a.substr(o.startOffset,a.length):c.length>1?c.eq(h).remove():e.Utils.Dom.isBlockLevelElement(u[0])?s?u.html(s):u.empty():(u.empty(),u.addClass("preparedForRemoval"))),y=!0,o.children.length>0&&this.splitRangeObjectHelper(o.children,r,c.eq(h),f)):o.selection==="none"&&y===!0&&(w=i(o.domobj).remove());else n.Log.error(this,"can not split splitObject due to an empty selection tree");l.find("br.aloha-ephemera:gt(0)").remove(),u.find("br.aloha-ephemera:gt(0)").remove(),l.find(".preparedForRemoval").remove(),u.find(".preparedForRemoval").remove(),l.contents().length===0&&e.Utils.Dom.isSplitObject(l[0])&&s&&l.html(s),u.contents().length===0&&e.Utils.Dom.isSplitObject(u[0])&&s&&u.html(s)},getSplitFollowUpContainer:function(n){var f=n.splitObject.nodeName.toLowerCase(),t,r,u;switch(f){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":if(u=i(n.splitObject).textNodes(":not(.aloha-cleanme)").last()[0],u&&n.startContainer===u&&n.startOffset===u.length)return t=i("<p><\/p>"),r=i(n.splitObject.outerHTML).contents(),t.append(r),t;break;case"li":if(n.startContainer.nodeName.toLowerCase()==="br"&&i(n.startContainer).hasClass("aloha-ephemera"))return t=i("<p><\/p>"),r=i(n.splitObject.outerHTML).contents(),t.append(r),t;if(!n.splitObject.nextSibling&&i.trim(i(n.splitObject).text()).length===0)return i("<p><\/p>")}return i(n.splitObject.outerHTML)},transformDomObject:function(n,t,r){var e=i(n),u=i("<"+t+">"),f,o=e[0].cloneNode(!1).attributes;if(o)for(f=0;f<o.length;++f)(typeof o[f].specified=="undefined"||o[f].specified)&&u.attr(o[f].nodeName,o[f].nodeValue);return e[0].style&&e[0].style.cssText&&(u[0].style.cssText=e[0].style.cssText),e.contents().appendTo(u),e.replaceWith(u),r&&(r.startContainer==n&&(r.startContainer=u.get(0)),r.endContainer==n&&(r.endContainer=u.get(0))),u},toString:function(){return"Aloha.Markup"}}),n.Markup=new n.Markup,n.Markup}),define("aloha/observable",["jquery"],function(n){var t=n;return{_eventHandlers:null,bind:function(n,t,i){this._eventHandlers=this._eventHandlers||{},this._eventHandlers[n]||(this._eventHandlers[n]=[]),this._eventHandlers[n].push({handler:t,scope:i||window})},unbind:function(n,i){(this._eventHandlers=this._eventHandlers||{},this._eventHandlers[n])&&(this._eventHandlers[n]=i?t.grep(this._eventHandlers[n],function(n){return n.handler===i?!1:!0}):[])},trigger:function(n){if(this._eventHandlers=this._eventHandlers||{},this._eventHandlers[n]){var i=[];t.each(arguments,function(n,t){n>0&&i.push(t)}),t.each(this._eventHandlers[n],function(n,t){t.handler.apply(t.scope,i)})}},unbindAll:function(){this._eventHandlers=null}}}),define("aloha/registry",["jquery","aloha/observable","util/class"],function(n,t,i){return i.extend(t,{_entries:null,_ids:null,_constructor:function(){this._entries={},this._ids=[]},register:function(n,t){this._entries[n]=t,this._ids.push(n),this.trigger("register",t,n)},unregister:function(n){var t,i=this._entries[n];delete this._entries[n];for(t in this._ids)if(this._ids.hasOwnProperty(t)&&this._ids[t]===n){this._ids.splice(t,1);break}this.trigger("unregister",i,n)},get:function(n){return this._entries[n]},has:function(n){return this._entries[n]?!0:!1},getEntries:function(){return n.extend({},this._entries)},getIds:function(){return n.extend([],this._ids)}})}),define("aloha/contenthandlermanager",["aloha/core","aloha/registry","util/class","aloha/console"],function(n,t,i){var r=t.extend({createHandler:function(n){if(typeof n.handleContent!="function")throw"ContentHandler has no function handleContent().";var t=i.extend({handleContent:function(){}},n);return new t},handleContent:function(t,i,r){var o=this,f=i?i.contenthandler:o.getIds(),u,e;if(!f)return t;for(u=0;u<f.length;u++)if(e=o.get(f[u]),e&&(t=e.handleContent(t,i,r||n.activeEditable)),null===t)break;return t}});return new r}),define("util/trees",["jquery"],function(n){function t(t,i,r){var h=n.type(t),f,u,o,c,s,e;if("array"===h){for(u=r?t:[],o=0,s=0,c=t.length;s<c;s++)f=i(t[s]),f.length&&(u[o++]=f[0]);o!==u.length&&(u=u.slice(0,o))}else if("object"===h){u=r?t:{};for(e in t)t.hasOwnProperty(e)&&(f=i(t[e]),f.length?u[e]=f[0]:delete u[e])}else u=t;return u}function r(n,i){return t(n,i,!0)}function u(n,t){var r,i,u;if(1===n.nodeType)for(i=n.firstChild;i;)r=t(i),u=i.nextSibling,r.length?r[0]!==i&&n.replaceChild(r[0],i):n.removeChild(i),i=u;return n}function f(n,t,i,r){return[i(t(r),n)]}function e(n,t,i,r){return[t(i(r,n))]}function o(n,t,i,r){return t(r)?[]:[i(r,n)]}function s(n,t,i,r){var u=i(r,n);return t(u)?[]:[u]}function i(n,t,i,r){function u(r){return n(u,t,i,r)}return u(r)[0]}function a(n,u,e){return i(f,u,e?r:t,n)}function v(n,u,f){return i(e,u,f?r:t,n)}function y(n,u,f){return i(o,u,f?r:t,n)}function p(n,u,f){return i(s,u,f?r:t,n)}function w(n,t,r){return i(f,t,u,r?n:n.cloneNode(!0))}function b(n,t,r){return i(e,t,u,r?n:n.cloneNode(!0))}function k(n,t,r){return i(o,t,u,r?n:n.cloneNode(!0))}function d(n,t,r){return i(s,t,u,r?n:n.cloneNode(!0))}function h(t){var i=n.type(t);return i!=="object"&&i!=="array"}function c(n,t,i){return[t(i,n)]}function l(n,i,u){function f(n){return h(n)?[i(n)]:c(f,e,n)}var e=u?r:t;return f(n)[0]}function g(n){function i(n){return c(i,t,n)}return i(n)[0]}function nt(n){var t=[];return l(n,function(n){return t.push(n),n},!0),t}return{prewalk:a,postwalk:v,preprune:y,postprune:p,prewalkDom:w,postwalkDom:b,prepruneDom:k,postpruneDom:d,isLeaf:h,leaves:l,clone:g,flatten:nt,walk:t,walkInplace:r,walkDomInplace:u}}),define("util/functions",[],function(){function n(n){return n}function t(){}function i(){return!0}function r(){return!1}function u(n){return function(){return!n.apply(this,arguments)}}return{identity:n,noop:t,returnTrue:i,returnFalse:r,complement:u}}),define("util/browser",["jquery"],function(n){return{ie7:n.browser.msie&&parseInt(n.browser.version,10)<8}}),define("util/dom2",["jquery","util/functions","util/maps","util/arrays","util/strings","util/browser"],function(n,t,i,r,u,f){function y(n,t,i){while(t){var r=t.nextSibling;n.insertBefore(t,i),t=r}}function w(n){var t=n.outerHTML;if(typeof t!="undefined")return t;try{return p?p.serializeToString(n):n.xml}catch(i){return n.xml}}function b(n){for(var t=[],r=w(n.cloneNode(!1)),i;null!=(i=at.exec(r));)t.push(i[1]);return t}function vt(t){for(var f=[],e=b(t),u,i,r=0,o=e.length;r<o;r++)u=e[r],i=n.attr(t,u),i=null==i?"":i.toString(),f.push([u,i]);return f}function k(n,t){for(var o={},s,h,i,r,e,f=0,c=n.length;f<c;f++)if(i=n[f],i.className)for(h=u.words(i.className),e=0;e<h.length;e++)r=h[e],t[r]&&(s=o[r],s?s.push(i):o[r]=[i]);return o}function yt(t,r){var u;return u=f.ie7?t.getElementsByTagName("*"):n(t).find("."+i.keys(r).join(",.")),k(u,r)}function pt(t,i){for(var f={},u,r=0,e=i.length;r<e;r++)u=i[r],f[u]=n.makeArray(t.getElementsByTagName(u));return f}function o(n){for(var t=0;n.previousSibling;)t++,n=n.previousSibling;return t}function s(n){for(var i=0,t=n.firstChild;t;)i+=1,t=t.nextSibling;return i}function d(n,t){return 1===n.nodeType&&t>=s(n)||3===n.nodeType&&t===n.length&&!n.nextSibling}function g(n,t){return 1===n.nodeType&&t<s(n)?n=n.childNodes[t]:3===n.nodeType&&t===n.length&&(n=n.nextSibling||n.parentNode),n}function wt(n){var t=n.parentNode;y(t,n.firstChild,n),t.removeChild(n)}function bt(n,t){n.parentNode.replaceChild(t,n),t.appendChild(n)}function nt(n,t,i){i?t.appendChild(n):t.parentNode.insertBefore(n,t)}function e(n,t){this.node=n,this.atEnd=t}function tt(n,t){return new e(n,t)}function l(n,t){return tt(g(n,t),d(n,t))}function a(n,t){for(var r=[],i=n.parentNode;i&&!t(i);)r.push(i),i=i.parentNode;return r}function it(n,t){var i=a(n,t),r=i.length?i[i.length-1]:n;return r.parentNode&&i.push(r.parentNode),i}function h(n,t){if(t(n))return[];var i=a(n,t);return i.unshift(n),i}function rt(n,t){if(t(n))return[n];var i=it(n,t);return i.unshift(n),i}function kt(n,t){return h(n,function(n){return n===t})}function dt(n,t){return rt(n,function(n){return n===t})}function ut(n,t){var r=n.parentNode,i=n.nodeValue,u,f;return 0===t||t>=i.length?n:(u=document.createTextNode(i.substring(0,t)),f=document.createTextNode(i.substring(t,i.length)),r.insertBefore(u,n),r.insertBefore(f,n),r.removeChild(n),u)}function ft(n,t,i,r,u,f){var e,s;t===u&&(e=f.length,i===0?(t=f.parentNode,i=o(f)):i<e?t=f:i===e?(t=f.parentNode,i=o(f)+1):(s=f.nextSibling,t=s,i-=e),n[r].call(n,t,i))}function et(n,t,i,r,u,f,e){if(3===n.nodeType){var o=ut(n,t);ft(e,i,r,"setStart",n,o),ft(e,u,f,"setEnd",n,o)}}function gt(n){var t=n.startContainer,i=n.startOffset,r=n.endContainer,u=n.endOffset;et(t,i,t,i,r,u,n),t=n.startContainer,i=n.startOffset,r=n.endContainer,u=n.endOffset,et(r,u,t,i,r,u,n)}function v(n,t,i,r){while(n&&!i(n,r))n=t(n,r);return n}function ot(n,i,r){v(n,i,t.returnFalse,r)}function st(n,t,i){return 1===n.nodeType&&ot(n.firstChild,function(n){return st(n,t,i)}),t(n,i)}function ni(n,t,i,r){return v(n,t,function(n){return n===i},r)}function c(n){this.startContainer=n.startContainer,this.startOffset=n.startOffset,this.endContainer=n.endContainer,this.endOffset=n.endOffset,this.commonAncestorContainer=n.commonAncestorContainer,this.collapsed=n.collapsed}function ht(n,t){t.atEnd?n.setStart(t.node,s(t.node)):n.setStart(t.node.parentNode,o(t.node))}function ct(n,t){t.atEnd?n.setEnd(t.node,s(t.node)):n.setEnd(t.node.parentNode,o(t.node))}function ti(n,t){n.setStart(t.startContainer,t.startOffset),n.setEnd(t.endContainer,t.endOffset)}function ii(n){return new c(n)}function lt(n,t,i){var f;if(!n.collapsed){for(var u=l(n.startContainer,n.startOffset),r=l(n.endContainer,n.endOffset),e=!1;!u.equals(r)&&t(u)&&u.next();)e=!0;for(i=i||t,f=!1,3===n.endContainer.nodeType&&n.endOffset>0&&n.endOffset<n.endContainer.length&&r.next()&&i(r)&&r.prev();!r.equals(u)&&i(r)&&r.prev();)f=!0;e&&ht(n,u),f&&ct(n,r)}}function ri(n,t,i){i=i||t,lt(n,function(n){return n.atEnd||t(n.node)},function(n){var t=n.atEnd?n.node.lastChild:n.node.previousSibling;return!t||i(t)})}var at=/\s([^\/<>\s=]+)(?:=(?:"[^"]*"|'[^']*'|[^>\/\s]+))?/g,p=window.XMLSerializer&&new window.XMLSerializer;return e.prototype.next=function(){var t=this.node,n;if(this.atEnd||1!==t.nodeType){if(n=t.nextSibling,n)this.atEnd=!1;else{if(n=t.parentNode,!n)return!1;this.atEnd=!0}this.node=n}else n=t.firstChild,n?this.node=n:this.atEnd=!0;return!0},e.prototype.prev=function(){var t=this.node,n;if(this.atEnd)n=t.lastChild,n?this.node=n:this.atEnd=!1;else{if(n=t.previousSibling,n)1===t.nodeType&&(this.atEnd=!0);else if(n=t.parentNode,!n)return!1;this.node=n}return!0},e.prototype.equals=function(n){return n.node===this.node&&n.atEnd===this.atEnd},e.prototype.clone=function(n){return n(n.node,n.atEnd)},e.prototype.insert=function(n){return nt(n,this.node,this.atEnd)},c.prototype.update=function(){if(this.startContainer&&this.endContainer){this.collapsed=this.startContainer===this.endContainer&&this.startOffset===this.endOffset;var n=h(this.startContainer,t.returnFalse),i=h(this.endContainer,t.returnFalse);this.commonAncestorContainer=r.intersect(n,i)[0]}},c.prototype.setStart=function(n,t){this.startContainer=n,this.startOffset=t,this.update()},c.prototype.setEnd=function(n,t){this.endContainer=n,this.endOffset=t,this.update()},{moveNextAll:y,attrNames:b,attrs:vt,indexByClass:yt,indexByName:pt,indexByClassHaveList:k,outerHtml:w,shallowRemove:wt,wrap:bt,insert:nt,cursor:tt,cursorFromBoundaryPoint:l,nodeAtOffset:g,isAtEnd:d,parentsUntil:a,parentsUntilIncl:it,childAndParentsUntil:h,childAndParentsUntilIncl:rt,childAndParentsUntilNode:kt,childAndParentsUntilInclNode:dt,nodeIndex:o,splitTextNode:ut,splitTextContainers:gt,walk:ot,walkRec:st,walkUntil:v,walkUntilNode:ni,stableRange:ii,trimRange:lt,trimRangeClosingOpening:ri,setRangeFromRef:ti,setRangeStartFromCursor:ht,setRangeEndFromCursor:ct}}),define("util/misc",[],function(){function n(n,t){for(var i=0,r=n.length;i<r;i++)if(n[i].test(t))return!0;return!1}return{anyRx:n}}),define("aloha/ephemera",["jquery","aloha/core","aloha/console","util/strings","util/trees","util/arrays","util/maps","util/dom2","util/functions","util/misc","PubSub"],function(n,t,i,r,u,f,e,o,s,h,c){function y(n){for(var t=0,r=n.length;t<r;t++)-1===n[t].indexOf(a)&&(i.warn('Class "'+n[t]+'" was set to be ephemeral,which hurts peformance. Add the common substring "'+a+'" to the class to fix this problem.'),a="")}function p(){var n=Array.prototype.slice.call(arguments);e.fillKeys(l.classMap,n,!0),y(n),c.pub("aloha.ephemera.classes",{ephemera:l,newClasses:n})}function w(){var n=Array.prototype.slice.call(arguments);e.fillKeys(l.attrMap,n,!0),c.pub("aloha.ephemera.attributes",{ephemera:l,newAttributes:n})}function b(n){return n&&(l=n),c.pub("aloha.ephemera",{ephemera:l}),l}function k(t){n(t).addClass("aloha-ephemera")}function d(t,i){t=n(t);var u=t.attr("data-aloha-ephemera-attr");null==u||""===u?u=i:-1===f.indexOf(r.words(u),i)&&(u+=" "+i),t.attr("data-aloha-ephemera-attr",u),t.addClass("aloha-ephemera-attr")}function g(t){n(t).addClass("aloha-ephemera-wrapper")}function nt(t){n(t).addClass("aloha-ephemera-filler")}function tt(t){var u=n(t),e=u.attr("data-aloha-ephemera-attr"),i,f;if(u.removeAttr("data-aloha-ephemera-attr"),typeof e=="string")for(f=r.words(e),i=0;i<f.length;i++)u.removeAttr(f[i])}function v(n,t,i,r){var u=i[t];return u&&(!0===u||-1!==f.indexOf(u,n.nodeName))?!0:h.anyRx(r,t)}function it(t,i){for(var u=null,e=o.attrNames(t),f,r=0,s=e.length;r<s;r++)f=e[r],v(t,f,i.attrMap,i.attrRxs)&&(u=u||n(t),u.removeAttr(f))}function rt(t,i){var s=t.className,u,e;if(s&&-1!==s.indexOf(a)){if(u=r.words(s),-1!==f.indexOf(u,"aloha-cleanme")||-1!==f.indexOf(u,"aloha-ephemera"))return n.removeData(t),!1;if(-1!==f.indexOf(u,"aloha-ephemera-wrapper")||-1!==f.indexOf(u,"aloha-ephemera-filler"))return o.moveNextAll(t.parentNode,t.firstChild,t.nextSibling),n.removeData(t),!1;-1!==f.indexOf(u,"aloha-ephemera-attr")&&tt(t),e=f.filter(u,function(n){return!i.classMap[n]}),e.length!==u.length&&(0===e.length?n(t).removeAttr("class"):t.className=e.join(" "))}return it(t,i),!0}function ut(n,t,i){if(1===i.nodeType){if(!rt(i,n))return[];i=u.walkDomInplace(i,t)}return(i=f.reduce(n.pruneFns,i,f.applyNotNull),!i)?[]:[i]}function ft(n,t){function i(n){return ut(t,i,n)}return t=t||l,i(n)[0]}var l={classMap:{"aloha-ephemera-wrapper":!0,"aloha-ephemera-filler":!0,"aloha-ephemera-attr":!0,"aloha-ephemera":!0,"aloha-cleanme":!0},attrMap:{hidefocus:!0,hideFocus:!0,tabindex:!0,tabIndex:!0,contenteditable:["TABLE"],contentEditable:["TABLE"]},attrRxs:[/^(?:nodeIndex|sizcache|sizset|jquery)[\w\d]*$/i],pruneFns:[]},a="aloha-";return{ephemera:b,classes:p,attributes:w,markElement:k,markAttr:d,markWrapper:g,markFiller:nt,prune:ft,isAttrEphemeral:v}}),define("aloha/copypaste",["jquery","aloha/core"],function(n,t){function r(i){if(!i||!i.commonAncestorContainer)return null;var r=n(i.commonAncestorContainer);return r.length?t.getEditableHost(r):null}function u(){var n=t.getSelection();return n.getRangeCount()?n.getRangeAt(0):null}function i(n){var i=t.createRange(),r=t.getSelection();i.setStart(n.startContainer,n.startOffset),i.setEnd(n.endContainer,n.endOffset),r.removeAllRanges(),r.addRange(i)}function f(t){i({startContainer:t,endContainer:t,startOffset:0,endOffset:t.childNodes?t.childNodes.length:t.length}),n(t).focus()}return{getEditableAt:r,getRange:u,selectAllOf:f,setSelectionAt:i}}),define("aloha/command",["aloha/core","aloha/registry","aloha/engine","util/dom","aloha/contenthandlermanager"],function(n,t,i,r,u){var f={execCommand:function(t,f,e,o){var c={commandId:t,preventDefault:!1},h,s;if(n.trigger("aloha-command-will-execute",c),c.preventDefault!==!0){if(!o){if(!n.getSelection().getRangeCount())return;o=n.getSelection().getRangeAt(0)}t.toLowerCase()==="inserthtml"&&(e=u.handleContent(e,{contenthandler:n.settings.contentHandler.insertHtml,command:"insertHtml"})),i.execCommand(t,f,e,o),n.getSelection().getRangeCount()&&(o=n.getSelection().getRangeAt(0),h=o.commonAncestorContainer,h.parentNode&&(h=h.parentNode),s=new window.GENTICS.Utils.RangeObject,s.startContainer=o.startContainer,s.startOffset=o.startOffset,s.endContainer=o.endContainer,s.endOffset=o.endOffset,r.doCleanup({merge:!0,removeempty:!1},s,h),s.select()),n.trigger("aloha-command-executed",t)}},queryCommandEnabled:function(t,r){if(!r){if(!n.getSelection().getRangeCount())return;r=n.getSelection().getRangeAt(0)}return i.queryCommandEnabled(t,r)},queryCommandIndeterm:function(t,r){if(!r){if(!n.getSelection().getRangeCount())return;r=n.getSelection().getRangeAt(0)}return i.queryCommandIndeterm(t,r)},queryCommandState:function(t,r){if(!r){if(!n.getSelection().getRangeCount())return;r=n.getSelection().getRangeAt(0)}return i.queryCommandState(t,r)},queryCommandSupported:function(n){return i.queryCommandSupported(n)},queryCommandValue:function(t,r){if(!r){if(!n.getSelection().getRangeCount())return;r=n.getSelection().getRangeAt(0)}return i.queryCommandValue(t,r)},querySupportedCommands:function(){var t=[],n;for(n in i.commands)i.commands.hasOwnProperty(n)&&t.push(n);return t},getStateOverride:i.getStateOverride,setStateOverride:i.setStateOverride,resetOverrides:i.resetOverrides,unsetStateOverride:i.unsetStateOverride};return f=new(t.extend(f)),n.execCommand=f.execCommand,n.queryCommandEnabled=f.queryCommandEnabled,n.queryCommandIndeterm=f.queryCommandIndeterm,n.queryCommandState=f.queryCommandState,n.queryCommandSupported=f.queryCommandSupported,n.queryCommandValue=f.queryCommandValue,n.querySupportedCommands=f.querySupportedCommands,f}),define("aloha/state-override",["aloha/core","jquery","aloha/selection","aloha/command","util/dom2","PubSub"],function(n,t,i,r,u,f){function o(t){var i,u,f;e&&(t.altKey||t.ctrlKey||!t.which||(i=n.getSelection(),i.getRangeCount())&&(u=String.fromCharCode(t.which),f=i.getRangeAt(0),n.Selection.preventSelectionChanged(),r.execCommand("insertText",null,u,f),t.preventDefault()))}function s(t){var i=n.createRange();return i.setStart(t.startContainer,t.startOffset),i.setEnd(t.endContainer,t.endOffset),i}function h(n,t,i){if(e){var u=s(i);r.setStateOverride(n,t,u),i.select()}}function c(n){return null!=n&&(e=n),e}var e=n.settings.stateOverride;return n.bind("aloha-selection-changed",function(n,t){r.resetOverrides(t)&&f.pub("aloha.selection.context-change",{range:t,event:n})}),{enabled:c,keyPressHandler:o,setWithRangeObject:h}}),define("aloha/editable",["aloha/core","util/class","jquery","aloha/pluginmanager","aloha/selection","aloha/markup","aloha/contenthandlermanager","aloha/console","aloha/block-jump","aloha/ephemera","util/dom2","PubSub","aloha/copypaste","aloha/command","aloha/state-override"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){function b(t){return e.handleContent(t.getContents(),{contenthandler:n.settings.contentHandler.smartContentChange},t)}function ut(n){return n.altKey?"alt":n.ctrlKey?"ctrl":n.shiftKey?"shift":null}function ft(t){var i,r,u;if(n.activeEditable)return i=rt[t.which],i&&(r=ut(t),u=(r?r+"+":"")+i,g[u])?g[u](t):void 0}var p=i,k=window.unescape,nt=window.GENTICS,d=!1,tt={},it,w,rt,g;n.defaults.contentHandler={},n.defaults.contentHandler.initEditable=["blockelement","sanitize"],n.defaults.contentHandler.getContents=["blockelement","sanitize","basic"],typeof n.settings.contentHandler=="undefined"&&(n.settings.contentHandler={}),it=function(n){return p(n).html()},w=it,rt={65:"a"},g={"ctrl+a":function(){var n=a.getEditableAt(a.getRange());if(n)return a.selectAllOf(n.obj[0]),!1}},i(document).keydown(ft),n.Editable=t.extend({_constructor:function(t){t.attr("id")||t.attr("id",nt.Utils.guid()),this.obj=t,this.originalObj=t,this.ready=!1,this.sccDelimiters=[":",";",".","!","?",",",k("%u0009"),k("%u0020"),k("%u0008"),k("%u007F"),"Enter"],this.sccIdle=5e3,this.sccDelay=500,this.sccTimerIdle=!1,this.sccTimerDelay=!1,this.keyCodeMap={93:"Apps",18:"Alt",20:"CapsLock",17:"Control",40:"Down",35:"End",13:"Enter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",36:"Home",45:"Insert",37:"Left",224:"Meta",34:"PageDown",33:"PageUp",19:"Pause",44:"PrintScreen",39:"Right",145:"Scroll",16:"Shift",38:"Up",91:"Win",92:"Win"},this.placeholderClass="aloha-placeholder",n.registerEditable(this)},init:function(){var t=this,i;if(this.settings=n.settings,n.settings&&n.settings.smartContentChange&&(n.settings.smartContentChange.delimiters&&(this.sccDelimiters=n.settings.smartContentChange.delimiters),n.settings.smartContentChange.idle&&(this.sccIdle=n.settings.smartContentChange.idle),n.settings.smartContentChange.delay&&(this.sccDelay=n.settings.smartContentChange.delay)),!this.check(this.obj)){this.destroy();return}typeof n.settings.contentHandler.getContents=="undefined"&&(n.settings.contentHandler.getContents=n.defaults.contentHandler.getContents),typeof n.settings.contentHandler.initEditable=="undefined"&&(n.settings.contentHandler.initEditable=n.defaults.contentHandler.initEditable),i=t.obj.html(),i=e.handleContent(i,{contenthandler:n.settings.contentHandler.initEditable,command:"initEditable"},t),t.obj.html(i),n.bind("aloha-plugins-loaded",function(){t.obj.addClass("aloha-editable").contentEditable(!0),t.obj.mousedown(function(i){if(!n.eventHandled)return n.eventHandled=!0,t.activate(i)}),t.obj.mouseup(function(){n.eventHandled=!1}),t.obj.focus(function(n){return t.activate(n)});var i=t.obj.add(".aloha-block",t.obj).keydown(function(n){var i=f.preProcessKeyStrokes(n);return t.keyCode=n.which,i||t.smartContentChange(n),i}).keypress(y.keyPressHandler);t.obj.keypress(function(t){n.activeEditable.smartContentChange(t)}),t.obj.keyup(function(t){if(t.keyCode===27)return n.deactivateEditable(),!1}),t.obj.contentEditableSelectionChange(function(n){u.onChange(t.obj,n);return t.obj}),t.setUnmodified(),t.snapshotContent=t.getContents(),p.browser.mozilla&&t.initEmptyEditable(),t.initPlaceholder(),t.ready=!0,window.setTimeout(function(){n.disableObjectResizing()},20),n.trigger("aloha-editable-created",[t]),l.pub("aloha.editable.created",{data:t})})},isActive:!1,originalContent:null,range:undefined,check:function(){for(var f=this,n=this.obj,e=n.get(0),i=e.nodeName.toLowerCase(),u=["a","abbr","address","article","aside","b","bdo","blockquote","cite","code","command","del","details","dfn","div","dl","em","footer","h1","h2","h3","h4","h5","h6","header","i","ins","menu","nav","p","pre","q","ruby","section","small","span","strong","sub","sup","var"],r,t=0;t<u.length;++t)if(i===u[t])return!0;switch(i){case"textarea":case"input":return r=p('<div id="'+this.getId()+'-aloha" class="aloha-'+i+'" />').insertAfter(n),r.height(n.height()).width(n.width()).html(n.val()),n.hide(),n.parents("form:first").submit(function(){n.val(f.getContents())}),this.obj=r,!0}return!1},initPlaceholder:function(){n.settings.placeholder&&this.isEmpty()&&this.addPlaceholder()},isEmpty:function(){var n=p.trim(this.getContents()),t=n==="<br>"?!0:!1;return n.length===0||t},initEmptyEditable:function(){var n=this.obj;this.empty(this.getContents())&&p(n).prepend('<br class="aloha-cleanme" />')},addPlaceholder:function(){var r=p("<div>"),u=p("<span>"),t,i=this.obj;(t=nt.Utils.Dom.allowsNesting(i[0],r[0])?r:u,p("."+this.placeholderClass,i).length===0)&&(p.each(n.settings.placeholder,function(n,r){i.is(n)&&t.html(r)}),t.is(":empty")||(t.addClass(this.placeholderClass).addClass("aloha-ephemera"),p(i).append(t)),p("br",i).remove())},removePlaceholder:function(n,t){var r=this.placeholderClass,i;p("."+this.placeholderClass,n).length!==0&&(t===!0?window.setTimeout(function(){i=new u.SelectionRange,i.startContainer=i.endContainer=n.get(0),i.startOffset=i.endOffset=0,p("."+r,n).remove(),i.select()},100):p("."+r,n).remove())},destroy:function(){this===n.getActiveEditable()&&this.blur();switch(this.originalObj.get(0).nodeName.toLowerCase()){case"textarea":case"input":this.originalObj.val(this.getContents()),this.obj.remove(),this.originalObj.show()}this.ready=!1,this.removePlaceholder(this.obj),this.obj.removeClass("aloha-editable").contentEditable(!1).unbind("mousedown click dblclick focus keydown keypress keyup"),n.trigger("aloha-editable-destroyed",[this]),l.pub("aloha.editable.destroyed",{data:this}),n.unregisterEditable(this)},setUnmodified:function(){this.originalContent=this.getContents()},isModified:function(){return this.originalContent!==this.getContents()},toString:function(){return"Aloha.Editable"},isDisabled:function(){return!this.obj.contentEditable()||this.obj.contentEditable()==="false"},disable:function(){return this.isDisabled()||this.obj.contentEditable(!1)},enable:function(){return this.isDisabled()&&this.obj.contentEditable(!0)},activate:function(t){var i=n.getActiveEditable();if(d){d=!1;return}t&&t.type==="focus"&&i!==null&&i.obj.parent().get(0)===t.currentTarget||this.isActive||this.isDisabled()||(this.obj.addClass("aloha-editable-active"),n.activateEditable(this),d=!0,this.removePlaceholder(this.obj,!0),d=!1,this.isActive=!0,n.trigger("aloha-editable-activated",{oldActive:i,editable:this}))},blur:function(){this.obj.blur(),this.isActive=!1,this.initPlaceholder(),this.obj.removeClass("aloha-editable-active"),n.trigger("aloha-editable-deactivated",{editable:this}),n.activeEditable.smartContentChange({type:"blur"},null)},empty:function(n){return null===n||p.trim(n)===""||n==="<br/>"},getContents:function(t){var f=this.obj.html(),i=tt[this.getId()],u;return(i&&f===i.raw||(s.removeZeroWidthTextNodeFix(),u=this.obj.clone(!1),this.removePlaceholder(u),u=p(h.prune(u[0])),r.makeClean(u),u=p("<div>"+e.handleContent(u.html(),{contenthandler:n.settings.contentHandler.getContents,command:"getContents"},this)+"<\/div>"),i=tt[this.getId()]={},i.raw=f,i.element=u),t)?i.element.clone().contents():(null==i.serialized&&(i.serialized=w(i.element[0])),i.serialized)},setContents:function(t,i){var r=null;return n.getActiveEditable()===this&&(n.deactivateEditable(),r=this),this.obj.html(t),null!==r&&r.activate(),this.smartContentChange({type:"set-contents"}),i?this.obj.contents():w(this.obj[0])},getId:function(){return this.obj.attr("id")},smartContentChange:function(t){function r(){return null==f&&(f=i.getSnapshotContent()),f}var i=this,u=null,e,s,f;if(t&&(t.metaKey||t.crtlKey||t.altKey))return!1;t&&t.originalEvent&&(e=new RegExp("U\\+(\\w{4})"),s=e.exec(t.originalEvent.keyIdentifier),u=this.keyCodeMap[this.keyCode]||String.fromCharCode(t.which)||"unknown"),f=null,p.inArray(u,this.sccDelimiters)>=0?(clearTimeout(this.sccTimerIdle),clearTimeout(this.sccTimerDelay),this.sccTimerDelay=window.setTimeout(function(){n.trigger("aloha-smart-content-changed",{editable:i,keyIdentifier:t.originalEvent.keyIdentifier,keyCode:t.keyCode,char:u,triggerType:"keypress",getSnapshotContent:r}),b(i),o.debug("Aloha.Editable","smartContentChanged: event type keypress triggered")},this.sccDelay)):t&&t.type==="paste"?(n.trigger("aloha-smart-content-changed",{editable:i,keyIdentifier:null,keyCode:null,char:null,triggerType:"paste",getSnapshotContent:r}),b(i)):t&&t.type==="blur"?(n.trigger("aloha-smart-content-changed",{editable:i,keyIdentifier:null,keyCode:null,char:null,triggerType:"blur",getSnapshotContent:r}),b(i)):t&&t.type==="block-change"?(n.trigger("aloha-smart-content-changed",{editable:i,keyIdentifier:null,keyCode:null,char:null,triggerType:"block-change",getSnapshotContent:r}),b(i)):u!==null&&(clearTimeout(this.sccTimerDelay),clearTimeout(this.sccTimerIdle),this.sccTimerIdle=window.setTimeout(function(){n.trigger("aloha-smart-content-changed",{editable:i,keyIdentifier:null,keyCode:null,char:null,triggerType:"idle",getSnapshotContent:r}),b(i)},this.sccIdle))},getSnapshotContent:function(){var n=this.snapshotContent;return this.snapshotContent=this.getContents(),n}}),n.Editable.setContentSerializer=function(n){w=n},n.Editable.getContentSerializer=function(){return w}}),define("aloha/plugin",["aloha/core","jquery","util/class","aloha/pluginmanager","aloha/console"],function(n,t,i,r,u){var f=i.extend({name:null,defaults:{},settings:{},dependencies:[],_constructor:function(n){typeof n!="string"?u.error("Cannot initialise unnamed plugin, skipping"):this.name=n},checkDependencies:function(){var i=this,r=!0;return t.each(i.dependencies,function(t,f){if(!n.isPluginLoaded(f.toString()))return r=!1,u.error("plugin."+i.name,'Required plugin "'+f+'" not found.'),!1}),r},init:function(){},getEditableConfig:function(n){var i=null,r=!1,u=this;return this.settings.editables&&t.each(this.settings.editables,function(f,e){var o;if(n.is(f))if(r=!0,e instanceof Array)i=[],i=t.merge(i,e);else if(typeof e=="object"){i={},i["aloha-editable-selector"]=f;for(o in e)e.hasOwnProperty(o)&&(e[o]instanceof Array?i[o]=e[o]:typeof e[o]=="object"?(i[o]={},i[o]=t.extend(!0,i[o],u.config[o],e[o])):i[o]=e[o])}else i=e}),r||(i=typeof this.settings.config!="undefined"&&this.settings.config?this.settings.config:this.config),i},makeClean:function(){},getUID:function(){return u.deprecated("plugin","getUID() is deprecated. Use plugin.name instead."),this.name},toString:function(){return this.name},log:function(n,t){u.deprecated("plugin","log() is deprecated. Use Aloha.console instead."),u.log(n,this,t)}});return f.create=function(i,u){var e=new(f.extend(u))(i);return e.settings=t.extendObjects(!0,e.defaults,n.settings[i]),r.register(e),e},f}),define("aloha/jquery.aloha",["aloha/core","aloha/selection","jquery","aloha/console"],function(n,t,i,r){function u(n,t,i,r){if(t===r.target||!/textarea|input|select/i.test(r.target.nodeName)&&r.target.type!=="text")return n.apply(t,i)}function e(n){var r,e,t,f;if(typeof n.data=="string"){for(r=n.handler,e=n.data.toLowerCase().split(" "),t={},f=0;f<e.length;f++)t[e[f]]=!0;n.handler=function(n){if(this===n.target){var e=n.type!=="keypress"&&i.hotkeys.specialKeys[n.which],f="",o;if(n.altKey&&e!=="alt"&&(f+="alt+"),n.ctrlKey&&e!=="ctrl"&&(f+="ctrl+"),n.metaKey&&!n.ctrlKey&&e!=="meta"&&(f+="meta+"),n.shiftKey&&e!=="shift"&&(f+="shift+"),e){if(t[f+e])return u(r,this,arguments,n)}else if((o=String.fromCharCode(n.which).toLowerCase(),t[f+o])||t[f+i.hotkeys.shiftNums[o]]||f==="shift+"&&t[i.hotkeys.shiftNums[o]])return u(r,this,arguments,n)}}}}var f=window.XMLSerializer;i.fn.between=function(n,t){var r,i;this[0].nodeType!==3?(r=this.children().size(),t>r&&(t=r),t<=0?this.prepend(n):this.children().eq(t-1).after(n)):t<=0?this.before(n):t>=this[0].length?this.after(n):(i=this[0].data,this[0].data=i.substring(0,t),this.after(i.substring(t,i.length)),this.after(n))},i.fn.contentEditable=function(n){var t=i(this),u="contenteditable";return(i.browser.msie&&parseInt(i.browser.version,10)==7&&(u="contentEditable"),typeof n=="undefined")?typeof t[0]=="undefined"?(r.warn("The jquery object did not contain any valid elements."),undefined):typeof t[0].isContentEditable=="undefined"?(r.warn("Could not determine whether the is editable or not. I assume it is."),!0):t[0].isContentEditable:(n===""?t.removeAttr(u):(n=n&&n!=="false"?"true":"false",t.attr(u,n)),t)},i.fn.aloha=function(){var t=this;return n.bind("aloha-plugins-loaded",function(){t.each(function(t,r){n.isEditable(r)||new n.Editable(i(r)).init()})}),t},i.fn.mahalo=function(){return this.each(function(){n.isEditable(this)&&n.getEditableById(i(this).attr("id")).destroy()})},i.fn.alohaText=function(){return this.each(function(){n.isEditable(this)&&n.getEditableById(i(this).attr("id")).getContents()})},i.fn.contentEditableSelectionChange=function(n){var r=this;return this.keyup(function(i){var r=t.getRangeObject();n(i)}),this.dblclick(function(t){n(t)}),this.mousedown(function(){r.selectionStarted=!0}),i(document).mouseup(function(i){t.eventOriginalTarget=r,r.selectionStarted&&n(i),t.eventOriginalTarget=!1,r.selectionStarted=!1}),this},i.fn.outerHtml=i.fn.outerHtml||function(){var t=i(this),n=t.get(0);if(typeof n.outerHTML!="undefined")return n.outerHTML;try{return(new f).serializeToString(n)}catch(r){try{return n.xml}catch(u){}}},i.fn.zap=function(){return this.each(function(){i(this.childNodes).insertBefore(this)}).remove()},i.fn.textNodes=function(n,t){var r=[],u=function(f){var e,o;if(f.nodeType===3&&i.trim(f.data)&&!t||f.nodeType===3&&t||f.nodeName=="BR"&&!n)r.push(f);else for(e=0,o=f.childNodes.length;e<o;++e)u(f.childNodes[e])};return u(this[0]),i(r)},i.extendObjects=i.fn.extendObjects=function(n,t){var o,e,f,u,c,l,s=1,r=n||{},v=arguments.length,a=!1,h;for(typeof r=="boolean"&&(a=r,r=t||{},s=2),typeof r=="object"||i.isFunction(r)||(r={}),v===s&&(r=this,--s),h=s;h<v;h++)if((o=arguments[h])!=null)for(e in o)if(o.hasOwnProperty(e)){if(f=r[e],u=o[e],r===u)continue;a&&u&&(i.isPlainObject(u)||!0===(c=i.isArray(u)))?(c?(c=!1,l=f&&i.isArray(f)?f:[]):l=f&&i.isPlainObject(f)?f:{},r[e]=i.isArray(u)?u:i.extendObjects(a,l,u)):u!==undefined&&(r[e]=u)}return r},i.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",188:",",190:".",191:"/",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},i.each(["keydown","keyup","keypress"],function(){i.event.special[this]={add:e}})}),define("aloha/sidebar",["aloha/core","jquery","aloha/selection","PubSub"],function(n,t,i,r){var e=+new Date,h,c;t.easing.easeOutExpo||t.extend(t.easing,{easeOutExpo:function(n,t,i,r,u){return t==u?i+r:r*(-Math.pow(2,-10*t/u)+1)+i},easeOutElastic:function(n,t,i,r,u){var f=Math,s=1.70158,e=0,o=r;return t?(t/=u)==1?i+r:(e||(e=u*.3),o<f.abs(r)?(o=r,s=e/4):s=e/(2*f.PI)*f.asin(r/o),o*f.pow(2,-10*t)*f.sin((t*u-s)*2*f.PI/e)+r+i):i}});var u=function(n){this.id=null,this.folds={},this.button=null,this.title=t('<div class="aloha-sidebar-panel-title"><span class="aloha-sidebar-panel-title-arrow"><\/span><span class="aloha-sidebar-panel-title-text">Untitled<\/span><\/div>'),this.content=t('<div class="aloha-sidebar-panel-content"><div class="aloha-sidebar-panel-content-inner"><div class="aloha-sidebar-panel-content-inner-text"><\/div><\/div><\/div>'),this.element=null,this.effectiveElement=null,this.expanded=!1,this.isActive=!0,this.init(n)},f=function(i){var r=this;this.id="aloha-sidebar-"+ ++e,this.panels={},this.container=t('<div class="aloha-ui aloha-sidebar-bar"><div class="aloha-sidebar-handle"><span class="aloha-sidebar-handle-icon"><\/span><\/div><div class="aloha-sidebar-inner"><ul class="aloha-sidebar-panels"><\/ul><\/div><\/div>'),this.width=300,this.opened=!1,this.isOpen=!1,this.isCompletelyOpen=!1,this.settings={rotateIcons:!t.browser.msie,overlayPage:!0},t(function(){typeof n.settings.sidebar!="undefined"&&n.settings.sidebar.disabled||r.init(i)})},o=null,s=null;return t.extend(f.prototype,{init:function(n){var i=this,u,r;typeof n=="object"&&(u=n.panels,delete n.panels),t.extend(this,n),typeof u=="object"&&t.each(u,function(){i.addPanel(this,!0)}),r=this.container,this.position==="right"&&r.addClass("aloha-sidebar-right"),r.hide().appendTo(t("body")).click(function(){i.barClicked.apply(i,arguments)}).find(".aloha-sidebar-panels").width(this.width),r.width(this.width),this.width=r.width(),this.updateHeight(),this.initToggler(),this.container.css(this.position==="right"?"marginRight":"marginLeft",-this.width),this.opened&&this.open(0),this.toggleHandleIcon(this.isOpen),this.subscribeToEvents(),t(window).resize(function(){i.updateHeight(),i.correctHeight()}),this.correctHeight()},show:function(){return this.container.css("display","block"),this},hide:function(){return this.container.css("display","none"),this},checkActivePanels:function(n){var r=[],u,i,f;if(typeof n!="undefined"&&typeof n.markupEffectiveAtStart!="undefined")for(u=n.markupEffectiveAtStart.length,i=0;i<u;++i)r.push(t(n.markupEffectiveAtStart[i]));f=this,t.each(this.panels,function(){f.showActivePanel(this,r)}),this.correctHeight()},subscribeToEvents:function(){var t=this;r.sub("aloha.selection.context-change",function(n){t.isOpen&&t.checkActivePanels(n.range),t.lastRange=n.range}),n.bind("aloha-editable-deactivated",function(){t.isOpen&&t.checkActivePanels(),t.lastRange=null}),this.container.mousedown(function(t){t.originalEvent.stopSelectionUpdate=!0,n.eventHandled=!0}),this.container.mouseup(function(t){t.originalEvent.stopSelectionUpdate=!0,n.eventHandled=!1})},correctHeight:function(){if(this.isOpen){if(!this.isCompletelyOpen){this.correctHeightWhenCompletelyOpen=!0;return}var v=t(window).height(),r=[],n=[],u;for(u in this.panels)this.panels.hasOwnProperty(u)&&this.panels[u].isActive&&(n.push(this.panels[u]),r.push(u));if(0!==n.length&&(r=r.sort().join(","),s!==r||o!==v)){o=v,s=r;for(var w=this.container.find(".aloha-sidebar-inner").height(),c=w-(n[0].title.outerHeight()+10)*n.length,f,e,i,y,l,a=0,p=Math,h;n.length>0&&c>0;){for(c+=a,a=0,l=[],h=n.length-1;h>=0;--h)f=n[h],i=f.content.find(".aloha-sidebar-panel-content-inner"),e=p.min(i.height("auto").height(),p.floor(c/(h+1))),i.height(e),c-=e,y=i.find(".aloha-sidebar-panel-content-inner-text"),y.height()>e?(l.push(f),a+=e,i.css({"overflow-x":"hidden","overflow-y":"scroll"})):i.css("overflow-y","hidden"),f.expanded&&f.expand();n=l}}}},showActivePanel:function(n,i){i.push(null);for(var s=n.content.parent("li"),e=n.activeOn,u=t(),f=0,o=i.length,r=0;r<o;++r)e(i[r])&&(++f,i[r]&&t.merge(u,i[r]));f?n.activate(u):n.deactivate()},initToggler:function(){var r=this,e=this.container,f=e.find(".aloha-sidebar-handle-icon"),o="aloha-sidebar-toggled",i,u=this.position==="right";this.opened&&this.rotateHandleArrow(u?0:180,0),t(function(){typeof n.settings.sidebar!="undefined"&&n.settings.sidebar.handle&&n.settings.sidebar.handle.top&&(t(e.find(".aloha-sidebar-handle"))[0].style.top=n.settings.sidebar.handle.top)}),e.find(".aloha-sidebar-handle").click(function(){i&&clearInterval(i),f.stop().css("marginLeft",4),r.isOpen?(t(this).removeClass(o),r.close(),r.isOpen=!1):(t(this).addClass(o),r.open(),r.isOpen=!0)}).hover(function(){var n=r.isOpen?-1:1;i&&clearInterval(i),f.stop(),t(this).stop().animate(u?{marginLeft:"-="+n*5}:{marginRight:"-="+n*5},200),i=setInterval(function(){n*=-1,f.animate(u?{left:"-="+n*4}:{right:"-="+n*4},300)},300)},function(){i&&clearInterval(i),f.stop().css(u?"left":"right",5),t(this).stop().animate(u?{marginLeft:0}:{marginRight:0},600,"easeOutElastic")})},roundCorners:function(){var n=this.container,t=n.find(".aloha-sidebar-panels>li:not(.aloha-sidebar-deactivated)"),i="aloha-sidebar-panel-top",r="aloha-sidebar-panel-bottom";n.find(".aloha-sidebar-panel-top, .aloha-sidebar-panel-bottom").removeClass(i).removeClass(r),t.first().find(".aloha-sidebar-panel-title").addClass(i),t.last().find(".aloha-sidebar-panel-content").addClass(r)},updateHeight:function(){var n=t(window).height();this.container.height(n).find(".aloha-sidebar-inner").height(n)},barClicked:function(n){this.handleBarclick(t(n.target))},handleBarclick:function(n){n.hasClass("aloha-sidebar-panel-title")?this.togglePanel(n):n.hasClass("aloha-sidebar-panel-content")||n.hasClass("aloha-sidebar-handle")||n.hasClass("aloha-sidebar-bar")||this.handleBarclick(n.parent())},getPanelById:function(n){return this.panels[n]},getPanelByElement:function(n){var t=n[0].tagName==="LI"?n:n.parent("li");return this.getPanelById(t[0].id)},togglePanel:function(n){this.getPanelByElement(n).toggle()},rotateHandleIcon:function(n,t){var i=this.container.find(".aloha-sidebar-handle-icon");i.animate({angle:n},{duration:typeof t=="number"||typeof t=="string"?t:500,easing:"easeOutExpo",step:function(n){i.css({"-o-transform":"rotate("+n+"deg)","-webkit-transform":"rotate("+n+"deg)","-moz-transform":"rotate("+n+"deg)","-ms-transform":"rotate("+n+"deg)"})}})},toggleHandleIcon:function(n){var i=this.position==="right"^n,t;this.settings.rotateIcons?this.rotateHandleIcon(i?180:0,0):(t=this.container.find(".aloha-sidebar-handle-icon"),i?t.addClass("aloha-sidebar-handle-icon-left"):t.removeClass("aloha-sidebar-handle-icon-left"))},open:function(n){if(this.isOpen)return this;var r=this.position==="right",u=r?{marginRight:0}:{marginLeft:0},i=this;return this.toggleHandleIcon(!0),this.container.animate(u,typeof n=="number"||typeof n=="string"?n:500,"easeOutExpo"),this.settings.overlayPage||t("body").animate(r?{marginRight:"+="+this.width}:{marginLeft:"+="+this.width},500,"easeOutExpo",function(){i.isCompletelyOpen=!0,i.correctHeightWhenCompletelyOpen&&i.correctHeight()}),this.isOpen=!0,this.correctHeight(),this.lastRange&&this.checkActivePanels(this.lastRange),t("body").trigger("aloha-sidebar-opened",this),this},close:function(n){if(!this.isOpen)return this;var i=this.position==="right",r=i?{marginRight:-this.width}:{marginLeft:-this.width};return this.toggleHandleIcon(!1),this.container.animate(r,typeof n=="number"||typeof n=="string"?n:500,"easeOutExpo"),this.settings.overlayPage||t("body").animate(i?{marginRight:"-="+this.width}:{marginLeft:"-="+this.width},500,"easeOutExpo"),this.isOpen=!1,this.isCompletelyOpen=!1,this},activatePanel:function(n,t){return typeof n=="string"&&(n=this.getPanelById(n)),n&&n.activate(t),this.roundCorners(),this},expandPanel:function(n,t){return typeof n=="string"&&(n=this.getPanelById(n)),n&&n.expand(t),this},collapsePanel:function(n,t){return typeof n=="string"&&(n=this.getPanelById(n)),n&&n.collapse(t),this},addPanel:function(n){return n instanceof u||(n.width||(n.width=this.width),n.sidebar=this,n=new u(n)),this.panels[n.id]=n,this.container.find(".aloha-sidebar-panels").append(n.element),this.checkActivePanels(i.getRangeObject()),n}}),t.extend(u.prototype,{init:function(n){this.setTitle(n.title).setContent(n.content),delete n.title,delete n.content,t.extend(this,n),this.id||(this.id="aloha-sidebar-"+ ++e);var i=this.element=t('<li id="'+this.id+'">').append(this.title,this.content);this.expanded&&this.content.height("auto"),this.toggleTitleIcon(this.expanded),this.coerceActiveOn(),this.title.attr("unselectable","on").css("-moz-user-select","none").each(function(){this.onselectstart=function(){return!1}}),typeof this.onInit=="function"&&this.onInit.apply(this)},toggleTitleIcon:function(n){if(this.sidebar.settings.rotateIcons)this.rotateTitleIcon(n?90:0);else{var t=this.title.find(".aloha-sidebar-panel-title-arrow");n?t.addClass("aloha-sidebar-panel-title-arrow-down"):t.removeClass("aloha-sidebar-panel-title-arrow-down")}},coerceActiveOn:function(){if(typeof this.activeOn!="function"){var n=this.activeOn;this.activeOn=function(){var t=typeof n;return t==="boolean"?function(){return n}:t==="undefined"?function(){return!0}:t==="string"?function(t){return t?t.is(n):!1}:function(){return!1}}()}},activate:function(n){this.isActive=!0,this.content.parent("li").show().removeClass("aloha-sidebar-deactivated"),this.effectiveElement=n,typeof this.onActivate=="function"&&this.onActivate.call(this,n)},deactivate:function(){this.isActive&&(this.isActive=!1,this.content.parent("li").hide().addClass("aloha-sidebar-deactivated"),this.effectiveElement=null)},toggle:function(){this.expanded?this.collapse():this.expand()},expand:function(n){var i=this,t=this.content,r=t.height(),u=t.height("auto").height();return t.height(r).stop().animate({height:u},500,"easeOutExpo",function(){typeof n=="function"&&n.call(i)}),this.element.removeClass("collapsed"),this.toggleTitleIcon(!0),this.expanded=!0,this},collapse:function(n,t){var i=this;return this.element.addClass("collapsed"),this.content.stop().animate({height:5},250,"easeOutExpo",function(){typeof t=="function"&&t.call(i)}),this.toggleTitleIcon(!1),this.expanded=!1,this},setTitle:function(n){return this.title.find(".aloha-sidebar-panel-title-text").html(n),this},setContent:function(n){return n&&n!==""||(n="&nbsp;"),this.content.find(".aloha-sidebar-panel-content-inner-text").html(n),this},rotateTitleIcon:function(n,t){var i=this.title.find(".aloha-sidebar-panel-title-arrow");i.animate({angle:n},{duration:typeof t=="number"?t:500,easing:"easeOutExpo",step:function(n){i.css({"-o-transform":"rotate("+n+"deg)","-webkit-transform":"rotate("+n+"deg)","-moz-transform":"rotate("+n+"deg)","-ms-transform":"rotate("+n+"deg)"})}})},renderEffectiveParents:function(n,i){for(var r=n.first(),o=[],u=[],s=this.activeOn,f,e;r.length>0&&!r.is(".aloha-editable");){if(s(r)){for(u.push("<span>"+r[0].tagName.toLowerCase()+"<\/span>"),f=u.length,e=[];f--;)e.push(u[f]);o.push('<div class="aloha-sidebar-panel-parent"><div class="aloha-sidebar-panel-parent-path">'+e.join("")+'<\/div><div class="aloha-sidebar-panel-parent-contentaloha-sidebar-opened">'+(typeof i=="function"?i(r):"----")+"<\/div><\/div>")}r=r.parent()}this.setContent(o.join("")),t(".aloha-sidebar-panel-parent-path").click(function(){var n=t(this).parent().find(".aloha-sidebar-panel-parent-content");n.hasClass("aloha-sidebar-opened")?n.hide().removeClass("aloha-sidebar-opened"):n.show().addClass("aloha-sidebar-opened")}),this.content.height("auto").find(".aloha-sidebar-panel-content-inner").height("auto")}}),h=new f({position:"left",width:250}),c=new f({position:"right",width:250}),n.Sidebar={left:h,right:c},n.Sidebar}),window.GENTICS=window.GENTICS||{},window.GENTICS.Utils=window.GENTICS.Utils||{},define("util/position",["jquery"],function(n){var i=n,t=window.GENTICS,r=window.Class,u=window.console;t.Utils.Position={},t.Utils.Position.w=n(window),t.Utils.Position.Scroll={top:0,left:0,isScrolling:!1},t.Utils.Position.ScrollCorrection={top:100,left:50},t.Utils.Position.Mouse={x:0,y:0,oldX:0,oldY:0,isMoving:!1,triggeredMouseStop:!0},t.Utils.Position.mouseStopCallbacks=[],t.Utils.Position.mouseMoveCallbacks=[],t.Utils.Position.update=function(){var t=this.w.scrollTop(),i=this.w.scrollLeft(),n;if(this.Scroll.isScrolling?this.Scroll.top==t&&this.Scroll.left==i&&(this.Scroll.isScrolling=!1):(this.Scroll.top!=t||this.Scroll.left!=i)&&(this.Scroll.isScrolling=!0),this.Scroll.top=t,this.Scroll.left=i,this.Mouse.x==this.Mouse.oldX&&this.Mouse.y==this.Mouse.oldY){if(this.Mouse.isMoving=!1,!this.Mouse.triggeredMouseStop)for(this.Mouse.triggeredMouseStop=!0,n=0;n<this.mouseStopCallbacks.length;n++)this.mouseStopCallbacks[n].call()}else for(this.Mouse.isMoving=!0,this.Mouse.triggeredMouseStop=!1,n=0;n<this.mouseMoveCallbacks.length;n++)this.mouseMoveCallbacks[n].call();this.Mouse.oldX=this.Mouse.x,this.Mouse.oldY=this.Mouse.y},t.Utils.Position.addMouseStopCallback=function(n){return this.mouseStopCallbacks.push(n),this.mouseStopCallbacks.length-1},t.Utils.Position.addMouseMoveCallback=function(n){return this.mouseMoveCallbacks.push(n),this.mouseMoveCallbacks.length-1},n(function(){window.setInterval(function(){t.Utils.Position.update()},500)}),n("html").mousemove(function(n){t.Utils.Position.Mouse.x=n.pageX,t.Utils.Position.Mouse.y=n.pageY})}),define("aloha/repositoryobjects",["aloha/core","util/class"],function(n,t){var i=window.GENTICS;n.RepositoryObject=function(){},n.RepositoryDocument=t.extend({_constructor:function(n){var t=n;(this.type="document",t.id&&t.name&&t.repositoryId)&&(i.Utils.applyProperties(this,n),this.baseType="document")}}),n.RepositoryFolder=t.extend({_constructor:function(n){var t=n;(this.type="folder",t.id&&t.name&&t.repositoryId)&&(i.Utils.applyProperties(this,n),this.baseType="folder")}})}),define("aloha/repositorymanager",["jquery","util/class","aloha/core","aloha/console","aloha/repositoryobjects"],function(n,t,i,r){function e(n,t){var i={items:n,results:n.length};return t&&(i.numItems=t.numItems,i.hasMoreItems=t.hasMoreItems,i.timeout=t.timeout),i}function u(n,t){n(t)}var f=function(n){return n?function(n,t){return n.filter(t)}:function(n,t){for(var r=[],i=0;i<n.length;i++)t(n[i])&&r.push(n[i]);return r}}(Array.prototype.hasOwnProperty("filter")),o={query:function(n){return typeof n.query=="function"},getChildren:function(n){return typeof n.getChildren=="function"},getSelectedFolder:function(n){return typeof n.getSelectedFolder=="function"}},s=t.extend({repositories:[],settings:i.settings&&i.settings.repositories||{},initialized:!1,init:function(){var n=this,t;for(typeof n.settings.timeout=="undefined"&&(n.settings.timeout=5e3),t=0;t<n.repositories.length;t++)n.initRepository(n.repositories[t]);n.initialized=!0},register:function(n){var t=this;t.getRepository(n.repositoryId)?r.warn(t,'A repository with name "'+n.repositoryId+'" already registerd. Ignoring this.'):(t.repositories.push(n),t.initialized&&t.initRepository(n))},initRepository:function(t){var i=this;t.settings||(t.settings={}),i.settings[t.repositoryId]&&n.extend(t.settings,i.settings[t.repositoryId]),t.init()},getRepository:function(n){for(var i=this,t=0;t<i.repositories.length;t++)if(i.repositories[t].repositoryId===n)return i.repositories[t];return null},query:function(t,i){var c=this,l,v=[],s={numItems:0,hasMoreItems:!1},h,p=t.timeout&&parseInt(t.timeout,10)||c.settings.timeout,y=window.setTimeout(function(){s=s||{},s.timeout=!0,h>0&&(r.warn(c,h+" repositories did not return before the configured timeout of "+p+"ms."),h=0),clearTimeout(y),u(i,e(v,s))},p),b=function(t,f){var l=this,a,o;if(0!==h){if(t&&t.length){if(!t[0].repositoryId)for(a=l.repositoryId,o=0;o<t.length;o++)t[o].repositoryId=a;n.merge(v,t)}f&&s?(s.numItems=n.isNumeric(f.numItems)&&n.isNumeric(s.numItems)?s.numItems+f.numItems:undefined,s.hasMoreItems=typeof f.hasMoreItems=="boolean"&&typeof s.hasMoreItems=="boolean"?s.hasMoreItems||f.hasMoreItems:undefined,f.timeout&&(s.timeout=!0)):s=undefined,r.debug(c,"The repository "+l.repositoryId+"returned with "+t.length+" results."),0==--h&&(clearTimeout(y),u(i,e(v,s)))}},k=t.repositoryId?[c.getRepository(t.repositoryId)]:c.repositories,a=f(k,o.query),w;if(0===a.length){clearTimeout(y),u(i,e(v,s));return}for(w=function(n){return function(){b.apply(n,arguments)}},h=a.length,l=0;l<a.length;l++)a[l].query(t,w(a[l]))},getChildren:function(t,e){var v=this,s,c=[],l=0,p=t.timeout&&parseInt(t.timeout,10)||v.settings.timeout,y=window.setTimeout(function(){l>0&&(r.warn(v,l+" repositories did not respond before the configured timeout of "+p+"ms."),l=0),clearTimeout(y),u(e,c)},p),w=function(t){0!==l&&(t&&n.merge(c,t),0==--l&&(clearTimeout(y),u(e,c)))},h=t.repositoryId?[v.getRepository(t.repositoryId)]:v.repositories,b,a;if(t.repositoryFilter&&t.repositoryFilter.length&&(h=f(h,function(i){return-1<n.inArray(i.repositoryId,t.repositoryFilter)})),"aloha"===t.inFolderId){for(b=t.repositoryFilter&&0<t.repositoryFilter.length,s=0;s<h.length;s++)c.push(new i.RepositoryFolder({id:h[s].repositoryId,name:h[s].repositoryName,repositoryId:h[s].repositoryId,type:"repository",hasMoreItems:!0}));clearTimeout(y),u(e,c);return}if(a=f(h,o.getChildren),0===a.length){clearTimeout(y),u(e,c);return}for(l=a.length,s=0;s<a.length;s++)a[s].getChildren(t,w)},makeClean:function(n){var i=this,t={},u=0,f=i.repositories.length;n.find("[data-gentics-aloha-repository="+this.prefix+"]").each(function(){while(u<f)t.makeClean(n),u+=1;r.debug(i,"Passing contents of HTML Element with id { "+this.attr("id")+" } for cleaning to repository { "+t.repositoryId+" }"),t.makeClean(this)})},markObject:function(t,i){var u,f;t&&(u=this,i?(f=u.getRepository(i.repositoryId),f?(n(t).attr({"data-gentics-aloha-repository":i.repositoryId,"data-gentics-aloha-object-id":i.id}),f.markObject(t,i)):r.error(u,'Trying to apply a repository "'+i.name+'" to an object, but item has no repositoryId.')):n(t).removeAttr("data-gentics-aloha-repository").removeAttr("data-gentics-aloha-object-id"))},getObject:function(t,i){var u=this,o=n(t),f=o.attr("data-gentics-aloha-object-id"),e=o.attr("data-gentics-aloha-repository"),s=u.getRepository(e),r;s&&f&&(u.itemCache||(u.itemCache=[]),r=u.itemCache[e],r||(r=u.itemCache[e]=[]),r[f]?i([r[f]]):s.getObjectById(f,function(n){r[f]=n[0],i(n)}))},folderOpened:function(n){var t=this.getRepository(n.repositoryId);typeof t.folderOpened=="function"&&t.folderOpened(n)},folderClosed:function(n){var t=this.getRepository(n.repositoryId);typeof t.folderClosed=="function"&&t.folderClosed(n)},folderSelected:function(n){var t=this.getRepository(n.repositoryId);typeof t.folderSelected=="function"&&t.folderSelected(n)},getSelectedFolder:function(){for(var i=f(this.repositories,o.getSelectedFolder),t,n=0;n<i.length;n++)if(t=i[n].getSelectedFolder(),t)return t;return null},toString:function(){return"repositorymanager"}});return i.RepositoryManager=new s,i.RepositoryManager}),define("aloha/repository",["aloha/core","util/class","aloha/repositorymanager"],function(n,t,i){var r=t.extend({_constructor:function(n,t){this.repositoryId=n,this.settings={},this.repositoryName=t||n,i.register(this)},init:function(){},query:null,getChildren:null,makeClean:function(){},markObject:function(){},setTemplate:function(n){this.template=n?n:null},hasTemplate:function(){return this.template?!0:!1},getTemplate:function(){return this.template},getObjectById:function(){return!0}});return n.AbstractRepository=r,r}),function(n){function u(){var u,i,n=Aloha.settings.plugins&&Aloha.settings.plugins.load,t=Aloha.settings.baseUrl,f,e=/\/aloha.js(\?\S*)?$/,r;if(!n||!t)for(u=document.getElementsByTagName("script"),r=0;r<u.length;r++){if(i=u[r],f=i.getAttribute("data-aloha-plugins"),null!=f){n||(n=f),t||(t=i.src.replace(/\/[^\/]*\.js$/,""));break}!t&&e.test(i.src)&&(t=i.src.replace(e,""))}return typeof n=="string"&&n!==""&&(n=n.replace(/\s+/g,"").split(",")),{baseUrl:t,plugins:n||[]}}function f(){for(var t=document.getElementsByTagName("script"),i,n=0;n<t.length;n++)if(i=t[n].getAttribute("data-aloha-defer-init"),"true"===i)return!0;return!1}function e(n,t,i){var f=["nls","css","vendor","res"],u,r;for(n[i]=t+"/"+i+"/lib",u=0;u<f.length;u++)r=f[u],n[i+"/"+r]=t+"/"+i+"/"+r}function o(n){for(var o={},s=[],h={},c={},u,i,t,l=Aloha.settings.basePath||"",f,a=Aloha.settings.bundles||{},r=0;r<n.length;r++)u=n[r].split("/"),i=u[0],t=u[1],f=a[i]?l+a[i]:l+"../plugins/"+i,e(o,f,t),h[t]=f+"/"+t,s.push(t+"/"+t+"-plugin"),c[t]={jquery:"aloha/jquery"};return{paths:o,entryPoints:s,baseUrlByName:h,names:[],map:c}}function i(){for(var u={},i=Array.prototype.slice.call(arguments),t,r,n=0;n<i.length;n++){r=i[n];for(t in r)r.hasOwnProperty(t)&&(u[t]=i[n][t])}return u}function s(n,t){define(n,function(){return t})}function r(){var c,r,e,h,l,a;Aloha.features={},Aloha.defaults={},Aloha.settings=Aloha.settings||{},Aloha.initialize=t.start,c=u(),r=o(c.plugins),Aloha.settings.baseUrl=c.baseUrl,Aloha.settings.loadedPlugins=r.names,Aloha.settings._pluginBaseUrlByName=r.baseUrlByName;var y=i({aloha:{jquery:"aloha/jquery"},"aloha/jquery":{jquery:"jquery"},jqueryui:{jquery:"aloha/jquery"},vendor:{jquery:"aloha/jquery"},util:{jquery:"aloha/jquery"},RepositoryBrowser:{jquery:"aloha/jquery"},jstree:{jquery:"aloha/jquery"},jqgrid:{jquery:"aloha/jquery"},"jqgrid-locale-en":{jquery:"aloha/jquery"},"jqgrid-locale-de":{jquery:"aloha/jquery"},"jquery-layout":{jquery:"aloha/jquery"}},r.map),v={context:"aloha",config:{i18n:{locale:Aloha.settings.locale||"en"}},baseUrl:Aloha.settings.baseUrl,map:y},p=n.__DEPS__||(n.__DEPS__={});p.lang=v.locale;var f=i(v,Aloha.settings.requireConfig);f.paths=i({jquery:"vendor/jquery-1.7.2",jqueryui:"vendor/jquery-ui-1.9.0.custom-aloha"},{PubSub:"vendor/pubsub/js/pubsub-unminified",Class:"vendor/class",RepositoryBrowser:"vendor/repository-browser/js/repository-browser-unminified",jstree:"vendor/jquery.jstree",jqgrid:"vendor/jquery.jqgrid","jquery-layout":"vendor/jquery.layout-1.3.0-rc30.7","jqgrid-locale-en":"vendor/grid.locale.en","jqgrid-locale-de":"vendor/grid.locale.de","repository-browser-i18n-de":"vendor/repository-browser/js/repository-browser-unminified","repository-browser-i18n-en":"vendor/repository-browser/js/repository-browser-unminified"},r.paths,f.paths),e=Aloha.settings.predefinedModules||{},Aloha.settings.jQuery&&(e.jquery=Aloha.settings.jQuery);for(h in e)e.hasOwnProperty(h)&&(s(h,e[h]),delete f.paths[h]);l=require.config(f),Aloha.require=function(n){return 1===arguments.length&&typeof n=="function"?l(["aloha"],n):l.apply(this,arguments)},Aloha.bind=function(n,i){return Aloha.require(["aloha/jquery"],function(r){Aloha.bind=function(n,i){switch(t.getReadiness(n)){case"deferred":var u=t.getPhaseByEvent(n);u.deferred||(u.deferred=r.Deferred()),u.deferred.done(i);break;case"immediate":i();break;case"normal":r(Aloha,"body").bind(n,i);break;default:throw"Unknown readiness";}return this},Aloha.bind(n,i)}),this},Aloha.trigger=function(n,i){return Aloha.require(["aloha/jquery"],function(r){Aloha.trigger=function(n,i){var u=t.getPhaseByEvent(n);return u&&u.deferred&&(r(u.deferred.resolve),u.deferred=null),r(Aloha,"body").trigger(n,i),this},Aloha.trigger(n,i)}),this},Aloha.unbind=function(n){Aloha.require(["aloha/jquery"],function(t){Aloha.unbind=function(n){t(Aloha,"body").unbind(n)},Aloha.unbind(n)})},Aloha.ready=function(n){return this.bind("aloha-ready",n),this},a=Aloha.settings.jQuery,define("aloha/jquery",["jquery"],function(n){return a||n}),Aloha.jQuery=a,define("aloha",["aloha/jquery","util/json2","aloha/rangy-core","util/class","util/lang","util/range","util/dom","aloha/core","aloha/editable","aloha/console","aloha/markup","aloha/plugin","aloha/selection","aloha/command","aloha/jquery.aloha","aloha/sidebar","util/position","aloha/repositorymanager","aloha/repository","aloha/repositoryobjects","aloha/contenthandlermanager"],function(n){return Aloha.features.jquery=!0,Aloha.jQuery=n,Aloha.settings=n.extendObjects(!0,{},Aloha.defaults,Aloha.settings),Aloha}),require(f,["aloha","aloha/jquery"],function(n,t){require(f,r.entryPoints,function(){t(function(){window.rangy.init(),n.init()})})})}var t={phases:[],completed:[],start:function(n,i){t.phases=t.phases.concat(n),t.proceed(0,n,i)},proceed:function(n,i,r){if(n<i.length){var u=i[n],f=function(){t.proceed(++n,i,r)},e=function(){t.completed.push(u),u.event&&Aloha.trigger(u.event)};u.fn?u.fn(e,f):(e(),f())}else r&&r()},getPhaseByEvent:function(n){for(var i=0;i<t.phases.length;i++)if(n===t.phases[i].event)return t.phases[i];return null},getReadiness:function(n){for(var i=0;i<t.completed.length;i++)if(n===t.completed[i].event)return"immediate";return t.getPhaseByEvent(n)?"deferred":"normal"}};n.Aloha=n.Aloha||{},n.Aloha.deferInit||f()?n.Aloha.deferInit=r:Aloha._load=r}(window),define("ui/context",["aloha","jquery","util/class"],function(n,t,i){var f="aloha-ui-context",e="#"+f,r,u;return r=t(e),r.length||(r=t("<div>",{"class":"aloha",id:f}),t(function(){r.appendTo("body")})),u=i.extend({surfaces:[],containers:[]}),t.extend(u,{selector:e,element:r}),u}),define("ui/scopes",["jquery","PubSub","util/maps"],function(n,t,i){function o(n,t){var r,i,u;if(f.hasOwnProperty(t))for(r=f[t],i=0;i<r.length;i++)u=r[i],n.push(u),o(n,u)}var f={"Aloha.empty":[],"Aloha.global":["Aloha.empty"],"Aloha.continuoustext":["Aloha.global"]},r=[],u={},e=!1,s;return Aloha.bind("aloha-selection-changed-before",function(){e=!1}),Aloha.bind("aloha-selection-changed-after",function(n,t,i){typeof i=="undefined"||e||s.setScope("Aloha.continuoustext")}),s={enterScope:function(n,i){var r,f;i=i||"_globalCounter",r=u[n],r||(r=u[n]={}),f=r[i]||0,r[i]=f+1,f||t.pub("aloha.ui.scope.change")},leaveScope:function(n,r,f){var e,o;(r=r||"_globalCounter",e=u[n],e)&&(o=e[r],o)&&(o-=1,o&&!f?e[r]=o:(delete e[r],i.isEmpty(e)&&delete u[n],t.pub("aloha.ui.scope.change")))},isActiveScope:function(t){if(u[t])return!0;var i=-1!==n.inArray(t,r);return i?!0:!1},getPrimaryScope:function(){return r[0]},setScope:function(n){e=!0,r[0]!=n&&(r=[n],o(r,n),t.pub("aloha.ui.scope.change"))},createScope:function(n,t){t?typeof t=="string"&&(t=[t]):t=["Aloha.empty"],f[n]=t}}}),define("ui/container",["jquery","util/class","ui/scopes"],function(n,t,i){function e(n){return n.showOnId||(n.showOnId=++f),n.showOnId}function o(n,t){for(var r=t?"show":"hide",i=0;i<n.length;i++)n[i][r]()}function h(t,u){switch(n.type(u)){case"function":return u;case"object":if(u.scope)return r[u.scope]?r[u.scope]:r[u.scope]=function(){return i.isActiveScope(u.scope)};throw"Invalid showOn configuration";default:return s}}var f=0,r={},s=function(){return!0},u=t.extend({element:null,_constructor:function(n,t){var r=h(this,t.showOn),u=e(r),i=n.containers[u];this.context=n,i||(i=n.containers[u]={shouldShow:r,containers:[]}),i.containers.push(this)},show:function(){},hide:function(){},focus:function(){},foreground:function(){},childVisible:function(){},childFocus:function(){},childForeground:function(){}});return n.extend(u,{showContainersForContext:function(n,t){var r,u,i;if(n.containers){i=n.containers;for(u in i)i.hasOwnProperty(u)&&(r=i[u],o(r.containers,r.shouldShow(t)))}}}),u}),define("ui/surface",["aloha/core","jquery","util/class","ui/container"],function(n,t,i){var r=i.extend({_constructor:function(n){n.surfaces.push(this)},isActive:function(){return!0}});return t.extend(r,{range:null,show:function(n){t.each(n.surfaces,function(n,t){t.show()})},hide:function(n){t.each(n.surfaces,function(n,t){t.hide()})},trackRange:function(t){t.bind("mousedown",function(t){if(t.originalEvent.stopSelectionUpdate=!0,n.eventHandled=!0,r.suppressHide=!0,n.activeEditable){var i=n.getSelection();r.range=0<i.getRangeCount()?i.getRangeAt(0):null}}),t.bind("mouseup",function(t){t.originalEvent.stopSelectionUpdate=!0,n.eventHandled=!1,r.suppressHide=!1})}}),r}),define("ui/component",["aloha/core","jquery","util/class"],function(n,t,i){var r=0;return i.extend({id:0,isInstance:!0,container:null,type:null,visible:!0,_constructor:function(){this.id=r++,this.init()},adoptParent:function(n){this.container=n},init:function(){},isVisible:function(){return this.visible},show:function(n){if(!1===n){this.hide();return}this.visible||(this.visible=!0,this.element.show(),this.container&&this.container.childVisible(this,!0))},hide:function(){this.visible&&(this.visible=!1,this.element.hide(),this.container&&this.container.childVisible(this,!1))},focus:function(){this.element.focus(),this.container&&this.container.childFocus(this)},foreground:function(){this.container&&this.container.childForeground(this)},enable:function(){},disable:function(){}})}),define("jqueryui",["jquery"],function(n){(function(n,t){function i(t,i){var u,f,e,o=t.nodeName.toLowerCase();return"area"===o?(u=t.parentNode,f=u.name,!t.href||!f||u.nodeName.toLowerCase()!=="map")?!1:(e=n("img[usemap=#"+f+"]")[0],!!e&&r(e)):(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"===o?t.href||i:i)&&r(t)}function r(t){return!n(t).parents().andSelf().filter(function(){return n.css(this,"visibility")==="hidden"||n.expr.filters.hidden(this)}).length}var u=0,f=/^ui-id-\d+$/;(n.ui=n.ui||{},n.ui.version)||(n.extend(n.ui,{version:"1.9.0",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),n.fn.extend({_focus:n.fn.focus,focus:function(t,i){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){n(r).focus(),i&&i.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=n.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(n.css(this,"position"))&&/(auto|scroll)/.test(n.css(this,"overflow")+n.css(this,"overflow-y")+n.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(n.css(this,"overflow")+n.css(this,"overflow-y")+n.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?n(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var r=n(this[0]),u,f;r.length&&r[0]!==document;){if(u=r.css("position"),(u==="absolute"||u==="relative"||u==="fixed")&&(f=parseInt(r.css("zIndex"),10),!isNaN(f)&&f!==0))return f;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++u)})},removeUniqueId:function(){return this.each(function(){f.test(this.id)&&n(this).removeAttr("id")})}}),n("<a>").outerWidth(1).jquery||n.each(["Width","Height"],function(i,r){function e(t,i,r,u){return n.each(o,function(){i-=parseFloat(n.css(t,"padding"+this))||0,r&&(i-=parseFloat(n.css(t,"border"+this+"Width"))||0),u&&(i-=parseFloat(n.css(t,"margin"+this))||0)}),i}var o=r==="Width"?["Left","Right"]:["Top","Bottom"],u=r.toLowerCase(),f={innerWidth:n.fn.innerWidth,innerHeight:n.fn.innerHeight,outerWidth:n.fn.outerWidth,outerHeight:n.fn.outerHeight};n.fn["inner"+r]=function(i){return i===t?f["inner"+r].call(this):this.each(function(){n(this).css(u,e(this,i)+"px")})},n.fn["outer"+r]=function(t,i){return typeof t!="number"?f["outer"+r].call(this,t):this.each(function(){n(this).css(u,e(this,t,!0,i)+"px")})}}),n.extend(n.expr[":"],{data:n.expr.createPseudo?n.expr.createPseudo(function(t){return function(i){return!!n.data(i,t)}}):function(t,i,r){return!!n.data(t,r[3])},focusable:function(t){return i(t,!isNaN(n.attr(t,"tabindex")))},tabbable:function(t){var r=n.attr(t,"tabindex"),u=isNaN(r);return(u||r>=0)&&i(t,!u)}}),n(function(){var i=document.body,t=i.appendChild(t=document.createElement("div"));t.offsetHeight,n.extend(t.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),n.support.minHeight=t.offsetHeight===100,n.support.selectstart="onselectstart"in t,i.removeChild(t).style.display="none"}),n.fn.extend({disableSelection:function(){return this.bind((n.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(n){n.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),n.extend(n.ui,{plugin:{add:function(t,i,r){var u,f=n.ui[t].prototype;for(u in r)f.plugins[u]=f.plugins[u]||[],f.plugins[u].push([i,r[u]])},call:function(n,t,i){var r,u=n.plugins[t];if(u&&n.element[0].parentNode&&n.element[0].parentNode.nodeType!==11)for(r=0;r<u.length;r++)n.options[u[r][0]]&&u[r][1].apply(n.element,i)}},contains:n.contains,hasScroll:function(t,i){if(n(t).css("overflow")==="hidden")return!1;var r=i&&i==="left"?"scrollLeft":"scrollTop",u=!1;return t[r]>0?!0:(t[r]=1,u=t[r]>0,t[r]=0,u)},isOverAxis:function(n,t,i){return n>t&&n<t+i},isOver:function(t,i,r,u,f,e){return n.ui.isOverAxis(t,r,f)&&n.ui.isOverAxis(i,u,e)}}))})(n),function(n,t){var r=0,i=Array.prototype.slice,u=n.cleanData;n.cleanData=function(t){for(var i=0,r;(r=t[i])!=null;i++)try{n(r).triggerHandler("remove")}catch(f){}u(t)},n.widget=function(t,i,r){var e,o,u,s,f=t.split(".")[0];t=t.split(".")[1],e=f+"-"+t,r||(r=i,i=n.Widget),n.expr[":"][e.toLowerCase()]=function(t){return!!n.data(t,e)},n[f]=n[f]||{},o=n[f][t],u=n[f][t]=function(n,t){if(!this._createWidget)return new u(n,t);arguments.length&&this._createWidget(n,t)},n.extend(u,o,{version:r.version,_proto:n.extend({},r),_childConstructors:[]}),s=new i,s.options=n.widget.extend({},s.options),n.each(r,function(t,u){n.isFunction(u)&&(r[t]=function(){var n=function(){return i.prototype[t].apply(this,arguments)},r=function(n){return i.prototype[t].apply(this,n)};return function(){var i=this._super,f=this._superApply,t;return this._super=n,this._superApply=r,t=u.apply(this,arguments),this._super=i,this._superApply=f,t}}())}),u.prototype=n.widget.extend(s,{widgetEventPrefix:t},r,{constructor:u,namespace:f,widgetName:t,widgetBaseClass:e,widgetFullName:e}),o?(n.each(o._childConstructors,function(t,i){var r=i.prototype;n.widget(r.namespace+"."+r.widgetName,u,i._proto)}),delete o._childConstructors):i._childConstructors.push(u),n.widget.bridge(t,u)},n.widget.extend=function(r){for(var o=i.call(arguments,1),u=0,s=o.length,f,e;u<s;u++)for(f in o[u])e=o[u][f],o[u].hasOwnProperty(f)&&e!==t&&(r[f]=n.isPlainObject(e)?n.widget.extend({},r[f],e):e);return r},n.widget.bridge=function(r,u){var f=u.prototype.widgetFullName;n.fn[r]=function(e){var h=typeof e=="string",o=i.call(arguments,1),s=this;return e=!h&&o.length?n.widget.extend.apply(null,[e].concat(o)):e,h?this.each(function(){var i,u=n.data(this,f);return u?!n.isFunction(u[e])||e.charAt(0)==="_"?n.error("no such method '"+e+"' for "+r+" widget instance"):(i=u[e].apply(u,o),i!==u&&i!==t?(s=i&&i.jquery?s.pushStack(i.get()):i,!1):void 0):n.error("cannot call methods on "+r+" prior to initialization; attempted to call method '"+e+"'")}):this.each(function(){var t=n.data(this,f);t?t.option(e||{})._init():new u(e,this)}),s}},n.Widget=function(){},n.Widget._childConstructors=[],n.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=n(i||this.defaultElement||this)[0],this.element=n(i),this.uuid=r++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=n.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=n(),this.hoverable=n(),this.focusable=n(),i!==this&&(n.data(i,this.widgetName,this),n.data(i,this.widgetFullName,this),this._on({remove:"destroy"}),this.document=n(i.style?i.ownerDocument:i.document||i),this.window=n(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:n.noop,_getCreateEventData:n.noop,_create:n.noop,_init:n.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(n.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:n.noop,widget:function(){return this.element},option:function(i,r){var o=i,u,f,e;if(arguments.length===0)return n.widget.extend({},this.options);if(typeof i=="string")if(o={},u=i.split("."),i=u.shift(),u.length){for(f=o[i]=n.widget.extend({},this.options[i]),e=0;e<u.length-1;e++)f[u[e]]=f[u[e]]||{},f=f[u[e]];if(i=u.pop(),r===t)return f[i]===t?null:f[i];f[i]=r}else{if(r===t)return this.options[i]===t?null:this.options[i];o[i]=r}return this._setOptions(o),this},_setOptions:function(n){var t;for(t in n)this._setOption(t,n[t]);return this},_setOption:function(n,t){return this.options[n]=t,n==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i){i?(t=n(t),this.bindings=this.bindings.add(t)):(i=t,t=this.element);var r=this;n.each(i,function(i,u){function f(){if(r.options.disabled!==!0&&!n(this).hasClass("ui-state-disabled"))return(typeof u=="string"?r[u]:u).apply(r,arguments)}typeof u!="string"&&(f.guid=u.guid=u.guid||f.guid||n.guid++);var e=i.match(/^(\w+)\s*(.*)$/),o=e[1]+r.eventNamespace,s=e[2];s?r.widget().delegate(s,o,f):t.bind(o,f)})},_off:function(n,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,n.unbind(t).undelegate(t)},_delay:function(n,t){function r(){return(typeof n=="string"?i[n]:n).apply(i,arguments)}var i=this;return setTimeout(r,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){n(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){n(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){n(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){n(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,r){var u,f,e=this.options[t];if(r=r||{},i=n.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],f=i.originalEvent,f)for(u in f)u in i||(i[u]=f[u]);return this.element.trigger(i,r),!(n.isFunction(e)&&e.apply(this.element[0],[i].concat(r))===!1||i.isDefaultPrevented())}},n.each({show:"fadeIn",hide:"fadeOut"},function(t,i){n.Widget.prototype["_"+t]=function(r,u,f){typeof u=="string"&&(u={effect:u});var o,e=u?u===!0||typeof u=="number"?i:u.effect||i:t;u=u||{},typeof u=="number"&&(u={duration:u}),o=!n.isEmptyObject(u),u.complete=f,u.delay&&r.delay(u.delay),o&&n.effects&&(n.effects.effect[e]||n.uiBackCompat!==!1&&n.effects[e])?r[t](u):e!==t&&r[e]?r[e](u.duration,u.easing,f):r.queue(function(i){n(this)[t](),f&&f.call(r[0]),i()})}}),n.uiBackCompat!==!1&&(n.Widget.prototype._getCreateOptions=function(){return n.metadata&&n.metadata.get(this.element[0])[this.widgetName]})}(n),function(n){var t=!1;n(document).mouseup(function(){t=!1}),n.widget("ui.mouse",{version:"1.9.0",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(n){return t._mouseDown(n)}).bind("click."+this.widgetName,function(i){if(!0===n.data(i.target,t.widgetName+".preventClickEvent"))return n.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&n(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!t){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var r=this,u=i.which===1,f=typeof this.options.cancel=="string"&&i.target.nodeName?n(i.target).closest(this.options.cancel).length:!1;return!u||f||!this._mouseCapture(i)?!0:(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted))?(i.preventDefault(),!0):(!0===n.data(i.target,this.widgetName+".preventClickEvent")&&n.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(n){return r._mouseMove(n)},this._mouseUpDelegate=function(n){return r._mouseUp(n)},n(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),t=!0,!0)}},_mouseMove:function(t){return n.browser.msie&&!(document.documentMode>=9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return n(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&n.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(n){return Math.max(Math.abs(this._mouseDownEvent.pageX-n.pageX),Math.abs(this._mouseDownEvent.pageY-n.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(n),function(t,i){function v(n,t,i){return[parseInt(n[0],10)*(a.test(n[0])?t/100:1),parseInt(n[1],10)*(a.test(n[1])?i/100:1)]}function f(n,i){return parseInt(t.css(n,i),10)||0}t.ui=t.ui||{};var e,u=Math.max,r=Math.abs,o=Math.round,s=/left|center|right/,h=/top|center|bottom/,c=/[\+\-]\d+%?/,l=/^\w+/,a=/%$/,y=t.fn.position;t.position={scrollbarWidth:function(){if(e!==i)return e;var u,r,n=t("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'><\/div><\/div>"),f=n.children()[0];return t("body").append(n),u=f.offsetWidth,n.css("overflow","scroll"),r=f.offsetWidth,u===r&&(r=n[0].clientWidth),n.remove(),e=u-r},getScrollInfo:function(n){var i=n.isWindow?"":n.element.css("overflow-x"),r=n.isWindow?"":n.element.css("overflow-y"),u=i==="scroll"||i==="auto"&&n.width<n.element[0].scrollWidth,f=r==="scroll"||r==="auto"&&n.height<n.element[0].scrollHeight;return{width:u?t.position.scrollbarWidth():0,height:f?t.position.scrollbarWidth():0}},getWithinInfo:function(n){var i=t(n||window),r=t.isWindow(i[0]);return{element:i,isWindow:r,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:r?i.width():i.outerWidth(),height:r?i.height():i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return y.apply(this,arguments);n=t.extend({},n);var b,i,e,p,w,a=t(n.of),nt=t.position.getWithinInfo(n.within),tt=t.position.getScrollInfo(nt),k=a[0],d=(n.collision||"flip").split(" "),g={};return k.nodeType===9?(i=a.width(),e=a.height(),p={top:0,left:0}):t.isWindow(k)?(i=a.width(),e=a.height(),p={top:a.scrollTop(),left:a.scrollLeft()}):k.preventDefault?(n.at="left top",i=e=0,p={top:k.pageY,left:k.pageX}):(i=a.outerWidth(),e=a.outerHeight(),p=a.offset()),w=t.extend({},p),t.each(["my","at"],function(){var t=(n[this]||"").split(" "),i,r;t.length===1&&(t=s.test(t[0])?t.concat(["center"]):h.test(t[0])?["center"].concat(t):["center","center"]),t[0]=s.test(t[0])?t[0]:"center",t[1]=h.test(t[1])?t[1]:"center",i=c.exec(t[0]),r=c.exec(t[1]),g[this]=[i?i[0]:0,r?r[0]:0],n[this]=[l.exec(t[0])[0],l.exec(t[1])[0]]}),d.length===1&&(d[1]=d[0]),n.at[0]==="right"?w.left+=i:n.at[0]==="center"&&(w.left+=i/2),n.at[1]==="bottom"?w.top+=e:n.at[1]==="center"&&(w.top+=e/2),b=v(g.at,i,e),w.left+=b[0],w.top+=b[1],this.each(function(){var k,it,h=t(this),c=h.outerWidth(),l=h.outerHeight(),rt=f(this,"marginLeft"),ut=f(this,"marginTop"),ft=c+rt+f(this,"marginRight")+tt.width,et=l+ut+f(this,"marginBottom")+tt.height,s=t.extend({},w),y=v(g.my,h.outerWidth(),h.outerHeight());n.my[0]==="right"?s.left-=c:n.my[0]==="center"&&(s.left-=c/2),n.my[1]==="bottom"?s.top-=l:n.my[1]==="center"&&(s.top-=l/2),s.left+=y[0],s.top+=y[1],t.support.offsetFractions||(s.left=o(s.left),s.top=o(s.top)),k={marginLeft:rt,marginTop:ut},t.each(["left","top"],function(r,u){t.ui.position[d[r]]&&t.ui.position[d[r]][u](s,{targetWidth:i,targetHeight:e,elemWidth:c,elemHeight:l,collisionPosition:k,collisionWidth:ft,collisionHeight:et,offset:[b[0]+y[0],b[1]+y[1]],my:n.my,at:n.at,within:nt,elem:h})}),t.fn.bgiframe&&h.bgiframe(),n.using&&(it=function(t){var f=p.left-s.left,y=f+i-c,o=p.top-s.top,w=o+e-l,v={target:{element:a,left:p.left,top:p.top,width:i,height:e},element:{element:h,left:s.left,top:s.top,width:c,height:l},horizontal:y<0?"left":f>0?"right":"center",vertical:w<0?"top":o>0?"bottom":"middle"};i<c&&r(f+y)<i&&(v.horizontal="center"),e<l&&r(o+w)<e&&(v.vertical="middle"),v.important=u(r(f),r(y))>u(r(o),r(w))?"horizontal":"vertical",n.using.call(this,t,v)}),h.offset(t.extend(s,{using:it}))})},t.ui.position={fit:{left:function(n,t){var e=t.within,r=e.isWindow?e.scrollLeft:e.offset.left,o=e.width,s=n.left-t.collisionPosition.marginLeft,i=r-s,f=s+t.collisionWidth-o-r,h;t.collisionWidth>o?i>0&&f<=0?(h=n.left+i+t.collisionWidth-o-r,n.left+=i-h):n.left=f>0&&i<=0?r:i>f?r+o-t.collisionWidth:r:i>0?n.left+=i:f>0?n.left-=f:n.left=u(n.left-s,n.left)},top:function(n,t){var o=t.within,r=o.isWindow?o.scrollTop:o.offset.top,e=t.within.height,s=n.top-t.collisionPosition.marginTop,i=r-s,f=s+t.collisionHeight-e-r,h;t.collisionHeight>e?i>0&&f<=0?(h=n.top+i+t.collisionHeight-e-r,n.top+=i-h):n.top=f>0&&i<=0?r:i>f?r+e-t.collisionHeight:r:i>0?n.top+=i:f>0?n.top-=f:n.top=u(n.top-s,n.top)}},flip:{left:function(n,t){var i=t.within,y=i.offset.left+i.scrollLeft,c=i.width,o=i.isWindow?i.scrollLeft:i.offset.left,l=n.left-t.collisionPosition.marginLeft,a=l-o,v=l+t.collisionWidth-c-o,u=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,f=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,e=-2*t.offset[0],s,h;a<0?(s=n.left+u+f+e+t.collisionWidth-c-y,(s<0||s<r(a))&&(n.left+=u+f+e)):v>0&&(h=n.left-t.collisionPosition.marginLeft+u+f+e-o,(h>0||r(h)<v)&&(n.left+=u+f+e))},top:function(n,t){var i=t.within,y=i.offset.top+i.scrollTop,a=i.height,o=i.isWindow?i.scrollTop:i.offset.top,v=n.top-t.collisionPosition.marginTop,s=v-o,h=v+t.collisionHeight-a-o,p=t.my[1]==="top",u=p?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,f=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,e=-2*t.offset[1],c,l;s<0?(l=n.top+u+f+e+t.collisionHeight-a-y,n.top+u+f+e>s&&(l<0||l<r(s))&&(n.top+=u+f+e)):h>0&&(c=n.top-t.collisionPosition.marginTop+u+f+e-o,n.top+u+f+e>h&&(c>0||r(c)<h)&&(n.top+=u+f+e))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var n,i,r,u,f,e=document.getElementsByTagName("body")[0],o=document.createElement("div");n=document.createElement(e?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},e&&t.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(f in r)n.style[f]=r[f];n.appendChild(o),i=e||document.documentElement,i.insertBefore(n,i.firstChild),o.style.cssText="position: absolute; left: 10.7432222px;",u=t(o).offset().left,t.support.offsetFractions=u>10&&u<11,n.innerHTML="",i.removeChild(n)}(),t.uiBackCompat!==!1&&function(n){var t=n.fn.position;n.fn.position=function(r){if(!r||!r.offset)return t.call(this,r);var u=r.offset.split(" "),f=r.at.split(" ");return u.length===1&&(u[1]=u[0]),/^\d/.test(u[0])&&(u[0]="+"+u[0]),/^\d/.test(u[1])&&(u[1]="+"+u[1]),f.length===1&&(/left|center|right/.test(f[0])?f[1]="center":(f[1]=f[0],f[0]="center")),t.call(this,n.extend(r,{at:f[0]+u[0]+" "+f[1]+u[1],offset:i}))}}(n)}(n),function(n){n.widget("ui.draggable",n.ui.mouse,{version:"1.9.0",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper!="original"||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||n(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),!this.handle)?!1:(n(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){n('<div class="ui-draggable-iframeFix" style="background: #fff;"><\/div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(n(this).offset()).appendTo("body")}),!0)},_mouseStart:function(t){var i=this.options;return(this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),n.ui.ddmanager&&(n.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},n.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),this._trigger("start",t)===!1)?(this._clear(),!1):(this._cacheHelperProportions(),n.ui.ddmanager&&!i.dropBehaviour&&n.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),n.ui.ddmanager&&n.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}return this.options.axis&&this.options.axis=="y"||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&this.options.axis=="x"||(this.helper[0].style.top=this.position.top+"px"),n.ui.ddmanager&&n.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=!1,r,u,f;for(n.ui.ddmanager&&!this.options.dropBehaviour&&(i=n.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1),r=this.element[0],u=!1;r&&(r=r.parentNode);)r==document&&(u=!0);return!u&&this.options.helper==="original"?!1:(this.options.revert=="invalid"&&!i||this.options.revert=="valid"&&i||this.options.revert===!0||n.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)?(f=this,n(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){f._trigger("stop",t)!==!1&&f._clear()})):this._trigger("stop",t)!==!1&&this._clear(),!1)},_mouseUp:function(t){return n("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),n.ui.ddmanager&&n.ui.ddmanager.dragStop(this,t),n.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var i=!this.options.handle||!n(this.options.handle,this.element).length?!0:!1;return n(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(i=!0)}),i},_createHelper:function(t){var r=this.options,i=n.isFunction(r.helper)?n(r.helper.apply(this.element[0],[t])):r.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo(r.appendTo=="parent"?this.element[0].parentNode:r.appendTo),i[0]==this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),n.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&n.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&n.browser.msie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var n=this.element.position();return{top:n.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:n.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var i=this.options,r,t,f,u;if(i.containment=="parent"&&(i.containment=this.helper[0].parentNode),(i.containment=="document"||i.containment=="window")&&(this.containment=[i.containment=="document"?0:n(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,i.containment=="document"?0:n(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(i.containment=="document"?0:n(window).scrollLeft())+n(i.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(i.containment=="document"?0:n(window).scrollTop())+(n(i.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(i.containment)||i.containment.constructor==Array)i.containment.constructor==Array&&(this.containment=i.containment);else{if(r=n(i.containment),t=r[0],!t)return;f=r.offset(),u=n(t).css("overflow")!="hidden",this.containment=[(parseInt(n(t).css("borderLeftWidth"),10)||0)+(parseInt(n(t).css("paddingLeft"),10)||0),(parseInt(n(t).css("borderTopWidth"),10)||0)+(parseInt(n(t).css("paddingTop"),10)||0),(u?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(n(t).css("borderLeftWidth"),10)||0)-(parseInt(n(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(u?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(n(t).css("borderTopWidth"),10)||0)-(parseInt(n(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=r}},_convertPositionTo:function(t,i){i||(i=this.position);var r=t=="absolute"?1:-1,e=this.options,u=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&n.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,f=/(html|body)/i.test(u[0].tagName);return{top:i.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():f?0:u.scrollTop())*r,left:i.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():f?0:u.scrollLeft())*r}},_generatePosition:function(t){var r=this.options,h=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&n.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,c=/(html|body)/i.test(h[0].tagName),e=t.pageX,o=t.pageY,i,s,u,f;return this.originalPosition&&(this.containment&&(this.relative_container?(s=this.relative_container.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(e=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(o=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(e=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(o=i[3]+this.offset.click.top)),r.grid&&(u=r.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/r.grid[1])*r.grid[1]:this.originalPageY,o=i?(u-this.offset.click.top<i[1]||u-this.offset.click.top>i[3])?(u-this.offset.click.top<i[1])?u+r.grid[1]:u-r.grid[1]:u:u,f=r.grid[0]?this.originalPageX+Math.round((e-this.originalPageX)/r.grid[0])*r.grid[0]:this.originalPageX,e=i?(f-this.offset.click.left<i[0]||f-this.offset.click.left>i[2])?(f-this.offset.click.left<i[0])?f+r.grid[0]:f-r.grid[0]:f:f)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():c?0:h.scrollTop()),left:e-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():c?0:h.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]==this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,r){return r=r||this._uiHash(),n.ui.plugin.call(this,t,[i,r]),t=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),n.Widget.prototype._trigger.call(this,t,i,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),n.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var r=n(this).data("draggable"),u=r.options,f=n.extend({},i,{item:r.element});r.sortables=[],n(u.connectToSortable).each(function(){var i=n.data(this,"sortable");i&&!i.options.disabled&&(r.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,f))})},stop:function(t,i){var r=n(this).data("draggable"),u=n.extend({},i,{item:r.element});n.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,u))})},drag:function(t,i){var r=n(this).data("draggable"),u=this,f=function(t){var i=this.offset.click.top,r=this.offset.click.left,u=this.positionAbs.top,f=this.positionAbs.left,e=t.height,o=t.width,s=t.top,h=t.left;return n.ui.isOver(u+i,f+r,s,h,e,o)};n.each(r.sortables,function(){this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=n(u).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),n.ui.plugin.add("draggable","cursor",{start:function(){var t=n("body"),i=n(this).data("draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=n(this).data("draggable").options;t._cursor&&n("body").css("cursor",t._cursor)}}),n.ui.plugin.add("draggable","opacity",{start:function(t,i){var r=n(i.helper),u=n(this).data("draggable").options;r.css("opacity")&&(u._opacity=r.css("opacity")),r.css("opacity",u.opacity)},stop:function(t,i){var r=n(this).data("draggable").options;r._opacity&&n(i.helper).css("opacity",r._opacity)}}),n.ui.plugin.add("draggable","scroll",{start:function(){var t=n(this).data("draggable");t.scrollParent[0]!=document&&t.scrollParent[0].tagName!="HTML"&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var r=n(this).data("draggable"),i=r.options,u=!1;r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"?(i.axis&&i.axis=="x"||(r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=u=r.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=u=r.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&i.axis=="y"||(r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=u=r.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&(r.scrollParent[0].scrollLeft=u=r.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&i.axis=="x"||(t.pageY-n(document).scrollTop()<i.scrollSensitivity?u=n(document).scrollTop(n(document).scrollTop()-i.scrollSpeed):n(window).height()-(t.pageY-n(document).scrollTop())<i.scrollSensitivity&&(u=n(document).scrollTop(n(document).scrollTop()+i.scrollSpeed))),i.axis&&i.axis=="y"||(t.pageX-n(document).scrollLeft()<i.scrollSensitivity?u=n(document).scrollLeft(n(document).scrollLeft()-i.scrollSpeed):n(window).width()-(t.pageX-n(document).scrollLeft())<i.scrollSensitivity&&(u=n(document).scrollLeft(n(document).scrollLeft()+i.scrollSpeed)))),u!==!1&&n.ui.ddmanager&&!i.dropBehaviour&&n.ui.ddmanager.prepareOffsets(r,t)}}),n.ui.plugin.add("draggable","snap",{start:function(){var t=n(this).data("draggable"),i=t.options;t.snapElements=[],n(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var i=n(this),r=i.offset();this!=t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:r.top,left:r.left})})},drag:function(t,i){for(var r=n(this).data("draggable"),k=r.options,u=k.snapTolerance,c=i.offset.left,a=c+r.helperProportions.width,l=i.offset.top,v=l+r.helperProportions.height,d,f=r.snapElements.length-1;f>=0;f--){var e=r.snapElements[f].left,s=e+r.snapElements[f].width,o=r.snapElements[f].top,h=o+r.snapElements[f].height;if(!(e-u<c&&c<s+u&&o-u<l&&l<h+u||e-u<c&&c<s+u&&o-u<v&&v<h+u||e-u<a&&a<s+u&&o-u<l&&l<h+u||e-u<a&&a<s+u&&o-u<v&&v<h+u)){r.snapElements[f].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,n.extend(r._uiHash(),{snapItem:r.snapElements[f].item})),r.snapElements[f].snapping=!1;continue}if(k.snapMode!="inner"){var y=Math.abs(o-v)<=u,p=Math.abs(h-l)<=u,w=Math.abs(e-a)<=u,b=Math.abs(s-c)<=u;y&&(i.position.top=r._convertPositionTo("relative",{top:o-r.helperProportions.height,left:0}).top-r.margins.top),p&&(i.position.top=r._convertPositionTo("relative",{top:h,left:0}).top-r.margins.top),w&&(i.position.left=r._convertPositionTo("relative",{top:0,left:e-r.helperProportions.width}).left-r.margins.left),b&&(i.position.left=r._convertPositionTo("relative",{top:0,left:s}).left-r.margins.left)}if(d=y||p||w||b,k.snapMode!="outer"){var y=Math.abs(o-l)<=u,p=Math.abs(h-v)<=u,w=Math.abs(e-c)<=u,b=Math.abs(s-a)<=u;y&&(i.position.top=r._convertPositionTo("relative",{top:o,left:0}).top-r.margins.top),p&&(i.position.top=r._convertPositionTo("relative",{top:h-r.helperProportions.height,left:0}).top-r.margins.top),w&&(i.position.left=r._convertPositionTo("relative",{top:0,left:e}).left-r.margins.left),b&&(i.position.left=r._convertPositionTo("relative",{top:0,left:s-r.helperProportions.width}).left-r.margins.left)}!r.snapElements[f].snapping&&(y||p||w||b||d)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,n.extend(r._uiHash(),{snapItem:r.snapElements[f].item})),r.snapElements[f].snapping=y||p||w||b||d}}}),n.ui.plugin.add("draggable","stack",{start:function(){var r=n(this).data("draggable").options,t=n.makeArray(n(r.stack)).sort(function(t,i){return(parseInt(n(t).css("zIndex"),10)||0)-(parseInt(n(i).css("zIndex"),10)||0)}),i;t.length&&(i=parseInt(t[0].style.zIndex)||0,n(t).each(function(n){this.style.zIndex=i+n}),this[0].style.zIndex=i+t.length)}}),n.ui.plugin.add("draggable","zIndex",{start:function(t,i){var r=n(i.helper),u=n(this).data("draggable").options;r.css("zIndex")&&(u._zIndex=r.css("zIndex")),r.css("zIndex",u.zIndex)},stop:function(t,i){var r=n(this).data("draggable").options;r._zIndex&&n(i.helper).css("zIndex",r._zIndex)}})}(n),function(n){n.widget("ui.droppable",{version:"1.9.0",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,i=t.accept;this.isover=0,this.isout=1,this.accept=n.isFunction(i)?i:function(n){return n.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},n.ui.ddmanager.droppables[t.scope]=n.ui.ddmanager.droppables[t.scope]||[],n.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var i=n.ui.ddmanager.droppables[this.options.scope],t=0;t<i.length;t++)i[t]==this&&i.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){t=="accept"&&(this.accept=n.isFunction(i)?i:function(n){return n.is(i)}),n.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=n.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=n.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=n.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=n.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var r=i||n.ui.ddmanager.current,u;return!r||(r.currentItem||r.element)[0]==this.element[0]?!1:(u=!1,this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=n.data(this,"droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope==r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&n.ui.intersect(r,n.extend(t,{offset:t.element.offset()}),t.options.tolerance))return u=!0,!1}),u)?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element):!1},ui:function(n){return{draggable:n.currentItem||n.element,helper:n.helper,position:n.position,offset:n.positionAbs}}}),n.ui.intersect=function(t,i,r){if(!i.offset)return!1;var e=(t.positionAbs||t.position.absolute).left,s=e+t.helperProportions.width,o=(t.positionAbs||t.position.absolute).top,h=o+t.helperProportions.height,u=i.offset.left,c=u+i.proportions.width,f=i.offset.top,l=f+i.proportions.height;switch(r){case"fit":return u<=e&&s<=c&&f<=o&&h<=l;case"intersect":return u<e+t.helperProportions.width/2&&s-t.helperProportions.width/2<c&&f<o+t.helperProportions.height/2&&h-t.helperProportions.height/2<l;case"pointer":var a=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,v=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top;return n.ui.isOver(v,a,f,u,i.proportions.height,i.proportions.width);case"touch":return(o>=f&&o<=l||h>=f&&h<=l||o<f&&h>l)&&(e>=u&&e<=c||s>=u&&s<=c||e<u&&s>c);default:return!1}},n.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var u=n.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,e=(t.currentItem||t.element).find(":data(droppable)").andSelf(),r,f;n:for(r=0;r<u.length;r++)if(!u[r].options.disabled&&(!t||u[r].accept.call(u[r].element[0],t.currentItem||t.element))){for(f=0;f<e.length;f++)if(e[f]==u[r].element[0]){u[r].proportions.height=0;continue n}(u[r].visible=u[r].element.css("display")!="none",u[r].visible)&&(o=="mousedown"&&u[r]._activate.call(u[r],i),u[r].offset=u[r].element.offset(),u[r].proportions={width:u[r].element[0].offsetWidth,height:u[r].element[0].offsetHeight})}},drop:function(t,i){var r=!1;return n.each(n.ui.ddmanager.droppables[t.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&n.ui.intersect(t,this,this.options.tolerance)&&(r=this._drop.call(this,i)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,i)))}),r},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||n.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&n.ui.ddmanager.prepareOffsets(t,i),n.each(n.ui.ddmanager.droppables[t.options.scope]||[],function(){var f,u,r,o,e;this.options.disabled||this.greedyChild||!this.visible||(f=n.ui.intersect(t,this,this.options.tolerance),u=!f&&this.isover==1?"isout":f&&this.isover==0?"isover":null,u)&&(this.options.greedy&&(o=this.options.scope,e=this.element.parents(":data(droppable)").filter(function(){return n.data(this,"droppable").options.scope===o}),e.length&&(r=n.data(e[0],"droppable"),r.greedyChild=u=="isover"?1:0)),r&&u=="isover"&&(r.isover=0,r.isout=1,r._out.call(r,i)),this[u]=1,this[u=="isout"?"isover":"isout"]=0,this[u=="isover"?"_over":"_out"].call(this,i),r&&u=="isout"&&(r.isout=0,r.isover=1,r._over.call(r,i)))})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||n.ui.ddmanager.prepareOffsets(t,i)}}}(n),function(n){n.widget("ui.resizable",n.ui.mouse,{version:"1.9.0",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var i=this,t=this.options,f,r;if(this.element.addClass("ui-resizable"),n.extend(this,{_aspectRatio:!!t.aspectRatio,aspectRatio:t.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:t.helper||t.ghost||t.animate?t.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(n('<div class="ui-wrapper" style="overflow: hidden;"><\/div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=t.handles||(n(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor==String)for(this.handles=="all"&&(this.handles="n,e,s,w,se,sw,ne,nw"),f=this.handles.split(","),this.handles={},r=0;r<f.length;r++){var u=n.trim(f[r]),o="ui-resizable-"+u,e=n('<div class="ui-resizable-handle '+o+'"><\/div>');e.css({zIndex:t.zIndex}),"se"==u&&e.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[u]=".ui-resizable-"+u,this.element.append(e)}this._renderAxis=function(t){var i,r,u,f;t=t||this.element;for(i in this.handles)this.handles[i].constructor==String&&(this.handles[i]=n(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(r=n(this.handles[i],this.element),u=0,u=/sw|ne|nw|se|n|s/.test(i)?r.outerHeight():r.outerWidth(),f=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(f,u),this._proportionallyResize()),!n(this.handles[i]).length},this._renderAxis(this.element),this._handles=n(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!i.resizing){if(this.className)var n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);i.axis=n&&n[1]?n[1]:"se"}}),t.autoHide&&(this._handles.hide(),n(this.element).addClass("ui-resizable-autohide").mouseenter(function(){t.disabled||(n(this).removeClass("ui-resizable-autohide"),i._handles.show())}).mouseleave(function(){t.disabled||i.resizing||(n(this).addClass("ui-resizable-autohide"),i._handles.hide())})),this._mouseInit()},_destroy:function(){var i,t;return this._mouseDestroy(),i=function(t){n(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()},this.elementIsWrapper&&(i(this.element),t=this.element,t.after(this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")})).remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i=!1,r;for(r in this.handles)n(this.handles[r])[0]==t.target&&(i=!0);return!this.options.disabled&&i},_mouseStart:function(t){var u=this.options,s=this.element.position(),r=this.element,f,e,o;return this.resizing=!0,this.documentScroll={top:n(document).scrollTop(),left:n(document).scrollLeft()},(r.is(".ui-draggable")||/absolute/.test(r.css("position")))&&r.css({position:"absolute",top:s.top,left:s.left}),this._renderProxy(),f=i(this.helper.css("left")),e=i(this.helper.css("top")),u.containment&&(f+=n(u.containment).scrollLeft()||0,e+=n(u.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:f,top:e},this.size=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.originalSize=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.originalPosition={left:f,top:e},this.sizeDiff={width:r.outerWidth()-r.width(),height:r.outerHeight()-r.height()},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio=typeof u.aspectRatio=="number"?u.aspectRatio:this.originalSize.width/this.originalSize.height||1,o=n(".ui-resizable-"+this.axis).css("cursor"),n("body").css("cursor",o=="auto"?this.axis+"-resize":o),r.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(n){var u=this.helper,s=this.options,h=this,i=this.originalMousePosition,f=this.axis,e=n.pageX-i.left||0,o=n.pageY-i.top||0,r=this._change[f],t;return r?(t=r.apply(this,[n,e,o]),this._updateVirtualBoundaries(n.shiftKey),(this._aspectRatio||n.shiftKey)&&(t=this._updateRatio(t,n)),t=this._respectSize(t,n),this._propagate("resize",n),u.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(t),this._trigger("resize",n,this.ui()),!1):!1},_mouseStop:function(t){var r,i;if(this.resizing=!1,r=this.options,i=this,this._helper){var u=this._proportionallyResizeElements,f=u.length&&/textarea/i.test(u[0].nodeName),e=f&&n.ui.hasScroll(u[0],"left")?0:i.sizeDiff.height,o=f?0:i.sizeDiff.width,s={width:i.helper.width()-o,height:i.helper.height()-e},h=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;r.animate||this.element.css(n.extend(s,{top:c,left:h})),i.helper.height(i.size.height),i.helper.width(i.size.width),this._helper&&!r.animate&&this._proportionallyResize()}return n("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(n){var r=this.options,u,f,e,o,i;i={minWidth:t(r.minWidth)?r.minWidth:0,maxWidth:t(r.maxWidth)?r.maxWidth:Infinity,minHeight:t(r.minHeight)?r.minHeight:0,maxHeight:t(r.maxHeight)?r.maxHeight:Infinity},(this._aspectRatio||n)&&(u=i.minHeight*this.aspectRatio,e=i.minWidth/this.aspectRatio,f=i.maxHeight*this.aspectRatio,o=i.maxWidth/this.aspectRatio,u>i.minWidth&&(i.minWidth=u),e>i.minHeight&&(i.minHeight=e),f<i.maxWidth&&(i.maxWidth=f),o<i.maxHeight&&(i.maxHeight=o)),this._vBoundaries=i},_updateCache:function(n){var i=this.options;this.offset=this.helper.offset(),t(n.left)&&(this.position.left=n.left),t(n.top)&&(this.position.top=n.top),t(n.height)&&(this.size.height=n.height),t(n.width)&&(this.size.width=n.width)},_updateRatio:function(n){var f=this.options,i=this.position,r=this.size,u=this.axis;return t(n.height)?n.width=n.height*this.aspectRatio:t(n.width)&&(n.height=n.width/this.aspectRatio),u=="sw"&&(n.left=i.left+(r.width-n.width),n.top=null),u=="nw"&&(n.top=i.top+(r.height-n.height),n.left=i.left+(r.width-n.width)),n},_respectSize:function(n,i){var y=this.helper,r=this._vBoundaries,p=this._aspectRatio||i.shiftKey,f=this.axis,e=t(n.width)&&r.maxWidth&&r.maxWidth<n.width,o=t(n.height)&&r.maxHeight&&r.maxHeight<n.height,s=t(n.width)&&r.minWidth&&r.minWidth>n.width,h=t(n.height)&&r.minHeight&&r.minHeight>n.height,u;s&&(n.width=r.minWidth),h&&(n.height=r.minHeight),e&&(n.width=r.maxWidth),o&&(n.height=r.maxHeight);var c=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,a=/sw|nw|w/.test(f),v=/nw|ne|n/.test(f);return s&&a&&(n.left=c-r.minWidth),e&&a&&(n.left=c-r.maxWidth),h&&v&&(n.top=l-r.minHeight),o&&v&&(n.top=l-r.maxHeight),u=!n.width&&!n.height,u&&!n.left&&n.top?n.top=null:u&&!n.top&&n.left&&(n.left=null),n},_proportionallyResize:function(){var e=this.options,r,i,t,u,f;if(this._proportionallyResizeElements.length)for(r=this.helper||this.element,i=0;i<this._proportionallyResizeElements.length;i++)t=this._proportionallyResizeElements[i],this.borderDif||(u=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],f=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")],this.borderDif=n.map(u,function(n,t){var i=parseInt(n,10)||0,r=parseInt(f[t],10)||0;return i+r})),t.css({height:r.height()-this.borderDif[0]-this.borderDif[2]||0,width:r.width()-this.borderDif[1]-this.borderDif[3]||0})},_renderProxy:function(){var u=this.element,f=this.options;if(this.elementOffset=u.offset(),this._helper){this.helper=this.helper||n('<div style="overflow:hidden;"><\/div>');var t=n.browser.msie&&n.browser.version<7,i=t?1:0,r=t?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+r,height:this.element.outerHeight()+r,position:"absolute",left:this.elementOffset.left-i+"px",top:this.elementOffset.top-i+"px",zIndex:++f.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(n,t){return{width:this.originalSize.width+t}},w:function(n,t){var u=this.options,i=this.originalSize,r=this.originalPosition;return{left:r.left+t,width:i.width-t}},n:function(n,t,i){var f=this.options,r=this.originalSize,u=this.originalPosition;return{top:u.top+i,height:r.height-i}},s:function(n,t,i){return{height:this.originalSize.height+i}},se:function(t,i,r){return n.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,r]))},sw:function(t,i,r){return n.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,r]))},ne:function(t,i,r){return n.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,r]))},nw:function(t,i,r){return n.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,r]))}},_propagate:function(t,i){n.ui.plugin.call(this,t,[i,this.ui()]),t!="resize"&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),n.ui.plugin.add("resizable","alsoResize",{start:function(){var r=n(this).data("resizable"),t=r.options,i=function(t){n(t).each(function(){var t=n(this);t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};typeof t.alsoResize!="object"||t.alsoResize.parentNode?i(t.alsoResize):t.alsoResize.length?(t.alsoResize=t.alsoResize[0],i(t.alsoResize)):n.each(t.alsoResize,function(n){i(n)})},resize:function(t,i){var r=n(this).data("resizable"),u=r.options,f=r.originalSize,e=r.originalPosition,s={height:r.size.height-f.height||0,width:r.size.width-f.width||0,top:r.position.top-e.top||0,left:r.position.left-e.left||0},o=function(t,r){n(t).each(function(){var t=n(this),f=n(this).data("resizable-alsoresize"),u={},e=r&&r.length?r:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];n.each(e,function(n,t){var i=(f[t]||0)+(s[t]||0);i&&i>=0&&(u[t]=i||null)}),t.css(u)})};typeof u.alsoResize!="object"||u.alsoResize.nodeType?o(u.alsoResize):n.each(u.alsoResize,function(n,t){o(n,t)})},stop:function(){n(this).removeData("resizable-alsoresize")}}),n.ui.plugin.add("resizable","animate",{stop:function(t){var i=n(this).data("resizable"),u=i.options,r=i._proportionallyResizeElements,f=r.length&&/textarea/i.test(r[0].nodeName),s=f&&n.ui.hasScroll(r[0],"left")?0:i.sizeDiff.height,h=f?0:i.sizeDiff.width,c={width:i.size.width-h,height:i.size.height-s},e=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,o=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(n.extend(c,o&&e?{top:o,left:e}:{}),{duration:u.animateDuration,easing:u.animateEasing,step:function(){var u={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};r&&r.length&&n(r[0]).css({width:u.width,height:u.height}),i._updateCache(u),i._propagate("resize",t)}})}}),n.ui.plugin.add("resizable","containment",{start:function(){var t=n(this).data("resizable"),s=t.options,h=t.element,u=s.containment,r=u instanceof n?u.get(0):/parent/.test(u)?h.parent().get(0):u,f,e;if(r)if(t.containerElement=n(r),/document/.test(u)||u==document)t.containerOffset={left:0,top:0},t.containerPosition={left:0,top:0},t.parentData={element:n(document),left:0,top:0,width:n(document).width(),height:n(document).height()||document.body.parentNode.scrollHeight};else{f=n(r),e=[],n(["Top","Right","Left","Bottom"]).each(function(n,t){e[n]=i(f.css("padding"+t))}),t.containerOffset=f.offset(),t.containerPosition=f.position(),t.containerSize={height:f.innerHeight()-e[3],width:f.innerWidth()-e[1]};var o=t.containerOffset,c=t.containerSize.height,l=t.containerSize.width,a=n.ui.hasScroll(r,"left")?r.scrollWidth:l,v=n.ui.hasScroll(r)?r.scrollHeight:c;t.parentData={element:r,left:o.left,top:o.top,width:a,height:v}}},resize:function(t){var i=n(this).data("resizable"),c=i.options,v=i.containerSize,r=i.containerOffset,y=i.size,o=i.position,f=i._aspectRatio||t.shiftKey,u={top:0,left:0},s=i.containerElement;s[0]!=document&&/static/.test(s.css("position"))&&(u=r),o.left<(i._helper?r.left:0)&&(i.size.width=i.size.width+(i._helper?i.position.left-r.left:i.position.left-u.left),f&&(i.size.height=i.size.width/i.aspectRatio),i.position.left=c.helper?r.left:0),o.top<(i._helper?r.top:0)&&(i.size.height=i.size.height+(i._helper?i.position.top-r.top:i.position.top),f&&(i.size.width=i.size.height*i.aspectRatio),i.position.top=i._helper?r.top:0),i.offset.left=i.parentData.left+i.position.left,i.offset.top=i.parentData.top+i.position.top;var e=Math.abs((i._helper?i.offset.left-u.left:i.offset.left-u.left)+i.sizeDiff.width),h=Math.abs((i._helper?i.offset.top-u.top:i.offset.top-r.top)+i.sizeDiff.height),l=i.containerElement.get(0)==i.element.parent().get(0),a=/relative|absolute/.test(i.containerElement.css("position"));l&&a&&(e-=i.parentData.left),e+i.size.width>=i.parentData.width&&(i.size.width=i.parentData.width-e,f&&(i.size.height=i.size.width/i.aspectRatio)),h+i.size.height>=i.parentData.height&&(i.size.height=i.parentData.height-h,f&&(i.size.width=i.size.height*i.aspectRatio))},stop:function(){var t=n(this).data("resizable"),r=t.options,c=t.position,u=t.containerOffset,f=t.containerPosition,e=t.containerElement,i=n(t.helper),o=i.offset(),s=i.outerWidth()-t.sizeDiff.width,h=i.outerHeight()-t.sizeDiff.height;t._helper&&!r.animate&&/relative/.test(e.css("position"))&&n(this).css({left:o.left-f.left-u.left,width:s,height:h}),t._helper&&!r.animate&&/static/.test(e.css("position"))&&n(this).css({left:o.left-f.left-u.left,width:s,height:h})}}),n.ui.plugin.add("resizable","ghost",{start:function(){var t=n(this).data("resizable"),i=t.options,r=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof i.ghost=="string"?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=n(this).data("resizable"),i=t.options;t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=n(this).data("resizable"),i=t.options;t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),n.ui.plugin.add("resizable","grid",{resize:function(t){var i=n(this).data("resizable"),r=i.options,h=i.size,u=i.originalSize,o=i.originalPosition,s=i.axis,c=r._aspectRatio||t.shiftKey,f,e;r.grid=typeof r.grid=="number"?[r.grid,r.grid]:r.grid,f=Math.round((h.width-u.width)/(r.grid[0]||1))*(r.grid[0]||1),e=Math.round((h.height-u.height)/(r.grid[1]||1))*(r.grid[1]||1),/^(se|s|e)$/.test(s)?(i.size.width=u.width+f,i.size.height=u.height+e):/^(ne)$/.test(s)?(i.size.width=u.width+f,i.size.height=u.height+e,i.position.top=o.top-e):/^(sw)$/.test(s)?(i.size.width=u.width+f,i.size.height=u.height+e,i.position.left=o.left-f):(i.size.width=u.width+f,i.size.height=u.height+e,i.position.top=o.top-e,i.position.left=o.left-f)}});var i=function(n){return parseInt(n,10)||0},t=function(n){return!isNaN(parseInt(n,10))}}(n),function(n){n.widget("ui.selectable",n.ui.mouse,{version:"1.9.0",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var i=this,t;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=n(i.options.filter,i.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=n(this),i=t.offset();n.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=n("<div class='ui-selectable-helper'><\/div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var r=this,i;(this.opos=[t.pageX,t.pageY],this.options.disabled)||(i=this.options,this.selectees=n(i.filter,this.element[0]),this._trigger("start",t),n(i.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),i.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var i=n.data(this,"selectable-item");i.startselected=!0,t.metaKey||t.ctrlKey||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,r._trigger("unselecting",t,{unselecting:i.element}))}),n(t.target).parents().andSelf().each(function(){var i=n.data(this,"selectable-item"),u;if(i)return u=!t.metaKey&&!t.ctrlKey||!i.$element.hasClass("ui-selected"),i.$element.removeClass(u?"ui-unselecting":"ui-selected").addClass(u?"ui-selecting":"ui-unselecting"),i.unselecting=!u,i.selecting=u,i.selected=u,u?r._trigger("selecting",t,{selecting:i.element}):r._trigger("unselecting",t,{unselecting:i.element}),!1}))},_mouseDrag:function(t){var o=this,e;if(this.dragged=!0,!this.options.disabled){var s=this.options,i=this.opos[0],r=this.opos[1],u=t.pageX,f=t.pageY;return i>u&&(e=u,u=i,i=e),r>f&&(e=f,f=r,r=e),this.helper.css({left:i,top:r,width:u-i,height:f-r}),this.selectees.each(function(){var e=n.data(this,"selectable-item"),h;e&&e.element!=o.element[0]&&(h=!1,s.tolerance=="touch"?h=!(e.left>u||e.right<i||e.top>f||e.bottom<r):s.tolerance=="fit"&&(h=e.left>i&&e.right<u&&e.top>r&&e.bottom<f),h?(e.selected&&(e.$element.removeClass("ui-selected"),e.selected=!1),e.unselecting&&(e.$element.removeClass("ui-unselecting"),e.unselecting=!1),e.selecting||(e.$element.addClass("ui-selecting"),e.selecting=!0,o._trigger("selecting",t,{selecting:e.element}))):(e.selecting&&((t.metaKey||t.ctrlKey)&&e.startselected?(e.$element.removeClass("ui-selecting"),e.selecting=!1,e.$element.addClass("ui-selected"),e.selected=!0):(e.$element.removeClass("ui-selecting"),e.selecting=!1,e.startselected&&(e.$element.addClass("ui-unselecting"),e.unselecting=!0),o._trigger("unselecting",t,{unselecting:e.element}))),e.selected&&(t.metaKey||t.ctrlKey||e.startselected||(e.$element.removeClass("ui-selected"),e.selected=!1,e.$element.addClass("ui-unselecting"),e.unselecting=!0,o._trigger("unselecting",t,{unselecting:e.element})))))}),!1}},_mouseStop:function(t){var i=this,r;return this.dragged=!1,r=this.options,n(".ui-unselecting",this.element[0]).each(function(){var r=n.data(this,"selectable-item");r.$element.removeClass("ui-unselecting"),r.unselecting=!1,r.startselected=!1,i._trigger("unselected",t,{unselected:r.element})}),n(".ui-selecting",this.element[0]).each(function(){var r=n.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,i._trigger("selected",t,{selected:r.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(n),function(n){n.widget("ui.sortable",n.ui.mouse,{version:"1.9.0",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var n=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?n.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var n=this.items.length-1;n>=0;n--)this.items[n].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){t==="disabled"?(this.options[t]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):n.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var u=this,r,e,f;return this.reverting?!1:this.options.disabled||this.options.type=="static"?!1:(this._refreshItems(t),r=null,e=n(t.target).parents().each(function(){if(n.data(this,u.widgetName+"-item")==u)return r=n(this),!1}),n.data(t.target,u.widgetName+"-item")==u&&(r=n(t.target)),!r)?!1:this.options.handle&&!i&&(f=!1,n(this.options.handle,r).find("*").andSelf().each(function(){this==t.target&&(f=!0)}),!f)?!1:(this.currentItem=r,this._removeCurrentsFromItems(),!0)},_mouseStart:function(t,i,r){var u=this.options,f;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},n.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,u.cursorAt&&this._adjustOffsetFromHelper(u.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),u.containment&&this._setContainment(),u.cursor&&(n("body").css("cursor")&&(this._storedCursor=n("body").css("cursor")),n("body").css("cursor",u.cursor)),u.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",u.opacity)),u.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",u.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(f=this.containers.length-1;f>=0;f--)this.containers[f]._trigger("activate",t,this._uiHash(this));return n.ui.ddmanager&&(n.ui.ddmanager.current=this),n.ui.ddmanager&&!u.dropBehaviour&&n.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,r,f;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(i=this.options,r=!1,this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-this.overflowOffset.top<i.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-i.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-this.overflowOffset.left<i.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-i.scrollSpeed)):(t.pageY-n(document).scrollTop()<i.scrollSensitivity?r=n(document).scrollTop(n(document).scrollTop()-i.scrollSpeed):n(window).height()-(t.pageY-n(document).scrollTop())<i.scrollSensitivity&&(r=n(document).scrollTop(n(document).scrollTop()+i.scrollSpeed)),t.pageX-n(document).scrollLeft()<i.scrollSensitivity?r=n(document).scrollLeft(n(document).scrollLeft()-i.scrollSpeed):n(window).width()-(t.pageX-n(document).scrollLeft())<i.scrollSensitivity&&(r=n(document).scrollLeft(n(document).scrollLeft()+i.scrollSpeed))),r!==!1&&n.ui.ddmanager&&!i.dropBehaviour&&n.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&this.options.axis=="y"||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&this.options.axis=="x"||(this.helper[0].style.top=this.position.top+"px"),f=this.items.length-1;f>=0;f--){var u=this.items[f],e=u.item[0],o=this._intersectsWithPointer(u);if(o&&u.instance===this.currentContainer&&e!=this.currentItem[0]&&this.placeholder[o==1?"next":"prev"]()[0]!=e&&!n.contains(this.placeholder[0],e)&&(this.options.type=="semi-dynamic"?!n.contains(this.element[0],e):!0)){if(this.direction=o==1?"down":"up",this.options.tolerance=="pointer"||this._intersectsWithSides(u))this._rearrange(t,u);else break;this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),n.ui.ddmanager&&n.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(n.ui.ddmanager&&!this.options.dropBehaviour&&n.ui.ddmanager.drop(this,t),this.options.revert){var u=this,r=this.placeholder.offset();this.reverting=!0,n(this.helper).animate({left:r.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:r.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){u._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),n.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?n(this.domPosition.prev).after(this.currentItem):n(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var r=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},n(r).each(function(){var r=(n(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);r&&i.push((t.key||r[1]+"[]")+"="+(t.key&&t.expression?r[1]:r[2]))}),!i.length&&t.key&&i.push(t.key+"="),i.join("&")},toArray:function(t){var r=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},r.each(function(){i.push(n(t.item||this).attr(t.attribute||"id")||"")}),i},_intersectsWith:function(n){var t=this.positionAbs.left,h=t+this.helperProportions.width,i=this.positionAbs.top,c=i+this.helperProportions.height,r=n.left,f=r+n.width,u=n.top,e=u+n.height,o=this.offset.click.top,s=this.offset.click.left,l=i+o>u&&i+o<e&&t+s>r&&t+s<f;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>n[this.floating?"width":"height"]?l:r<t+this.helperProportions.width/2&&h-this.helperProportions.width/2<f&&u<i+this.helperProportions.height/2&&c-this.helperProportions.height/2<e},isOverAxis:function(n,t,i){return n>t&&n<t+i},isOver:function(t,i,r,u,f,e){return n.ui.isOverAxis(t,r,f)&&n.ui.isOverAxis(i,u,e)},_intersectsWithPointer:function(n){var r=this.options.axis==="x"||this.isOverAxis(this.positionAbs.top+this.offset.click.top,n.top,n.height),u=this.options.axis==="y"||this.isOverAxis(this.positionAbs.left+this.offset.click.left,n.left,n.width),f=r&&u,t=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection();return f?this.floating?i&&i=="right"||t=="down"?2:1:t&&(t=="down"?2:1):!1},_intersectsWithSides:function(n){var r=this.isOverAxis(this.positionAbs.top+this.offset.click.top,n.top+n.height/2,n.height),u=this.isOverAxis(this.positionAbs.left+this.offset.click.left,n.left+n.width/2,n.width),t=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection();return this.floating&&i?i=="right"&&u||i=="left"&&!u:t&&(t=="down"&&r||t=="up"&&!r)},_getDragVerticalDirection:function(){var n=this.positionAbs.top-this.lastPositionAbs.top;return n!=0&&(n>0?"down":"up")},_getDragHorizontalDirection:function(){var n=this.positionAbs.left-this.lastPositionAbs.left;return n!=0&&(n>0?"right":"left")},refresh:function(n){return this._refreshItems(n),this.refreshPositions(),this},_connectWith:function(){var n=this.options;return n.connectWith.constructor==String?[n.connectWith]:n.connectWith},_getItemsAsjQuery:function(t){var s=[],u=[],e=this._connectWith(),o,f,i,r;if(e&&t)for(r=e.length-1;r>=0;r--)for(o=n(e[r]),f=o.length-1;f>=0;f--)i=n.data(o[f],this.widgetName),i&&i!=this&&!i.options.disabled&&u.push([n.isFunction(i.options.items)?i.options.items.call(i.element):n(i.options.items,i.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),i]);for(u.push([n.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):n(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),r=u.length-1;r>=0;r--)u[r][0].each(function(){s.push(this)});return n(s)},_removeCurrentsFromItems:function(){for(var i=this.currentItem.find(":data("+this.widgetName+"-item)"),t,n=0;n<this.items.length;n++)for(t=0;t<i.length;t++)i[t]==this.items[n].item[0]&&this.items.splice(n,1)},_refreshItems:function(t){var o,i,r,s,h,u,l,c;this.items=[],this.containers=[this];var a=this.items,f=[[n.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):n(this.options.items,this.element),this]],e=this._connectWith();if(e&&this.ready)for(r=e.length-1;r>=0;r--)for(o=n(e[r]),u=o.length-1;u>=0;u--)i=n.data(o[u],this.widgetName),i&&i!=this&&!i.options.disabled&&(f.push([n.isFunction(i.options.items)?i.options.items.call(i.element[0],t,{item:this.currentItem}):n(i.options.items,i.element),i]),this.containers.push(i));for(r=f.length-1;r>=0;r--)for(s=f[r][1],h=f[r][0],u=0,l=h.length;u<l;u++)c=n(h[u]),c.data(this.widgetName+"-item",s),a.push({item:c,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(t){var r,f,i,u;for(this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),i=this.items.length-1;i>=0;i--)(r=this.items[i],r.instance!=this.currentContainer&&this.currentContainer&&r.item[0]!=this.currentItem[0])||(f=this.options.toleranceElement?n(this.options.toleranceElement,r.item):r.item,t||(r.width=f.outerWidth(),r.height=f.outerHeight()),u=f.offset(),r.left=u.left,r.top=u.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)u=this.containers[i].element.offset(),this.containers[i].containerCache.left=u.left,this.containers[i].containerCache.top=u.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){var i,r;t=t||this,i=t.options,i.placeholder&&i.placeholder.constructor!=String||(r=i.placeholder,i.placeholder={element:function(){var i=n(document.createElement(t.currentItem[0].nodeName)).addClass(r||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return r||(i.style.visibility="hidden"),i},update:function(n,u){(!r||i.forcePlaceholderSize)&&(u.height()||u.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),u.width()||u.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=n(i.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),i.placeholder.update(t,t.placeholder)},_contactContainers:function(t){for(var f=null,i=null,u,o,r=this.containers.length-1;r>=0;r--)if(!n.contains(this.currentItem[0],this.containers[r].element[0]))if(this._intersectsWith(this.containers[r].containerCache)){if(f&&n.contains(this.containers[r].element[0],f.element[0]))continue;f=this.containers[r],i=r}else this.containers[r].containerCache.over&&(this.containers[r]._trigger("out",t,this._uiHash(this)),this.containers[r].containerCache.over=0);if(f)if(this.containers.length===1)this.containers[i]._trigger("over",t,this._uiHash(this)),this.containers[i].containerCache.over=1;else if(this.currentContainer!=this.containers[i]){var h=1e4,e=null,s=this.positionAbs[this.containers[i].floating?"left":"top"];for(u=this.items.length-1;u>=0;u--)n.contains(this.containers[i].element[0],this.items[u].item[0])&&(o=this.containers[i].floating?this.items[u].item.offset().left:this.items[u].item.offset().top,Math.abs(o-s)<h&&(h=Math.abs(o-s),e=this.items[u],this.direction=o-s>0?"down":"up"));if(!e&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[i],e?this._rearrange(t,e,null,!0):this._rearrange(t,null,this.containers[i].element,!0),this._trigger("change",t,this._uiHash()),this.containers[i]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[i]._trigger("over",t,this._uiHash(this)),this.containers[i].containerCache.over=1}},_createHelper:function(t){var r=this.options,i=n.isFunction(r.helper)?n(r.helper.apply(this.element[0],[t,this.currentItem])):r.helper=="clone"?this.currentItem.clone():this.currentItem;return i.parents("body").length||n(r.appendTo!="parent"?r.appendTo:this.currentItem[0].parentNode)[0].appendChild(i[0]),i[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(i[0].style.width==""||r.forceHelperSize)&&i.width(this.currentItem.width()),(i[0].style.height==""||r.forceHelperSize)&&i.height(this.currentItem.height()),i},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),n.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&n.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&n.browser.msie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var n=this.currentItem.position();return{top:n.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:n.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var i=this.options;if(i.containment=="parent"&&(i.containment=this.helper[0].parentNode),(i.containment=="document"||i.containment=="window")&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,n(i.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(n(i.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(i.containment)){var t=n(i.containment)[0],r=n(i.containment).offset(),u=n(t).css("overflow")!="hidden";this.containment=[r.left+(parseInt(n(t).css("borderLeftWidth"),10)||0)+(parseInt(n(t).css("paddingLeft"),10)||0)-this.margins.left,r.top+(parseInt(n(t).css("borderTopWidth"),10)||0)+(parseInt(n(t).css("paddingTop"),10)||0)-this.margins.top,r.left+(u?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(n(t).css("borderLeftWidth"),10)||0)-(parseInt(n(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,r.top+(u?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(n(t).css("borderTopWidth"),10)||0)-(parseInt(n(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,i){i||(i=this.position);var r=t=="absolute"?1:-1,e=this.options,u=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&n.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,f=/(html|body)/i.test(u[0].tagName);return{top:i.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():f?0:u.scrollTop())*r,left:i.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():f?0:u.scrollLeft())*r}},_generatePosition:function(t){var i=this.options,o=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&n.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,s=/(html|body)/i.test(o[0].tagName),f,e,r,u;return this.cssPosition!="relative"||this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),f=t.pageX,e=t.pageY,this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(e=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(e=this.containment[3]+this.offset.click.top)),i.grid&&(r=this.originalPageY+Math.round((e-this.originalPageY)/i.grid[1])*i.grid[1],e=this.containment?(r-this.offset.click.top<this.containment[1]||r-this.offset.click.top>this.containment[3])?(r-this.offset.click.top<this.containment[1])?r+i.grid[1]:r-i.grid[1]:r:r,u=this.originalPageX+Math.round((f-this.originalPageX)/i.grid[0])*i.grid[0],f=this.containment?(u-this.offset.click.left<this.containment[0]||u-this.offset.click.left>this.containment[2])?(u-this.offset.click.left<this.containment[0])?u+i.grid[0]:u-i.grid[0]:u:u)),{top:e-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():s?0:o.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():s?0:o.scrollLeft())}},_rearrange:function(n,t,i,r){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var u=this.counter;this._delay(function(){u==this.counter&&this.refreshPositions(!r)})},_clear:function(t,i){var u,r;if(this.reverting=!1,u=[],!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(r in this._storedCSS)(this._storedCSS[r]=="auto"||this._storedCSS[r]=="static")&&(this._storedCSS[r]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!i&&u.push(function(n){this._trigger("receive",n,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!i&&u.push(function(n){this._trigger("update",n,this._uiHash())}),this!==this.currentContainer&&(i||(u.push(function(n){this._trigger("remove",n,this._uiHash())}),u.push(function(n){return function(t){n._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),u.push(function(n){return function(t){n._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),r=this.containers.length-1;r>=0;r--)i||u.push(function(n){return function(t){n._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over&&(u.push(function(n){return function(t){n._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over=0);if(this._storedCursor&&n("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!i){for(this._trigger("beforeStop",t,this._uiHash()),r=0;r<u.length;r++)u[r].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(i||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!i){for(r=0;r<u.length;r++)u[r].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){n.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||n([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})}(n),function(t){var u=0,i={},r={};i.height=i.paddingTop=i.paddingBottom=i.borderTopWidth=i.borderBottomWidth="hide",r.height=r.paddingTop=r.paddingBottom=r.borderTopWidth=r.borderBottomWidth="show",t.widget("ui.accordion",{version:"1.9.0",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var i=this.accordionId="ui-accordion-"+(this.element.attr("id")||++u),n=this.options;this.prevShow=this.prevHide=t(),this.element.addClass("ui-accordion ui-widget ui-helper-reset"),this.headers=this.element.find(n.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this._hoverable(this.headers),this._focusable(this.headers),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").hide(),n.collapsible||n.active!==!1||(n.active=0),n.active<0&&(n.active+=this.headers.length),this.active=this._findActive(n.active).addClass("ui-accordion-header-active ui-state-active").toggleClass("ui-corner-all ui-corner-top"),this.active.next().addClass("ui-accordion-content-active").show(),this._createIcons(),this.originalHeight=this.element[0].style.height,this.refresh(),this.element.attr("role","tablist"),this.headers.attr("role","tab").each(function(n){var r=t(this),u=r.attr("id"),e=r.next(),f=e.attr("id");u||(u=i+"-header-"+n,r.attr("id",u)),f||(f=i+"-panel-"+n,e.attr("id",f)),r.attr("aria-controls",f),e.attr("aria-labelledby",u)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false",tabIndex:-1}).next().attr({"aria-expanded":"false","aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true",tabIndex:0}).next().attr({"aria-expanded":"true","aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._on(this.headers,{keydown:"_keydown"}),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._setupEvents(n.event)},_getCreateEventData:function(){return{header:this.active,content:this.active.length?this.active.next():t()}},_createIcons:function(){var n=this.options.icons;n&&(t("<span>").addClass("ui-accordion-header-icon ui-icon "+n.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(n.header).addClass(n.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var n;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this._destroyIcons(),n=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this.options.heightStyle!=="content"&&(this.element.css("height",this.originalHeight),n.css("height",""))},_setOption:function(n,t){if(n==="active"){this._activate(t);return}n==="event"&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(n,t),n!=="collapsible"||t||this.options.active!==!1||this._activate(0),n==="icons"&&(this._destroyIcons(),t&&this._createIcons()),n==="disabled"&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)},_keydown:function(n){if(!n.altKey&&!n.ctrlKey){var i=t.ui.keyCode,u=this.headers.length,f=this.headers.index(n.target),r=!1;switch(n.keyCode){case i.RIGHT:case i.DOWN:r=this.headers[(f+1)%u];break;case i.LEFT:case i.UP:r=this.headers[(f-1+u)%u];break;case i.SPACE:case i.ENTER:this._eventHandler(n);break;case i.HOME:r=this.headers[0];break;case i.END:r=this.headers[u-1]}r&&(t(n.target).attr("tabIndex",-1),t(r).attr("tabIndex",0),r.focus(),n.preventDefault())}},_panelKeyDown:function(n){n.keyCode===t.ui.keyCode.UP&&n.ctrlKey&&t(n.currentTarget).prev().focus()},refresh:function(){var n,r,u=this.options.heightStyle,i=this.element.parent();this.element.css("height",this.originalHeight),u==="fill"?(t.support.minHeight||(r=i.css("overflow"),i.css("overflow","hidden")),n=i.height(),this.element.siblings(":visible").each(function(){var i=t(this),r=i.css("position");r!=="absolute"&&r!=="fixed"&&(n-=i.outerHeight(!0))}),r&&i.css("overflow",r),this.headers.each(function(){n-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,n-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):u==="auto"&&(n=0,this.headers.next().each(function(){n=Math.max(n,t(this).height("").height())}).height(n)),u!=="content"&&this.element.height(this.element.height())},_activate:function(n){var i=this._findActive(n)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(n){return typeof n=="number"?this.headers.eq(n):t()},_setupEvents:function(n){var i={};n&&(t.each(n.split(" "),function(n,t){i[t]="_eventHandler"}),this._on(this.headers,i))},_eventHandler:function(n){var i=this.options,u=this.active,r=t(n.currentTarget),f=r[0]===u[0],e=f&&i.collapsible,s=e?t():r.next(),h=u.next(),o={oldHeader:u,oldPanel:h,newHeader:e?t():r,newPanel:s};(n.preventDefault(),(!f||i.collapsible)&&this._trigger("beforeActivate",n,o)!==!1)&&(i.active=e?!1:this.headers.index(r),this.active=f?t():r,this._toggle(o),u.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&u.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),f||(r.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&r.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),r.next().addClass("ui-accordion-content-active")))},_toggle:function(n){var r=n.newPanel,i=this.prevShow.length?this.prevShow:n.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=r,this.prevHide=i,this.options.animate?this._animate(r,i,n):(i.hide(),r.show(),this._toggleComplete(n)),i.attr({"aria-expanded":"false","aria-hidden":"true"}),i.prev().attr("aria-selected","false"),r.length&&i.length?i.prev().attr("tabIndex",-1):r.length&&this.headers.filter(function(){return t(this).attr("tabIndex")===0}).attr("tabIndex",-1),r.attr({"aria-expanded":"true","aria-hidden":"false"}).prev().attr({"aria-selected":"true",tabIndex:0})},_animate:function(n,t,u){var l,f,e,a=this,h=0,v=n.length&&(!t.length||n.index()<t.index()),s=this.options.animate||{},o=v&&s.down||s,c=function(){a._toggleComplete(u)};if(typeof o=="number"&&(e=o),typeof o=="string"&&(f=o),f=f||o.easing||s.easing,e=e||o.duration||s.duration,!t.length)return n.animate(r,e,f,c);if(!n.length)return t.animate(i,e,f,c);l=n.show().outerHeight(),t.animate(i,{duration:e,easing:f,step:function(n,t){t.now=Math.round(n)}}),n.hide().animate(r,{duration:e,easing:f,complete:c,step:function(n,i){i.now=Math.round(n),i.prop!=="height"?h+=i.now:a.options.heightStyle!=="content"&&(i.now=Math.round(l-t.outerHeight()-h),h=0)}})},_toggleComplete:function(n){var t=n.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,n)}}),t.uiBackCompat!==!1&&(function(n,t){n.extend(t.options,{navigation:!1,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}});var i=t._create;t._create=function(){if(this.options.navigation){var f=this,t=this.element.find(this.options.header),r=t.next(),u=t.add(r).find("a").filter(this.options.navigationFilter)[0];u&&t.add(r).each(function(t){if(n.contains(this,u))return f.options.active=Math.floor(t/2),!1})}i.call(this)}}(n,n.ui.accordion.prototype),function(n,t){n.extend(t.options,{heightStyle:null,autoHeight:!0,clearStyle:!1,fillSpace:!1});var i=t._create,r=t._setOption;n.extend(t,{_create:function(){this.options.heightStyle=this.options.heightStyle||this._mergeHeightStyle(),i.call(this)},_setOption:function(n){(n==="autoHeight"||n==="clearStyle"||n==="fillSpace")&&(this.options.heightStyle=this._mergeHeightStyle()),r.apply(this,arguments)},_mergeHeightStyle:function(){var n=this.options;return n.fillSpace?"fill":n.clearStyle?"content":n.autoHeight?"auto":void 0}})}(n,n.ui.accordion.prototype),function(n,t){n.extend(t.options.icons,{activeHeader:null,headerSelected:"ui-icon-triangle-1-s"});var i=t._createIcons;t._createIcons=function(){this.options.icons&&(this.options.icons.activeHeader=this.options.icons.activeHeader||this.options.icons.headerSelected),i.call(this)}}(n,n.ui.accordion.prototype),function(n,t){t.activate=t._activate;var i=t._findActive;t._findActive=function(n){return n===-1&&(n=!1),n&&typeof n!="number"&&(n=this.headers.index(this.headers.filter(n)),n===-1&&(n=!1)),i.call(this,n)}}(n,n.ui.accordion.prototype),n.ui.accordion.prototype.resize=n.ui.accordion.prototype.refresh,function(n,t){n.extend(t.options,{change:null,changestart:null});var i=t._trigger;t._trigger=function(n,t,r){var u=i.apply(this,arguments);return u?(n==="beforeActivate"?u=i.call(this,"changestart",t,{oldHeader:r.oldHeader,oldContent:r.oldPanel,newHeader:r.newHeader,newContent:r.newPanel}):n==="activate"&&(u=i.call(this,"change",t,{oldHeader:r.oldHeader,oldContent:r.oldPanel,newHeader:r.newHeader,newContent:r.newPanel})),u):!1}}(n,n.ui.accordion.prototype),function(n,t){n.extend(t.options,{animate:null,animated:"slide"});var i=t._create;t._create=function(){var n=this.options;n.animate===null&&(n.animate=n.animated?n.animated==="slide"?300:n.animated==="bounceslide"?{duration:200,down:{easing:"easeOutBounce",duration:1e3}}:n.animated:!1),i.call(this)}}(n,n.ui.accordion.prototype))}(n),function(n){var t=0;n.widget("ui.autocomplete",{version:"1.9.0",defaultElement:"<input>",options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var t,i,r;this.isMultiLine=this._isMultiLine(),this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on({keydown:function(u){if(this.element.prop("readOnly")){t=!0,r=!0,i=!0;return}t=!1,r=!1,i=!1;var f=n.ui.keyCode;switch(u.keyCode){case f.PAGE_UP:t=!0,this._move("previousPage",u);break;case f.PAGE_DOWN:t=!0,this._move("nextPage",u);break;case f.UP:t=!0,this._keyEvent("previous",u);break;case f.DOWN:t=!0,this._keyEvent("next",u);break;case f.ENTER:case f.NUMPAD_ENTER:this.menu.active&&(t=!0,u.preventDefault(),this.menu.select(u));break;case f.TAB:this.menu.active&&this.menu.select(u);break;case f.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(u),u.preventDefault());break;default:i=!0,this._searchTimeout(u)}},keypress:function(r){if(t){t=!1,r.preventDefault();return}if(!i){var u=n.ui.keyCode;switch(r.keyCode){case u.PAGE_UP:this._move("previousPage",r);break;case u.PAGE_DOWN:this._move("nextPage",r);break;case u.UP:this._keyEvent("previous",r);break;case u.DOWN:this._keyEvent("next",r)}}},input:function(n){if(r){r=!1,n.preventDefault();return}this._searchTimeout(n)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(n){if(this.cancelBlur){delete this.cancelBlur;return}clearTimeout(this.searching),this.close(n),this._change(n)}}),this._initSource(),this.menu=n("<ul>").addClass("ui-autocomplete").appendTo(this.document.find(this.options.appendTo||"body")[0]).menu({input:n(),role:null}).zIndex(this.element.zIndex()+1).hide().data("menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];n(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(r){r.target===t.element[0]||r.target===i||n.contains(i,r.target)||t.close()})})},menufocus:function(t,i){if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type))){this.menu.blur();this.document.one("mousemove",function(){n(t.target).trigger(t.originalEvent)});return}var r=i.item.data("ui-autocomplete-item")||i.item.data("item.autocomplete");!1!==this._trigger("focus",t,{item:r})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(r.value):this.liveRegion.text(r.value)},menuselect:function(n,t){var i=t.item.data("ui-autocomplete-item")||t.item.data("item.autocomplete"),r=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=r,this._delay(function(){this.previous=r,this.selectedItem=i})),!1!==this._trigger("select",n,{item:i})&&this._value(i.value),this.term=this._value(),this.close(n),this.selectedItem=i}}),this.liveRegion=n("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element),n.fn.bgiframe&&this.menu.element.bgiframe(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(n,t){this._super(n,t),n==="source"&&this._initSource(),n==="appendTo"&&this.menu.element.appendTo(this.document.find(t||"body")[0]),n==="disabled"&&t&&this.xhr&&this.xhr.abort()},_isMultiLine:function(){return this.element.is("textarea")?!0:this.element.is("input")?!1:this.element.prop("isContentEditable")},_initSource:function(){var i,r,t=this;n.isArray(this.options.source)?(i=this.options.source,this.source=function(t,r){r(n.ui.autocomplete.filter(i,t.term))}):typeof this.options.source=="string"?(r=this.options.source,this.source=function(i,u){t.xhr&&t.xhr.abort(),t.xhr=n.ajax({url:r,data:i,dataType:"json",success:function(n){u(n)},error:function(){u([])}})}):this.source=this.options.source},_searchTimeout:function(n){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,n))},this.options.delay)},search:function(n,t){return(n=n!=null?n:this._value(),this.term=this._value(),n.length<this.options.minLength)?this.close(t):this._trigger("search",t)===!1?void 0:this._search(n)},_search:function(n){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:n},this._response())},_response:function(){var n=this,i=++t;return function(r){i===t&&n.__response(r),n.pending--,n.pending||n.element.removeClass("ui-autocomplete-loading")}},__response:function(n){n&&(n=this._normalize(n)),this._trigger("response",null,{content:n}),!this.options.disabled&&n&&n.length&&!this.cancelSearch?(this._suggest(n),this._trigger("open")):this._close()},close:function(n){this.cancelSearch=!0,this._close(n)},_close:function(n){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",n))},_change:function(n){this.previous!==this._value()&&this._trigger("change",n,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:n.map(t,function(t){return typeof t=="string"?{label:t,value:t}:n.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var i=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(i,t),this.menu.refresh(),i.show(),this._resizeMenu(),i.position(n.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var n=this.menu.element;n.outerWidth(Math.max(n.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var r=this;n.each(i,function(n,i){r._renderItemData(t,i)})},_renderItemData:function(n,t){return this._renderItem(n,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return n("<li>").append(n("<a>").text(i.label)).appendTo(t)},_move:function(n,t){if(!this.menu.element.is(":visible")){this.search(null,t);return}if(this.menu.isFirstItem()&&/^previous/.test(n)||this.menu.isLastItem()&&/^next/.test(n)){this._value(this.term),this.menu.blur();return}this.menu[n](t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(n,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(n,t),t.preventDefault())}}),n.extend(n.ui.autocomplete,{escapeRegex:function(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var r=new RegExp(n.ui.autocomplete.escapeRegex(i),"i");return n.grep(t,function(n){return r.test(n.label||n.value||n)})}}),n.widget("ui.autocomplete",n.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(n){return n+(n>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(n){var t;(this._superApply(arguments),this.options.disabled||this.cancelSearch)||(t=n&&n.length?this.options.messages.results(n.length):this.options.messages.noResults,this.liveRegion.text(t))}})}(n),function(n){var i,r,u,t,f="ui-button ui-widget ui-state-default ui-corner-all",s="ui-state-hover ui-state-active ",e="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",h=function(){var t=n(this).find(":ui-button");setTimeout(function(){t.button("refresh")},1)},o=function(t){var i=t.name,r=t.form,u=n([]);return i&&(u=r?n(r).find("[name='"+i+"']"):n("[name='"+i+"']",t.ownerDocument).filter(function(){return!this.form})),u};n.widget("ui.button",{version:"1.9.0",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,h),typeof this.options.disabled!="boolean"?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var s=this,e=this.options,c=this.type==="checkbox"||this.type==="radio",a="ui-state-hover"+(c?"":" ui-state-active"),l="ui-state-focus";e.label===null&&(e.label=this.type==="input"?this.buttonElement.val():this.buttonElement.html()),this.buttonElement.addClass(f).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){e.disabled||(n(this).addClass("ui-state-hover"),this===i&&n(this).addClass("ui-state-active"))}).bind("mouseleave"+this.eventNamespace,function(){e.disabled||n(this).removeClass(a)}).bind("click"+this.eventNamespace,function(n){e.disabled&&(n.preventDefault(),n.stopImmediatePropagation())}),this.element.bind("focus"+this.eventNamespace,function(){s.buttonElement.addClass(l)}).bind("blur"+this.eventNamespace,function(){s.buttonElement.removeClass(l)}),c&&(this.element.bind("change"+this.eventNamespace,function(){t||s.refresh()}),this.buttonElement.bind("mousedown"+this.eventNamespace,function(n){e.disabled||(t=!1,r=n.pageX,u=n.pageY)}).bind("mouseup"+this.eventNamespace,function(n){e.disabled||(r!==n.pageX||u!==n.pageY)&&(t=!0)})),this.type==="checkbox"?this.buttonElement.bind("click"+this.eventNamespace,function(){if(e.disabled||t)return!1;n(this).toggleClass("ui-state-active"),s.buttonElement.attr("aria-pressed",s.element[0].checked)}):this.type==="radio"?this.buttonElement.bind("click"+this.eventNamespace,function(){if(e.disabled||t)return!1;n(this).addClass("ui-state-active"),s.buttonElement.attr("aria-pressed","true");var i=s.element[0];o(i).not(i).map(function(){return n(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(e.disabled)return!1;n(this).addClass("ui-state-active"),i=this;s.document.one("mouseup",function(){i=null})}).bind("mouseup"+this.eventNamespace,function(){if(e.disabled)return!1;n(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(t){if(e.disabled)return!1;(t.keyCode===n.ui.keyCode.SPACE||t.keyCode===n.ui.keyCode.ENTER)&&n(this).addClass("ui-state-active")}).bind("keyup"+this.eventNamespace,function(){n(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===n.ui.keyCode.SPACE&&n(this).click()})),this._setOption("disabled",e.disabled),this._resetButton()},_determineButtonType:function(){var n,t,i;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button",this.type==="checkbox"||this.type==="radio"?(n=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=n.find(t),this.buttonElement.length||(n=n.length?n.siblings():this.element.siblings(),this.buttonElement=n.filter(t),this.buttonElement.length||(this.buttonElement=n.find(t))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(f+" "+s+" "+e).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(n,t){if(this._super(n,t),n==="disabled"){t?this.element.prop("disabled",!0):this.element.prop("disabled",!1);return}this._resetButton()},refresh:function(){var t=this.element.is(":disabled");t!==this.options.disabled&&this._setOption("disabled",t),this.type==="radio"?o(this.element[0]).each(function(){n(this).is(":checked")?n(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):n(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):this.type==="checkbox"&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if(this.type==="input"){this.options.label&&this.element.val(this.options.label);return}var i=this.buttonElement.removeClass(e),f=n("<span><\/span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(i.empty()).text(),t=this.options.icons,u=t.primary&&t.secondary,r=[];t.primary||t.secondary?(this.options.text&&r.push("ui-button-text-icon"+(u?"s":t.primary?"-primary":"-secondary")),t.primary&&i.prepend("<span class='ui-button-icon-primary ui-icon "+t.primary+"'><\/span>"),t.secondary&&i.append("<span class='ui-button-icon-secondary ui-icon "+t.secondary+"'><\/span>"),this.options.text||(r.push(u?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||i.attr("title",n.trim(f)))):r.push("ui-button-text-only"),i.addClass(r.join(" "))}}),n.widget("ui.buttonset",{version:"1.9.0",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(n,t){n==="disabled"&&this.buttons.button("option",n,t),this._super(n,t)},refresh:function(){var t=this.element.css("direction")==="rtl";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return n(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return n(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(n),function(n,t){function e(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},n.extend(this._defaults,this.regional[""]),this.dpDiv=o(n('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"><\/div>'))}function o(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(i,"mouseout",function(){n(this).removeClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!=-1&&n(this).removeClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!=-1&&n(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",function(){n.datepicker._isDisabledDatepicker(f.inline?t.parent()[0]:f.input[0])||(n(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),n(this).addClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!=-1&&n(this).addClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!=-1&&n(this).addClass("ui-datepicker-next-hover"))})}function u(i,r){n.extend(i,r);for(var u in r)(r[u]==null||r[u]==t)&&(i[u]=r[u]);return i}n.extend(n.ui,{datepicker:{version:"1.9.0"}});var i="datepicker",r=(new Date).getTime(),f;n.extend(e.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(n){return u(this._defaults,n||{}),this},_attachDatepicker:function(target,settings){var inlineSettings=null,attrName,attrValue,nodeName,inline,inst;for(attrName in this._defaults)if(attrValue=target.getAttribute("date:"+attrName),attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}nodeName=target.nodeName.toLowerCase(),inline=nodeName=="div"||nodeName=="span",target.id||(this.uuid+=1,target.id="dp"+this.uuid),inst=this._newInst(n(target),inline),inst.settings=n.extend({},settings||{},inlineSettings||{}),nodeName=="input"?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst)},_newInst:function(t,i){var r=t[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:r,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?o(n('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"><\/div>')):this.dpDiv}},_connectDatepicker:function(t,r){var u=n(t);(r.append=n([]),r.trigger=n([]),u.hasClass(this.markerClassName))||(this._attachments(u,r),u.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(n,t,i){r.settings[t]=i}).bind("getData.datepicker",function(n,t){return this._get(r,t)}),this._autoSize(r),n.data(t,i,r),r.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var e=this._get(i,"appendText"),o=this._get(i,"isRTL"),u,r,f;i.append&&i.append.remove(),e&&(i.append=n('<span class="'+this._appendClass+'">'+e+"<\/span>"),t[o?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),u=this._get(i,"showOn"),(u=="focus"||u=="both")&&t.focus(this._showDatepicker),(u=="button"||u=="both")&&(r=this._get(i,"buttonText"),f=this._get(i,"buttonImage"),i.trigger=n(this._get(i,"buttonImageOnly")?n("<img/>").addClass(this._triggerClass).attr({src:f,alt:r,title:r}):n('<button type="button"><\/button>').addClass(this._triggerClass).html(f==""?r:n("<img/>").attr({src:f,alt:r,title:r}))),t[o?"before":"after"](i.trigger),i.trigger.click(function(){return n.datepicker._datepickerShowing&&n.datepicker._lastInput==t[0]?n.datepicker._hideDatepicker():n.datepicker._datepickerShowing&&n.datepicker._lastInput!=t[0]?(n.datepicker._hideDatepicker(),n.datepicker._showDatepicker(t[0])):n.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(n){var t,i,r;this._get(n,"autoSize")&&!n.inline&&(t=new Date(2009,11,20),i=this._get(n,"dateFormat"),i.match(/[DM]/)&&(r=function(n){for(var i=0,r=0,t=0;t<n.length;t++)n[t].length>i&&(i=n[t].length,r=t);return r},t.setMonth(r(this._get(n,i.match(/MM/)?"monthNames":"monthNamesShort"))),t.setDate(r(this._get(n,i.match(/DD/)?"dayNames":"dayNamesShort"))+20-t.getDay())),n.input.attr("size",this._formatDate(n,t).length))},_inlineDatepicker:function(t,r){var u=n(t);u.hasClass(this.markerClassName)||(u.addClass(this.markerClassName).append(r.dpDiv).bind("setData.datepicker",function(n,t,i){r.settings[t]=i}).bind("getData.datepicker",function(n,t){return this._get(r,t)}),n.data(t,i,r),this._setDate(r,this._getDefaultDate(r),!0),this._updateDatepicker(r),this._updateAlternate(r),r.settings.disabled&&this._disableDatepicker(t),r.dpDiv.css("display","block"))},_dialogDatepicker:function(t,r,f,e,o){var s=this._dialogInst,h;if(s||(this.uuid+=1,h="dp"+this.uuid,this._dialogInput=n('<input type="text" id="'+h+'" style="position: absolute; top: -100px; width: 0px;"/>'),this._dialogInput.keydown(this._doKeyDown),n("body").append(this._dialogInput),s=this._dialogInst=this._newInst(this._dialogInput,!1),s.settings={},n.data(this._dialogInput[0],i,s)),u(s.settings,e||{}),r=r&&r.constructor==Date?this._formatDate(s,r):r,this._dialogInput.val(r),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,!this._pos){var c=document.documentElement.clientWidth,l=document.documentElement.clientHeight,a=document.documentElement.scrollLeft||document.body.scrollLeft,v=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[c/2-100+a,l/2-150+v]}return this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),s.settings.onSelect=f,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),n.blockUI&&n.blockUI(this.dpDiv),n.data(this._dialogInput[0],i,s),this},_destroyDatepicker:function(t){var u=n(t),f=n.data(t,i),r;u.hasClass(this.markerClassName)&&(r=t.nodeName.toLowerCase(),n.removeData(t,i),r=="input"?(f.append.remove(),f.trigger.remove(),u.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):(r=="div"||r=="span")&&u.removeClass(this.markerClassName).empty())},_enableDatepicker:function(t){var f=n(t),e=n.data(t,i),r,u;f.hasClass(this.markerClassName)&&(r=t.nodeName.toLowerCase(),r=="input"?(t.disabled=!1,e.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):(r=="div"||r=="span")&&(u=f.children("."+this._inlineClass),u.children().removeClass("ui-state-disabled"),u.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=n.map(this._disabledInputs,function(n){return n==t?null:n}))},_disableDatepicker:function(t){var f=n(t),e=n.data(t,i),r,u;f.hasClass(this.markerClassName)&&(r=t.nodeName.toLowerCase(),r=="input"?(t.disabled=!0,e.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):(r=="div"||r=="span")&&(u=f.children("."+this._inlineClass),u.children().addClass("ui-state-disabled"),u.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=n.map(this._disabledInputs,function(n){return n==t?null:n}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(n){if(!n)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]==n)return!0;return!1},_getInst:function(t){try{return n.data(t,i)}catch(r){throw"Missing instance data for this datepicker";}},_optionDatepicker:function(i,r,f){var e=this._getInst(i),o;if(arguments.length==2&&typeof r=="string")return r=="defaults"?n.extend({},n.datepicker._defaults):e?r=="all"?n.extend({},e.settings):this._get(e,r):null;if(o=r||{},typeof r=="string"&&(o={},o[r]=f),e){this._curInst==e&&this._hideDatepicker();var c=this._getDateDatepicker(i,!0),s=this._getMinMaxDate(e,"min"),h=this._getMinMaxDate(e,"max");u(e.settings,o),s!==null&&o.dateFormat!==t&&o.minDate===t&&(e.settings.minDate=this._formatDate(e,s)),h!==null&&o.dateFormat!==t&&o.maxDate===t&&(e.settings.maxDate=this._formatDate(e,h)),this._attachments(n(i),e),this._autoSize(e),this._setDate(e,c),this._updateAlternate(e),this._updateDatepicker(e)}},_changeDatepicker:function(n,t,i){this._optionDatepicker(n,t,i)},_refreshDatepicker:function(n){var t=this._getInst(n);t&&this._updateDatepicker(t)},_setDateDatepicker:function(n,t){var i=this._getInst(n);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(n,t){var i=this._getInst(n);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i=n.datepicker._getInst(t.target),r=!0,e=i.dpDiv.is(".ui-datepicker-rtl"),u,f,o;if(i._keyEvent=!0,n.datepicker._datepickerShowing)switch(t.keyCode){case 9:n.datepicker._hideDatepicker(),r=!1;break;case 13:return u=n("td."+n.datepicker._dayOverClass+":not(."+n.datepicker._currentClass+")",i.dpDiv),u[0]&&n.datepicker._selectDay(t.target,i.selectedMonth,i.selectedYear,u[0]),f=n.datepicker._get(i,"onSelect"),f?(o=n.datepicker._formatDate(i),f.apply(i.input?i.input[0]:null,[o,i])):n.datepicker._hideDatepicker(),!1;case 27:n.datepicker._hideDatepicker();break;case 33:n.datepicker._adjustDate(t.target,t.ctrlKey?-n.datepicker._get(i,"stepBigMonths"):-n.datepicker._get(i,"stepMonths"),"M");break;case 34:n.datepicker._adjustDate(t.target,t.ctrlKey?+n.datepicker._get(i,"stepBigMonths"):+n.datepicker._get(i,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&n.datepicker._clearDate(t.target),r=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&n.datepicker._gotoToday(t.target),r=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&n.datepicker._adjustDate(t.target,e?1:-1,"D"),r=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&n.datepicker._adjustDate(t.target,t.ctrlKey?-n.datepicker._get(i,"stepBigMonths"):-n.datepicker._get(i,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&n.datepicker._adjustDate(t.target,-7,"D"),r=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&n.datepicker._adjustDate(t.target,e?-1:1,"D"),r=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&n.datepicker._adjustDate(t.target,t.ctrlKey?+n.datepicker._get(i,"stepBigMonths"):+n.datepicker._get(i,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&n.datepicker._adjustDate(t.target,7,"D"),r=t.ctrlKey||t.metaKey;break;default:r=!1}else t.keyCode==36&&t.ctrlKey?n.datepicker._showDatepicker(this):r=!1;r&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(i){var f=n.datepicker._getInst(i.target),r,u;if(n.datepicker._get(f,"constrainInput"))return r=n.datepicker._possibleChars(n.datepicker._get(f,"dateFormat")),u=String.fromCharCode(i.charCode==t?i.keyCode:i.charCode),i.ctrlKey||i.metaKey||u<" "||!r||r.indexOf(u)>-1},_doKeyUp:function(t){var i=n.datepicker._getInst(t.target),r;if(i.input.val()!=i.lastVal)try{r=n.datepicker.parseDate(n.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,n.datepicker._getFormatConfig(i)),r&&(n.datepicker._setDateFromField(i),n.datepicker._updateAlternate(i),n.datepicker._updateDatepicker(i))}catch(u){n.datepicker.log(u)}return!0},_showDatepicker:function(t){var i,o,s,f,e;if((t=t.target||t,t.nodeName.toLowerCase()!="input"&&(t=n("input",t.parentNode)[0]),!n.datepicker._isDisabledDatepicker(t)&&n.datepicker._lastInput!=t)&&(i=n.datepicker._getInst(t),n.datepicker._curInst&&n.datepicker._curInst!=i&&(n.datepicker._curInst.dpDiv.stop(!0,!0),i&&n.datepicker._datepickerShowing&&n.datepicker._hideDatepicker(n.datepicker._curInst.input[0])),o=n.datepicker._get(i,"beforeShow"),s=o?o.apply(t,[t,i]):{},s!==!1)&&(u(i.settings,s),i.lastVal=null,n.datepicker._lastInput=t,n.datepicker._setDateFromField(i),n.datepicker._inDialog&&(t.value=""),n.datepicker._pos||(n.datepicker._pos=n.datepicker._findPos(t),n.datepicker._pos[1]+=t.offsetHeight),f=!1,n(t).parents().each(function(){return f|=n(this).css("position")=="fixed",!f}),e={left:n.datepicker._pos[0],top:n.datepicker._pos[1]},n.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),n.datepicker._updateDatepicker(i),e=n.datepicker._checkOffset(i,e,f),i.dpDiv.css({position:n.datepicker._inDialog&&n.blockUI?"static":f?"fixed":"absolute",display:"none",left:e.left+"px",top:e.top+"px"}),!i.inline)){var r=n.datepicker._get(i,"showAnim"),h=n.datepicker._get(i,"duration"),c=function(){var r=i.dpDiv.find("iframe.ui-datepicker-cover"),t;!r.length||(t=n.datepicker._getBorders(i.dpDiv),r.css({left:-t[0],top:-t[1],width:i.dpDiv.outerWidth(),height:i.dpDiv.outerHeight()}))};i.dpDiv.zIndex(n(t).zIndex()+1),n.datepicker._datepickerShowing=!0,n.effects&&(n.effects.effect[r]||n.effects[r])?i.dpDiv.show(r,n.datepicker._get(i,"showOptions"),h,c):i.dpDiv[r||"show"](r?h:null,c),r&&h||c(),i.input.is(":visible")&&!i.input.is(":disabled")&&i.input.focus(),n.datepicker._curInst=i}},_updateDatepicker:function(t){var i,r,o;this.maxRows=4,i=n.datepicker._getBorders(t.dpDiv),f=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t),r=t.dpDiv.find("iframe.ui-datepicker-cover"),!r.length||r.css({left:-i[0],top:-i[1],width:t.dpDiv.outerWidth(),height:t.dpDiv.outerHeight()}),t.dpDiv.find("."+this._dayOverClass+" a").mouseover();var u=this._getNumberOfMonths(t),e=u[1];t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),e>1&&t.dpDiv.addClass("ui-datepicker-multi-"+e).css("width",17*e+"em"),t.dpDiv[(u[0]!=1||u[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t==n.datepicker._curInst&&n.datepicker._datepickerShowing&&t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&t.input[0]!=document.activeElement&&t.input.focus(),t.yearshtml&&(o=t.yearshtml,setTimeout(function(){o===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),o=t.yearshtml=null},0))},_getBorders:function(n){var t=function(n){return{thin:1,medium:2,thick:3}[n]||n};return[parseFloat(t(n.css("border-left-width"))),parseFloat(t(n.css("border-top-width")))]},_checkOffset:function(t,i,r){var u=t.dpDiv.outerWidth(),f=t.dpDiv.outerHeight(),h=t.input?t.input.outerWidth():0,o=t.input?t.input.outerHeight():0,e=document.documentElement.clientWidth+(r?0:n(document).scrollLeft()),s=document.documentElement.clientHeight+(r?0:n(document).scrollTop());return i.left-=this._get(t,"isRTL")?u-h:0,i.left-=r&&i.left==t.input.offset().left?n(document).scrollLeft():0,i.top-=r&&i.top==t.input.offset().top+o?n(document).scrollTop():0,i.left-=Math.min(i.left,i.left+u>e&&e>u?Math.abs(i.left+u-e):0),i.top-=Math.min(i.top,i.top+f>s&&s>f?Math.abs(f+o):0),i},_findPos:function(t){for(var r=this._getInst(t),u=this._get(r,"isRTL"),i;t&&(t.type=="hidden"||t.nodeType!=1||n.expr.filters.hidden(t));)t=t[u?"previousSibling":"nextSibling"];return i=n(t).offset(),[i.left,i.top]},_hideDatepicker:function(t){var r=this._curInst,e;if(r&&(!t||r==n.data(t,i))&&this._datepickerShowing){var u=this._get(r,"showAnim"),o=this._get(r,"duration"),f=function(){n.datepicker._tidyDialog(r)};n.effects&&(n.effects.effect[u]||n.effects[u])?r.dpDiv.hide(u,n.datepicker._get(r,"showOptions"),o,f):r.dpDiv[u=="slideDown"?"slideUp":u=="fadeIn"?"fadeOut":"hide"](u?o:null,f),u||f(),this._datepickerShowing=!1,e=this._get(r,"onClose"),e&&e.apply(r.input?r.input[0]:null,[r.input?r.input.val():"",r]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),n.blockUI&&(n.unblockUI(),n("body").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(n){n.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(n.datepicker._curInst){var i=n(t.target),r=n.datepicker._getInst(i[0]);(i[0].id==n.datepicker._mainDivId||i.parents("#"+n.datepicker._mainDivId).length!=0||i.hasClass(n.datepicker.markerClassName)||i.closest("."+n.datepicker._triggerClass).length||!n.datepicker._datepickerShowing||n.datepicker._inDialog&&n.blockUI)&&(!i.hasClass(n.datepicker.markerClassName)||n.datepicker._curInst==r)||n.datepicker._hideDatepicker()}},_adjustDate:function(t,i,r){var f=n(t),u=this._getInst(f[0]);this._isDisabledDatepicker(f[0])||(this._adjustInstDate(u,i+(r=="M"?this._get(u,"showCurrentAtPos"):0),r),this._updateDatepicker(u))},_gotoToday:function(t){var u=n(t),i=this._getInst(u[0]),r;this._get(i,"gotoCurrent")&&i.currentDay?(i.selectedDay=i.currentDay,i.drawMonth=i.selectedMonth=i.currentMonth,i.drawYear=i.selectedYear=i.currentYear):(r=new Date,i.selectedDay=r.getDate(),i.drawMonth=i.selectedMonth=r.getMonth(),i.drawYear=i.selectedYear=r.getFullYear()),this._notifyChange(i),this._adjustDate(u)},_selectMonthYear:function(t,i,r){var f=n(t),u=this._getInst(f[0]);u["selected"+(r=="M"?"Month":"Year")]=u["draw"+(r=="M"?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(u),this._adjustDate(f)},_selectDay:function(t,i,r,u){var e=n(t),f;n(u).hasClass(this._unselectableClass)||this._isDisabledDatepicker(e[0])||(f=this._getInst(e[0]),f.selectedDay=f.currentDay=n("a",u).html(),f.selectedMonth=f.currentMonth=i,f.selectedYear=f.currentYear=r,this._selectDate(t,this._formatDate(f,f.currentDay,f.currentMonth,f.currentYear)))},_clearDate:function(t){var i=n(t),r=this._getInst(i[0]);this._selectDate(i,"")},_selectDate:function(t,i){var f=n(t),r=this._getInst(f[0]),u;i=i!=null?i:this._formatDate(r),r.input&&r.input.val(i),this._updateAlternate(r),u=this._get(r,"onSelect"),u?u.apply(r.input?r.input[0]:null,[i,r]):r.input&&r.input.trigger("change"),r.inline?this._updateDatepicker(r):(this._hideDatepicker(),this._lastInput=r.input[0],typeof r.input[0]!="object"&&r.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i=this._get(t,"altField");if(i){var r=this._get(t,"altFormat")||this._get(t,"dateFormat"),u=this._getDate(t),f=this.formatDate(r,u,this._getFormatConfig(t));n(i).each(function(){n(this).val(f)})}},noWeekends:function(n){var t=n.getDay();return[t>0&&t<6,""]},iso8601Week:function(n){var t=new Date(n.getTime()),i;return t.setDate(t.getDate()+4-(t.getDay()||7)),i=t.getTime(),t.setMonth(0),t.setDate(1),Math.floor(Math.round((i-t)/864e5)/7)+1},parseDate:function(t,i,r){var c,s,w,b,u;if(t==null||i==null)throw"Invalid arguments";if(i=typeof i=="object"?i.toString():i+"",i=="")return null;c=(r?r.shortYearCutoff:null)||this._defaults.shortYearCutoff,c=typeof c!="string"?c:(new Date).getFullYear()%100+parseInt(c,10);var d=(r?r.dayNamesShort:null)||this._defaults.dayNamesShort,g=(r?r.dayNames:null)||this._defaults.dayNames,nt=(r?r.monthNamesShort:null)||this._defaults.monthNamesShort,tt=(r?r.monthNames:null)||this._defaults.monthNames,f=-1,o=-1,h=-1,v=-1,y=!1,a=function(n){var i=s+1<t.length&&t.charAt(s+1)==n;return i&&s++,i},l=function(n){var r=a(n),u=n=="@"?14:n=="!"?20:n=="y"&&r?4:n=="o"?3:2,f=new RegExp("^\\d{1,"+u+"}"),t=i.substring(e).match(f);if(!t)throw"Missing number at position "+e;return e+=t[0].length,parseInt(t[0],10)},k=function(t,r,u){var o=n.map(a(t)?u:r,function(n,t){return[[t,n]]}).sort(function(n,t){return-(n[1].length-t[1].length)}),f=-1;if(n.each(o,function(n,t){var r=t[1];if(i.substr(e,r.length).toLowerCase()==r.toLowerCase())return f=t[0],e+=r.length,!1}),f!=-1)return f+1;throw"Unknown name at position "+e;},p=function(){if(i.charAt(e)!=t.charAt(s))throw"Unexpected literal at position "+e;e++},e=0;for(s=0;s<t.length;s++)if(y)t.charAt(s)!="'"||a("'")?p():y=!1;else switch(t.charAt(s)){case"d":h=l("d");break;case"D":k("D",d,g);break;case"o":v=l("o");break;case"m":o=l("m");break;case"M":o=k("M",nt,tt);break;case"y":f=l("y");break;case"@":u=new Date(l("@")),f=u.getFullYear(),o=u.getMonth()+1,h=u.getDate();break;case"!":u=new Date((l("!")-this._ticksTo1970)/1e4),f=u.getFullYear(),o=u.getMonth()+1,h=u.getDate();break;case"'":a("'")?p():y=!0;break;default:p()}if(e<i.length&&(w=i.substr(e),!/^\s+/.test(w)))throw"Extra/unparsed characters found in date: "+w;if(f==-1?f=(new Date).getFullYear():f<100&&(f+=(new Date).getFullYear()-(new Date).getFullYear()%100+(f<=c?0:-100)),v>-1){o=1,h=v;do{if(b=this._getDaysInMonth(f,o-1),h<=b)break;o++,h-=b}while(1)}if(u=this._daylightSavingAdjust(new Date(f,o-1,h)),u.getFullYear()!=f||u.getMonth()+1!=o||u.getDate()!=h)throw"Invalid date";return u},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(1970/4)-Math.floor(1970/100)+Math.floor(1970/400))*864e9,formatDate:function(n,t,i){var u;if(!t)return"";var h=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,c=(i?i.dayNames:null)||this._defaults.dayNames,l=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,a=(i?i.monthNames:null)||this._defaults.monthNames,f=function(t){var i=u+1<n.length&&n.charAt(u+1)==t;return i&&u++,i},e=function(n,t,i){var r=""+t;if(f(n))while(r.length<i)r="0"+r;return r},s=function(n,t,i,r){return f(n)?r[t]:i[t]},r="",o=!1;if(t)for(u=0;u<n.length;u++)if(o)n.charAt(u)!="'"||f("'")?r+=n.charAt(u):o=!1;else switch(n.charAt(u)){case"d":r+=e("d",t.getDate(),2);break;case"D":r+=s("D",t.getDay(),h,c);break;case"o":r+=e("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":r+=e("m",t.getMonth()+1,2);break;case"M":r+=s("M",t.getMonth(),l,a);break;case"y":r+=f("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":r+=t.getTime();break;case"!":r+=t.getTime()*1e4+this._ticksTo1970;break;case"'":f("'")?r+="'":o=!0;break;default:r+=n.charAt(u)}return r},_possibleChars:function(n){for(var i="",r=!1,u=function(i){var r=t+1<n.length&&n.charAt(t+1)==i;return r&&t++,r},t=0;t<n.length;t++)if(r)n.charAt(t)!="'"||u("'")?i+=n.charAt(t):r=!1;else switch(n.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":u("'")?i+="'":r=!0;break;default:i+=n.charAt(t)}return i},_get:function(n,i){return n.settings[i]!==t?n.settings[i]:this._defaults[i]},_setDateFromField:function(n,t){var u,r,i,f,e;if(n.input.val()!=n.lastVal){u=this._get(n,"dateFormat"),r=n.lastVal=n.input?n.input.val():null,i=f=this._getDefaultDate(n),e=this._getFormatConfig(n);try{i=this.parseDate(u,r,e)||f}catch(o){this.log(o),r=t?"":r}n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear(),n.currentDay=r?i.getDate():0,n.currentMonth=r?i.getMonth():0,n.currentYear=r?i.getFullYear():0,this._adjustInstDate(n)}},_getDefaultDate:function(n){return this._restrictMinMax(n,this._determineDate(n,this._get(n,"defaultDate"),new Date))},_determineDate:function(t,i,r){var f=function(n){var t=new Date;return t.setDate(t.getDate()+n),t},e=function(i){try{return n.datepicker.parseDate(n.datepicker._get(t,"dateFormat"),i,n.datepicker._getFormatConfig(t))}catch(h){}for(var o=(i.toLowerCase().match(/^c/)?n.datepicker._getDate(t):null)||new Date,f=o.getFullYear(),e=o.getMonth(),r=o.getDate(),s=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,u=s.exec(i);u;){switch(u[2]||"d"){case"d":case"D":r+=parseInt(u[1],10);break;case"w":case"W":r+=parseInt(u[1],10)*7;break;case"m":case"M":e+=parseInt(u[1],10),r=Math.min(r,n.datepicker._getDaysInMonth(f,e));break;case"y":case"Y":f+=parseInt(u[1],10),r=Math.min(r,n.datepicker._getDaysInMonth(f,e))}u=s.exec(i)}return new Date(f,e,r)},u=i==null||i===""?r:typeof i=="string"?e(i):typeof i=="number"?isNaN(i)?r:f(i):new Date(i.getTime());return u=u&&u.toString()=="Invalid Date"?r:u,u&&(u.setHours(0),u.setMinutes(0),u.setSeconds(0),u.setMilliseconds(0)),this._daylightSavingAdjust(u)},_daylightSavingAdjust:function(n){return n?(n.setHours(n.getHours()>12?n.getHours()+2:0),n):null},_setDate:function(n,t,i){var u=!t,f=n.selectedMonth,e=n.selectedYear,r=this._restrictMinMax(n,this._determineDate(n,t,new Date));n.selectedDay=n.currentDay=r.getDate(),n.drawMonth=n.selectedMonth=n.currentMonth=r.getMonth(),n.drawYear=n.selectedYear=n.currentYear=r.getFullYear(),f==n.selectedMonth&&e==n.selectedYear||i||this._notifyChange(n),this._adjustInstDate(n),n.input&&n.input.val(u?"":this._formatDate(n))},_getDate:function(n){return!n.currentYear||n.input&&n.input.val()==""?null:this._daylightSavingAdjust(new Date(n.currentYear,n.currentMonth,n.currentDay))},_attachHandlers:function(t){var u=this._get(t,"stepMonths"),i="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){window["DP_jQuery_"+r].datepicker._adjustDate(i,-u,"M")},next:function(){window["DP_jQuery_"+r].datepicker._adjustDate(i,+u,"M")},hide:function(){window["DP_jQuery_"+r].datepicker._hideDatepicker()},today:function(){window["DP_jQuery_"+r].datepicker._gotoToday(i)},selectDay:function(){return window["DP_jQuery_"+r].datepicker._selectDay(i,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return window["DP_jQuery_"+r].datepicker._selectMonthYear(i,this,"M"),!1},selectYear:function(){return window["DP_jQuery_"+r].datepicker._selectMonthYear(i,this,"Y"),!1}};n(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(t){var l=new Date,d,h,ut,c,p,ot,w,st,ht,ct,r,at,vt,s;l=this._daylightSavingAdjust(new Date(l.getFullYear(),l.getMonth(),l.getDate()));var e=this._get(t,"isRTL"),fi=this._get(t,"showButtonPanel"),pt=this._get(t,"hideIfNoPrevNext"),tt=this._get(t,"navigationAsDateFormat"),o=this._getNumberOfMonths(t),ei=this._get(t,"showCurrentAtPos"),wt=this._get(t,"stepMonths"),it=o[0]!=1||o[1]!=1,rt=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),y=this._getMinMaxDate(t,"min"),a=this._getMinMaxDate(t,"max"),i=t.drawMonth-ei,u=t.drawYear;if(i<0&&(i+=12,u--),a)for(d=this._daylightSavingAdjust(new Date(a.getFullYear(),a.getMonth()-o[0]*o[1]+1,a.getDate())),d=y&&d<y?y:d;this._daylightSavingAdjust(new Date(u,i,1))>d;)i--,i<0&&(i=11,u--);t.drawMonth=i,t.drawYear=u,h=this._get(t,"prevText"),h=tt?this.formatDate(h,this._daylightSavingAdjust(new Date(u,i-wt,1)),this._getFormatConfig(t)):h,ut=this._canAdjustMonth(t,-1,u,i)?'<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click" title="'+h+'"><span class="ui-icon ui-icon-circle-triangle-'+(e?"e":"w")+'">'+h+"<\/span><\/a>":pt?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+h+'"><span class="ui-icon ui-icon-circle-triangle-'+(e?"e":"w")+'">'+h+"<\/span><\/a>",c=this._get(t,"nextText"),c=tt?this.formatDate(c,this._daylightSavingAdjust(new Date(u,i+wt,1)),this._getFormatConfig(t)):c;var bt=this._canAdjustMonth(t,1,u,i)?'<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click" title="'+c+'"><span class="ui-icon ui-icon-circle-triangle-'+(e?"w":"e")+'">'+c+"<\/span><\/a>":pt?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+c+'"><span class="ui-icon ui-icon-circle-triangle-'+(e?"w":"e")+'">'+c+"<\/span><\/a>",g=this._get(t,"currentText"),kt=this._get(t,"gotoCurrent")&&t.currentDay?rt:l;g=tt?this.formatDate(g,kt,this._getFormatConfig(t)):g;var dt=t.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">'+this._get(t,"closeText")+"<\/button>",oi=fi?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(e?dt:"")+(this._isInRange(t,kt)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click">'+g+"<\/button>":"")+(e?"":dt)+"<\/div>":"",v=parseInt(this._get(t,"firstDay"),10);v=isNaN(v)?0:v;var gt=this._get(t,"showWeek"),si=this._get(t,"dayNames"),vi=this._get(t,"dayNamesShort"),hi=this._get(t,"dayNamesMin"),ci=this._get(t,"monthNames"),li=this._get(t,"monthNamesShort"),ni=this._get(t,"beforeShowDay"),ft=this._get(t,"showOtherMonths"),ai=this._get(t,"selectOtherMonths"),yi=this._get(t,"calculateWeek")||this.iso8601Week,ti=this._getDefaultDate(t),et="";for(p=0;p<o[0];p++){for(ot="",this.maxRows=4,w=0;w<o[1];w++){var ii=this._daylightSavingAdjust(new Date(u,i,t.selectedDay)),b=" ui-corner-all",f="";if(it){if(f+='<div class="ui-datepicker-group',o[1]>1)switch(w){case 0:f+=" ui-datepicker-group-first",b=" ui-corner-"+(e?"right":"left");break;case o[1]-1:f+=" ui-datepicker-group-last",b=" ui-corner-"+(e?"left":"right");break;default:f+=" ui-datepicker-group-middle",b=""}f+='">'}for(f+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+b+'">'+(/all|left/.test(b)&&p==0?e?bt:ut:"")+(/all|right/.test(b)&&p==0?e?ut:bt:"")+this._generateMonthYearHeader(t,i,u,y,a,p>0||w>0,ci,li)+'<\/div><table class="ui-datepicker-calendar"><thead><tr>',st=gt?'<th class="ui-datepicker-week-col">'+this._get(t,"weekHeader")+"<\/th>":"",s=0;s<7;s++)ht=(s+v)%7,st+="<th"+((s+v+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+si[ht]+'">'+hi[ht]+"<\/span><\/th>";f+=st+"<\/tr><\/thead><tbody>",ct=this._getDaysInMonth(u,i),u==t.selectedYear&&i==t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,ct));var ri=(this._getFirstDayOfMonth(u,i)-v+7)%7,lt=Math.ceil((ri+ct)/7),ui=it?this.maxRows>lt?this.maxRows:lt:lt;for(this.maxRows=ui,r=this._daylightSavingAdjust(new Date(u,i,1-ri)),at=0;at<ui;at++){for(f+="<tr>",vt=gt?'<td class="ui-datepicker-week-col">'+this._get(t,"calculateWeek")(r)+"<\/td>":"",s=0;s<7;s++){var nt=ni?ni.apply(t.input?t.input[0]:null,[r]):[!0,""],k=r.getMonth()!=i,yt=k&&!ai||!nt[0]||y&&r<y||a&&r>a;vt+='<td class="'+((s+v+6)%7>=5?" ui-datepicker-week-end":"")+(k?" ui-datepicker-other-month":"")+(r.getTime()==ii.getTime()&&i==t.selectedMonth&&t._keyEvent||ti.getTime()==r.getTime()&&ti.getTime()==ii.getTime()?" "+this._dayOverClass:"")+(yt?" "+this._unselectableClass+" ui-state-disabled":"")+(k&&!ft?"":" "+nt[1]+(r.getTime()==rt.getTime()?" "+this._currentClass:"")+(r.getTime()==l.getTime()?" ui-datepicker-today":""))+'"'+((!k||ft)&&nt[2]?' title="'+nt[2]+'"':"")+(yt?"":' data-handler="selectDay" data-event="click" data-month="'+r.getMonth()+'" data-year="'+r.getFullYear()+'"')+">"+(k&&!ft?"&#xa0;":yt?'<span class="ui-state-default">'+r.getDate()+"<\/span>":'<a class="ui-state-default'+(r.getTime()==l.getTime()?" ui-state-highlight":"")+(r.getTime()==rt.getTime()?" ui-state-active":"")+(k?" ui-priority-secondary":"")+'" href="#">'+r.getDate()+"<\/a>")+"<\/td>",r.setDate(r.getDate()+1),r=this._daylightSavingAdjust(r)}f+=vt+"<\/tr>"}i++,i>11&&(i=0,u++),f+="<\/tbody><\/table>"+(it?"<\/div>"+(o[0]>0&&w==o[1]-1?'<div class="ui-datepicker-row-break"><\/div>':""):""),ot+=f}et+=ot}return et+=oi+(n.browser.msie&&parseInt(n.browser.version,10)<7&&!t.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"><\/iframe>':""),t._keyEvent=!1,et},_generateMonthYearHeader:function(n,t,i,r,u,f,e,o){var v=this._get(n,"changeMonth"),y=this._get(n,"changeYear"),p=this._get(n,"showMonthAfterYear"),c='<div class="ui-datepicker-title">',l="",w,b,h;if(f||!v)l+='<span class="ui-datepicker-month">'+e[t]+"<\/span>";else{for(w=r&&r.getFullYear()==i,b=u&&u.getFullYear()==i,l+='<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">',h=0;h<12;h++)(!w||h>=r.getMonth())&&(!b||h<=u.getMonth())&&(l+='<option value="'+h+'"'+(h==t?' selected="selected"':"")+">"+o[h]+"<\/option>");l+="<\/select>"}if(p||(c+=l+(f||!(v&&y)?"&#xa0;":"")),!n.yearshtml)if(n.yearshtml="",f||!y)c+='<span class="ui-datepicker-year">'+i+"<\/span>";else{var k=this._get(n,"yearRange").split(":"),d=(new Date).getFullYear(),g=function(n){var t=n.match(/c[+-].*/)?i+parseInt(n.substring(1),10):n.match(/[+-].*/)?d+parseInt(n,10):parseInt(n,10);return isNaN(t)?d:t},s=g(k[0]),a=Math.max(s,g(k[1]||""));for(s=r?Math.max(s,r.getFullYear()):s,a=u?Math.min(a,u.getFullYear()):a,n.yearshtml+='<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">';s<=a;s++)n.yearshtml+='<option value="'+s+'"'+(s==i?' selected="selected"':"")+">"+s+"<\/option>";n.yearshtml+="<\/select>",c+=n.yearshtml,n.yearshtml=null}return c+=this._get(n,"yearSuffix"),p&&(c+=(f||!(v&&y)?"&#xa0;":"")+l),c+"<\/div>"},_adjustInstDate:function(n,t,i){var u=n.drawYear+(i=="Y"?t:0),f=n.drawMonth+(i=="M"?t:0),e=Math.min(n.selectedDay,this._getDaysInMonth(u,f))+(i=="D"?t:0),r=this._restrictMinMax(n,this._daylightSavingAdjust(new Date(u,f,e)));n.selectedDay=r.getDate(),n.drawMonth=n.selectedMonth=r.getMonth(),n.drawYear=n.selectedYear=r.getFullYear(),(i=="M"||i=="Y")&&this._notifyChange(n)},_restrictMinMax:function(n,t){var i=this._getMinMaxDate(n,"min"),r=this._getMinMaxDate(n,"max"),u=i&&t<i?i:t;return r&&u>r?r:u},_notifyChange:function(n){var t=this._get(n,"onChangeMonthYear");t&&t.apply(n.input?n.input[0]:null,[n.selectedYear,n.selectedMonth+1,n])},_getNumberOfMonths:function(n){var t=this._get(n,"numberOfMonths");return t==null?[1,1]:typeof t=="number"?[1,t]:t},_getMinMaxDate:function(n,t){return this._determineDate(n,this._get(n,t+"Date"),null)},_getDaysInMonth:function(n,t){return 32-this._daylightSavingAdjust(new Date(n,t,32)).getDate()},_getFirstDayOfMonth:function(n,t){return new Date(n,t,1).getDay()},_canAdjustMonth:function(n,t,i,r){var f=this._getNumberOfMonths(n),u=this._daylightSavingAdjust(new Date(i,r+(t<0?t:f[0]*f[1]),1));return t<0&&u.setDate(this._getDaysInMonth(u.getFullYear(),u.getMonth())),this._isInRange(n,u)},_isInRange:function(n,t){var i=this._getMinMaxDate(n,"min"),r=this._getMinMaxDate(n,"max");return(!i||t.getTime()>=i.getTime())&&(!r||t.getTime()<=r.getTime())},_getFormatConfig:function(n){var t=this._get(n,"shortYearCutoff");return t=typeof t!="string"?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(n,"dayNamesShort"),dayNames:this._get(n,"dayNames"),monthNamesShort:this._get(n,"monthNamesShort"),monthNames:this._get(n,"monthNames")}},_formatDate:function(n,t,i,r){t||(n.currentDay=n.selectedDay,n.currentMonth=n.selectedMonth,n.currentYear=n.selectedYear);var u=t?typeof t=="object"?t:this._daylightSavingAdjust(new Date(r,i,t)):this._daylightSavingAdjust(new Date(n.currentYear,n.currentMonth,n.currentDay));return this.formatDate(this._get(n,"dateFormat"),u,this._getFormatConfig(n))}}),n.fn.datepicker=function(t){if(!this.length)return this;n.datepicker.initialized||(n(document).mousedown(n.datepicker._checkExternalClick).find(document.body).append(n.datepicker.dpDiv),n.datepicker.initialized=!0);var i=Array.prototype.slice.call(arguments,1);return typeof t=="string"&&(t=="isDisabled"||t=="getDate"||t=="widget")?n.datepicker["_"+t+"Datepicker"].apply(n.datepicker,[this[0]].concat(i)):t=="option"&&arguments.length==2&&typeof arguments[1]=="string"?n.datepicker["_"+t+"Datepicker"].apply(n.datepicker,[this[0]].concat(i)):this.each(function(){typeof t=="string"?n.datepicker["_"+t+"Datepicker"].apply(n.datepicker,[this].concat(i)):n.datepicker._attachDatepicker(this,t)})},n.datepicker=new e,n.datepicker.initialized=!1,n.datepicker.uuid=(new Date).getTime(),n.datepicker.version="1.9.0",window["DP_jQuery_"+r]=n}(n),function(n,t){var i="ui-dialog ui-widget ui-widget-content ui-corner-all ",r={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},u={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};n.widget("ui.dialog",{version:"1.9.0",options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=n(this).css(t).offset().top;i<0&&n(this).css("top",t.top-i)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),typeof this.originalTitle!="string"&&(this.originalTitle=""),this.oldPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.options.title=this.options.title||this.originalTitle;var f=this,t=this.options,o=t.title||"&#160;",r=(this.uiDialog=n("<div>")).addClass(i+t.dialogClass).css({display:"none",outline:0,zIndex:t.zIndex}).attr("tabIndex",-1).keydown(function(i){t.closeOnEscape&&!i.isDefaultPrevented()&&i.keyCode&&i.keyCode===n.ui.keyCode.ESCAPE&&(f.close(i),i.preventDefault())}).mousedown(function(n){f.moveToTop(!1,n)}).appendTo("body"),c=this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(r),u=(this.uiDialogTitlebar=n("<div>")).addClass("ui-dialog-titlebar  ui-widget-header  ui-corner-all  ui-helper-clearfix").prependTo(r),e=n("<a href='#'><\/a>").addClass("ui-dialog-titlebar-close  ui-corner-all").attr("role","button").click(function(n){n.preventDefault(),f.close(n)}).appendTo(u),l=(this.uiDialogTitlebarCloseText=n("<span>")).addClass("ui-icon ui-icon-closethick").text(t.closeText).appendTo(e),s=n("<span>").uniqueId().addClass("ui-dialog-title").html(o).prependTo(u),h=(this.uiDialogButtonPane=n("<div>")).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),a=(this.uiButtonSet=n("<div>")).addClass("ui-dialog-buttonset").appendTo(h);r.attr({role:"dialog","aria-labelledby":s.attr("id")}),u.find("*").add(u).disableSelection(),this._hoverable(e),this._focusable(e),t.draggable&&n.fn.draggable&&this._makeDraggable(),t.resizable&&n.fn.resizable&&this._makeResizable(),this._createButtons(t.buttons),this._isOpen=!1,n.fn.bgiframe&&r.bgiframe(),this._on(r,{keydown:function(i){if(t.modal&&i.keyCode===n.ui.keyCode.TAB){var u=n(":tabbable",r),f=u.filter(":first"),e=u.filter(":last");if(i.target!==e[0]||i.shiftKey){if(i.target===f[0]&&i.shiftKey)return e.focus(1),!1}else return f.focus(1),!1}}})},_init:function(){this.options.autoOpen&&this.open()},_destroy:function(){var n,t=this.oldPosition;this.overlay&&this.overlay.destroy(),this.uiDialog.hide(),this.element.removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),n=t.parent.children().eq(t.index),n.length&&n[0]!==this.element[0]?n.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},close:function(t){var u=this,i,r;if(this._isOpen)return!1===this._trigger("beforeClose",t)?void 0:(this._isOpen=!1,this.overlay&&this.overlay.destroy(),this.options.hide?this.uiDialog.hide(this.options.hide,function(){u._trigger("close",t)}):(this.uiDialog.hide(),this._trigger("close",t)),n.ui.dialog.overlay.resize(),this.options.modal&&(i=0,n(".ui-dialog").each(function(){this!==u.uiDialog[0]&&(r=n(this).css("z-index"),isNaN(r)||(i=Math.max(i,r)))}),n.ui.dialog.maxZ=i),this)},isOpen:function(){return this._isOpen},moveToTop:function(t,i){var r=this.options,u;return r.modal&&!t||!r.stack&&!r.modal?this._trigger("focus",i):(r.zIndex>n.ui.dialog.maxZ&&(n.ui.dialog.maxZ=r.zIndex),this.overlay&&(n.ui.dialog.maxZ+=1,n.ui.dialog.overlay.maxZ=n.ui.dialog.maxZ,this.overlay.$el.css("z-index",n.ui.dialog.overlay.maxZ)),u={scrollTop:this.element.scrollTop(),scrollLeft:this.element.scrollLeft()},n.ui.dialog.maxZ+=1,this.uiDialog.css("z-index",n.ui.dialog.maxZ),this.element.attr(u),this._trigger("focus",i),this)},open:function(){if(!this._isOpen){var t,i=this.options,r=this.uiDialog;return this._size(),this._position(i.position),r.show(i.show),this.overlay=i.modal?new n.ui.dialog.overlay(this):null,this.moveToTop(!0),t=this.element.find(":tabbable"),t.length||(t=this.uiDialogButtonPane.find(":tabbable"),t.length||(t=r)),t.eq(0).focus(),this._isOpen=!0,this._trigger("open"),this}},_createButtons:function(t){var i=this,r=!1;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),typeof t=="object"&&t!==null&&n.each(t,function(){return!(r=!0)}),r?(n.each(t,function(t,r){r=n.isFunction(r)?{click:r,text:t}:r;var u=n("<button type='button'>").attr(r,!0).unbind("click").click(function(){r.click.apply(i.element[0],arguments)}).appendTo(i.uiButtonSet);n.fn.button&&u.button()}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog)):this.uiDialog.removeClass("ui-dialog-buttons")},_makeDraggable:function(){function i(n){return{position:n.position,offset:n.offset}}var t=this,r=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(r,u){n(this).addClass("ui-dialog-dragging"),t._trigger("dragStart",r,i(u))},drag:function(n,r){t._trigger("drag",n,i(r))},stop:function(u,f){r.position=[f.position.left-t.document.scrollLeft(),f.position.top-t.document.scrollTop()],n(this).removeClass("ui-dialog-dragging"),t._trigger("dragStop",u,i(f)),n.ui.dialog.overlay.resize()}})},_makeResizable:function(i){function f(n){return{originalPosition:n.originalPosition,originalSize:n.originalSize,position:n.position,size:n.size}}i=i===t?this.options.resizable:i;var u=this,r=this.options,e=this.uiDialog.css("position"),o=typeof i=="string"?i:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:r.maxWidth,maxHeight:r.maxHeight,minWidth:r.minWidth,minHeight:this._minHeight(),handles:o,start:function(t,i){n(this).addClass("ui-dialog-resizing"),u._trigger("resizeStart",t,f(i))},resize:function(n,t){u._trigger("resize",n,f(t))},stop:function(t,i){n(this).removeClass("ui-dialog-resizing"),r.height=n(this).height(),r.width=n(this).width(),u._trigger("resizeStop",t,f(i)),n.ui.dialog.overlay.resize()}}).css("position",e).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var n=this.options;return n.height==="auto"?n.minHeight:Math.min(n.minHeight,n.height)},_position:function(t){var i=[],u=[0,0],r;t?((typeof t=="string"||typeof t=="object"&&"0"in t)&&(i=t.split?t.split(" "):[t[0],t[1]],i.length===1&&(i[1]=i[0]),n.each(["left","top"],function(n,t){+i[n]===i[n]&&(u[n]=i[n],i[n]=t)}),t={my:i.join(" "),at:i.join(" "),offset:u.join(" ")}),t=n.extend({},n.ui.dialog.prototype.options.position,t)):t=n.ui.dialog.prototype.options.position,r=this.uiDialog.is(":visible"),r||this.uiDialog.show(),this.uiDialog.position(t),r||this.uiDialog.hide()},_setOptions:function(t){var e=this,i={},f=!1;n.each(t,function(n,t){e._setOption(n,t),n in r&&(f=!0),n in u&&(i[n]=t)}),f&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",i)},_setOption:function(t,r){var e,f,u=this.uiDialog;switch(t){case"buttons":this._createButtons(r);break;case"closeText":this.uiDialogTitlebarCloseText.text(""+r);break;case"dialogClass":u.removeClass(this.options.dialogClass).addClass(i+r);break;case"disabled":r?u.addClass("ui-dialog-disabled"):u.removeClass("ui-dialog-disabled");break;case"draggable":e=u.is(":data(draggable)"),e&&!r&&u.draggable("destroy"),!e&&r&&this._makeDraggable();break;case"position":this._position(r);break;case"resizable":f=u.is(":data(resizable)"),f&&!r&&u.resizable("destroy"),f&&typeof r=="string"&&u.resizable("option","handles",r),f||r===!1||this._makeResizable(r);break;case"title":n(".ui-dialog-title",this.uiDialogTitlebar).html(""+(r||"&#160;"))}this._super(t,r)},_size:function(){var i,r,u,t=this.options,f=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0}),t.minWidth>t.width&&(t.width=t.minWidth),i=this.uiDialog.css({height:"auto",width:t.width}).outerHeight(),r=Math.max(0,t.minHeight-i),t.height==="auto"?n.support.minHeight?this.element.css({minHeight:r,height:"auto"}):(this.uiDialog.show(),u=this.element.css("height","auto").height(),f||this.uiDialog.hide(),this.element.height(Math.max(u,r))):this.element.height(Math.max(t.height-i,0)),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),n.extend(n.ui.dialog,{uuid:0,maxZ:0,getTitleId:function(n){var t=n.attr("id");return t||(this.uuid+=1,t=this.uuid),"ui-dialog-title-"+t},overlay:function(t){this.$el=n.ui.dialog.overlay.create(t)}}),n.extend(n.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:n.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(n){return n+".dialog-overlay"}).join(" "),create:function(t){this.instances.length===0&&(setTimeout(function(){n.ui.dialog.overlay.instances.length&&n(document).bind(n.ui.dialog.overlay.events,function(t){if(n(t.target).zIndex()<n.ui.dialog.overlay.maxZ)return!1})},1),n(window).bind("resize.dialog-overlay",n.ui.dialog.overlay.resize));var i=this.oldInstances.pop()||n("<div>").addClass("ui-widget-overlay");return n(document).bind("keydown.dialog-overlay",function(r){var u=n.ui.dialog.overlay.instances;u.length!==0&&u[u.length-1]===i&&t.options.closeOnEscape&&!r.isDefaultPrevented()&&r.keyCode&&r.keyCode===n.ui.keyCode.ESCAPE&&(t.close(r),r.preventDefault())}),i.appendTo(document.body).css({width:this.width(),height:this.height()}),n.fn.bgiframe&&i.bgiframe(),this.instances.push(i),i},destroy:function(t){var r=n.inArray(t,this.instances),i=0;r!==-1&&this.oldInstances.push(this.instances.splice(r,1)[0]),this.instances.length===0&&n([document,window]).unbind(".dialog-overlay"),t.height(0).width(0).remove(),n.each(this.instances,function(){i=Math.max(i,this.css("z-index"))}),this.maxZ=i},height:function(){var t,i;return n.browser.msie?(t=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),i=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),t<i?n(window).height()+"px":t+"px"):n(document).height()+"px"},width:function(){var t,i;return n.browser.msie?(t=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),i=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),t<i?n(window).width()+"px":t+"px"):n(document).width()+"px"},resize:function(){var t=n([]);n.each(n.ui.dialog.overlay.instances,function(){t=t.add(this)}),t.css({width:0,height:0}).css({width:n.ui.dialog.overlay.width(),height:n.ui.dialog.overlay.height()})}}),n.extend(n.ui.dialog.overlay.prototype,{destroy:function(){n.ui.dialog.overlay.destroy(this.$el)}})}(n),function(n){var t=!1;n.widget("ui.menu",{version:"1.9.0",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,n.proxy(function(n){this.options.disabled&&n.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(n){n.preventDefault()},"click .ui-state-disabled > a":function(n){n.preventDefault()},"click .ui-menu-item:has(a)":function(i){var r=n(i.target).closest(".ui-menu-item");!t&&r.not(".ui-state-disabled").length&&(t=!0,this.select(i),r.has(".ui-menu").length?this.expand(i):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&this.active.parents(".ui-menu").length===1&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){var i=n(t.currentTarget);i.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(n,t){var i=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(n,i)},blur:function(t){this._delay(function(){n.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(i){n(i.target).closest(".ui-menu").length||this.collapseAll(i),t=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=n(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){function s(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var i,f,r,e,u,o=!0;switch(t.keyCode){case n.ui.keyCode.PAGE_UP:this.previousPage(t);break;case n.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case n.ui.keyCode.HOME:this._move("first","first",t);break;case n.ui.keyCode.END:this._move("last","last",t);break;case n.ui.keyCode.UP:this.previous(t);break;case n.ui.keyCode.DOWN:this.next(t);break;case n.ui.keyCode.LEFT:this.collapse(t);break;case n.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case n.ui.keyCode.ENTER:case n.ui.keyCode.SPACE:this._activate(t);break;case n.ui.keyCode.ESCAPE:this.collapse(t);break;default:o=!1,f=this.previousFilter||"",r=String.fromCharCode(t.keyCode),e=!1,clearTimeout(this.filterTimer),r===f?e=!0:r=f+r,u=new RegExp("^"+s(r),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return u.test(n(this).children("a").text())}),i=e&&i.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):i,i.length||(r=String.fromCharCode(t.keyCode),u=new RegExp("^"+s(r),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return u.test(n(this).children("a").text())})),i.length?(this.focus(t,i),i.length>1?(this.previousFilter=r,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}o&&t.preventDefault()},_activate:function(n){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(n):this.select(n))},refresh:function(){var t,r=this.options.icons.submenu,i=this.element.find(this.options.menus+":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"});t=i.add(this.element),t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each(function(){var t=n(this);/[^\-—–\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider")}),t.children(".ui-state-disabled").attr("aria-disabled","true"),i.each(function(){var t=n(this),i=t.prev("a"),u=n("<span>").addClass("ui-menu-icon ui-icon "+r).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(u),t.attr("aria-labelledby",i.attr("id"))}),this.active&&!n.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},focus:function(n,t){var i,r;this.blur(n,n&&n.type==="focus"),this._scrollIntoView(t),this.active=t.first(),r=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",r.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),n&&n.type==="keydown"?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=t.children(".ui-menu"),i.length&&/^mouse/.test(n.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",n,{item:t})},_scrollIntoView:function(t){var e,o,i,r,u,f;this._hasScroll()&&(e=parseFloat(n.css(this.activeMenu[0],"borderTopWidth"))||0,o=parseFloat(n.css(this.activeMenu[0],"paddingTop"))||0,i=t.offset().top-this.activeMenu.offset().top-e-o,r=this.activeMenu.scrollTop(),u=this.activeMenu.height(),f=t.height(),i<0?this.activeMenu.scrollTop(r+i):i+f>u&&this.activeMenu.scrollTop(r+i-u+f))},blur:function(n,t){(t||clearTimeout(this.timer),this.active)&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",n,{item:this.active}))},_startOpening:function(n){(clearTimeout(this.timer),n.attr("aria-hidden")==="true")&&(this.timer=this._delay(function(){this._close(),this._open(n)},this.delay))},_open:function(t){var i=n.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var r=i?this.element:n(t&&t.target).closest(this.element.find(".ui-menu"));r.length||(r=this.element),this._close(r),this.blur(t),this.activeMenu=r},this.delay)},_close:function(n){n||(n=this.active?this.active.parent():this.element),n.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(n){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(n,t))},expand:function(n){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(n,t)}))},next:function(n){this._move("next","first",n)},previous:function(n){this._move("prev","last",n)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(n,t,i){var r;this.active&&(r=n==="first"||n==="last"?this.active[n==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[n+"All"](".ui-menu-item").eq(0)),r&&r.length&&this.active||(r=this.activeMenu.children(".ui-menu-item")[t]()),this.focus(i,r)},nextPage:function(t){var i,r,u;if(!this.active){this.next(t);return}this.isLastItem()||(this._hasScroll()?(r=this.active.offset().top,u=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=n(this),i.offset().top-r-u<0}),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]()))},previousPage:function(t){var i,r,u;if(!this.active){this.next(t);return}this.isFirstItem()||(this._hasScroll()?(r=this.active.offset().top,u=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=n(this),i.offset().top-r+u>0}),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item").first()))},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||n(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)}})}(n),function(n,t){n.widget("ui.progressbar",{version:"1.9.0",options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()}),this.valueDiv=n("<div class='ui-progressbar-value ui-widget-header ui-corner-left'><\/div>").appendTo(this.element),this.oldValue=this._value(),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(n){return n===t?this._value():(this._setOption("value",n),this)},_setOption:function(n,t){n==="value"&&(this.options.value=t,this._refreshValue(),this._value()===this.options.max&&this._trigger("complete")),this._super(n,t)},_value:function(){var n=this.options.value;return typeof n!="number"&&(n=0),Math.min(this.options.max,Math.max(this.min,n))},_percentage:function(){return 100*this._value()/this.options.max},_refreshValue:function(){var n=this.value(),t=this._percentage();this.oldValue!==n&&(this.oldValue=n,this._trigger("change")),this.valueDiv.toggle(n>this.min).toggleClass("ui-corner-right",n===this.options.max).width(t.toFixed(0)+"%"),this.element.attr("aria-valuenow",n)}})}(n),function(n){var t=5;n.widget("ui.slider",n.ui.mouse,{version:"1.9.0",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var r,i=this.options,u=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),e=i.values&&i.values.length||1,f=[];for(this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(i.disabled?" ui-slider-disabled ui-disabled":"")),this.range=n([]),i.range&&(i.range===!0&&(i.values||(i.values=[this._valueMin(),this._valueMin()]),i.values.length&&i.values.length!==2&&(i.values=[i.values[0],i.values[0]])),this.range=n("<div><\/div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(i.range==="min"||i.range==="max"?" ui-slider-range-"+i.range:""))),r=u.length;r<e;r++)f.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'><\/a>");this.handles=u.add(n(f.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(n){n.preventDefault()}).mouseenter(function(){i.disabled||n(this).addClass("ui-state-hover")}).mouseleave(function(){n(this).removeClass("ui-state-hover")}).focus(function(){i.disabled?n(this).blur():(n(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),n(this).addClass("ui-state-focus"))}).blur(function(){n(this).removeClass("ui-state-focus")}),this.handles.each(function(t){n(this).data("ui-slider-handle-index",t)}),this._on(this.handles,{keydown:function(i){var o,u,r,f,e=n(i.target).data("ui-slider-handle-index");switch(i.keyCode){case n.ui.keyCode.HOME:case n.ui.keyCode.END:case n.ui.keyCode.PAGE_UP:case n.ui.keyCode.PAGE_DOWN:case n.ui.keyCode.UP:case n.ui.keyCode.RIGHT:case n.ui.keyCode.DOWN:case n.ui.keyCode.LEFT:if(i.preventDefault(),!this._keySliding&&(this._keySliding=!0,n(i.target).addClass("ui-state-active"),o=this._start(i,e),o===!1))return}f=this.options.step,u=this.options.values&&this.options.values.length?r=this.values(e):r=this.value();switch(i.keyCode){case n.ui.keyCode.HOME:r=this._valueMin();break;case n.ui.keyCode.END:r=this._valueMax();break;case n.ui.keyCode.PAGE_UP:r=this._trimAlignValue(u+(this._valueMax()-this._valueMin())/t);break;case n.ui.keyCode.PAGE_DOWN:r=this._trimAlignValue(u-(this._valueMax()-this._valueMin())/t);break;case n.ui.keyCode.UP:case n.ui.keyCode.RIGHT:if(u===this._valueMax())return;r=this._trimAlignValue(u+f);break;case n.ui.keyCode.DOWN:case n.ui.keyCode.LEFT:if(u===this._valueMin())return;r=this._trimAlignValue(u-f)}this._slide(i,e,r)},keyup:function(t){var i=n(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),n(t.target).removeClass("ui-state-active"))}}),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var s,u,f,i,r,h,e,c,l=this,o=this.options;return o.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),s={x:t.pageX,y:t.pageY},u=this._normValueFromMouse(s),f=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var e=Math.abs(u-l.values(t));f>e&&(f=e,i=n(this),r=t)}),o.range===!0&&this.values(1)===o.min&&(r+=1,i=n(this.handles[r])),h=this._start(t,r),h===!1)?!1:(this._mouseSliding=!0,this._handleIndex=r,i.addClass("ui-state-active").focus(),e=i.offset(),c=!n(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=c?{left:0,top:0}:{left:t.pageX-e.left-i.width()/2,top:t.pageY-e.top-i.height()/2-(parseInt(i.css("borderTopWidth"),10)||0)-(parseInt(i.css("borderBottomWidth"),10)||0)+(parseInt(i.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,r,u),this._animateOff=!0,!0)},_mouseStart:function(){return!0},_mouseDrag:function(n){var t={x:n.pageX,y:n.pageY},i=this._normValueFromMouse(t);return this._slide(n,this._handleIndex,i),!1},_mouseStop:function(n){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(n,this._handleIndex),this._change(n,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(n){var i,r,t,u,f;return this.orientation==="horizontal"?(i=this.elementSize.width,r=n.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(i=this.elementSize.height,r=n.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),t=r/i,t>1&&(t=1),t<0&&(t=0),this.orientation==="vertical"&&(t=1-t),u=this._valueMax()-this._valueMin(),f=this._valueMin()+t*u,this._trimAlignValue(f)},_start:function(n,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",n,i)},_slide:function(n,t,i){var r,f,u;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&i>r||t===1&&i<r)&&(i=r),i!==this.values(t)&&(f=this.values(),f[t]=i,u=this._trigger("slide",n,{handle:this.handles[t],value:i,values:f}),r=this.values(t?0:1),u!==!1&&this.values(t,i,!0))):i!==this.value()&&(u=this._trigger("slide",n,{handle:this.handles[t],value:i}),u!==!1&&this.value(i))},_stop:function(n,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",n,i)},_change:function(n,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("change",n,i)}},value:function(n){if(arguments.length){this.options.value=this._trimAlignValue(n),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(t,i){var u,f,r;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t);return}if(arguments.length)if(n.isArray(arguments[0])){for(u=this.options.values,f=arguments[0],r=0;r<u.length;r+=1)u[r]=this._trimAlignValue(f[r]),this._change(null,r);this._refreshValue()}else return this.options.values&&this.options.values.length?this._values(t):this.value();else return this._values()},_setOption:function(t,i){var r,u=0;n.isArray(this.options.values)&&(u=this.options.values.length),n.Widget.prototype._setOption.apply(this,arguments);switch(t){case"disabled":i?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),r=0;r<u;r+=1)this._change(null,r);this._animateOff=!1}},_value:function(){var n=this.options.value;return this._trimAlignValue(n)},_values:function(n){var r,t,i;if(arguments.length)return r=this.options.values[n],this._trimAlignValue(r);for(t=this.options.values.slice(),i=0;i<t.length;i+=1)t[i]=this._trimAlignValue(t[i]);return t},_trimAlignValue:function(n){if(n<=this._valueMin())return this._valueMin();if(n>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(n-this._valueMin())%t,r=n-i;return Math.abs(i)*2>=t&&(r+=i>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var s,t,c,f,h,e=this.options.range,i=this.options,r=this,u=this._animateOff?!1:i.animate,o={};this.options.values&&this.options.values.length?this.handles.each(function(f){t=(r.values(f)-r._valueMin())/(r._valueMax()-r._valueMin())*100,o[r.orientation==="horizontal"?"left":"bottom"]=t+"%",n(this).stop(1,1)[u?"animate":"css"](o,i.animate),r.options.range===!0&&(r.orientation==="horizontal"?(f===0&&r.range.stop(1,1)[u?"animate":"css"]({left:t+"%"},i.animate),f===1&&r.range[u?"animate":"css"]({width:t-s+"%"},{queue:!1,duration:i.animate})):(f===0&&r.range.stop(1,1)[u?"animate":"css"]({bottom:t+"%"},i.animate),f===1&&r.range[u?"animate":"css"]({height:t-s+"%"},{queue:!1,duration:i.animate}))),s=t}):(c=this.value(),f=this._valueMin(),h=this._valueMax(),t=h!==f?(c-f)/(h-f)*100:0,o[this.orientation==="horizontal"?"left":"bottom"]=t+"%",this.handle.stop(1,1)[u?"animate":"css"](o,i.animate),e==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[u?"animate":"css"]({width:t+"%"},i.animate),e==="max"&&this.orientation==="horizontal"&&this.range[u?"animate":"css"]({width:100-t+"%"},{queue:!1,duration:i.animate}),e==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[u?"animate":"css"]({height:t+"%"},i.animate),e==="max"&&this.orientation==="vertical"&&this.range[u?"animate":"css"]({height:100-t+"%"},{queue:!1,duration:i.animate}))}})}(n),function(n){function t(n){return function(){var t=this.element.val();n.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}n.widget("ui.spinner",{version:"1.9.0",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},i=this.element;return n.each(["min","max","step"],function(n,r){var u=i.attr(r);u!==undefined&&u.length&&(t[r]=u)}),t},_events:{keydown:function(n){this._start(n)&&this._keydown(n)&&n.preventDefault()},keyup:"_stop",focus:function(){this.uiSpinner.addClass("ui-state-active"),this.previous=this.element.val()},blur:function(n){if(this.cancelBlur){delete this.cancelBlur;return}this._refresh(),this.uiSpinner.removeClass("ui-state-active"),this.previous!==this.element.val()&&this._trigger("change",n)},mousewheel:function(n,t){if(t){if(!this.spinning&&!this._start(n))return!1;this._spin((t>0?1:-1)*this.options.step,n),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(n)},100),n.preventDefault()}},"mousedown .ui-spinner-button":function(t){function r(){var n=this.element[0]===this.document[0].activeElement;n||(this.element.focus(),this.previous=i,this._delay(function(){this.previous=i}))}var i;(i=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),r.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,r.call(this)}),this._start(t)!==!1)&&this._repeat(null,n(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){if(n(t.currentTarget).hasClass("ui-state-active")){if(this._start(t)===!1)return!1;this._repeat(null,n(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)}},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var n=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this._hoverable(n),this.element.attr("role","spinbutton"),this.buttons=n.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(n.height()*.5)&&n.height()>0&&n.height(n.height()),this.options.disabled&&this.disable()},_keydown:function(t){var r=this.options,i=n.ui.keyCode;switch(t.keyCode){case i.UP:return this._repeat(null,1,t),!0;case i.DOWN:return this._repeat(null,-1,t),!0;case i.PAGE_UP:return this._repeat(null,r.page,t),!0;case i.PAGE_DOWN:return this._repeat(null,-r.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-state-default ui-widget ui-widget-content ui-corner-all'><\/span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;<\/span><\/a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;<\/span><\/a>"},_start:function(n){return!this.spinning&&this._trigger("start",n)===!1?!1:(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(n,t,i){n=n||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},n),this._spin(t*this.options.step,i)},_spin:function(n,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+n*this._increment(this.counter)),this.spinning&&this._trigger("spin",t,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?n.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var n=this._precisionOf(this.options.step);return this.options.min!==null&&(n=Math.max(n,this._precisionOf(this.options.min))),n},_precisionOf:function(n){var t=n.toString(),i=t.indexOf(".");return i===-1?0:t.length-i-1},_adjustValue:function(n){var r,i,t=this.options;return(r=t.min!==null?t.min:0,i=n-r,i=Math.round(i/t.step)*t.step,n=r+i,n=parseFloat(n.toFixed(this._precision())),t.max!==null&&n>t.max)?t.max:t.min!==null&&n<t.min?t.min:n},_stop:function(n){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",n))},_setOption:function(n,t){if(n==="culture"||n==="numberFormat"){var i=this._parse(this.element.val());this.options[n]=t,this.element.val(this._format(i));return}(n==="max"||n==="min"||n==="step")&&typeof t=="string"&&(t=this._parse(t)),this._super(n,t),n==="disabled"&&(t?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:t(function(n){this._super(n),this._value(this.element.val())}),_parse:function(n){return typeof n=="string"&&n!==""&&(n=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(n,10,this.options.culture):+n),n===""||isNaN(n)?null:n},_format:function(n){return n===""?"":window.Globalize&&this.options.numberFormat?Globalize.format(n,this.options.numberFormat,this.options.culture):n},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(n,t){var i;n!==""&&(i=this._parse(n),i!==null&&(t||(i=this._adjustValue(i)),n=this._format(i))),this.element.val(n),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:t(function(n){this._stepUp(n)}),_stepUp:function(n){this._spin((n||1)*this.options.step)},stepDown:t(function(n){this._stepDown(n)}),_stepDown:function(n){this._spin((n||1)*-this.options.step)},pageUp:t(function(n){this._stepUp((n||1)*this.options.page)}),pageDown:t(function(n){this._stepDown((n||1)*this.options.page)}),value:function(n){if(!arguments.length)return this._parse(this.element.val());t(this._value).call(this,n)},widget:function(){return this.uiSpinner}})}(n),function(n,t){function r(){return++f}function u(n){return n=n.cloneNode(!1),n.hash.length>1&&n.href.replace(i,"")===location.href.replace(i,"")}var f=0,i=/#.*$/;n.widget("ui.tabs",{version:"1.9.0",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var r=this,i=this.options,t=i.active;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(t){n(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){n(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),t===null&&(location.hash&&this.anchors.each(function(n,i){if(i.hash===location.hash)return t=n,!1}),t===null&&(t=this.tabs.filter(".ui-tabs-active").index()),(t===null||t===-1)&&(t=this.tabs.length?0:!1)),t!==!1&&(t=this.tabs.index(this.tabs.eq(t)),t===-1&&(t=i.collapsible?!1:0)),i.active=t,!i.collapsible&&i.active===!1&&this.anchors.length&&(i.active=0),n.isArray(i.disabled)&&(i.disabled=n.unique(i.disabled.concat(n.map(this.tabs.filter(".ui-state-disabled"),function(n){return r.tabs.index(n)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(this.options.active):n(),this._refresh(),this.active.length&&this.load(i.active)},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):n()}},_tabKeydown:function(t){var r=n(this.document[0].activeElement).closest("li"),i=this.tabs.index(r),u=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case n.ui.keyCode.RIGHT:case n.ui.keyCode.DOWN:i++;break;case n.ui.keyCode.UP:case n.ui.keyCode.LEFT:u=!1,i--;break;case n.ui.keyCode.END:i=this.anchors.length-1;break;case n.ui.keyCode.HOME:i=0;break;case n.ui.keyCode.SPACE:t.preventDefault(),clearTimeout(this.activating),this._activate(i);return;case n.ui.keyCode.ENTER:t.preventDefault(),clearTimeout(this.activating),this._activate(i===this.options.active?!1:i);return;default:return}t.preventDefault(),clearTimeout(this.activating),i=this._focusNextTab(i,u),t.ctrlKey||(r.attr("aria-selected","false"),this.tabs.eq(i).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",i)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===n.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===n.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===n.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){function u(){return t>r&&(t=0),t<0&&(t=r),t}for(var r=this.tabs.length-1;n.inArray(u(),this.options.disabled)!==-1;)t=i?t+1:t-1;return t},_focusNextTab:function(n,t){return n=this._findNextTab(n,t),this.tabs.eq(n).focus(),n},_setOption:function(n,t){if(n==="active"){this._activate(t);return}if(n==="disabled"){this._setupDisabled(t);return}this._super(n,t),n==="collapsible"&&(this.element.toggleClass("ui-tabs-collapsible",t),t||this.options.active!==!1||this._activate(0)),n==="event"&&this._setupEvents(t),n==="heightStyle"&&this._setupHeightStyle(t)},_tabId:function(n){return n.attr("aria-controls")||"ui-tabs-"+r()},_sanitizeSelector:function(n){return n?n.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=n.map(i.filter(".ui-state-disabled"),function(n){return i.index(n)}),this._processTabs(),t.active!==!1&&this.anchors.length?this.active.length&&!n.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=n()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=n()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return n("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=n(),this.anchors.each(function(i,r){var e,f,s,h=n(r).uniqueId().attr("id"),o=n(r).closest("li"),c=o.attr("aria-controls");u(r)?(e=r.hash,f=t.element.find(t._sanitizeSelector(e))):(s=t._tabId(o),e="#"+s,f=t.element.find(e),f.length||(f=t._createPanel(s),f.insertAfter(t.panels[i-1]||t.tablist)),f.attr("aria-live","polite")),f.length&&(t.panels=t.panels.add(f)),c&&o.data("ui-tabs-aria-controls",c),o.attr({"aria-controls":e.substring(1),"aria-labelledby":h}),f.attr("aria-labelledby",h)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(t){return n("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){n.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i=0,r;r=this.tabs[i];i++)t===!0||n.inArray(i,t)!==-1?n(r).addClass("ui-state-disabled").attr("aria-disabled","true"):n(r).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var i={click:function(n){n.preventDefault()}};t&&n.each(t.split(" "),function(n,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,u,r=this.element.parent();t==="fill"?(n.support.minHeight||(u=r.css("overflow"),r.css("overflow","hidden")),i=r.height(),this.element.siblings(":visible").each(function(){var t=n(this),r=t.css("position");r!=="absolute"&&r!=="fixed"&&(i-=t.outerHeight(!0))}),u&&r.css("overflow",u),this.element.children().not(this.panels).each(function(){i-=n(this).outerHeight(!0)}),this.panels.each(function(){n(this).height(Math.max(0,i-n(this).innerHeight()+n(this).height()))}).css("overflow","auto")):t==="auto"&&(i=0,this.panels.each(function(){i=Math.max(i,n(this).height("").height())}).height(i))},_eventHandler:function(t){var u=this.options,r=this.active,c=n(t.currentTarget),i=c.closest("li"),f=i[0]===r[0],e=f&&u.collapsible,o=e?n():this._getPanelForTab(i),s=r.length?this._getPanelForTab(r):n(),h={oldTab:r,oldPanel:s,newTab:e?n():i,newPanel:o};(t.preventDefault(),i.hasClass("ui-state-disabled")||i.hasClass("ui-tabs-loading")||this.running||f&&!u.collapsible||this._trigger("beforeActivate",t,h)===!1)||(u.active=e?!1:this.tabs.index(i),this.active=f?n():i,this.xhr&&this.xhr.abort(),s.length||o.length||n.error("jQuery UI Tabs: Mismatching fragment identifier."),o.length&&this.load(this.tabs.index(i),t),this._toggle(t,h))},_toggle:function(t,i){function e(){u.running=!1,u._trigger("activate",t,i)}function o(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),r.length&&u.options.show?u._show(r,u.options.show,e):(r.show(),e())}var u=this,r=i.newPanel,f=i.oldPanel;this.running=!0,f.length&&this.options.hide?this._hide(f,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),o()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),f.hide(),o()),f.attr({"aria-expanded":"false","aria-hidden":"true"}),i.oldTab.attr("aria-selected","false"),r.length&&f.length?i.oldTab.attr("tabIndex",-1):r.length&&this.tabs.filter(function(){return n(this).attr("tabIndex")===0}).attr("tabIndex",-1),r.attr({"aria-expanded":"true","aria-hidden":"false"}),i.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(t){var r,i=this._findActive(t);i[0]!==this.active[0]&&(i.length||(i=this.active),r=i.find(".ui-tabs-anchor")[0],this._eventHandler({target:r,currentTarget:r,preventDefault:n.noop}))},_findActive:function(t){return t===!1?n():this.tabs.eq(t)},_getIndex:function(n){return typeof n=="string"&&(n=this.anchors.index(this.anchors.filter("[href$='"+n+"']"))),n},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeData("href.tabs").removeData("load.tabs").removeUniqueId(),this.tabs.add(this.panels).each(function(){n.data(this,"ui-tabs-destroy")?n(this).remove():n(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=n(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i):t.removeAttr("aria-controls")}),this.options.heightStyle!=="content"&&this.panels.css("height","")},enable:function(i){var r=this.options.disabled;r!==!1&&(i===t?r=!1:(i=this._getIndex(i),r=n.isArray(r)?n.map(r,function(n){return n!==i?n:null}):n.map(this.tabs,function(n,t){return t!==i?t:null})),this._setupDisabled(r))},disable:function(i){var r=this.options.disabled;if(r!==!0){if(i===t)r=!0;else{if(i=this._getIndex(i),n.inArray(i,r)!==-1)return;r=n.isArray(r)?n.merge([i],r).sort():[i]}this._setupDisabled(r)}},load:function(t,i){t=this._getIndex(t);var f=this,r=this.tabs.eq(t),o=r.find(".ui-tabs-anchor"),e=this._getPanelForTab(r),s={tab:r,panel:e};u(o[0])||(this.xhr=n.ajax(this._ajaxSettings(o,i,s)),this.xhr&&this.xhr.statusText!=="canceled"&&(r.addClass("ui-tabs-loading"),e.attr("aria-busy","true"),this.xhr.success(function(n){setTimeout(function(){e.html(n),f._trigger("load",i,s)},1)}).complete(function(n,t){setTimeout(function(){t==="abort"&&f.panels.stop(!1,!0),r.removeClass("ui-tabs-loading"),e.removeAttr("aria-busy"),n===f.xhr&&delete f.xhr},1)})))},_ajaxSettings:function(t,i,r){var u=this;return{url:t.attr("href"),beforeSend:function(t,f){return u._trigger("beforeLoad",i,n.extend({jqXHR:t,ajaxSettings:f},r))}}},_getPanelForTab:function(t){var i=n(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),n.uiBackCompat!==!1&&(n.ui.tabs.prototype._ui=function(n,t){return{tab:n,panel:t,index:this.anchors.index(n)}},n.widget("ui.tabs",n.ui.tabs,{url:function(n,t){this.anchors.eq(n).attr("href",t)}}),n.widget("ui.tabs",n.ui.tabs,{options:{ajaxOptions:null,cache:!1},_create:function(){this._super();var t=this;this._on({tabsbeforeload:function(i,r){if(n.data(r.tab[0],"cache.tabs")){i.preventDefault();return}r.jqXHR.success(function(){t.options.cache&&n.data(r.tab[0],"cache.tabs",!0)})}})},_ajaxSettings:function(t,i,r){var u=this.options.ajaxOptions;return n.extend({},u,{error:function(n,t){try{u.error(n,t,r.tab.closest("li").index(),r.tab[0])}catch(e){}}},this._superApply(arguments))},_setOption:function(n,t){n==="cache"&&t===!1&&this.anchors.removeData("cache.tabs"),this._super(n,t)},_destroy:function(){this.anchors.removeData("cache.tabs"),this._super()},url:function(n){this.anchors.eq(n).removeData("cache.tabs"),this._superApply(arguments)}}),n.widget("ui.tabs",n.ui.tabs,{abort:function(){this.xhr&&this.xhr.abort()}}),n.widget("ui.tabs",n.ui.tabs,{options:{spinner:"<em>Loading&#8230;<\/em>"},_create:function(){this._super(),this._on({tabsbeforeload:function(n,t){if(n.target===this.element[0]&&this.options.spinner){var i=t.tab.find("span"),r=i.html();i.html(this.options.spinner),t.jqXHR.complete(function(){i.html(r)})}}})}}),n.widget("ui.tabs",n.ui.tabs,{options:{enable:null,disable:null},enable:function(t){var i=this.options,r;(t&&i.disabled===!0||n.isArray(i.disabled)&&n.inArray(t,i.disabled)!==-1)&&(r=!0),this._superApply(arguments),r&&this._trigger("enable",null,this._ui(this.anchors[t],this.panels[t]))},disable:function(t){var i=this.options,r;(t&&i.disabled===!1||n.isArray(i.disabled)&&n.inArray(t,i.disabled)===-1)&&(r=!0),this._superApply(arguments),r&&this._trigger("disable",null,this._ui(this.anchors[t],this.panels[t]))}}),n.widget("ui.tabs",n.ui.tabs,{options:{add:null,remove:null,tabTemplate:"<li><a href='#{href}'><span>#{label}<\/span><\/a><\/li>"},add:function(i,r,u){u===t&&(u=this.anchors.length);var s,f,o=this.options,e=n(o.tabTemplate.replace(/#\{href\}/g,i).replace(/#\{label\}/g,r)),h=i.indexOf("#")?this._tabId(e):i.replace("#","");return e.addClass("ui-state-default ui-corner-top").data("ui-tabs-destroy",!0),e.attr("aria-controls",h),s=u>=this.tabs.length,f=this.element.find("#"+h),f.length||(f=this._createPanel(h),s?u>0?f.insertAfter(this.panels.eq(-1)):f.appendTo(this.element):f.insertBefore(this.panels[u])),f.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").hide(),s?e.appendTo(this.tablist):e.insertBefore(this.tabs[u]),o.disabled=n.map(o.disabled,function(n){return n>=u?++n:n}),this.refresh(),this.tabs.length===1&&o.active===!1&&this.option("active",0),this._trigger("add",null,this._ui(this.anchors[u],this.panels[u])),this},remove:function(t){t=this._getIndex(t);var r=this.options,i=this.tabs.eq(t).remove(),u=this._getPanelForTab(i).remove();return i.hasClass("ui-tabs-active")&&this.anchors.length>2&&this._activate(t+(t+1<this.anchors.length?1:-1)),r.disabled=n.map(n.grep(r.disabled,function(n){return n!==t}),function(n){return n>=t?--n:n}),this.refresh(),this._trigger("remove",null,this._ui(i.find("a")[0],u[0])),this}}),n.widget("ui.tabs",n.ui.tabs,{length:function(){return this.anchors.length}}),n.widget("ui.tabs",n.ui.tabs,{options:{idPrefix:"ui-tabs-"},_tabId:function(t){var i=t.is("li")?t.find("a[href]"):t;return i=i[0],n(i).closest("li").attr("aria-controls")||i.title&&i.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF\-]/g,"")||this.options.idPrefix+r()}}),n.widget("ui.tabs",n.ui.tabs,{options:{panelTemplate:"<div><\/div>"},_createPanel:function(t){return n(this.options.panelTemplate).attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)}}),n.widget("ui.tabs",n.ui.tabs,{_create:function(){var n=this.options;n.active===null&&n.selected!==t&&(n.active=n.selected===-1?!1:n.selected),this._super(),n.selected=n.active,n.selected===!1&&(n.selected=-1)},_setOption:function(n,t){if(n!=="selected")return this._super(n,t);var i=this.options;this._super("active",t===-1?!1:t),i.selected=i.active,i.selected===!1&&(i.selected=-1)},_eventHandler:function(){this._superApply(arguments),this.options.selected=this.options.active,this.options.selected===!1&&(this.options.selected=-1)}}),n.widget("ui.tabs",n.ui.tabs,{options:{show:null,select:null},_create:function(){this._super(),this.options.active!==!1&&this._trigger("show",null,this._ui(this.active.find(".ui-tabs-anchor")[0],this._getPanelForTab(this.active)[0]))},_trigger:function(n,t,i){var r=this._superApply(arguments);return r?(n==="beforeActivate"&&i.newTab.length?r=this._super("select",t,{tab:i.newTab.find(".ui-tabs-anchor")[0],panel:i.newPanel[0],index:i.newTab.closest("li").index()}):n==="activate"&&i.newTab.length&&(r=this._super("show",t,{tab:i.newTab.find(".ui-tabs-anchor")[0],panel:i.newPanel[0],index:i.newTab.closest("li").index()})),r):!1}}),n.widget("ui.tabs",n.ui.tabs,{select:function(n){if(n=this._getIndex(n),n===-1)if(this.options.collapsible&&this.options.selected!==-1)n=this.options.selected;else return;this.anchors.eq(n).trigger(this.options.event+this.eventNamespace)}}),function(){var t=0;n.widget("ui.tabs",n.ui.tabs,{options:{cookie:null},_create:function(){var t=this.options,n;t.active==null&&t.cookie&&(n=parseInt(this._cookie(),10),n===-1&&(n=!1),t.active=n),this._super()},_cookie:function(i){var r=[this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+ ++t)];return arguments.length&&(r.push(i===!1?-1:i),r.push(this.options.cookie)),n.cookie.apply(null,r)},_refresh:function(){this._super(),this.options.cookie&&this._cookie(this.options.active,this.options.cookie)},_eventHandler:function(){this._superApply(arguments),this.options.cookie&&this._cookie(this.options.active,this.options.cookie)},_destroy:function(){this._super(),this.options.cookie&&this._cookie(null,this.options.cookie)}})}(),n.widget("ui.tabs",n.ui.tabs,{_trigger:function(t,i,r){var u=n.extend({},r);return t==="load"&&(u.panel=u.panel[0],u.tab=u.tab.find(".ui-tabs-anchor")[0]),this._super(t,i,u)}}),n.widget("ui.tabs",n.ui.tabs,{options:{fx:null},_getFx:function(){var i,r,t=this.options.fx;return t&&(n.isArray(t)?(i=t[0],r=t[1]):i=r=t),t?{show:r,hide:i}:null},_toggle:function(n,t){function e(){r.running=!1,r._trigger("activate",n,t)}function o(){t.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),u.length&&i.show?u.animate(i.show,i.show.duration,function(){e()}):(u.show(),e())}var r=this,u=t.newPanel,f=t.oldPanel,i=this._getFx();if(!i)return this._super(n,t);r.running=!0,f.length&&i.hide?f.animate(i.hide,i.hide.duration,function(){t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),o()}):(t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),f.hide(),o())}}))}(n),function(n){function i(t,i){var r=(t.attr("aria-describedby")||"").split(/\s+/);r.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",n.trim(r.join(" ")))}function r(t){var u=t.data("ui-tooltip-id"),i=(t.attr("aria-describedby")||"").split(/\s+/),r=n.inArray(u,i);r!==-1&&i.splice(r,1),t.removeData("ui-tooltip-id"),i=n.trim(i.join(" ")),i?t.attr("aria-describedby",i):t.removeAttr("aria-describedby")}var t=0;n.widget("ui.tooltip",{version:"1.9.0",options:{content:function(){return n(this).attr("title")},hide:!0,items:"[title]",position:{my:"left+15 center",at:"right center",collision:"flipfit flipfit"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={}},_setOption:function(t,i){var r=this;if(t==="disabled"){this[i?"_disable":"_enable"](),this.options[t]=i;return}this._super(t,i),t==="content"&&n.each(this.tooltips,function(n,t){r._updateContent(t)})},_disable:function(){var t=this;n.each(this.tooltips,function(i,r){var u=n.Event("blur");u.target=u.currentTarget=r[0],t.close(u,!0)}),this.element.find(this.options.items).andSelf().each(function(){var t=n(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var t=n(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=n(t?t.target:this.element).closest(this.options.items);if(i.length){if(this.options.track&&i.data("ui-tooltip-id")){this._find(i).position(n.extend({of:i},this.options.position)),this._off(this.document,"mousemove");return}i.attr("title")&&i.data("ui-tooltip-title",i.attr("title")),i.data("tooltip-open",!0),this._updateContent(i,t)}},_updateContent:function(n,t){var i,r=this.options.content,u=this;if(typeof r=="string")return this._open(t,n,r);i=r.call(n[0],function(i){n.data("tooltip-open")&&u._delay(function(){this._open(t,n,i)})}),i&&this._open(t,n,i)},_open:function(t,r,u){function o(n){e.of=n,f.position(e)}var f,e;if(u){if(f=this._find(r),f.length){f.find(".ui-tooltip-content").html(u);return}r.is("[title]")&&(t&&t.type==="mouseover"?r.attr("title",""):r.removeAttr("title")),f=this._tooltip(r),i(r,f.attr("id")),f.find(".ui-tooltip-content").html(u),this.options.track&&t&&/^mouse/.test(t.originalEvent.type)?(e=n.extend({},this.options.position),this._on(this.document,{mousemove:o}),o(t)):f.position(n.extend({of:r},this.options.position)),f.hide(),this._show(f,this.options.show),this._trigger("open",t,{tooltip:f}),this._on(r,{mouseleave:"close",focusout:"close",keyup:function(t){if(t.keyCode===n.ui.keyCode.ESCAPE){var i=n.Event(t);i.currentTarget=r[0],this.close(i,!0)}}})}},close:function(t,i){var e=this,u=n(t?t.currentTarget:this.element),f=this._find(u);this.closing||(i||!t||t.type==="focusout"||this.document[0].activeElement!==u[0])&&(u.data("ui-tooltip-title")&&u.attr("title",u.data("ui-tooltip-title")),r(u),f.stop(!0),this._hide(f,this.options.hide,function(){n(this).remove(),delete e.tooltips[this.id]}),u.removeData("tooltip-open"),this._off(u,"mouseleave focusout keyup"),this._off(this.document,"mousemove"),this.closing=!0,this._trigger("close",t,{tooltip:f}),this.closing=!1)},_tooltip:function(i){var u="ui-tooltip-"+t++,r=n("<div>").attr({id:u,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return n("<div>").addClass("ui-tooltip-content").appendTo(r),r.appendTo(this.document[0].body),n.fn.bgiframe&&r.bgiframe(),this.tooltips[u]=i,r},_find:function(t){var i=t.data("ui-tooltip-id");return i?n("#"+i):n()},_destroy:function(){var t=this;n.each(this.tooltips,function(i,r){var u=n.Event("blur");u.target=u.currentTarget=r[0],t.close(u,!0),n("#"+i).remove(),r.data("ui-tooltip-title")&&(r.attr("title",r.data("ui-tooltip-title")),r.removeData("ui-tooltip-title"))})}})}(n),n.effects||function(t,i){var r=t.uiBackCompat!==!1,u="ui-effects-";t.effects={effect:{}},function(n,i){function o(n,t,i){var r=h[t.type]||{};return n==null?i||!t.def?null:t.def:(n=r.floor?~~n:parseFloat(n),isNaN(n))?t.def:r.mod?(n+r.mod)%r.mod:0>n?0:r.max<n?r.max:n}function a(t){var i=r(),o=i._rgba=[];return(t=t.toLowerCase(),u(p,function(n,r){var u,s=r.re.exec(t),h=s&&r.parse(s),e=r.space||"rgba";if(h)return u=i[e](h),i[f[e].cache]=u[f[e].cache],o=i._rgba=u._rgba,!1}),o.length)?(o.join()==="0,0,0,0"&&n.extend(o,e.transparent),i):e[t]}function s(n,t,i){return(i=(i+1)%1,i*6<1)?n+(t-n)*i*6:i*2<1?t:i*3<2?n+(t-n)*(2/3-i)*6:n}var v="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor".split(" "),y=/^([\-+])=\s*(\d+\.?\d*)/,p=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(n){return[n[1],n[2],n[3],n[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(n){return[n[1]*2.55,n[2]*2.55,n[3]*2.55,n[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(n){return[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(n){return[parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(n){return[n[1],n[2]/100,n[3]/100,n[4]]}}],r=n.Color=function(t,i,r,u){return new n.Color.fn.parse(t,i,r,u)},f={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},h={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},c=r.support={},l=n("<p>")[0],e,u=n.each;l.style.cssText="background-color:rgba(1,1,1,.5)",c.rgba=l.style.backgroundColor.indexOf("rgba")>-1,u(f,function(n,t){t.cache="_"+n,t.props.alpha={idx:3,type:"percent",def:1}}),r.fn=n.extend(r.prototype,{parse:function(s,h,c,l){if(s===i)return this._rgba=[null,null,null,null],this;(s.jquery||s.nodeType)&&(s=n(s).css(h),h=i);var v=this,y=n.type(s),p=this._rgba=[];return(h!==i&&(s=[s,h,c,l],y="array"),y==="string")?this.parse(a(s)||e._default):y==="array"?(u(f.rgba.props,function(n,t){p[t.idx]=o(s[t.idx],t)}),this):y==="object"?(s instanceof r?u(f,function(n,t){s[t.cache]&&(v[t.cache]=s[t.cache].slice())}):u(f,function(n,i){var r=i.cache;u(i.props,function(n,t){if(!v[r]&&i.to){if(n==="alpha"||s[n]==null)return;v[r]=i.to(v._rgba)}v[r][t.idx]=o(s[n],t,!0)}),v[r]&&t.inArray(null,v[r].slice(0,3))<0&&(v[r][3]=1,i.from&&(v._rgba=i.from(v[r])))}),this):void 0},is:function(n){var e=r(n),t=!0,i=this;return u(f,function(n,r){var o,f=e[r.cache];return f&&(o=i[r.cache]||r.to&&r.to(i._rgba)||[],u(r.props,function(n,i){if(f[i.idx]!=null)return t=f[i.idx]===o[i.idx]})),t}),t},_space:function(){var n=[],t=this;return u(f,function(i,r){t[r.cache]&&n.push(i)}),n.pop()},transition:function(n,t){var i=r(n),c=i._space(),e=f[c],l=this.alpha()===0?r("transparent"):this,a=l[e.cache]||e.to(l._rgba),s=a.slice();return i=i[e.cache],u(e.props,function(n,r){var c=r.idx,u=a[c],f=i[c],e=h[r.type]||{};f!==null&&(u===null?s[c]=f:(e.mod&&(f-u>e.mod/2?u+=e.mod:u-f>e.mod/2&&(u-=e.mod)),s[c]=o((f-u)*t+u,r)))}),this[c](s)},blend:function(t){if(this._rgba[3]===1)return this;var i=this._rgba.slice(),u=i.pop(),f=r(t)._rgba;return r(n.map(i,function(n,t){return(1-u)*f[t]+u*n}))},toRgbaString:function(){var i="rgba(",t=n.map(this._rgba,function(n,t){return n==null?t>2?1:0:n});return t[3]===1&&(t.pop(),i="rgb("),i+t.join()+")"},toHslaString:function(){var i="hsla(",t=n.map(this.hsla(),function(n,t){return n==null&&(n=t>2?1:0),t&&t<3&&(n=Math.round(n*100)+"%"),n});return t[3]===1&&(t.pop(),i="hsl("),i+t.join()+")"},toHexString:function(t){var i=this._rgba.slice(),r=i.pop();return t&&i.push(~~(r*255)),"#"+n.map(i,function(n){return n=(n||0).toString(16),n.length===1?"0"+n:n}).join("")},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString()}}),r.fn.parse.prototype=r.fn,f.hsla.to=function(n){if(n[0]==null||n[1]==null||n[2]==null)return[null,null,null,n[3]];var t=n[0]/255,i=n[1]/255,e=n[2]/255,h=n[3],r=Math.max(t,i,e),o=Math.min(t,i,e),u=r-o,s=r+o,f=s*.5,c,l;return c=o===r?0:t===r?60*(i-e)/u+360:i===r?60*(e-t)/u+120:60*(t-i)/u+240,l=f===0||f===1?f:f<=.5?u/s:u/(2-s),[Math.round(c)%360,l,f,h==null?1:h]},f.hsla.from=function(n){if(n[0]==null||n[1]==null||n[2]==null)return[null,null,null,n[3]];var r=n[0]/360,u=n[1],t=n[2],e=n[3],i=t<=.5?t*(1+u):t+u-t*u,f=2*t-i;return[Math.round(s(f,i,r+1/3)*255),Math.round(s(f,i,r)*255),Math.round(s(f,i,r-1/3)*255),e]},u(f,function(t,f){var s=f.props,e=f.cache,h=f.to,c=f.from;r.fn[t]=function(t){if(h&&!this[e]&&(this[e]=h(this._rgba)),t===i)return this[e].slice();var l,a=n.type(t),v=a==="array"||a==="object"?t:arguments,f=this[e].slice();return u(s,function(n,t){var i=v[a==="object"?n:t.idx];i==null&&(i=f[t.idx]),f[t.idx]=o(i,t)}),c?(l=r(c(f)),l[e]=f,l):r(f)},u(s,function(i,u){r.fn[i]||(r.fn[i]=function(r){var f=n.type(r),h=i==="alpha"?this._hsla?"hsla":"rgba":t,o=this[h](),s=o[u.idx],e;return f==="undefined"?s:(f==="function"&&(r=r.call(this,s),f=n.type(r)),r==null&&u.empty)?this:(f==="string"&&(e=y.exec(r),e&&(r=s+parseFloat(e[2])*(e[1]==="+"?1:-1))),o[u.idx]=r,this[h](o))})})}),u(v,function(t,i){n.cssHooks[i]={set:function(t,u){var o,f,e="";if(n.type(u)!=="string"||(o=a(u))){if(u=r(o||u),!c.rgba&&u._rgba[3]!==1){for(f=i==="backgroundColor"?t.parentNode:t;(e===""||e==="transparent")&&f&&f.style;)try{e=n.css(f,"backgroundColor"),f=f.parentNode}catch(s){}u=u.blend(e&&e!=="transparent"?e:"_default")}u=u.toRgbaString()}try{t.style[i]=u}catch(u){}}},n.fx.step[i]=function(t){t.colorInit||(t.start=r(t.elem,i),t.end=r(t.end),t.colorInit=!0),n.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}}),n.cssHooks.borderColor={expand:function(n){var t={};return u(["Top","Right","Bottom","Left"],function(i,r){t["border"+r+"Color"]=n}),t}},e=n.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(n),function(){function r(){var n=this.ownerDocument.defaultView?this.ownerDocument.defaultView.getComputedStyle(this,null):this.currentStyle,r={},i,u;if(n&&n.length&&n[0]&&n[n[0]])for(u=n.length;u--;)i=n[u],typeof n[i]=="string"&&(r[t.camelCase(i)]=n[i]);else for(i in n)typeof n[i]=="string"&&(r[i]=n[i]);return r}function e(n,i){var e={},r,u;for(r in i)u=i[r],n[r]!==u&&(f[r]||(t.fx.step[r]||!isNaN(parseFloat(u)))&&(e[r]=u));return e}var u=["add","remove","toggle"],f={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(i,r){t.fx.step[r]=function(t){(t.end==="none"||t.setAttr)&&(t.pos!==1||t.setAttr)||(n.style(t.elem,r,t.end),t.setAttr=!0)}}),t.effects.animateClass=function(i,f,o,s){var h=t.speed(f,o,s);return this.queue(function(){var o=t(this),c=o.attr("class")||"",s,f=h.children?o.find("*").andSelf():o;f=f.map(function(){var n=t(this);return{el:n,start:r.call(this)}}),s=function(){t.each(u,function(n,t){i[t]&&o[t+"Class"](i[t])})},s(),f=f.map(function(){return this.end=r.call(this.el[0]),this.diff=e(this.start,this.end),this}),o.attr("class",c),f=f.map(function(){var r=this,i=t.Deferred(),u=n.extend({},h,{queue:!1,complete:function(){i.resolve(r)}});return this.el.animate(this.diff,u),i.promise()}),t.when.apply(t,f.get()).done(function(){s(),t.each(arguments,function(){var n=this.el;t.each(this.diff,function(t){n.css(t,"")})}),h.complete.call(o[0])})})},t.fn.extend({_addClass:t.fn.addClass,addClass:function(n,i,r,u){return i?t.effects.animateClass.call(this,{add:n},i,r,u):this._addClass(n)},_removeClass:t.fn.removeClass,removeClass:function(n,i,r,u){return i?t.effects.animateClass.call(this,{remove:n},i,r,u):this._removeClass(n)},_toggleClass:t.fn.toggleClass,toggleClass:function(n,r,u,f,e){return typeof r=="boolean"||r===i?u?t.effects.animateClass.call(this,r?{add:n}:{remove:n},u,f,e):this._toggleClass(n,r):t.effects.animateClass.call(this,{toggle:n},r,u,f)},switchClass:function(n,i,r,u,f){return t.effects.animateClass.call(this,{add:i,remove:n},r,u,f)}})}(),function(){function n(n,r,u,f){return t.isPlainObject(n)&&(r=n,n=n.effect),n={effect:n},r===i&&(r={}),t.isFunction(r)&&(f=r,u=null,r={}),(typeof r=="number"||t.fx.speeds[r])&&(f=u,u=r,r={}),t.isFunction(u)&&(f=u,u=null),r&&t.extend(n,r),u=u||r.duration,n.duration=t.fx.off?0:typeof u=="number"?u:u in t.fx.speeds?t.fx.speeds[u]:t.fx.speeds._default,n.complete=f||r.complete,n}function f(n){return!n||typeof n=="number"||t.fx.speeds[n]?!0:typeof n=="string"&&!t.effects.effect[n]?r&&t.effects[n]?!1:!0:!1}t.extend(t.effects,{version:"1.9.0",save:function(n,t){for(var i=0;i<t.length;i++)t[i]!==null&&n.data(u+t[i],n[0].style[t[i]])},restore:function(n,t){for(var f,r=0;r<t.length;r++)t[r]!==null&&(f=n.data(u+t[r]),f===i&&(f=""),n.css(t[r],f))},setMode:function(n,t){return t==="toggle"&&(t=n.is(":hidden")?"show":"hide"),t},getBaseline:function(n,t){var i,r;switch(n[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=n[0]/t.height}switch(n[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=n[1]/t.width}return{x:r,y:i}},createWrapper:function(n){if(n.parent().is(".ui-effects-wrapper"))return n.parent();var i={width:n.outerWidth(!0),height:n.outerHeight(!0),float:n.css("float")},u=t("<div><\/div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),f={width:n.width(),height:n.height()},r=document.activeElement;try{r.id}catch(e){r=document.body}return n.wrap(u),(n[0]===r||t.contains(n[0],r))&&t(r).focus(),u=n.parent(),n.css("position")==="static"?(u.css({position:"relative"}),n.css({position:"relative"})):(t.extend(i,{position:n.css("position"),zIndex:n.css("z-index")}),t.each(["top","left","bottom","right"],function(t,r){i[r]=n.css(r),isNaN(parseInt(i[r],10))&&(i[r]="auto")}),n.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),n.css(f),u.css(i).show()},removeWrapper:function(n){var i=document.activeElement;return n.parent().is(".ui-effects-wrapper")&&(n.parent().replaceWith(n),(n[0]===i||t.contains(n[0],i))&&t(i).focus()),n},setTransition:function(n,i,r,u){return u=u||{},t.each(i,function(t,i){var f=n.cssUnit(i);f[0]>0&&(u[i]=f[0]*r+f[1])}),u}}),t.fn.extend({effect:function(){function s(n){function o(){t.isFunction(f)&&f.call(r[0]),t.isFunction(n)&&n()}var r=t(this),f=i.complete,e=i.mode;(r.is(":hidden")?e==="hide":e==="show")?o():u.call(r[0],i,o)}var i=n.apply(this,arguments),f=i.mode,e=i.queue,u=t.effects.effect[i.effect],o=!u&&r&&t.effects[i.effect];return t.fx.off||!(u||o)?f?this[f](i.duration,i.complete):this.each(function(){i.complete&&i.complete.call(this)}):u?e===!1?this.each(s):this.queue(e||"fx",s):o.call(this,{options:i,duration:i.duration,callback:i.complete,mode:i.mode})},_show:t.fn.show,show:function(t){if(f(t))return this._show.apply(this,arguments);var i=n.apply(this,arguments);return i.mode="show",this.effect.call(this,i)},_hide:t.fn.hide,hide:function(t){if(f(t))return this._hide.apply(this,arguments);var i=n.apply(this,arguments);return i.mode="hide",this.effect.call(this,i)},__toggle:t.fn.toggle,toggle:function(i){if(f(i)||typeof i=="boolean"||t.isFunction(i))return this.__toggle.apply(this,arguments);var r=n.apply(this,arguments);return r.mode="toggle",this.effect.call(this,r)},cssUnit:function(n){var i=this.css(n),r=[];return t.each(["em","px","%","pt"],function(n,t){i.indexOf(t)>0&&(r=[parseFloat(i),t])}),r}})}(),function(){var n={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){n[i]=function(n){return Math.pow(n,t+2)}}),t.extend(n,{Sine:function(n){return 1-Math.cos(n*Math.PI/2)},Circ:function(n){return 1-Math.sqrt(1-n*n)},Elastic:function(n){return n===0||n===1?n:-Math.pow(2,8*(n-1))*Math.sin(((n-1)*80-7.5)*Math.PI/15)},Back:function(n){return n*n*(3*n-2)},Bounce:function(n){for(var t,i=4;n<((t=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((t*3-2)/22-n,2)}}),t.each(n,function(n,i){t.easing["easeIn"+n]=i,t.easing["easeOut"+n]=function(n){return 1-i(1-n)},t.easing["easeInOut"+n]=function(n){return n<.5?i(n*2)/2:1-i(n*-2+2)/2}})}()}(n),function(n){var t=/up|down|vertical/,i=/up|left|vertical|horizontal/;n.effects.effect.blind=function(r,u){var f=n(this),c=["position","top","bottom","left","right","height","width"],p=n.effects.setMode(f,r.mode||"hide"),w=r.direction||"up",o=t.test(w),l=o?"height":"width",a=o?"top":"left",b=i.test(w),v={},y=p==="show",e,s,h;f.parent().is(".ui-effects-wrapper")?n.effects.save(f.parent(),c):n.effects.save(f,c),f.show(),e=n.effects.createWrapper(f).css({overflow:"hidden"}),s=e[l](),h=parseFloat(e.css(a))||0,v[l]=y?s:0,b||(f.css(o?"bottom":"right",0).css(o?"top":"left","auto").css({position:"absolute"}),v[a]=y?h:s+h),y&&(e.css(l,0),b||e.css(a,h+s)),e.animate(v,{duration:r.duration,easing:r.easing,queue:!1,complete:function(){p==="hide"&&f.hide(),n.effects.restore(f,c),n.effects.removeWrapper(f),u()}})}}(n),function(n){n.effects.effect.bounce=function(t,i){var r=n(this),v=["position","top","bottom","left","right","height","width"],k=n.effects.setMode(r,t.mode||"effect"),f=k==="hide",y=k==="show",h=t.direction||"up",u=t.distance,p=t.times||5,d=p*2+(y||f?1:0),c=t.duration/d,l=t.easing,e=h==="up"||h==="down"?"top":"left",w=h==="up"||h==="left",b,o,s,a=r.queue(),g=a.length;for((y||f)&&v.push("opacity"),n.effects.save(r,v),r.show(),n.effects.createWrapper(r),u||(u=r[e==="top"?"outerHeight":"outerWidth"]()/3),y&&(s={opacity:1},s[e]=0,r.css("opacity",0).css(e,w?-u*2:u*2).animate(s,c,l)),f&&(u=u/Math.pow(2,p-1)),s={},s[e]=0,b=0;b<p;b++)o={},o[e]=(w?"-=":"+=")+u,r.animate(o,c,l).animate(s,c,l),u=f?u*2:u/2;f&&(o={opacity:0},o[e]=(w?"-=":"+=")+u,r.animate(o,c,l)),r.queue(function(){f&&r.hide(),n.effects.restore(r,v),n.effects.removeWrapper(r),i()}),g>1&&a.splice.apply(a,[1,0].concat(a.splice(g,d+1))),r.dequeue()}}(n),function(n){n.effects.effect.clip=function(t,i){var r=n(this),h=["position","top","bottom","left","right","height","width"],v=n.effects.setMode(r,t.mode||"hide"),f=v==="show",y=t.direction||"vertical",c=y==="vertical",o=c?"height":"width",l=c?"top":"left",s={},a,u,e;n.effects.save(r,h),r.show(),a=n.effects.createWrapper(r).css({overflow:"hidden"}),u=r[0].tagName==="IMG"?a:r,e=u[o](),f&&(u.css(o,0),u.css(l,e/2)),s[o]=f?e:0,s[l]=f?0:e/2,u.animate(s,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){f||r.hide(),n.effects.restore(r,h),n.effects.removeWrapper(r),i()}})}}(n),function(n){n.effects.effect.drop=function(t,i){var r=n(this),h=["position","top","bottom","left","right","opacity","height","width"],c=n.effects.setMode(r,t.mode||"hide"),e=c==="show",u=t.direction||"left",o=u==="up"||u==="down"?"top":"left",s=u==="up"||u==="left"?"pos":"neg",l={opacity:e?1:0},f;n.effects.save(r,h),r.show(),n.effects.createWrapper(r),f=t.distance||r[o==="top"?"outerHeight":"outerWidth"](!0)/2,e&&r.css("opacity",0).css(o,s==="pos"?-f:f),l[o]=(e?s==="pos"?"+=":"-=":s==="pos"?"-=":"+=")+f,r.animate(l,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){c==="hide"&&r.hide(),n.effects.restore(r,h),n.effects.removeWrapper(r),i()}})}}(n),function(n){n.effects.effect.explode=function(t,i){function k(){l.push(this),l.length===o*c&&d()}function d(){r.css({visibility:"visible"}),n(l).remove(),u||r.hide(),i()}for(var o=t.pieces?Math.round(Math.sqrt(t.pieces)):3,c=o,r=n(this),b=n.effects.setMode(r,t.mode||"hide"),u=b==="show",w=r.show().css("visibility","hidden").offset(),s=Math.ceil(r.outerWidth()/c),h=Math.ceil(r.outerHeight()/o),l=[],e,a,v,y,p,f=0;f<o;f++)for(v=w.top+f*h,p=f-(o-1)/2,e=0;e<c;e++)a=w.left+e*s,y=e-(c-1)/2,r.clone().appendTo("body").wrap("<div><\/div>").css({position:"absolute",visibility:"visible",left:-e*s,top:-f*h}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:s,height:h,left:a+(u?y*s:0),top:v+(u?p*h:0),opacity:u?0:1}).animate({left:a+(u?0:y*s),top:v+(u?0:p*h),opacity:u?1:0},t.duration||500,t.easing,k)}}(n),function(n){n.effects.effect.fade=function(t,i){var r=n(this),u=n.effects.setMode(r,t.mode||"toggle");r.animate({opacity:u},{queue:!1,duration:t.duration,easing:t.easing,complete:i})}}(n),function(n){n.effects.effect.fold=function(t,i){var r=n(this),s=["position","top","bottom","left","right","height","width"],h=n.effects.setMode(r,t.mode||"hide"),e=h==="show",c=h==="hide",f=t.size||15,l=/([0-9]+)%/.exec(f),a=!!t.horizFirst,v=e!==a,y=v?["width","height"]:["height","width"],p=t.duration/2,u,o,w={},b={};n.effects.save(r,s),r.show(),u=n.effects.createWrapper(r).css({overflow:"hidden"}),o=v?[u.width(),u.height()]:[u.height(),u.width()],l&&(f=parseInt(l[1],10)/100*o[c?0:1]),e&&u.css(a?{height:0,width:f}:{height:f,width:0}),w[y[0]]=e?o[0]:f,b[y[1]]=e?o[1]:0,u.animate(w,p,t.easing).animate(b,p,t.easing,function(){c&&r.hide(),n.effects.restore(r,s),n.effects.removeWrapper(r),i()})}}(n),function(n){n.effects.effect.highlight=function(t,i){var r=n(this),u=["backgroundImage","backgroundColor","opacity"],f=n.effects.setMode(r,t.mode||"show"),e={backgroundColor:r.css("backgroundColor")};f==="hide"&&(e.opacity=0),n.effects.save(r,u),r.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(e,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){f==="hide"&&r.hide(),n.effects.restore(r,u),i()}})}}(n),function(n){n.effects.effect.pulsate=function(t,i){var r=n(this),e=n.effects.setMode(r,t.mode||"show"),h=e==="show",a=e==="hide",v=h||e==="hide",o=(t.times||5)*2+(v?1:0),c=t.duration/o,u=0,f=r.queue(),l=f.length,s;for((h||!r.is(":visible"))&&(r.css("opacity",0).show(),u=1),s=1;s<o;s++)r.animate({opacity:u},c,t.easing),u=1-u;r.animate({opacity:u},c,t.easing),r.queue(function(){a&&r.hide(),i()}),l>1&&f.splice.apply(f,[1,0].concat(f.splice(l,o+1))),r.dequeue()}}(n),function(n){n.effects.effect.puff=function(t,i){var r=n(this),f=n.effects.setMode(r,t.mode||"hide"),e=f==="hide",o=parseInt(t.percent,10)||150,s=o/100,u={height:r.height(),width:r.width()};n.extend(t,{effect:"scale",queue:!1,fade:!0,mode:f,complete:i,percent:e?o:100,from:e?u:{height:u.height*s,width:u.width*s}}),r.effect(t)},n.effects.effect.scale=function(t,i){var u=n(this),r=n.extend(!0,{},t),f=n.effects.setMode(u,t.mode||"effect"),s=parseInt(t.percent,10)||(parseInt(t.percent,10)===0?0:f==="hide"?0:100),h=t.direction||"both",c=t.origin,e={height:u.height(),width:u.width(),outerHeight:u.outerHeight(),outerWidth:u.outerWidth()},o={y:h!=="horizontal"?s/100:1,x:h!=="vertical"?s/100:1};r.effect="size",r.queue=!1,r.complete=i,f!=="effect"&&(r.origin=c||["middle","center"],r.restore=!0),r.from=t.from||(f==="show"?{height:0,width:0}:e),r.to={height:e.height*o.y,width:e.width*o.x,outerHeight:e.outerHeight*o.y,outerWidth:e.outerWidth*o.x},r.fade&&(f==="show"&&(r.from.opacity=0,r.to.opacity=1),f==="hide"&&(r.from.opacity=1,r.to.opacity=0)),u.effect(r)},n.effects.effect.size=function(t,i){var r=n(this),e=["position","top","bottom","left","right","width","height","overflow","opacity"],p=["position","top","bottom","left","right","overflow","opacity"],v=["width","height","overflow"],a=["fontSize"],o=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],s=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],y=n.effects.setMode(r,t.mode||"effect"),c=t.restore||y!=="effect",h=t.scale||"both",w=t.origin||["middle","center"],f,l,u,b=r.css("position");y==="show"&&r.show(),f={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()},r.from=t.from||f,r.to=t.to||f,u={from:{y:r.from.height/f.height,x:r.from.width/f.width},to:{y:r.to.height/f.height,x:r.to.width/f.width}},(h==="box"||h==="both")&&(u.from.y!==u.to.y&&(e=e.concat(o),r.from=n.effects.setTransition(r,o,u.from.y,r.from),r.to=n.effects.setTransition(r,o,u.to.y,r.to)),u.from.x!==u.to.x&&(e=e.concat(s),r.from=n.effects.setTransition(r,s,u.from.x,r.from),r.to=n.effects.setTransition(r,s,u.to.x,r.to))),(h==="content"||h==="both")&&u.from.y!==u.to.y&&(e=e.concat(a),r.from=n.effects.setTransition(r,a,u.from.y,r.from),r.to=n.effects.setTransition(r,a,u.to.y,r.to)),n.effects.save(r,c?e:p),r.show(),n.effects.createWrapper(r),r.css("overflow","hidden").css(r.from),w&&(l=n.effects.getBaseline(w,f),r.from.top=(f.outerHeight-r.outerHeight())*l.y,r.from.left=(f.outerWidth-r.outerWidth())*l.x,r.to.top=(f.outerHeight-r.to.outerHeight)*l.y,r.to.left=(f.outerWidth-r.to.outerWidth)*l.x),r.css(r.from),(h==="content"||h==="both")&&(o=o.concat(["marginTop","marginBottom"]).concat(a),s=s.concat(["marginLeft","marginRight"]),v=e.concat(o).concat(s),r.find("*[width]").each(function(){var i=n(this),r={height:i.height(),width:i.width()};c&&n.effects.save(i,v),i.from={height:r.height*u.from.y,width:r.width*u.from.x},i.to={height:r.height*u.to.y,width:r.width*u.to.x},u.from.y!==u.to.y&&(i.from=n.effects.setTransition(i,o,u.from.y,i.from),i.to=n.effects.setTransition(i,o,u.to.y,i.to)),u.from.x!==u.to.x&&(i.from=n.effects.setTransition(i,s,u.from.x,i.from),i.to=n.effects.setTransition(i,s,u.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){c&&n.effects.restore(i,v)})})),r.animate(r.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){r.to.opacity===0&&r.css("opacity",r.from.opacity),y==="hide"&&r.hide(),n.effects.restore(r,c?e:p),c||(b==="static"?r.css({position:"relative",top:r.to.top,left:r.to.left}):n.each(["top","left"],function(n,t){r.css(t,function(t,i){var f=parseInt(i,10),u=n?r.to.left:r.to.top;return i==="auto"?u+"px":f+u+"px"})})),n.effects.removeWrapper(r),i()}})}}(n),function(n){n.effects.effect.shake=function(t,i){var r=n(this),v=["position","top","bottom","left","right","height","width"],k=n.effects.setMode(r,t.mode||"effect"),f=t.direction||"left",o=t.distance||20,y=t.times||3,p=y*2+1,u=Math.round(t.duration/p),s=f==="up"||f==="down"?"top":"left",h=f==="up"||f==="left",c={},l={},w={},a,e=r.queue(),b=e.length;for(n.effects.save(r,v),r.show(),n.effects.createWrapper(r),c[s]=(h?"-=":"+=")+o,l[s]=(h?"+=":"-=")+o*2,w[s]=(h?"-=":"+=")+o*2,r.animate(c,u,t.easing),a=1;a<y;a++)r.animate(l,u,t.easing).animate(w,u,t.easing);r.animate(l,u,t.easing).animate(c,u/2,t.easing).queue(function(){k==="hide"&&r.hide(),n.effects.restore(r,v),n.effects.removeWrapper(r),i()}),b>1&&e.splice.apply(e,[1,0].concat(e.splice(b,p+1))),r.dequeue()}}(n),function(n){n.effects.effect.slide=function(t,i){var r=n(this),s=["position","top","bottom","left","right","width","height"],h=n.effects.setMode(r,t.mode||"show"),c=h==="show",f=t.direction||"left",e=f==="up"||f==="down"?"top":"left",o=f==="up"||f==="left",u,l={};n.effects.save(r,s),r.show(),u=t.distance||r[e==="top"?"outerHeight":"outerWidth"](!0),n.effects.createWrapper(r).css({overflow:"hidden"}),c&&r.css(e,o?isNaN(u)?"-"+u:-u:u),l[e]=(c?o?"+=":"-=":o?"-=":"+=")+u,r.animate(l,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){h==="hide"&&r.hide(),n.effects.restore(r,s),n.effects.removeWrapper(r),i()}})}}(n),function(n){n.effects.effect.transfer=function(t,i){var u=n(this),r=n(t.to),f=r.css("position")==="fixed",e=n("body"),o=f?e.scrollTop():0,s=f?e.scrollLeft():0,h=r.offset(),l={top:h.top-o,left:h.left-s,height:r.innerHeight(),width:r.innerWidth()},c=u.offset(),a=n('<div class="ui-effects-transfer"><\/div>').appendTo(document.body).addClass(t.className).css({top:c.top-o,left:c.left-s,height:u.innerHeight(),width:u.innerWidth(),position:f?"fixed":"absolute"}).animate(l,t.duration,t.easing,function(){a.remove(),i()})}}(n)}),define("ui/tab",["aloha/core","jquery","ui/container","ui/component","PubSub","jqueryui"],function(n,t,i,r,u){var o=0,f={},e=i.extend({_elemBySlot:null,_groupBySlot:null,_groupByComponent:null,_constructor:function(n,i,r){var v=this,f,u,s,e,h,l,a,c;for(this._elemBySlot={},this._groupBySlot={},this._groupByComponent={},this._super(n,i),this.container=i.container,this.list=this.container.data("list"),this.panels=this.container.data("panels"),this.id="tab-ui-container-"+ ++o,this.panel=t("<div>",{id:this.id,unselectable:"on"}),this.handle=t('<li><a href="'+location.href.replace(/#.*$/,"")+"#"+this.id+'">'+i.label+"<\/a><\/li>"),f=0;f<r.length;f++)if(typeof r[f]=="string")1===r[f].length&&r[f].charCodeAt(0)===10?this.panel.append("<div>",{unselectable:"on"}):(s=t("<span>",{unselectable:"on"}),this._elemBySlot[r[f]]=s,this.panel.append(s));else for(h=t("<div>",{"class":"aloha-ui-component-group aloha-ui-hidden",unselectable:"on"}).appendTo(this.panel),l={element:h,visibleCounter:0},e=r[f],u=0;u<e.length;u++)this._groupBySlot[e[u]]=l,e[u]&&1===e[u].length&&e[u].charCodeAt(0)===10?h.append(t("<div>",{unselectable:"on"})):(a=e[u],s=t("<span>",{unselectable:"on"}),this._elemBySlot[e[u]]=s,h.append(s));this.panel.append(t("<div>",{"class":"aloha-ui-clear",unselectable:"on"})),this.handle.appendTo(this.list),this.panel.appendTo(this.panels),this.container.tabs("refresh"),c=i.container.data("aloha-tabs"),this.index=c.length,c.push(this)},adoptInto:function(n,t){var r=this._elemBySlot[n],i;return r?(f[n]=t,t.adoptParent(this),r.append(t.element),i=this._groupBySlot[n],i&&(this._groupByComponent[t.id]=i,t.isVisible()&&(i.visibleCounter||i.element.removeClass("aloha-ui-hidden"),i.visibleCounter+=1)),!0):!1},foreground:function(){this.container.tabs("select",this.index)},childForeground:function(){this.foreground()},hasVisibleComponents:function(){var t=this._elemBySlot,n;for(n in t)if(t.hasOwnProperty(n)&&f[n]&&f[n].visible)return!0;return!1},childVisible:function(n,t){t?n.container.show():n.container.hasVisibleComponents()||n.container.hide();var i=this._groupByComponent[n.id];i&&(t?(0===i.visibleCounter&&i.element.removeClass("aloha-ui-hidden"),i.visibleCounter+=1):(i.visibleCounter-=1,0===i.visibleCounter&&i.element.addClass("aloha-ui-hidden")))},show:function(){this.list.children().length&&(this.handle.show(),this.visible=!0,this.container.show(),this.container.find(".ui-tabs-active").length&&this.container.tabs("option","selected")!==this.index||this.foreground())},hide:function(){var t=this.list.children(),n;if(0!==t.length&&(this.handle.hide(),this.visible=!1,this.index===this.container.tabs("option","selected"))){for(t=this.container.data("aloha-tabs"),n=0;n<t.length;++n)if(t[n].visible){this.container.tabs("select",n);return}this.handle.removeClass("ui-tabs-active"),this.container.hide()}}});return t.extend(e,{createContainer:function(){var n=t("<div>",{unselectable:"on"}),i=t("<ul>",{unselectable:"on"}).appendTo(n),r=t("<div>",{unselectable:"on"}).appendTo(n);return n.data("list",i).data("panels",r).data("aloha-tabs",[]).tabs({select:function(t,i){var r=n.data("aloha-tabs");n.data("aloha-active-container",r[i.index]),u.pub("aloha.ui.container.selected",{data:r[i.index]})}}),n}}),e}),define("ui/subguarded",["aloha/core","jquery","PubSub"],function(n,t,i){function o(n){return n.alohaUid||(n.alohaUid=++e),n.alohaUid}function s(n){return u[n]||[]}function h(n){return r[n.alohaUid]||[]}function c(n,t){return r[n.alohaUid]||(r[n.alohaUid]=[]),r[n.alohaUid].push(t),r[n.alohaUid]}function l(n,t){return u[n]||(u[n]=[]),u[n].push(t),u[n]}function f(n){for(var i=s(n),t=0;t<i.length;t++)i[t].apply(null,[h(i[t])].concat(arguments))}function a(){var s=Array.prototype.slice.call(arguments),r=s.shift(),u,e,t,h,a;for(typeof r=="string"&&(r=[r]),u=s.shift(),o(u),c(u,s),h=function(n,i,r){f(t,n,i,r)},a=function(){f(t)},e=0;e<r.length;e++)t=r[e],l(t,u),n.bind(t,h),i.sub(t,a)}var e=0,r={},u={};return a}),define("vendor/amplify.store",["util/json2"],function(){var t={};return function(t,i){function e(t,u){r.addType(t,function(e,o,s){var l,h,y,a,c=o,v=(new Date).getTime();if(!e){c={},a=[],y=0;try{for(e=u.length;e=u.key(y++);)f.test(e)&&(h=n.parse(u.getItem(e)),h.expires&&h.expires<=v?a.push(e):c[e.replace(f,"")]=h.data);while(e=a.pop())u.removeItem(e)}catch(p){}return c}if(e="__amplify__"+e,o===i)if(l=u.getItem(e),h=l?n.parse(l):{expires:-1},h.expires&&h.expires<=v)u.removeItem(e);else return h.data;else if(o===null)u.removeItem(e);else{h=n.stringify({data:o,expires:s.expires?v+s.expires:null});try{u.setItem(e,h)}catch(p){r[t]();try{u.setItem(e,h)}catch(p){throw r.error();}}}return c})}var r=t.store=function(n,t,i,u){var u=r.type;return i&&i.type&&i.type in r.types&&(u=i.type),r.types[u](n,t,i||{})},f,u;r.types={},r.type=null,r.addType=function(n,t){r.type||(r.type=n),r.types[n]=t,r[n]=function(t,i,u){return u=u||{},u.type=n,r(t,i,u)}},r.error=function(){return"amplify.store quota exceeded"},f=/^__amplify__/;for(u in{localStorage:1,sessionStorage:1})try{window[u].getItem&&e(u,window[u])}catch(o){}if(window.globalStorage)try{e("globalStorage",window.globalStorage[window.location.hostname]),r.type==="sessionStorage"&&(r.type="globalStorage")}catch(o){}(function(){if(!r.types.localStorage){var t=document.createElement("div"),u="amplify";t.style.display="none",document.getElementsByTagName("head")[0].appendChild(t);try{t.addBehavior("#default#userdata"),t.load(u)}catch(f){t.parentNode.removeChild(t);return}r.addType("userData",function(f,e,o){t.load(u);var h,s,c,y,a,l=e,v=(new Date).getTime();if(!f){for(l={},a=[],y=0;h=t.XMLDocument.documentElement.attributes[y++];)s=n.parse(h.value),s.expires&&s.expires<=v?a.push(h.name):l[h.name]=s.data;while(f=a.pop())t.removeAttribute(f);return t.save(u),l}if(f=f.replace(/[^-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u37f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-"),e===i)if(h=t.getAttribute(f),s=h?n.parse(h):{expires:-1},s.expires&&s.expires<=v)t.removeAttribute(f);else return s.data;else e===null?t.removeAttribute(f):(c=t.getAttribute(f),s=n.stringify({data:e,expires:o.expires?v+o.expires:null}),t.setAttribute(f,s));try{t.save(u)}catch(p){c===null?t.removeAttribute(f):t.setAttribute(f,c),r.userData();try{t.setAttribute(f,s),t.save(u)}catch(p){c===null?t.removeAttribute(f):t.setAttribute(f,c);throw r.error();}}return l})}})(),function(){function f(t){return t===i?i:n.parse(n.stringify(t))}var t={},u={};r.addType("memory",function(n,r,e){return n?r===i?f(t[n]):(u[n]&&(clearTimeout(u[n]),delete u[n]),r===null)?(delete t[n],null):(t[n]=r,e.expires&&(u[n]=setTimeout(function(){delete t[n],delete u[n]},e.expires)),r):f(t)})}()}(t),t}),define("ui/floating",["jquery","aloha/core","ui/surface","ui/subguarded","PubSub","vendor/amplify.store","util/browser"],function(n,t,i,r,u,f,e){function l(t,i,r,f){"absolute"===s&&(i.top+=o.scrollTop(),i.left+=o.scrollLeft()),c.offset=i,t.stop().animate(i,r,function(){f(i),u.pub("aloha.floating.changed",{position:n.extend({},c)})})}function p(n,t,i,r){t.top-=n.height()+h,l(n,t,i,r)}function a(n,t,i,r){t.top+=h,l(n,t,i,r)}function v(n){f.store("Aloha.FloatingMenu.pinned","true"),f.store("Aloha.FloatingMenu.top",n.top),f.store("Aloha.FloatingMenu.left",n.left)}function w(){f.store("Aloha.FloatingMenu.pinned",null),f.store("Aloha.FloatingMenu.top",null),f.store("Aloha.FloatingMenu.left",null)}function b(){return f.store("Aloha.FloatingMenu.pinned")==="true"?{top:parseInt(f.store("Aloha.FloatingMenu.top"),10),left:parseInt(f.store("Aloha.FloatingMenu.left"),10),isPinned:!0}:{top:null,left:null,isPinned:!1}}function k(n){var t=n.left,i=n.top;return i<0?i=0:i>o.height()&&(i=o.height()/2),t<0?t=0:t>o.width()&&(t=o.width()/2),{top:i,left:t}}function d(t,i,r,u){typeof r!="number"&&(r=y);var c=(parseInt(n("body").css("marginTop"),10)||0)+(parseInt(n("body").css("paddingTop"),10)||0),f=t.$element,l=i.obj.offset(),s=l.top,e=l.left,v=o.scrollTop(),h=s-v-c,w=e+f.width()-o.width();w>0&&(e=Math.max(0,e-w)),h>=f.height()?p(f,{top:s-v,left:e},r,u):h+f.height()>h+i.obj.height()?a(f,{top:s+i.obj.height(),left:e},r,u):a(f,{top:c,left:e},r,u)}function g(n,t,i){var r=n.$element;i?(w(),r.find(".aloha-ui-pin").removeClass("aloha-ui-pin-down")):(v(t),r.find(".aloha-ui-pin").addClass("aloha-ui-pin-down")),r.css({position:"fixed",top:t.top})}function nt(n,t,i,r,u){for(var f=0;f<n.length;f++)n[f][0].isActive()&&n[f][1](i,r,u)}function tt(t){if(n.browser.msie){var i=t.$element.parent();t.$element.appendTo("body"),t.$element.css("position",s),i.length?t.$element.appendTo(i):t.$element.detach()}else t.$element.css("position",s)}function it(n,t){r(["aloha-selection-changed","aloha.ui.container.selected"],nt,n,function(){n._move()});var i=function(){var i=k({top:t.pinTop,left:t.pinLeft});t.setFloatingPosition(i),n.$element.css({top:i.top,left:i.left})};o.scroll(function(){n._move(0)}),o.resize(function(){t.isFloatingMode||i()}),n.addPin(),tt(n),t.isFloatingMode||i(),n.$element.css("z-index",10100).draggable({distance:20,stop:function(n,i){t.setFloatingPosition(i.position),t.isFloatingMode||v(i.position)}})}var h=10,y=500,o=n(window),s=e.ie7?"absolute":"fixed",c={style:s,offset:{top:0,left:0}};return{getPinState:b,makeFloating:it,floatSurface:d,togglePinSurface:g,POSITION_STYLE:s}}),function(){function n(n,t,i,r,u,f){t[n]&&(i.push(n),(t[n]===!0||t[n]===1)&&r.push(u+n+"/"+f))}function t(n,t,i,r,u){var f=r+t+"/"+u;require._fileExists(n.toUrl(f))&&i.push(f)}function i(n,t,r){var u;for(u in t)t.hasOwnProperty(u)&&(!n.hasOwnProperty(u)||r)?n[u]=t[u]:typeof t[u]=="object"&&i(n[u],t[u],r)}var r=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(u){var f=u.config();return{version:"2.0.1",load:function(u,e,o,s){s=s||{},s.locale&&(f.locale=s.locale);var b,v=r.exec(u),c=v[1],p=v[4],l=v[5],w=p.split("-"),a=[],k={},h,d,y="";if(v[5]?(c=v[1],b=c+l):(b=u,l=v[4],p=f.locale,p||(p=f.locale=typeof navigator=="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),w=p.split("-")),s.isBuild){for(a.push(b),t(e,"root",a,c,l),h=0;h<w.length;h++)d=w[h],y+=(y?"-":"")+d,t(e,y,a,c,l);e(a,function(){o()})}else e([b],function(t){var r=[],u;for(n("root",t,r,a,c,l),h=0;h<w.length;h++)u=w[h],y+=(y?"-":"")+u,n(y,t,r,a,c,l);e(a,function(){for(var u,f,n=r.length-1;n>-1&&r[n];n--)f=r[n],u=t[f],(u===!0||u===1)&&(u=e(c+f+"/"+l)),i(k,u);k.t=function(n,t){return this[n]?this[n]:t?t:n},o(k)})})}}})}(),define("ui/nls/i18n",{root:{"button.dismiss.label":"Dismiss","button.bold.label":"Bold","button.italic.label":"Italic","button.strikethrough.label":"Strikethrough","button.subscript.label":"Subscript","button.superscript.label":"Superscript","button.underline.label":"Underline","button.yes.label":"Yes","button.no.label":"No","button.p.label":"Paragraph","button.h1.label":"Heading 1","button.h2.label":"Heading 2","button.h3.label":"Heading 3","button.h4.label":"Heading 4","button.h5.label":"Heading 5","button.h6.label":"Heading 6","button.pre.label":"Preformatted text","button.removeFormatting.label":"Remove formatting","button.ol.label":"Insert ordered list","button.ul.label":"Insert unordered list","button.indent.label":"Indent list","button.outdent.label":"Outdent list","button.createLink.label":"Insert link","button.removeLink.label":"Remove link","button.createAbbr.label":"Insert abbreviation","button.characterPicker.label":"Pick special characters","button.createLink.label":"Insert link","button.removeLink.label":"Remove link","button.createAbbr.label":"Insert abbreviation","button.characterPicker.label":"Pick special characters","button.justifyLeft.label":"Align to the left","button.justifyRight.label":"Align to the right","button.justifyCenter.label":"Center","button.justifyFull.label":"Justify","button.horizontalRule.label":"Insert horizontal rule","button.createLanguageAnnotation.label":"Insert language annotation","button.metaview.label":"Switch between meta and normal view","button.quote.label":"Format selection as quote","button.blockquote.label":"Format selection as blockquote","tab.format.label":"Format","tab.insert.label":"Insert","tab.abbr.label":"Abbreviation","tab.img.label":"Image","tab.link.label":"Link","tab.list.label":"List","tab.table.label":"Table","tab.col.label":"Table Column","tab.row.label":"Table Row","tab.cell.label":"Table Cell","tab.wai-lang.label":"Language annotation"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("ui/toolbar",["jquery","aloha/core","ui/surface","ui/tab","ui/floating","ui/context","i18n!ui/nls/i18n","jqueryui"],function(n,t,i,r,u,f,e){var o=i.extend({_moveTimeout:null,$_container:null,_tabBySlot:null,_tabs:[],_constructor:function(t,i){var f,s,h,c;for(this._super(t),this.$element=n("<div>",{"class":"aloha-ui aloha-ui-toolbar",unselectable:"on"}),this.$_container=r.createContainer().appendTo(this.$element),this._tabBySlot={},h=0;h<i.length;h++){f=i[h],s=new r(t,{label:e.t(f.label,f.label),showOn:f.showOn,container:this.$_container},f.components);for(c in s._elemBySlot)s._elemBySlot.hasOwnProperty(c)&&(this._tabBySlot[c]=s);this._tabs.push({tab:s,settings:f})}u.makeFloating(this,o)},adoptInto:function(n,t){var i=this._tabBySlot[n];return i&&i.adoptInto(n,t)},getActiveContainer:function(){return this.$_container.data("aloha-active-container")},getContainers:function(){return this.$_container.data("aloha-tabs")},_move:function(n){var i=this;i._moveTimeout&&clearTimeout(i._moveTimeout),i._moveTimeout=setTimeout(function(){i._moveTimeout=null,t.activeEditable&&o.isFloatingMode&&u.floatSurface(i,t.activeEditable,n,o.setFloatingPosition)},20)},addPin:function(){var i=n('<div class="aloha-ui-pin">'),t=this.$element,r;t.find(".ui-tabs").append(i),t.find(".ui-tabs").hover(function(){t.addClass("aloha-ui-hover")},function(){t.removeClass("aloha-ui-hover")}),o.isFloatingMode||i.addClass("aloha-ui-pin-down"),r=this,i.click(function(){o.isFloatingMode=!o.isFloatingMode;var t;o.isFloatingMode?t={top:o.pinTop,left:o.pinLeft}:(t=r.$element.offset(),t.top-=n(window).scrollTop()),o.setFloatingPosition(t),u.togglePinSurface(r,t,o.isFloatingMode)})},show:function(){o.$surfaceContainer.children().detach(),o.$surfaceContainer.append(this.$element),o.$surfaceContainer.stop().fadeTo(200,1);var n=o.getFloatingPosition();this.$element.stop().css({top:n.top,left:n.left}),this._move()},hide:function(){o.$surfaceContainer.stop().fadeOut(200,function(){o.$surfaceContainer.children().detach()})}});return n.extend(o,{$surfaceContainer:null,isFloatingMode:!0,pinLeft:0,pinTop:0,init:function(){o.$surfaceContainer=n("<div>",{"class":"aloha aloha-surface aloha-toolbar",unselectable:"on"}).hide(),n(function(){o.$surfaceContainer.appendTo("body")}),i.trackRange(o.$surfaceContainer);var t=u.getPinState();o.pinTop=t.top,o.pinLeft=t.left,o.isFloatingMode=!t.isPinned},setFloatingPosition:function(n){o.pinTop=n.top,o.pinLeft=n.left},getFloatingPosition:function(){return{top:o.pinTop,left:o.pinLeft}}}),o.init(),o}),define("ui/settings",["jquery","util/arrays","util/maps","util/trees"],function(n,t,i,r){function u(r,u,s){function c(t){return"array"===n.type(t)?!t.length:h[t]}var l=i.fillTuples({},t.map(u,function(n){return[n.label,n]})),h=o(r,s);return r=e(r,l,c),u=f(u,h,c),r.concat(u)}function f(t,i,u){for(var o,h=[],e,s,f=0;f<t.length;f++)e=t[f],i[e.label]||(s=r.postprune(e.components,u),s&&(o=n.extend({},e),o.components=s,h.push(o)));return h}function e(t,i,u){for(var h,l=[],f,o,s,c,e=0;e<t.length;e++)f=t[e],o=f.components||[],s=i[f.label],!f.exclusive&&s&&(c=r.postprune(s.components,u),c&&(o=o.concat(c))),h=n.extend({},s||{},f),h.components=o,l.push(h);return l}function o(n,t){for(var f=i.fillKeys({},t,!0),u=0;u<n.length;u++)f[n[u].label]=!0,i.fillKeys(f,r.flatten(n[u].components),!0);return f}return{defaultToolbarSettings:{tabs:[{label:"tab.format.label",showOn:{scope:"Aloha.continuoustext"},components:[["bold","strong","italic","emphasis","underline","\n","subscript","superscript","strikethrough","quote"],["formatLink","formatAbbr","formatNumeratedHeaders","toggleDragDrop","\n","toggleMetaView","wailang","toggleFormatlessPaste"],["alignLeft","alignCenter","alignRight","alignJustify","\n","orderedList","unorderedList","indentList","outdentList","colorPicker"],["formatBlock"]]},{label:"tab.insert.label",showOn:{scope:"Aloha.continuoustext"},components:[["createTable","characterPicker","insertLink","insertImage","insertAbbr","insertToc","insertHorizontalRule","insertTag"]]},{label:"tab.link.label",showOn:{scope:"link"},components:["editLink","removeLink","linkBrowser"]},{label:"tab.img.label",showOn:{scope:"image"},components:[["imageSource","\n","imageTitle"],["imageResizeWidth","\n","imageResizeHeight"],["imageAlignLeft","imageAlignRight","imageAlignNone","imageIncPadding","\n","imageCropButton","imageCnrReset","imageCnrRatio","imageDecPadding"],["imageBrowser"]]},{label:"tab.abbr.label",showOn:{scope:"abbr"},components:[["abbrText","removeAbbr"]]},{label:"tab.wai-lang.label",showOn:{scope:"wai-lang"},components:[["wailangfield","removewailang"]]},{label:"tab.table.label",showOn:{scope:"table.cell"},components:[["mergecells","splitcells","tableCaption","tableSummary","naturalFit"],["formatTable"]]},{label:"tab.col.label",showOn:{scope:"table.column"},components:[["addcolumnleft","addcolumnright","deletecolumns","columnheader","mergecellsColumn","splitcellsColumn","formatColumn"]]},{label:"tab.row.label",showOn:{scope:"table.row"},components:[["addrowbefore","addrowafter","deleterows","rowheader","mergecellsRow","splitcellsRow","formatRow"]]},{label:"tab.cell.label",showOn:{scope:"table.cell"},components:[["alignTop","alignMiddle","alignBottom","formatCell"]]}]},combineToolbarSettings:u}}),define("ui/ui-plugin",["jquery","aloha","ui/context","ui/container","ui/surface","ui/toolbar","ui/scopes","ui/settings","PubSub","jqueryui"],function(n,t,i,r,u,f,e,o,s){function l(){var n=t.settings.toolbar,i=o.defaultToolbarSettings;return n?o.combineToolbarSettings(n.tabs||[],i.tabs,n.exclude||[]):i.tabs}function a(){for(var i=c._tabs,u=e.getPrimaryScope(),r,t=0;t<i.length;t++)if(r=i[t].settings,"object"===n.type(r.showOn)&&r.showOn.scope===u){i[t].tab.foreground();break}}function v(n,t){return c.adoptInto(n,t)}function y(n){u.show(h),r.showContainersForContext(h,n)}var h=new i,c=new f(h,l());return t.bind("aloha-editable-activated",function(n){u.show(h),r.showContainersForContext(h,n)}),t.bind("aloha-editable-deactivated",function(){u.suppressHide||u.hide(h)}),s.sub("aloha.ui.scope.change",function(){r.showContainersForContext(h),a(e.getPrimaryScope())}),{adoptInto:v,showToolbar:y}}),define("ui/ui",["jquery","ui/ui-plugin"],function(n,t){function r(r,u,f){var o,e;return"string"!==n.type(r)?(f=u,u=r,r=f.name):f=n.extend({name:r},f),u.isInstance?e=u:(o=f?u.extend(f):u,e=new o),i[r]=e,t.adoptInto(r,e),e}function u(n){return i[n]||null}var i={};return{adopt:r,getAdoptedComponent:u}}),define("ui/utils",["jquery","jqueryui"],function(n){function r(t,i){return n("<label>",{"class":"aloha-ui-label"}).append(n("<span>",{"class":"aloha-ui-label-text",text:t})).append(i)}function u(n,r,u){return n.button({label:t(r),text:!!(r.text||r.html),icons:{primary:r.icon||r.iconUrl&&"aloha-ui-inline-icon-container"||null,secondary:u&&"aloha-jqueryui-icon ui-icon-triangle-1-s"||null}}),r.iconUrl&&n.button("widget").children(".ui-button-icon-primary").append(i(r.iconUrl)),n}function t(n){return n.html||n.text||n.tooltip}function f(n){var r=t(n);return n.iconUrl&&(r=i(n.iconUrl)+r),r}function i(n){return'<img class="aloha-ui-inline-icon" src="'+n+'">'}function e(t){return n("<button>",t).attr("type","button")}return{wrapWithLabel:r,makeButton:u,makeButtonElement:e,makeButtonLabel:t,makeButtonLabelWithIcon:f,makeButtonIconFromUrl:i}}),define("ui/vendor/jquery-ui-autocomplete-html",["jquery","jqueryui"],function(n){(function(n){function r(t,i){var r=new RegExp(n.ui.autocomplete.escapeRegex(i),"i");return n.grep(t,function(t){return r.test(n("<div>").html(t.label||t.value||t).text())})}var t=n.ui.autocomplete.prototype,i=t._initSource;n.extend(t,{_initSource:function(){this.options.html&&n.isArray(this.options.source)?this.source=function(n,t){t(r(this.options.source,n.term))}:i.call(this)},_renderItem:function(t,i){return n("<li><\/li>").data("item.autocomplete",i).append(n("<a><\/a>")[this.options.html?"html":"text"](i.label)).appendTo(t)}})})(n)}),define("ui/port-helper-attribute-field",["jquery","ui/ui","ui/component","ui/scopes","ui/context","ui/utils","aloha/repositorymanager","aloha/selection","aloha/console","ui/vendor/jquery-ui-autocomplete-html"],function(n,t,i,r,u,f,e,o){return function(r){function ht(n,t){t.item&&w(t.item.obj),d()}function ct(){d()}function lt(t){n(t.target).is(":visible")&&(yt(),a()===b&&v(""))}function at(n){(n.keyCode==13||n.keyCode==27)&&n.preventDefault()}function vt(n){c&&p!==a()&&(c=null,p=null),c||nt(l,a()),(n.keyCode==13||n.keyCode==27)&&(o.getRangeObject().select(),d())}function d(){(ft(),h&&ut!==n(h).attr(l))&&(c||e.markObject(h),a()===""&&g())}function yt(){var t=n(h);(t&&y&&t.addClass(y),it)||(ft(),t&&t.context&&t.context.style&&t.context.style["background-color"]&&t.attr("data-original-background-color",t.context.style["background-color"]),t.css("background-color","#80B5F2"))}function ft(){var t=n(h),i;(y&&t.removeClass(y),!it&&t)&&(i=t.attr("data-original-background-color"),i?t.css("background-color",i):t.css("background-color",""),t.attr("style")||t.removeAttr("style"),t.removeAttr("data-original-background-color"))}function pt(n,t){return n.replace(/\{([^}]+)\}/g,function(n,i){return i in t?t[i]:""})}function g(){null!==b&&(s.css("color","#AAA"),s.val(b))}function wt(n){rt=n}function bt(n){tt=n}function kt(t,i){s.bind(t,n.proxy(i,et))}function a(){return s.val()}function v(n){s.val(n),s.css("color","black")}function w(n){if(c=n,n){var t=n[st];v(t),p=t,nt(l,n[ot]),e.markObject(h,n)}else p=null}function dt(){return c}function nt(t,i,r,u){var f,e;h&&(f=!0,typeof u!="undefined"&&(e=new RegExp(r),u.match(e)||(f=!1)),f?n(h).attr(t,i):n(h).removeAttr(t))}function gt(t,i){if(h=t,l=i,w(null),t&&i)ut=n(t).attr(i),v(n(h).attr(l));else{v("");return}e.getObject(t,function(n){n&&n.length>0&&w(n[0])})}function ni(){return h}function ti(){k.focus(),s.focus()}function ii(){k.foreground()}function ri(){s.show()}function ui(){s.hide()}function fi(){return s.attr("id")}function ei(){return!0}function oi(){return s[0]}var ot=r.valueField||"id",st=r.displayField||"name",tt=r.objectTypeFilter||["all"],b=r.placeholder,it=!!r.noTargetHighlight,y=r.targetHighlightClass,s=r.element?n(r.element):n('<input id="aloha-attribute-field-'+r.name+'">'),k,rt,c,p,h,l,ut,et;return r.cls&&s.addClass(r.cls),r.width&&s.width(r.width),k=t.adopt(r.name,i,{scope:r.scope,init:function(){r.element?this.element=s:r.label?(this.element=f.wrapWithLabel(r.label,s),r.labelClass&&this.element.addClass(r.labelClass)):this.element=n("<span>").append(s),s.autocomplete({html:!0,appendTo:u.selector,source:function(t,i){e.query({queryString:t.term,objectTypeFilter:tt},function(t){i(n.map(t.items,function(n){return{label:pt(rt,n),value:n.name,obj:n}}))})},select:ht})}}),s.bind("focus",lt).bind("blur",ct).bind("keydown",at).bind("keyup",vt),g(),et={getInputElem:oi,hasInputElem:ei,getInputId:fi,hide:ui,show:ri,foreground:ii,focus:ti,getTargetObject:ni,setTargetObject:gt,setAttribute:nt,getItem:dt,setItem:w,setValue:v,getValue:a,addListener:kt,setObjectTypeFilter:bt,setTemplate:wt,setPlaceholder:g}}}),define("ui/button",["jquery","ui/component","ui/utils","jqueryui"],function(n,t,i){return t.extend({init:function(){this._super(),this.createButtonElement(),i.makeButton(this.buttonElement,this).button("widget").tooltip({tooltipClass:"aloha aloha-ui-tooltip",position:{my:"left top",at:"right bottom"}}).click(n.proxy(function(){this.buttonElement.tooltip("close",null,!0),this._onClick()},this))},_onClick:function(){this.click()},click:function(){},createButtonElement:function(){var n=i.makeButtonElement();return this["class"]&&n.addClass(this["class"]),this.element=this.buttonElement=n,n},disable:function(){this.element.button("option","disabled",!1)},enable:function(n){this.element.button("option","disabled",n===!1)}})}),define("ui/toggleButton",["jquery","ui/button","jqueryui"],function(n,t){return t.extend({_checked:!1,setState:function(n){this._checked!==n&&(this._checked=n,n?this.element.addClass("aloha-button-active"):this.element.removeClass("aloha-button-active"))},getState:function(){return this._checked},_onClick:function(){this.setState(!this._checked),this.click()}})}),define("link/nls/i18n",{root:{"button.addlink.tooltip":"Insert Link","button.removelink.tooltip":"Remove Link","newlink.defaulttext":"New Link","floatingmenu.tab.link":"Link","link.target.self":"Self","link.target.blank":"Blank","link.target.parent":"Parent","link.target.top":"Top","link.target.framename":"Framename","link.target.legend":"Target","link.title.legend":"Title",insertLink:"ctrl+k"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("aloha/nls/i18n",{root:{"plugin.abbr.floatingmenu.tab.abbr":"Abbreviation","floatingmenu.tab.format":"Format","floatingmenu.tab.insert":"Insert",yes:"Yes",no:"No",cancel:"Cancel","repository.no_item_found":"No item found.","repository.loading":"Loading","repository.no_items_found_yet":"No items found yet..."},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("util/keys",["jquery"],function(n){function i(n){return t[n]}var t=function(){var t={};return n.each({8:"backspace",9:"tab",13:"enter",16:"shift control alt",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",37:"left up right down",45:"insert",46:"delete",48:"0 1 2 3 4 5 6 7 8 9",65:"a b c d e f g h i j k l m n o p q r s t u v w x y z",112:"f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12 f13 f14 f15"},function(i,r){var u=parseInt(i,10);n.each(r.split(" "),function(n,i){t[u+n]=i})}),t}();return{getToken:i,keyCodeTokenMap:n.extend({},t)}}),define("link/link-plugin",["aloha","aloha/plugin","aloha/ephemera","jquery","ui/port-helper-attribute-field","ui/ui","ui/scopes","ui/surface","ui/button","ui/toggleButton","i18n!link/nls/i18n","i18n!aloha/nls/i18n","aloha/console","PubSub","util/keys"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){function g(){r(document).bind("keydown.aloha-link.pointer-fix",function(n){(n.metaKey||y.getToken(n.keyCode)==="control")&&r("body").addClass("aloha-link-pointer")}).bind("keyup.aloha-link.pointer-fix",function(n){(n.metaKey||y.getToken(n.keyCode)==="control")&&r("body").removeClass("aloha-link-pointer")})}function nt(){r(document).unbind(".aloha-link.pointer-fix")}function tt(t){t.obj.delegate("a","click.aloha-link.meta-click-link",function(t){if(t.metaKey||t.ctrlKey)return n.activeEditable.blur(),window.setTimeout(function(){location.href=t.target},0),t.stopPropagation(),!1})}function it(n){n.obj.unbind(".aloha-link.meta-click-link")}function rt(t,i){var u,f=!1;return!t.ignoreNextSelectionChangedEvent&&n.Selection.isSelectionEditable()&&n.activeEditable!=null?(u=t.findLinkMarkup(i),u?(t.toggleLinkScope(!0),t.hrefField.setTargetObject(u,"href"),r("#"+t.hrefField.getInputId()).length==0&&(t.hrefUpdateInt!==null&&clearInterval(t.hrefUpdateInt),t.hrefUpdateInt=setInterval(function(){r("#"+t.hrefField.getInputId()).length>0&&(t.hrefField.setTargetObject(u,"href"),clearInterval(t.hrefUpdateInt))},200)),n.trigger("aloha-link-selected"),f=!0,v.pub("aloha.link.selected",{input:t.hrefField.getInputElem(),href:t.hrefField.getValue(),element:t.hrefField.getTargetObject()})):(t.toggleLinkScope(!1),t.hrefField.setTargetObject(null),n.trigger("aloha-link-unselected"))):t.toggleLinkScope(!1),t.ignoreNextSelectionChangedEvent=!1,f}var p=window.GENTICS,b="aloha-link",k="",w,d={merge:!0,mergeable:function(n){return"aloha-new-link"===n.className&&n.nextSibling&&"aloha-new-link"===n.nextSibling.className}};return i.classes("aloha-link-pointer","aloha-link-text"),t.create("link",{config:["a"],targetregex:"",target:"",cssclassregex:null,cssclass:"",objectTypeFilter:[],onHrefChange:null,ignoreNextSelectionChangedEvent:!1,hrefUpdateInt:null,hotKey:{insertLink:c.t("insertLink","ctrl+k")},hrefValue:"http://",init:function(){var t=this;typeof this.settings.targetregex!="undefined"&&(this.targetregex=this.settings.targetregex),typeof this.settings.target!="undefined"&&(this.target=this.settings.target),typeof this.settings.cssclassregex!="undefined"&&(this.cssclassregex=this.settings.cssclassregex),typeof this.settings.cssclass!="undefined"&&(this.cssclass=this.settings.cssclass),typeof this.settings.objectTypeFilter!="undefined"&&(this.objectTypeFilter=this.settings.objectTypeFilter),typeof this.settings.onHrefChange!="undefined"&&(this.onHrefChange=this.settings.onHrefChange),typeof this.settings.hotKey!="undefined"&&r.extend(!0,this.hotKey,this.settings.hotKey),typeof this.settings.hrefValue!="undefined"&&(this.hrefValue=this.settings.hrefValue),this.createButtons(),this.subscribeEvents(),this.bindInteractions(),n.bind("aloha-plugins-loaded",function(){t.initSidebar(n.Sidebar.right),v.pub("aloha.link.ready",{plugin:t})})},nsSel:function(){var n=[],t=b;return r.each(arguments,function(){n.push("."+(this==""?t:t+"-"+this))}),r.trim(n.join(" "))},nsClass:function(){var n=[],t=b;return r.each(arguments,function(){n.push(this==""?t:t+"-"+this)}),r.trim(n.join(" "))},initSidebar:function(n){var t=this;t.sidebar=n,n.addPanel({id:t.nsClass("sidebar-panel-target"),title:c.t("floatingmenu.tab.link"),content:"",expanded:!0,activeOn:"a, link",onInit:function(){var n=this,i=this.setContent('<div class="'+t.nsClass("target-container")+'"><fieldset><legend>'+c.t("link.target.legend")+'<\/legend><ul><li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="_self" /><span>'+c.t("link.target.self")+'<\/span><\/li><li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="_blank" /><span>'+c.t("link.target.blank")+'<\/span><\/li><li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="_parent" /><span>'+c.t("link.target.parent")+'<\/span><\/li><li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="_top" /><span>'+c.t("link.target.top")+'<\/span><\/li><li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="framename" /><span>'+c.t("link.target.framename")+'<\/span><\/li><li><input type="text" class="'+t.nsClass("framename")+'" /><\/li><\/ul><\/fieldset><\/div><div class="'+t.nsClass("title-container")+'" ><fieldset><legend>'+c.t("link.title.legend")+'<\/legend><input type="text" class="'+t.nsClass("linkTitle")+'" /><\/fieldset><\/div>').content;r(t.nsSel("framename")).live("keyup",function(){r(n.effective).attr("target",r(this).val().replace('"',"&quot;").replace("'","&#39;"))}),r(t.nsSel("radioTarget")).live("change",function(){r(this).val()=="framename"?r(t.nsSel("framename")).slideDown():(r(t.nsSel("framename")).slideUp().val(""),r(n.effective).attr("target",r(this).val()))}),r(t.nsSel("linkTitle")).live("keyup",function(){r(n.effective).attr("title",r(this).val().replace('"',"&quot;").replace("'","&#39;"))})},onActivate:function(n){var i=this,u;i.effective=n,r(i.effective).attr("target")!=null?(u=!0,r(t.nsSel("framename")).hide().val(""),r(t.nsSel("radioTarget")).each(function(){r(this).removeAttr("checked"),r(this).val()===r(i.effective).attr("target")&&(u=!1,r(this).attr("checked","checked"))}),u&&(r(t.nsSel('radioTarget[value="framename"]')).attr("checked","checked"),r(t.nsSel("framename")).val(r(i.effective).attr("target")).show())):(r(t.nsSel("radioTarget")).first().attr("checked","checked"),r(i.effective).attr("target",r(t.nsSel("radioTarget")).first().val())),i=this,i.effective=n,r(t.nsSel("linkTitle")).val(r(i.effective).attr("title"))}}),n.show()},subscribeEvents:function(){var t=this,u={},f=0,i,e;n.bind("aloha-editable-created",function(n,i){var o=t.getEditableConfig(i.obj),e=r.inArray("a",o)!==-1;(u[i.getId()]=e,e)&&(i.obj.bind("keydown.aloha-link",t.hotKey.insertLink,function(){return t.findLinkMarkup()?(t.hrefField.foreground(),t.hrefField.focus()):t.insertLink(!0),!1}),i.obj.find("a").each(function(){t.addLinkEventHandlers(this)}),0==f++&&g())}),n.bind("aloha-editable-destroyed",function(n,t){t.obj.unbind(".aloha-link"),0==--f&&nt()}),n.bind("aloha-editable-activated",function(i,r){u[n.activeEditable.getId()]?(t._formatLinkButton.show(),t._insertLinkButton.show()):(t._formatLinkButton.hide(),t._insertLinkButton.hide()),tt(r.editable)}),i=!1,n.bind("aloha-selection-changed",function(r,f){var e=!1;n.activeEditable&&u[n.activeEditable.getId()]&&(e=rt(t,f),e&&i!==e&&t.hrefField.foreground()),i=e}),e=this,n.bind("aloha-editable-deactivated",function(n,t){i&&(setTimeout(function(){i||e.toggleLinkScope(!1)},100),i=!1),it(t.editable)})},toggleLinkScope:function(t){this._isScopeActive===t&&n.activeEditable&&this._isScopeActive_editableId===n.activeEditable.getId()||(this._isScopeActive=t,this._isScopeActive_editableId=n.activeEditable&&n.activeEditable.getId(),t?(this.hrefField.show(),this._insertLinkButton.hide(),n.activeEditable&&n.activeEditable.obj[0].nodeName==="A"?this._removeLinkButton.hide():this._removeLinkButton.show(),this._formatLinkButton.setState(!0),e.enterScope(this.name,"link")):(this.hrefField.hide(),this._insertLinkButton.show(),this._removeLinkButton.hide(),this._formatLinkButton.setState(!1),e.leaveScope(this.name,"link",!0)))},addLinkEventHandlers:function(t){var i=this;r(t).mouseenter(function(){n.Log.debug(i,"mouse over link."),i.mouseOverLink=t,i.updateMousePointer()}),r(t).mouseleave(function(){n.Log.debug(i,"mouse left link."),i.mouseOverLink=null,i.updateMousePointer()}),r(t).click(function(t){if(t.metaKey)return n.activeEditable.blur(),window.setTimeout(function(){location.href=t.target},0),t.stopPropagation(),!1})},createButtons:function(){var n=this;this._formatLinkButton=f.adopt("formatLink",h,{tooltip:c.t("button.addlink.tooltip"),icon:"aloha-icon aloha-icon-link",scope:"Aloha.continuoustext",click:function(){n.formatLink()}}),this._insertLinkButton=f.adopt("insertLink",s,{tooltip:c.t("button.addlink.tooltip"),icon:"aloha-icon aloha-icon-link",scope:"Aloha.continuoustext",click:function(){n.insertLink(!1)}}),this.hrefField=u({name:"editLink",width:320,valueField:"url",cls:"aloha-link-href-field",scope:"Aloha.continuoustext",noTargetHighlight:!0,targetHighlightClass:"aloha-focus"}),this.hrefField.setTemplate("<span><b>{name}<\/b><br/>{url}<\/span>"),this.hrefField.setObjectTypeFilter(this.objectTypeFilter),this._removeLinkButton=f.adopt("removeLink",s,{tooltip:c.t("button.removelink.tooltip"),icon:"aloha-icon aloha-icon-unlink",scope:"Aloha.continuoustext",click:function(){n.removeLink()}})},bindInteractions:function(){var t=this;this.hrefField.addListener("keyup",function(i){var f,o,u;y.getToken(i.keyCode)==="escape"&&(f=t.hrefField.getValue(),f[0]=="/"||f[0]=="#"||f.match(/^.*\.([a-z]){2,4}$/i)||f.match(/^([a-z]){3,10}:\/\/.+/i)||f.match(/^(mailto|tel):.+/i)||(u=t.hrefField.getValue(),t.hrefField.setValue(u),(u==t.hrefValue||u=="")&&t.removeLink(!1))),t.hrefChange(),y.getToken(i.keyCode)==="enter"?(o=n.Selection.getRangeObject(),t.ignoreNextSelectionChangedEvent=!0,o.startContainer=o.endContainer,o.startOffset=o.endOffset,o.select(),t.ignoreNextSelectionChangedEvent=!0,u=r(t.hrefField.getInputElem()).attr("value"),(u==t.hrefValue||u=="")&&t.removeLink(!1),window.setTimeout(function(){e.setScope("Aloha.continuoustext")},100)):(w=r(t.hrefField.getInputElem()).attr("value"),k!=w&&(k=w))}),r(document).keydown(function(i){n.Log.debug(t,"Meta key down."),t.metaKey=i.metaKey,t.updateMousePointer()}).keyup(function(i){n.Log.debug(t,"Meta key up."),t.metaKey=i.metaKey,t.updateMousePointer()})},updateMousePointer:function(){this.metaKey&&this.mouseOverLink?(n.Log.debug(this,"set pointer"),r(this.mouseOverLink).removeClass("aloha-link-text"),r(this.mouseOverLink).addClass("aloha-link-pointer")):(r(this.mouseOverLink).removeClass("aloha-link-pointer"),r(this.mouseOverLink).addClass("aloha-link-text"))},findLinkMarkup:function(t){if(typeof t=="undefined"&&(t=n.Selection.getRangeObject()),n.activeEditable){var i=n.activeEditable.obj;return i[0]&&i[0].nodeName==="A"&&(i=i.parent()),t.findMarkup(function(){return this.nodeName=="A"},i)}return null},formatLink:function(){n.activeEditable&&(this.findLinkMarkup(n.Selection.getRangeObject())?this.removeLink():this.insertLink())},insertLink:function(t){var f=this,i=n.Selection.getRangeObject(),o,u,e;i.startContainer&&i.endContainer&&(this.findLinkMarkup(i)||(this.hrefField.foreground(),i.isCollapsed()&&t!==!1&&p.Utils.Dom.extendToWord(i),i.isCollapsed()?(o=c.t("newlink.defaulttext"),u=r('<a href="'+f.hrefValue+'" class="aloha-new-link">'+o+"<\/a>"),p.Utils.Dom.insertIntoDOM(u,i,r(n.activeEditable.obj)),i.startContainer=i.endContainer=u.contents().get(0),i.startOffset=0,i.endOffset=o.length):(u=r('<a href="'+f.hrefValue+'" class="aloha-new-link"><\/a>'),p.Utils.Dom.addMarkup(i,u,!1),p.Utils.Dom.doCleanup(d,i)),n.activeEditable.obj.find("a.aloha-new-link").each(function(){f.addLinkEventHandlers(this),r(this).removeClass("aloha-new-link")}),i.select(),this.hrefField.focus(),this.hrefField.hasInputElem()&&r(this.hrefField.getInputElem()).attr("value",f.hrefValue).select(),e=n.createRange(),e.setStart(i.startContainer,i.startOffset),e.setEnd(i.endContainer,i.endOffset),v.pub("aloha.link.insert",{range:e}),this.hrefChange()))},removeLink:function(t){var i=n.Selection.getRangeObject(),r=this.findLinkMarkup();this.hrefField.setItem(null),r&&(p.Utils.Dom.removeFromDOM(r,i,!0),i.startContainer=i.endContainer,i.startOffset=i.endOffset,i.select(),(typeof t=="undefined"||t===!0)&&e.setScope("Aloha.continuoustext"))},hrefChange:function(){var t=this,i,r;this.target!=""&&this.hrefField.setAttribute("target",this.target,this.targetregex,this.hrefField.getValue()),null!=this.cssclassregex&&this.hrefField.setAttribute("class",this.cssclass,this.cssclassregex,this.hrefField.getValue()),i=t.hrefField.getValue(),r=t.hrefField.getTargetObject(),n.trigger("aloha-link-href-change",{href:i,obj:r,item:t.hrefField.getItem()}),v.pub("aloha.link.changed",{href:i,element:r,input:t.hrefField.getInputElem()}),typeof this.onHrefChange=="function"&&this.onHrefChange.call(this,this.hrefField.getTargetObject(),this.hrefField.getValue(),this.hrefField.getItem())}})}),define("ui/dialog",["jquery","ui/component","i18n!ui/nls/i18n"],function(n,t,i){function r(t){var i={};return t.text&&(i.text=t.text),t.html&&(i.html=t.html),n("<div>",i)}function e(t){return function(){t.apply(this),n(this).dialog("destroy").remove()}}function f(n){var t;for(t in n)n.hasOwnProperty(t)&&(n[t]=e(n[t]));return n}function u(n,t){var i="aloha aloha-dialog";return n.cls&&(i+=" "+n.cls),{resizable:!1,modal:!0,title:n.title||t,dialogClass:i,zIndex:10200}}return{confirm:function(t){var e=t.buttons||{},o=i.t("button.yes.label"),s=i.t("button.no.label"),h,c,l;return e.Yes!==null&&o!=="Yes"&&(e[o]=e.Yes,delete e.Yes),e.No!==null&&s!=="No"&&(e[s]=e.No,delete e.No),e[o]=e[o]||t.yes||n.noop,e[s]=e[s]||t.no||n.noop,t.answer&&(h=e[o],c=e[s],e[o]=function(){h(),t.answer(!0)},e[s]=function(){c(),t.answer(!1)}),l=r(t).dialog(n.extend(u(t,"Confirm"),{buttons:f(e)})),function(){l.dialog("destroy").remove()}},alert:function(t){var e={},o;return e[i.t("button.dismiss.label")]=n.noop,o=r(t).dialog(n.extend(u(t,"Alert"),{buttons:f(e)})),function(){o.dialog("destroy").remove()}},modal:function(t){var i=r(t).dialog(n.extend(u(t,""),t));return i.parent().find(".ui-dialog-titlebar").remove(),i},progress:function(t){var i=n("<div>").progressbar({value:null!=t.value?t.value:100}),f=r(t).dialog(n.extend(u(t,"Progress"),{open:function(){n(this).append(i)}}));return function(n){null!=n?i.progressbar({value:n}):f.dialog("destroy").remove()}}}}),define("ui/multiSplit",["jquery","ui/component","ui/button","ui/utils"],function(n,t,i,r){return t.extend({_activeButton:null,_isOpen:!1,init:function(){var i,u;this._super();var t=this,f=this.element=n("<div>",{"class":"aloha-multisplit"}),e=this.contentElement=n("<div>",{"class":"aloha-multisplit-content"}).appendTo(f),o=this.toggleButton=r.makeButtonElement({"class":"aloha-multisplit-toggle",click:function(){t.toggle()}}).button().appendTo(f);for(this.buttons=[],i=this.getButtons(),0===i.length&&f.hide(),u=0;u<i.length;u++)this.addButton(i[u]);n("body").click(function(n){t._isOpen&&!t.element.is(n.target)&&0===t.element.find(n.target).length&&t.close()})},addButton:function(n){var r=this,t=new(i.extend({tooltip:n.tooltip,icon:n.wide?n.icon:"aloha-large-icon "+n.icon,iconOnly:n.wide?!1:!0,init:function(){this._super(),n.init&&n.init.call(this)},click:function(){n.click.apply(r,arguments),r.close()}})),u;n.wide||t.element.addClass("aloha-large-button"),r.buttons[n.name]={settings:n,component:t,element:t.element,visible:!0},u=this.contentElement.children(".aloha-ui-multisplit-fullwidth"),!n.wide&&u.length?u.before(t.element[0]):this.contentElement.append(t.element[0])},setActiveButton:function(n){n||(n=null),null!==this._activeButton&&this.buttons[this._activeButton].element.removeClass("aloha-multisplit-active"),this._activeButton=n,null!==n&&this.buttons[n].element.addClass("aloha-multisplit-active")},toggle:function(){this.element.toggleClass("aloha-multisplit-open"),this._isOpen=!this._isOpen},open:function(){this.element.addClass("aloha-multisplit-open"),this._isOpen=!0},close:function(){this.element.removeClass("aloha-multisplit-open"),this._isOpen=!1},show:function(n){n||(n=null),null!==n&&this.buttons[n]!==undefined&&(this.buttons[n].element.show(),this.buttons[n].visible=!0,this.element.show())},hide:function(n){var t,i=!1;if(n||(n=null),null!==n&&this.buttons[n]!==undefined){this.buttons[n].element.hide(),this.buttons[n].visible=!1;for(t in this.buttons)if(this.buttons.hasOwnProperty(t)&&this.buttons[t].visible){this.element.show(),i=!0;break}i||this.element.hide()}}})}),define("ui/port-helper-multi-split",["aloha/core","jquery","ui/ui","ui/multiSplit"],function(n,t,i,r){function u(n){var u;return u=i.adopt(n.name,r,{scope:n.scope,getButtons:function(){var i=[];return t.each(n.items,function(n,t){i.push({tooltip:t.tooltip,text:t.text,name:t.name,icon:t.iconClass,click:t.click,init:function(){t.cls&&this.element.addClass(t.cls),t.init&&t.init.call(this)},wide:t.wide})}),i}}),{pushItem:function(n){u.addButton(n)},showItem:function(n){u.show(n)},hideItem:function(n){u.hide(n)},setActiveItem:function(n){u.setActiveButton(n)}}}return u}),define("table/nls/i18n",{root:{"floatingmenu.tab.table":"Table","floatingmenu.tab.tablelayout":"Table Layout","deleterows.confirm":"Do you really want to delete the selected rows?","deletecolumns.confirm":"Do you really want to delete the selected columns?","deletetable.confirm":"Do you really want to delete the table?",Table:"Table","button.createtable.tooltip":"Insert Table","button.addcolleft.tooltip":"Add Column left","button.addcolright.tooltip":"Add Column right","button.delcols.tooltip":"Delete Columns","button.addrowbefore.tooltip":"Add Row before","button.addrowafter.tooltip":"Add Row after","button.delrows.tooltip":"Delete Rows","button.caption.tooltip":"Table caption","button.naturalfit.tooltip":"Reset table sizing","empty.caption":"Table caption","button.removeFormat.tooltip":"Remove formatting","button.removeFormat.text":"Remove formatting","button.rowheader.tooltip":"Format row as table header","button.columnheader.tooltip":"Format column as table header","button.mergecells.tooltip":"Merge Cells","button.splitcells.tooltip":"Split Cells","table.label.target":"Summary","table.sidebar.title":"Table","table.mergeCells.notRectangular":"Only a rectangular selection can be merged","table.addColumns.nonConsecutive":"Please select a single column or a consecutive range of columns","table.createTable.nestedTablesNoSupported":"Sorry, nested tables are not supported"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("table/table-create-layer",["jquery"],function(n){return CreateLayer=function(n){this.TablePlugin=n},CreateLayer.prototype.parameters={elemId:"aloha-table-createLayer",className:"aloha-table-createdialog",numX:10,numY:10,layer:undefined,target:undefined},CreateLayer.prototype.config={},CreateLayer.prototype.visible=!1,CreateLayer.prototype.show=function(){var n=this.get("layer");n==null?this.create():(this.setPosition(n),n.find("td").removeClass("hover"),n.show()),this.visible=!0},CreateLayer.prototype.create=function(){var t=this,i=n("<div><\/div>"),f,o,e,r,u;for(i.id=this.get("elemId"),i.addClass(this.get("className")),f=n("<table><\/table>"),f.css("width",(this.get("numX")+6)*15),r=0;r<this.get("numY");r++){for(o=n("<tr><\/tr>"),u=0;u<this.get("numX");u++)e=n("<td> <\/td>"),r==0&&u==0&&e.addClass("hover"),e.bind("mouseover",{rowId:r,colId:u},function(n){t.handleMouseOver(n,f)}),e.bind("click",{rowId:r,colId:u},function(n){var i=n.data.rowId+1,r=n.data.colId+1;t.TablePlugin.createTable(r,i),t.hide()}),o.append(e);f.append(o)}i.append(f),this.set("layer",i),this.setPosition(),i.bind("click",function(n){n.stopPropagation()}).mousedown(function(n){n.stopPropagation()}),n("body").append(i).bind("click",function(i){!t.visible||i.target===t.get("target")[0]||n.contains(t.get("target")[0],i.target)||t.hide()})},CreateLayer.prototype.handleMouseOver=function(t,i){for(var o=t.data.rowId,s=t.data.colId,e=i.find("tr"),f,r,u=0;u<=e.length;u++)for(f=n(e[u]).find("td"),r=0;r<=f.length;r++)u<=o&&r<=s?n(f[r]).addClass("hover"):n(f[r]).removeClass("hover")},CreateLayer.prototype.setPosition=function(){var t=n(this.get("target")),i=t.offset();this.get("layer").css("left",i.left+"px"),this.get("layer").css("top",i.top+t.height()+"px")},CreateLayer.prototype.hide=function(){this.get("layer").hide(),this.visible=!1},CreateLayer.prototype.get=function(n){return this.config[n]?this.config[n]:this.parameters[n]?this.parameters[n]:undefined},CreateLayer.prototype.set=function(n,t){this.config[n]?this.config[n]=t:this.parameters[n]=t},CreateLayer}),define("table/table-plugin-utils",["jquery"],function(n){var t={cellIndexToGridColumn:function(n,i,r){var u=null;return t.walkCells(n,function(n,t,f){if(n===i&&t===r)return u=f,!1}),u},walkCells:function(n,i){for(var f=[],s,u,r,o,e=0;e<n.length;e++){for(s=n[e].cells,u=0,r=0;r<s.length;r++){for(var c=s[r],h=t.colspan(c),l=t.rowspan(c);f[r+u];)f[r+u]-=1,u+=1;if(!1===i(e,r,r+u,h,l))return;for(o=0;o<h;o++){if(f[r+u+o])throw"an impossible case has occurred";f[r+u+o]=l-1}u+=h-1}for(;r+u<f.length;u++)f[r+u]&&(f[r+u]-=1)}},makeGrid:function(n){var i=[];return t.walkCells(n,function(t,r,u,f,e){for(var h=n[t].cells[r],s,o=0;o<e;o++)for(i[t+o]=i[t+o]||[],s=0;s<f;s++)i[t+o][u+s]={cell:h,colspan:f,rowspan:e,spannedX:s,spannedY:o}}),i},containsDomCell:function(n){return 0===n.spannedX&&0===n.spannedY},leftDomCell:function(n,t,i){do{var r=n[t][i];if(0===r.spannedY)return r.cell;i-=r.spannedX+1}while(i>=0);return null},splitCell:function(i,r){var f=n(i),c=t.colspan(i),l=t.rowspan(i),u,s,h;if(1!==c||1!==l){var a=f.parent(),e=a.parent().children(),o=a.index(),v=f.index(),y=t.makeGrid(e),p=t.cellIndexToGridColumn(e,o,v);for(u=0;u<l;u++)for(s=0===u?1:0;s<c;s++)h=t.leftDomCell(y,o+u,p),null==h?e.eq(o+u).prepend(r()):n(h).after(r());f.removeAttr("colSpan"),f.removeAttr("rowSpan")}},rowspan:function(t){return parseInt(n(t).attr("rowspan"))||1},colspan:function(t){return parseInt(n(t).attr("colspan"))||1},walkGrid:function(n,t){for(var r,i=0;i<n.length;i++)for(r=0;r<n[i].length;r++)if(!1===t(n[i][r],r,i))return},walkGridInsideRect:function(n,i,r){t.walkGrid(n,function(n,t,u){if(u>=i.top&&u<i.bottom&&t>=i.left&&t<i.right)return r(n,t,u)})},leftTrimArray:function(n){for(var t=0;t<n.length;t++)if(null!=n[t])return n.slice(t,n.length);return[]},makeContour:function(n,i){var r=[],u=[],f=[],e=[];return t.walkGrid(n,function(n,t,o){i(n,t,o)&&((null==r[o]||t<r[o])&&(r[o]=t),(null==u[o]||t>u[o])&&(u[o]=t),(null==f[t]||o<f[t])&&(f[t]=o),(null==e[t]||o>e[t])&&(e[t]=o))}),r=t.leftTrimArray(r),u=t.leftTrimArray(u),f=t.leftTrimArray(f),e=t.leftTrimArray(e),{left:r,right:u,top:f,bottom:e}},indexOfAnyBut:function(n,t){for(var i=0;i<n.length;i++)if(t!==n[i])return i;return-1},isConsecutive:function(n){for(var t=1;t<n.length;t++)if(1!==Math.abs(n[t]-n[t-1]))return!1;return!0},resizeCellWidth:function(t,i){n(t).css("width",i),n(t).find(".aloha-table-cell-editable").eq(0).css({width:i,"word-wrap":"break-word"})},getMinColWidth:function(i){var u=i.closest("tbody").children("tr"),e=i.closest("tr"),s=t.cellIndexToGridColumn(u,u.index(e),e.children().index(i)),f="",r,o;return t.walkCells(u,function(t,i,r,e){var c,h,o;if(r===s){if(c=n(n(u[t]).children()[i]),e>1)return;for(h=c.text().split(" "),o=0;o<h.length;o++)h[o].length>f.length&&(f=h[o])}}),r=n("<span><\/span>"),r.css("text-indent",-9999),r.css("display","inline"),r.text(f),n(i).append(r),o=r.width(),n(r).remove(),o},getCellResizeBoundaries:function(i,r,u){var f,e;t.walkCells(r,function(o,s,h,c){var l=n(n(r[o]).children()[s]);return l.hasClass("aloha-table-selectrow")||l.closest("tr").hasClass("aloha-table-selectcolumn")?!0:(h===i&&c===1&&(f=l.offset().left+t.getCellBorder(l)+l.width()-t.getMinColWidth(l)),h===i-1&&c===1&&(e=l.offset().left+t.getCellBorder(l)+t.getCellPadding(l)+t.getMinColWidth(l)),f&&e?(u(f,e),!1):void 0)})},getCellBorder:function(n){return(n.outerWidth()-n.innerWidth())/2},getCellPadding:function(n){return n.innerWidth()-n.width()}};return t}),define("table/table-cell",["jquery","table/table-plugin-utils"],function(n,t){var i=function(t,i){null==t&&(t="<td>&nbsp;<\/td>"),t=n(t).get(0),this.obj=n(t),this.tableObj=i,i.cells.push(this)};return i.prototype.tableObj=undefined,i.prototype.obj=undefined,i.prototype.wrapper=undefined,i.prototype.hasFocus=!1,i.prototype.activate=function(){var i=this,u=i.obj,r;return u.wrapInner("<div/>"),r=u.children("div").eq(0),r.contentEditable(!0),r.addClass("aloha-table-cell-editable"),r.bind("focus",function(n){n.currentTarget&&(n.currentTarget.indexOf=function(){return-1}),i._editableFocus(n)}),r.bind("mousedown",function(r){var s,l;if(r.currentTarget&&(r.currentTarget.indexOf=function(){return-1}),i._editableMouseDown(r),i.tableObj.selection.baseCellPosition=[i._virtualY(),i._virtualX()],r.shiftKey){var f=i.tableObj.selection.lastBaseCellPosition[1],e=i.tableObj.selection.lastBaseCellPosition[0],o=i.tableObj.selection.baseCellPosition,c=o[1];c>f&&(c=f,f=o[1]),s=o[0],s>e&&(s=e,e=o[0]);var h={top:s,right:f,bottom:e,left:c},u=i.tableObj,a=u.obj.children().children("tr"),v=t.makeGrid(a);u.selection.selectedCells=[],l=u.get("classCellSelected"),t.walkGrid(v,function(i,r,f){t.containsDomCell(i)&&(f>=h.top&&f<=h.bottom&&r>=h.left&&r<=h.right?(n(i.cell).addClass(l),u.selection.selectedCells.push(i.cell)):n(i.cell).removeClass(l))}),u.selection.notifyCellsSelected()}else i.tableObj.selection.lastBaseCellPosition=i.tableObj.selection.baseCellPosition,i._editableMouseDown(r),i._startCellSelection()}),r.bind("blur",function(n){i._editableBlur(n)}),r.bind("keyup",function(n){i._editableKeyUp(n)}),r.bind("keydown",function(n){i._editableKeyDown(n)}),r.bind("mouseover",function(){i._selectCellRange()}),r.contentEditableSelectionChange(function(n){Aloha.Selection.onChange(r,n);return r}),u.bind("mousedown",function(n){window.setTimeout(function(){i.wrapper.trigger("focus"),i._selectAll(r)},1),n.shiftKey||(i.tableObj.selection.unselectCells(),i._startCellSelection()),n.stopPropagation()}),u.get(0)&&(u.get(0).onselectstart=function(){return!1}),this.wrapper=u.children(),this.wrapper.get(0)&&(this.wrapper.get(0).onselectstart=function(){window.event.cancelBubble=!0},this.wrapper.get(0).ondragstart=function(){}),this},i.prototype.deactivate=function(){var t=n(this.obj.children(".aloha-table-cell-editable"));t.length&&(t.parent().append(t.contents()),t.remove(),this.obj.unbind("click"),this.obj.unbind("mousedown"),n.trim(this.obj.attr("class"))==""&&this.obj.removeAttr("class"))},i.prototype.toString=function(){return"TableCell"},i.prototype._editableFocus=function(){this.hasFocus||(this.tableObj.focus(),this.obj.addClass("aloha-table-cell_active"),this.hasFocus=!0,this.tableObj.selection.selectionType="cell")},i.prototype._editableBlur=function(){this.hasFocus=!1,this.obj.removeClass("aloha-table-cell_active")},i.prototype._virtualX=function(){var n=this.tableObj.obj.children().children("tr"),i=this.obj.parent().index(),r=this.obj.index();return t.cellIndexToGridColumn(n,i,r)},i.prototype._virtualY=function(){return this.obj.parent("tr").index()},i.prototype._startCellSelection=function(){if(!this.tableObj.selection.cellSelectionMode){this.tableObj.selection.unselectCells(),this.tableObj.selection.cellSelectionMode=!0;var t=this;n("body").bind("mouseup.cellselection",function(){t._endCellSelection()}),this.tableObj.selection.baseCellPosition=[this._virtualY(),this._virtualX()]}},i.prototype._endCellSelection=function(){this.tableObj.selection.cellSelectionMode&&(this.tableObj.selection.cellSelectionMode=!1,this.tableObj.selection.baseCellPosition=null,this.tableObj.selection.lastSelectionRange=null,this.tableObj.selection.selectionType="cell",n("body").unbind("mouseup.cellselection"))},i.prototype._getSelectedRect=function(){var n=this._virtualX(),t=this._virtualY(),i=this.tableObj.selection.baseCellPosition,u=i[1],r;return u>n&&(u=n,n=i[1]),r=i[0],r>t&&(r=t,t=i[0]),{top:r,right:n,bottom:t,left:u}},i.prototype._selectCellRange=function(){var u;if(!this.tableObj.selection.resizeMode&&this.tableObj.selection.cellSelectionMode){var r=this._getSelectedRect(),i=this.tableObj,f=i.obj.children().children("tr"),e=t.makeGrid(f);i.selection.selectedCells=[],u=i.get("classCellSelected"),t.walkGrid(e,function(f,e,o){t.containsDomCell(f)&&(o>=r.top&&o<=r.bottom&&e>=r.left&&e<=r.right?(n(f.cell).addClass(u),i.selection.selectedCells.push(f.cell)):n(f.cell).removeClass(u))}),i.selection.notifyCellsSelected()}},i.prototype._selectAll=function(t){var r=t.jquery?t.get(0):t,u,i;n.browser.msie?document.getSelection?(u=document.getSelection(),i=document.createRange(),i.selectNodeContents(r),u.removeAllRanges(),u.addRange(i)):document.selection&&(i=document.body.createTextRange(),i.moveToElementText(r),i.select()):(u=window.getSelection(),u.setBaseAndExtent?u.setBaseAndExtent(r,0,r,Math.max(0,r.innerText.length-1)):(window.opera&&r.innerHTML.substring(r.innerHTML.length-4)=="<BR>"&&(r.innerHTML=r.innerHTML+"&#160;"),i=document.createRange(),i.selectNodeContents(r),u.removeAllRanges(),u.addRange(i)))},i.prototype._editableMouseDown=function(n){this.tableObj.selection.unselectCells(),this.tableObj.hasFocus&&n.stopPropagation()},i.prototype._editableKeyUp=function(){},i.prototype._editableKeyDown=function(n){if(this._checkForEmptyEvent(n),this.obj[0]===this.tableObj.obj.find("tr:last td:last")[0]&&9==n.keyCode&&!n.altKey&&!n.shiftKey&&!n.ctrlKey){this.tableObj.addRow(this.obj.parent().index()+1),this.tableObj.cells[this.tableObj.cells.length-1]._selectAll(this.wrapper.get(0)),n.stopPropagation();return}},i.prototype._checkForEmptyEvent=function(){var t=n(this.wrapper),i=t.text();t.children().length>0||i===""&&(this.wrapper.text(" "),this.wrapper.get(0).blur(),this.wrapper.get(0).focus())},i.getContainer=function(t){return n(t.firstChild).hasClass("aloha-table-cell-editable")?t.firstChild:t},i}),define("table/table-selection",["aloha","jquery","table/table-plugin-utils","table/table-cell","ui/dialog","i18n!table/nls/i18n"],function(n,t,i,r,u,f){function o(n){return{top:n.top[0],right:n.right[0]+1,bottom:n.bottom[0]+1,left:n.left[0]}}function s(n,t,r){var u=!0,f;return-1!==i.indexOfAnyBut(t.top,t.top[0])||-1!==i.indexOfAnyBut(t.right,t.right[0])||-1!==i.indexOfAnyBut(t.bottom,t.bottom[0])||-1!==i.indexOfAnyBut(t.left,t.left[0])?u=!1:(f=o(t),i.walkGridInsideRect(n,f,function(n){if(!r(n))return u=!1,!1})),u}var e=function(n){this.table=n};return e.prototype.selectionType=undefined,e.prototype.selectedCells=[],e.prototype.selectedColumnIdxs=[],e.prototype.selectedRowIdxs=[],e.prototype.cellSelectionMode=!1,e.prototype.baseCellPosition=null,e.prototype.lastSelectionRange=null,e.prototype.selectColumns=function(n){var e,o,r,u,f;for(this.unselectCells(),e=this.table.getRows(),e.shift(),o=i.makeGrid(e),r=0;r<n.length;r++)if(-1===t.inArray(n[r],this.selectedColumnIdxs))for(this.selectedColumnIdxs.push(n[r]),u=0;u<o.length;u++)f=o[u][n[r]],i.containsDomCell(f)&&(t(f.cell).addClass(this.table.get("classCellSelected")),this.selectedCells.push(f.cell));this.selectionType="column"},e.prototype.selectRows=function(n){var r,i,f,u;for(this.unselectCells(),r=this.table.getRows(),n.sort(function(n,t){return n-t}),i=0;i<n.length;i++)if(r[n[i]]){for(f=0;f<this.selectedRowIdxs.length;f++)if(n[i]==this.selectedRowIdxs[f])return;for(this.selectedRowIdxs.push(n[i]),u=1;u<r[n[i]].cells.length;u++)this.selectedCells.push(r[n[i]].cells[u]),t(r[n[i]].cells[u]).addClass(this.table.get("classCellSelected"))}this.selectionType="row"},e.prototype.selectAll=function(){var n=t.map(this.table.getRows(),function(n,t){return t});n.shift(),this.selectRows(n)},e.prototype.notifyCellsSelected=function(){n.trigger("aloha-table-selection-changed")},e.prototype._notifyCellsUnselected=function(){n.trigger("aloha-table-selection-changed")},e.prototype.isHeader=function(){if(this.selectedCells.length==0)return!1;for(var n=0;n<this.selectedCells.length;n++)if(!this.selectedCells[n]||this.selectedCells[n].nodeName.toLowerCase()!="th")return!1;return!0},e.prototype.unselectCells=function(){var i,n,r;if(!this.cellSelectionMode&&this.selectedCells.length>0){for(i=this.table.getRows(),n=0;n<i.length;n++)for(r=1;r<i[n].cells.length;r++)t(i[n].cells[r]).removeClass(this.table.get("classCellSelected"));this.selectedCells=[],this.selectedColumnIdxs=[],this.selectedRowIdxs=[],this.selectionType="cell",this._notifyCellsUnselected()}},e.prototype.selectionIndex=function(n){for(var t=0;t<this.selectedCells.length;t++)if(this.selectedCells[t]===n)return t;return-1},e.prototype.mergeCells=function(){var l=this.selectedCells;if(0!==l.length){var a=function(n){return-1!=t.inArray(n.cell,l)},h=i.makeGrid(this.table.getRows()),v=i.makeContour(h,a);if(!s(h,v,a)){u.alert({title:f.t("Table"),text:f.t("table.mergeCells.notRectangular")});return}var e=o(v),c=t(h[e.top][e.left].cell),y=t(r.getContainer(c.get(0)));i.walkGridInsideRect(h,e,function(n,i,u){var s,f,o;if(i-n.spannedX!==e.left||u-n.spannedY!==e.top){for(s=n.cell,f=t(r.getContainer(s)).contents(),o=0;o<f.length;o++)if("string"!=typeof f[o]||""!==t.trim(f[o])){y.append(" "),y.append(f);break}t(s).remove()}}),c.attr({rowspan:e.bottom-e.top,colspan:e.right-e.left}),this.selectedCells=[c.get(0)],this.cellSelectionMode=!1,this.baseCellPosition=null,this.lastSelectionRange=null,this.selectionType="cell",n.trigger("aloha-table-selection-changed")}},e.prototype.splitCells=function(){var u=this,r=this.selectedCells;r.length>0&&(t(r).each(function(){i.splitCell(this,function(){return u.table.newActiveCell().obj})}),this.cellSelectionMode=!1,this.baseCellPosition=null,this.lastSelectionRange=null,this.selectionType="cell",n.trigger("aloha-table-selection-changed"))},e.prototype.cellsAreMergeable=function(){var n=this.selectedCells;if(n.length<2)return!1;var r=function(i){return-1!=t.inArray(i.cell,n)},u=i.makeGrid(this.table.getRows()),f=i.makeContour(u,r);return s(u,f,r)?!0:!1},e.prototype.cellsAreSplitable=function(){var n=0;return this.selectedCells.length>0?(t(this.selectedCells).each(function(){var t=this,r=i.colspan(t),u=i.rowspan(t);(r>1||u>1)&&n++}),n>0?!0:!1):!1},e}),define("table/table",["aloha","jquery","ui/scopes","ui/dialog","i18n!table/nls/i18n","table/table-cell","table/table-selection","table/table-plugin-utils"],function(n,t,i,r,u,f,e,o){function a(n){for(var y=n.obj,c,f=n.getRows(),l=f.length,e,a,r,s=0,v=[],h,u,i=0;i<l;i++)c=t(f[i]),e=c.children("td, th"),a=e.length,r=o.cellIndexToGridColumn(f,i,a-1)+1,u=parseInt(e.last().attr("colspan"),10),u==0||isNaN(u)||(u==1&&e.last().removeAttr("colspan"),r+=u-1),v.push(r),r>s&&(s=r);for(i=0;i<l;i++)h=s-v[i],h>0&&t(f[i]).append(new Array(h+1).join("<td><\/td>"))}function l(n,t){var r=-1,i=null,u;return"before"===n?i=t.selectedCells[0]:"after"===n&&(u=t.selectedCells.length-1,i=t.selectedCells[u]),i&&i.nodeType==1&&(r=i.parentNode.rowIndex),r}var h=void 0,c=window.GENTICS,s=function(n,i){this.obj=t(n),a(this),this.obj.attr("id")||this.obj.attr("id",c.Utils.guid()),this.tablePlugin=i,this.selection=new e(this),this.refresh()};return t.extend(s.prototype,{obj:h,tableWrapper:h,cells:h,numRows:h,numCols:h,isActive:!1,hasFocus:!1,parentEditable:h,mousedown:!1,clickedColumnId:-1,clickedRowId:-1,columnsToSelect:[],rowsToSelect:[],fmPluginId:h}),s.prototype.refresh=function(){var n,i,f,u,r,e,o;for(this.numCols=this.countVirtualCols(),n=this.getRows(),this.numRows=n.length,this.cells=[],i=0;i<n.length;i++)for(f=t(n[i]),u=f.children(),r=0;r<u.length;r++)e=u[r],o=this.newCell(e)},s.prototype.countVirtualCols=function(){var n=this.obj.children().children("tr:first-child").children();return n.length-n.filter("."+this.get("classLeftUpperCorner")).length},s.prototype.get=function(n){return this.tablePlugin.get(n)},s.prototype.set=function(n,t){this.tablePlugin.set(n,t)},s.prototype.activate=function(){var i,u,e,r,f;this.isActive||(i=this,this.obj.addClass(this.get("className")),this.obj.contentEditable(!1),this.obj.attr("id")==""&&this.obj.attr("id",c.Utils.guid()),this.selection.selectionType=h,r=this.obj.children("tbody"),r.length===0&&(r=this.obj),r.bind("keydown",function(n){n.ctrlKey||n.shiftKey||i.selection.selectedCells.length>0&&i.selection.selectedCells[0].length>0&&i.selection.selectedCells[0][0].firstChild.focus()}),r.delegate("td","mousemove",function(n){var r=t(this),u=3;if(!t(this).hasClass("aloha-table-selectrow")&&!t(this).closest("tr").hasClass("aloha-table-selectcolumn")){var e=function(t){return n.pageX-t.offset().left<u},o=function(t){return n.pageY-t.offset().top<u},s=function(t){var i=t.closest("tr"),r;return i.next("tr").length>0?!1:(r=n.pageY-(i.offset().top+i.outerHeight()),r>u*-1&&r<u)},h=i.tablePlugin.colResize,f=i.tablePlugin.rowResize;return h&&e(r)?(r.css("cursor","col-resize"),i.attachColumnResize(r)):f&&o(r)?(r.css("cursor","row-resize"),i.attachRowResize(r)):f&&s(r)?(r.css("cursor","row-resize"),i.attachRowResize(r,!0)):(r.css("cursor","default"),i.detachRowColResize(r))}}),r.bind("mousemove",function(n){var r=t(this).closest("table"),u=function(t){var i=n.pageX-(t.offset().left+t.outerWidth());return i>-5&&i<5},f=i.tablePlugin.tableResize;if(f&&u(r))return i.attachTableResizeWidth(r)}),r.bind("mousedown",function(n){return i.hasFocus||i.focus(),n.stopPropagation(),n.preventDefault(),!1}),e=t('<div class="'+this.get("classTableWrapper")+'" data-block-skip-scope="true"><\/div>'),this.obj.wrap(e),f=this.obj.parent(),f.alohaBlock&&f.alohaBlock(),u=this.obj.parents("."+this.get("classTableWrapper")),u.get(0).onresizestart=function(){return!1},u.get(0).oncontrolselect=function(){return!1},u.get(0).ondragstart=function(){return!1},u.get(0).onmovestart=function(){return!1},this.tableWrapper=this.obj.parents("."+this.get("classTableWrapper")).get(0),t(this.cells).each(function(){this.activate()}),this.attachSelectionColumn(),this.attachSelectionRow(),this.makeCaptionEditable(),this.checkWai(),this.isActive=!0,n.trigger("aloha-table-activated"))},s.prototype.makeCaptionEditable=function(){var n=this.obj.find("caption").eq(0);n&&this.tablePlugin.makeCaptionEditable(n)},s.prototype.checkWai=function(){var n=this.wai;n&&(n.removeClass(this.get("waiGreen")),n.removeClass(this.get("waiRed")),t.trim(this.obj[0].summary)!=""?n.addClass(this.get("waiGreen")):n.addClass(this.get("waiRed")))},s.prototype.attachSelectionColumn=function(){var u=t("<td>"),e,n,f,o=this,r,i;for(u.html(" "),o=this,r=this.obj.context.rows,i=0;i<r.length;i++)f=t(r[i]),n=u.clone(),n.addClass(this.get("classSelectionColumn")),n.css("width",this.get("selectionArea")+"px"),f.prepend(n),e=i+1,this.attachRowSelectionEventsToCell(n)},s.prototype.attachRowSelectionEventsToCell=function(n){var t=this;n.unbind("mousedown"),n.unbind("mouseover"),n.get(0).onselectstart=function(){return!1},n.bind("mousedown",function(n){return t.rowSelectionMouseDown(n)}),n.bind("mouseover",function(n){if(t.mousedown)return t.rowSelectionMouseOver(n)})},s.prototype.rowSelectionMouseDown=function(n){var f,r,i,u;if(this.focus(),this.selection.selectedCells.length==0&&(this.rowsToSelect=[]),this.clickedRowId=n.currentTarget.parentNode.rowIndex,n.metaKey)f=t.inArray(this.clickedRowId,this.rowsToSelect),f>=0?this.rowsToSelect.splice(f,1):this.rowsToSelect.push(this.clickedRowId);else if(n.shiftKey)for(this.rowsToSelect.sort(function(n,t){return n-t}),r=this.rowsToSelect[0],i=this.clickedRowId,r>i&&(r=i,i=this.rowsToSelect[0]),this.rowsToSelect=[],u=r;u<=i;u++)this.rowsToSelect.push(u);else this.rowsToSelect=[this.clickedRowId];return this.selectRows(),n.preventDefault(),n.stopPropagation(),this.tablePlugin.summary.focus(),!1},s.prototype.rowSelectionMouseOver=function(n){var i=n.currentTarget.parentNode.rowIndex,e,u,f,r;if(this.mousedown&&this.clickedRowId>=0){for(e=t.inArray(i,this.rowsToSelect),u=i<this.clickedRowId?i:this.clickedRowId,f=i<this.clickedRowId?this.clickedRowId:i,this.rowsToSelect=[],r=u;r<=f;r++)this.rowsToSelect.push(r);return this.selectRows(),n.preventDefault(),n.stopPropagation(),!1}},s.prototype.attachSelectionRow=function(){var n=this,h=t("<td>"),f,e,s,c,u,i,r,l;for(h.html(" "),f=0,i=0;i<this.obj.context.rows.length;i++){for(e=0,s=0;s<this.obj.context.rows[i].cells.length;s++)c=o.colspan(this.obj.context.rows[i].cells[s]),e+=c;f<e&&(f=e)}for(u=t("<tr>"),u.addClass(this.get("classSelectionRow")),u.css("height",this.get("selectionArea")+"px"),i=0;i<f;i++)r=h.clone(),i>0?this.attachColumnSelectEventsToCell(r):(r=t("<td>").clone(),r.addClass(this.get("classLeftUpperCorner")),l=function(t){n.focus(),n.selection.selectAll(),n.tablePlugin.activeTable.selection.selectionType="cell",n.tablePlugin.updateFloatingMenuScope(),n._removeCursorSelection(),n.tablePlugin.settings.summaryinsidebar&&(n.tablePlugin.sidebar.open(),n.tablePlugin.sidebarPanel.activate(n.obj),n.tablePlugin.sidebar.correctHeight());try{n.tablePlugin.summary.focus(),t.stopPropagation(),t.preventDefault()}catch(t){}return!1},this.wai=t("<div/>").width(25).height(12).click(l),r.append(this.wai)),u.append(r);t(document).bind("mouseup",function(t){n.columnSelectionMouseUp(t)}),this.obj.find("tr:first").before(u)},s.prototype.attachColumnSelectEventsToCell=function(n){var t=this;n.unbind("mousedown"),n.unbind("mouseover"),n.get(0).onselectstart=function(){return!1},n.bind("mousedown",function(n){t.columnSelectionMouseDown(n)}),n.bind("mouseover",function(n){t.columnSelectionMouseOver(n)})},s.prototype.columnSelectionMouseDown=function(n){var f,r,i,u;if(this.focus(),this.selection.selectedCells.length==0&&(this.columnsToSelect=[]),this.clickedColumnId=t(n.currentTarget.parentNode).children().index(n.currentTarget),n.metaKey)f=t.inArray(this.clickedColumnId,this.columnsToSelect),f>=0?this.columnsToSelect.splice(f,1):this.columnsToSelect.push(this.clickedColumnId);else if(n.shiftKey)for(this.columnsToSelect.sort(function(n,t){return n-t}),r=this.columnsToSelect[0],i=this.clickedColumnId,r>i&&(r=i,i=this.columnsToSelect[0]),this.columnsToSelect=[],u=r;u<=i;u++)this.columnsToSelect.push(u);else this.columnsToSelect=[this.clickedColumnId];return this.selectColumns(),n.preventDefault(),n.stopPropagation(),!1},s.prototype.columnSelectionMouseOver=function(n){var t=n.currentTarget.cellIndex,r=[],u,f,i;if(this.mouseDownColIdx){for(u=t<this.mouseDownColIdx?t:this.mouseDownColIdx,f=t<this.mouseDownColIdx?this.mouseDownColIdx:t,i=u;i<=f;i++)r.push(i);this.selectColumns(r)}},s.prototype.columnSelectionMouseUp=function(){this.mouseDownColIdx=!1},s.prototype.deleteRows=function(){var n=[],h={},a=this,f,s,c,e,i,l;if(0!==this.selection.selectedCells.length){for(f=0;f<this.selection.selectedCells.length;f++)h[this.selection.selectedCells[f].parentNode.rowIndex]=!0;for(rowId in h)n.push(rowId);s=!1,n.length==this.numRows&&(s=!0),s?(c=this,r.confirm({title:u.t("Table"),text:u.t("deletetable.confirm"),yes:function(){c.deleteTable()}})):(n.sort(function(n,t){return n-t}),e=n[0],e>this.numRows-n.length&&e--,i=this.getRows(),t.each(n,function(n,t){for(var u=i[t],r=0;r<u.cells.length;r++)o.splitCell(u.cells[r],function(){return a.newActiveCell().obj})}),l=o.makeGrid(i),t.each(n,function(n,r){for(var s=l[r],f,e,u=0;u<s.length;)f=s[u],e=o.rowspan(f.cell),1<e&&t(f.cell).attr("rowspan",e-1),u+=f.colspan;t(i[r]).remove()}),this.numRows-=n.length,window.setTimeout(function(){var n=t(i[1].cells[e+1]);n.focus()},5),this.selection.unselectCells())}},s.prototype.deleteColumns=function(){var l=[],f=this.getRows(),v=this,h=o.makeGrid(f),c,e,a,i,n,s;if(this.selection.selectedColumnIdxs.length==h[0].length-1)r.confirm({title:u.t("Table"),text:u.t("deletetable.confirm"),yes:function(){v.deleteTable()}});else{for(l.sort(function(n,t){return n-t}),c=this.selection.selectedColumnIdxs.sort(function(n,t){return t-n}),e=0;e<c.length;e++){for(a=c[e],i=0;i<f.length;i++)(n=h[i][a],n)&&(0===n.spannedX?(1<n.colspan&&(s=this.newActiveCell().obj,t(n.cell).after(s),s.attr("rowspan",n.rowspan),s.attr("colspan",n.colspan-1)),t(n.cell).remove()):t(n.cell).attr("colspan",n.colspan-1),i+=n.rowspan-1);h=o.makeGrid(f)}this.numCols-=l.length,window.setTimeout(function(){var n=t(f[1].cells[1]);n.focus()},5),this.selection.unselectCells()}},s.prototype.deleteTable=function(){for(var r=-1,t,i=0;i<this.tablePlugin.TableRegistry.length;i++)if(this.tablePlugin.TableRegistry[i].obj.attr("id")==this.obj.attr("id")){r=i;break}r>=0&&(this.deactivate(),this.selection.selectionType=h,this.tablePlugin.TableRegistry.splice(i,1),t=n.Selection.rangeObject,t.endContainer=this.obj.get(0).parentNode,t.startContainer=t.endContainer,t.endOffset=c.Utils.Dom.getIndexInParent(this.obj.get(0)),t.startOffset=t.endOffset,t.clearCaches(),this.obj.remove(),this.parentEditable.obj.focus(),t.correctRange(),t.select())},s.prototype.addRowBeforeSelection=function(){var n=l("before",this.selection);-1!==n&&this.addRow(n)},s.prototype.addRowAfterSelection=function(){var n=l("after",this.selection);-1!==n&&this.addRow(n+1)},s.prototype.addRow=function(n){for(var v=this,l=1,y=this.countVirtualCols(),f=this.obj.children().children("tr"),r,s,e,c,i,u,a,h=0;h<l;h++){if(r=t("<tr>"),s=t("<td>"),s.addClass(this.get("classSelectionColumn")),this.attachRowSelectionEventsToCell(s),r.append(s),e=o.makeGrid(f),c=1,n>=e.length)for(i=c;i<e[0].length;i++)r.append(this.newActiveCell().obj);else for(i=c;i<e[n].length;){if(u=e[n][i],o.containsDomCell(u))for(a=u.colspan;a--;)r.append(this.newActiveCell().obj);else t(u.cell).attr("rowspan",u.rowspan+1);i+=u.colspan}n>=f.length?f.eq(f.length-1).after(r):f.eq(n).before(r)}this.numRows+=l},s.prototype.addColumnsRight=function(){this.addColumns("right")},s.prototype.addColumnsLeft=function(){this.addColumns("left")},s.prototype.addColumns=function(n){var v=this,a=t("<td>"),c=this.getRows(),f,s,e=this.selection.selectedColumnIdxs,l,i,h;if(0!==e.length){if(e.sort(function(n,t){return n-t}),!o.isConsecutive(e)){r.alert({title:u.t("Table"),text:u.t("table.addColumns.nonConsecutive")});return}if("left"===n)for(s=e[0],i=0;i<this.selection.selectedColumnIdxs.length;i++)this.selection.selectedColumnIdxs[i]+=1;else s=e[e.length-1];for(l=o.makeGrid(c),i=0;i<c.length;i++)f=a.clone(),f.html(" "),i==0?this.attachColumnSelectEventsToCell(f):(cellObj=this.newActiveCell(f.get(0)),f=cellObj.obj),h=o.leftDomCell(l,i,s),null==h?t(c[i]).prepend(f):"left"===n&&o.containsDomCell(l[i][s])?t(h).before(f):t(h).after(f),this.numCols++}},s.prototype.focus=function(){this.hasFocus||(this.parentEditable.isActive||this.parentEditable.obj.focus(),this.tablePlugin.setFocusedTable(this))},s.prototype.focusOut=function(){this.hasFocus&&(this.tablePlugin.setFocusedTable(h),this.selection.selectionType=h)},s.prototype._removeCursorSelection=function(){var i=n.getSelection(),r,u;i&&i._nativeSelection&&i._nativeSelection._ranges.length!=0&&(r=i.getRangeAt(0),null!=r.startContainer)&&0===t(r.startContainer).closest("table").length&&0!==this.selection.selectedCells.length&&(u=f.getContainer(this.selection.selectedCells[0]),t(u).focus())},s.prototype.selectColumns=function(n){for(var e,r,f=n?n:this.columnsToSelect,u=0;u<this.tablePlugin.columnMSItems.length;u++)this.tablePlugin.columnMSButton.showItem(this.tablePlugin.columnMSItems[u].name);for(i.setScope(this.tablePlugin.name+".column"),this.tablePlugin._columnheaderButton.setState(this.selection.isHeader()),e=this.getRows(),this.tablePlugin.columnMSButton.setActiveItem(),r=0;r<this.tablePlugin.columnConfig.length;r++)t(e[0].cells[0]).hasClass(this.tablePlugin.columnConfig[r].cssClass)&&(this.tablePlugin.columnMSButton.setActiveItem(this.tablePlugin.columnConfig[r].name),r=this.tablePlugin.columnConfig.length);this.obj.find("div.aloha-ui-table-cell-editable").blur(),this.selection.selectColumns(f),this.selection.notifyCellsSelected(),this._removeCursorSelection()},s.prototype.selectRows=function(){for(var e,f,u,r,n=0;n<this.tablePlugin.rowMSItems.length;n++)this.tablePlugin.rowMSButton.showItem(this.tablePlugin.rowMSItems[n].name);for(n=0;n<this.rowsToSelect.length;n++)if(e=this.rowsToSelect[n],f=t(this.getRows()[e].cells).toArray(),n==0)for(u=0;u<f.length;u++)for(this.tablePlugin.rowMSButton.setActiveItem(),r=0;r<this.tablePlugin.rowConfig.length;r++)t(f[u]).hasClass(this.tablePlugin.rowConfig[r].cssClass)&&(this.tablePlugin.rowMSButton.setActiveItem(this.tablePlugin.rowConfig[r].name),r=this.tablePlugin.rowConfig.length);i.setScope(this.tablePlugin.name+".row"),this.selection.selectRows(this.rowsToSelect),this.tablePlugin._rowheaderButton.setState(this.selection.isHeader()),this.obj.find("div.aloha-ui-table-cell-editable").blur(),this.selection.notifyCellsSelected(),this._removeCursorSelection()},s.prototype.deactivate=function(){var i=this.obj.parent(),r,n,u;for(i.mahaloBlock&&i.mahaloBlock(),this.obj.removeClass(this.get("className")),t.trim(this.obj.attr("class"))==""&&this.obj.removeAttr("class"),this.obj.removeAttr("contenteditable"),this.obj.parents("."+this.get("classTableWrapper")).length&&this.obj.unwrap(),this.obj.find("tr."+this.get("classSelectionRow")+":first").remove(),r=this,t.each(this.obj.context.rows,function(){t(this).children("td."+r.get("classSelectionColumn")).remove()}),this.obj.find("td, th").removeClass(this.get("classCellSelected")),this.obj.find("td, th").removeClass("aloha-table-cell_active"),this.obj.unbind(),this.obj.children("tbody").unbind(),n=0;n<this.cells.length;n++)u=this.cells[n],u.deactivate();this.obj.find("caption div").each(function(){t(this).contents().unwrap()}),this.isActive=!1},s.prototype.attachColumnResize=function(n){var r=this;r.detachRowColResize(n);var i=n.closest("tbody").children("tr"),f=n.closest("tr"),u=o.cellIndexToGridColumn(i,i.index(f),f.children().index(n)),e=function(n){var r,f;o.walkCells(i,function(e,s,h,c){var l=t(t(i[e]).children()[s]);return l.hasClass("aloha-table-selectrow")||l.closest("tr").hasClass("aloha-table-selectcolumn")||c>1?!0:(h===u?(f||(f=l.width()-n),o.resizeCellWidth(l,f)):h===u-1&&(r||(r=l.width()+n),o.resizeCellWidth(l,r)),!0)})};n.bind("mousedown.resize",function(){var f=t("<div><\/div>");f.css({height:t(n).closest("tbody").innerHeight(),width:t(n).outerWidth()-t(n).innerWidth(),top:t(n).closest("tbody").offset().top,left:t(n).offset().left,position:"absolute","background-color":"#80B5F2"}),t("body").append(f),o.getCellResizeBoundaries(u,i,function(i,u){r.selection.resizeMode=!0,t("body").bind("mousemove.dnd_col_resize",function(n){n.pageX>u&&n.pageX<i&&f.css("left",n.pageX)}),t("body").bind("mouseup.dnd_col_resize",function(o){var s=0;o.pageX<u?s=u-n.offset().left:o.pageX>u&&o.pageX<i?s=o.pageX-n.offset().left:o.pageX>i&&(s=i-n.offset().left),s!==0&&e(s),t("body").unbind("mousemove.dnd_col_resize"),t("body").unbind("mouseup.dnd_col_resize"),r.selection.resizeMode=!1,f.remove()})})})},s.prototype.attachRowResize=function(n,i){var r=this,u;r.detachRowColResize(n),u=function(t){var u,f,r;u=i?n.closest("tr"):n.closest("tr").prev("tr"),f=u.height(),r=f+t,r<0&&(r=1),u.css("height",r)},n.bind("mousedown.resize",function(){var f=t("<div><\/div>"),o=function(){return i?n.offset().top+n.outerHeight():n.offset().top},e;f.css({width:n.closest("tbody").innerWidth(),height:n.outerHeight()-n.innerHeight(),top:o(),left:n.closest("tbody").offset().left,position:"absolute","background-color":"#80B5F2"}),t("body").append(f),e=function(){return i?n.closest("tr").offset().top:n.closest("tr").prev("tr").offset().top},r.selection.resizeMode=!0,t("body").bind("mousemove.dnd_row_resize",function(n){n.pageY>e()&&f.css("top",n.pageY)}),t("body").bind("mouseup.dnd_row_resize",function(e){var o=0;o=i?e.pageY-(n.offset().top+n.outerHeight()):e.pageY-n.offset().top,u(o),t("body").unbind("mousemove.dnd_row_resize"),t("body").unbind("mouseup.dnd_row_resize"),r.selection.resizeMode=!1,f.remove()})})},s.prototype.attachTableResizeWidth=function(n){var u=this,f=n.closest(".aloha-table-wrapper"),r=n.find("tr:not(.aloha-table-selectcolumn) td:last-child"),i,e;t.each(r,function(){if(!t(this).attr("colspan")||t(this).attr("colspan")<2)return i=t(this),!1}),r.css("cursor","col-resize"),e=function(r){var u=n.find("tr"),f=i.closest("tr"),e=o.cellIndexToGridColumn(u,u.index(f),f.children().index(i)),s=r-o.getCellBorder(i)-o.getCellPadding(i);o.walkCells(u,function(n,i,r,f){var h=t(t(u[n]).children()[i]);return h.hasClass("aloha-table-selectrow")||h.closest("tr").hasClass("aloha-table-selectcolumn")||f>1?!0:(r===e?o.resizeCellWidth(h,s):o.resizeCellWidth(h,h.width()),!0)})},r.bind("mousedown.resize",function(){var c=t("<div><\/div>"),s,h;c.css({height:n.children("tbody").innerHeight(),width:i.outerWidth()-i.innerWidth(),top:n.find("tbody").offset().top,left:n.offset().left+n.outerWidth(),position:"absolute","background-color":"#80B5F2"}),t("body").append(c),s=f.offset().left+f.width(),h=i.offset().left+(i.innerWidth()-i.width())+o.getMinColWidth(i),u.selection.resizeMode=!0,t("body").bind("mousemove.dnd_col_resize",function(n){n.pageX>h&&n.pageX<s&&c.css("left",n.pageX)}),t("body").bind("mouseup.dnd_col_resize",function(n){var f=0;n.pageX<=h?f=h-i.offset().left:n.pageX>h&&n.pageX<s?f=n.pageX-i.offset().left:n.pageX>s&&(f=s-i.offset().left),e(f),t("body").unbind("mousemove.dnd_col_resize"),t("body").unbind("mouseup.dnd_col_resize"),r.unbind("mousedown.resize"),r.css("cursor","default"),u.selection.resizeMode=!1,c.remove()})})},s.prototype.detachRowColResize=function(n){return n.unbind("mousedown.resize")},s.prototype.toString=function(){return"Table"},s.prototype.newCell=function(n){return new f(n,this)},s.prototype.newActiveCell=function(n){var t=new f(n,this);return t.activate(),t},s.prototype.getRows=function(){var n=this.obj.get(0).rows;return t.makeArray(n)},s}),define("table/table-plugin",["aloha","jquery","aloha/plugin","aloha/pluginmanager","ui/ui","ui/scopes","ui/button","ui/toggleButton","ui/dialog","ui/port-helper-attribute-field","ui/port-helper-multi-split","i18n!table/nls/i18n","i18n!aloha/nls/i18n","table/table-create-layer","table/table","table/table-plugin-utils","util/dom","aloha/console"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){function ut(n){return 0<n.parents(".aloha-editable table").length}function ft(n){for(var i,r=n.parents(),t=0;t<r.length;t++){if(i=r.eq(t),i.is(".aloha-editable"))return!1;if(i.is(".aloha-block"))return!0}return!1}function et(n){return d.Utils.Dom.isEditable(n)}function ot(n){var t=n.is("table")?"table":"table table";return n.find(t).length?(b.warn("Table Plugin","Nested tables found. They will not be initialized."),!0):!1}function nt(t){var r=it(t),f=et(t)&&!ut(r)&&!ft(r),i,u;return f?(i=new y(t,k),u=it(w.getEditingHostOf(t)),i.parentEditable=n.getEditableById(u.attr("id")),k.TableRegistry.push(i),ot(r),n.activeEditable===i.parentEditable&&i.activate(),i):null}function tt(){var n=[],i=rt;return t.each(arguments,function(){n.push("."+(this==""?i:i+"-"+this))}),t.trim(n.join(" "))}function g(){var n=[],i=rt;return t.each(arguments,function(){n.push(this==""?i:i+"-"+this)}),t.trim(n.join(" "))}function st(n,i){var u=n.endContainer,r=n.startContainer,f=u.nodeType==3?u.length:u.childNodes.length;r.nodeType==3&&r.parentNode.tagName=="P"&&r.parentNode.childNodes.length==1&&/^(\s|%A0)$/.test(escape(r.data))&&(r.data="",n.startOffset=0,u==r&&(n.endOffset=0)),d.Utils.Dom.allowsNesting(r.nodeType==3?r.parentNode:r,i)||(n.startOffset==0&&t(r.nodeType==3?r.parentNode:r).addClass("aloha-table-cleanme"),n.endOffset==f&&t(u.nodeType==3?u.parentNode:u).addClass("aloha-table-cleanme"))}function ht(){for(var i=t(".aloha-table-cleanme").removeClass("aloha-table-cleanme"),n=0;n<i.length;n++)t.trim(t(i[n]).html())!=""||d.Utils.Dom.isEditingHost(i[n])||t(i[n]).remove()}var it=t,d=window.GENTICS,k=new i("table"),rt;return k.createLayer=undefined,k.config=["table"],k.TableRegistry=[],k.activeTable=undefined,k.parameters={className:"aloha-table",classSelectionRow:"aloha-table-selectcolumn",classSelectionColumn:"aloha-table-selectrow",classLeftUpperCorner:"aloha-table-leftuppercorner",classTableWrapper:"aloha-table-wrapper",classCellSelected:"aloha-cell-selected",waiRed:"aloha-wai-red",waiGreen:"aloha-wai-green",selectionArea:10},k.checkConfig=function(n){var i,t;if(typeof n=="object"&&n.length){for(i=[],t=0;t<n.length;t++)n[t]&&i.push({name:n[t].name,text:n[t].text?n[t].text:n[t].name,tooltip:n[t].tooltip?n[t].tooltip:n[t].text,iconClass:n[t].iconClass?n[t].iconClass:"aloha-icon-"+n[t].name,cssClass:n[t].cssClass?n[t].cssClass:n[t].name});n=i}else n=[];return n},k.init=function(){var i=this,r={};this.tableConfig=this.checkConfig(this.tableConfig||this.settings.tableConfig),this.columnConfig=this.checkConfig(this.columnConfig||this.settings.columnConfig),this.rowConfig=this.checkConfig(this.rowConfig||this.settings.rowConfig),this.cellConfig=this.checkConfig(this.cellConfig||this.settings.cellConfig),this.tableResize=this.settings.tableResize===undefined?!1:this.settings.tableResize,this.colResize=this.settings.colResize===undefined?!1:this.settings.colResize,this.rowResize=this.settings.rowResize===undefined?!1:this.settings.rowResize,t.browser.msie&&parseInt(t.browser.version,10)<8&&(this.tableResize=!1,this.colResize=!1,this.rowResize=!1),this.createLayer=new v(this),n.bind("aloha-editable-created",function(n,u){var f=i.getEditableConfig(u.obj);r[u.getId()]=-1!==t.inArray("table",f),u.obj.bind("mousedown",function(){k.setFocusedTable(undefined)}),u.obj.find("table").each(function(n,t){nt(t)})}),this.initTableButtons(),n.bind("aloha-table-selection-changed",function(){typeof k.activeTable!="undefined"&&k.activeTable.selection&&(k.updateFloatingMenuScope(),k.activeTable.selection.cellsAreSplitable()?(i._splitcellsButton.enable(!0),i._splitcellsRowButton.enable(!0),i._splitcellsColumnButton.enable(!0)):(i._splitcellsButton.enable(!1),i._splitcellsRowButton.enable(!1),i._splitcellsColumnButton.enable(!1)),k.activeTable.selection.cellsAreMergeable()?(i._mergecellsButton.enable(!0),i._mergecellsRowButton.enable(!0),i._mergecellsColumnButton.enable(!0)):(i._mergecellsButton.enable(!1),i._mergecellsRowButton.enable(!1),i._mergecellsColumnButton.enable(!1)))}),n.bind("aloha-selection-changed",function(t,u){if(u.startContainer&&n.activeEditable&&(r[n.activeEditable.getId()]&&n.Selection.mayInsertTag("table")?i._createTableButton.show():i._createTableButton.hide(),i.activeTable)){var f=u.findMarkup(function(){return this.nodeName==="TABLE"},n.activeEditable.obj);f?(k.updateFloatingMenuScope(),k.setActiveCellStyle()):(i.activeTable.selection.cellSelectionMode=!1,i.activeTable.selection.baseCellPosition=null,i.activeTable.selection.lastSelectionRange=null,i.activeTable.focusOut())}}),n.bind("aloha-editable-activated",function(n,r){i._splitcellsButton.enable(!1),i._mergecellsButton.enable(!1),i._splitcellsRowButton.enable(!1),i._mergecellsRowButton.enable(!1),i._splitcellsColumnButton.enable(!1),i._mergecellsColumnButton.enable(!1),r.editable.obj.find("table").each(function(){for(var i=k.TableRegistry,n=0;n<i.length;n++)if(i[n].obj.attr("id")===t(this).attr("id"))return i[n].activate(),!0;nt(this)})}),n.bind("aloha-editable-deactivated",function(){var t,n;for(k.activeTable&&k.activeTable.selection.unselectCells(),k.setFocusedTable(undefined),t=k.TableRegistry,n=0;n<t.length;n++)t[n].deactivate()}),n.bind("aloha-smart-content-changed",function(){n.activeEditable&&n.activeEditable.obj.find("table").each(function(){k.indexOfTableInRegistry(this)==-1&&nt(this)&&(this.id=d.Utils.guid())})}),this.settings.summaryinsidebar&&n.bind("aloha-plugins-loaded",function(){i.initSidebar(n.Sidebar.right.show())})},rt="aloha-table",k.initSidebar=function(n){var i=this;i.sidebar=n,i.sidebarPanel=n.addPanel({id:g("sidebar-panel"),title:l.t("table.sidebar.title"),content:"",expanded:!0,activeOn:"table",onInit:function(){var n=this,r=this.setContent('<label class="'+g("label")+'" for="'+g("textarea")+'" >'+l.t("table.label.target")+'<\/label><textarea id="'+g("textarea")+'" class="'+g("textarea")+'" />').content;t(tt("textarea")).live("keyup",function(){t(n.effective).attr("summary",t(tt("textarea")).val());var r=t('div[class*="wai"]',"table#"+t(n.effective).attr("id"));r.removeClass(i.get("waiGreen")),r.removeClass(i.get("waiRed")),t(tt("textarea")).val().trim()!=""?r.addClass(i.get("waiGreen")):r.addClass(i.get("waiRed"))})},onActivate:function(n){var i=this;i.effective=n,t(tt("textarea")).val(t(i.effective).attr("summary"))}}),n.show()},k.isEditableTable=function(n){return d.Utils.Dom.isEditable(n)},k.indexOfTableInRegistry=function(n){for(var i=this.TableRegistry,t=0;t<i.length;t++)if(i[t].obj[0].id==n.id)return t;return-1},k.getTableFromRegistry=function(n){var t=this.indexOfTableInRegistry(n);return t>-1?this.TableRegistry[t]:null},k.isSelectionInTable=function(){var r=n.Selection.getRangeObject(),i=t(r.commonAncestorContainer);return i.length==0?!1:i.parents(".aloha-editable table").length?!0:!1},k.preventNestedTables=function(){return this.isSelectionInTable()?(s.alert({title:l.t("Table"),text:l.t("table.createTable.nestedTablesNoSupported")}),!0):!1},k.initMergeSplitCellsBtns=function(){this._mergecellsButton=u.adopt("mergecells",e,{tooltip:l.t("button.mergecells.tooltip"),icon:"aloha-icon aloha-icon-mergecells",scope:this.name+".cell",click:function(){k.activeTable&&k.activeTable.selection.mergeCells()}}),this._splitcellsButton=u.adopt("splitcells",e,{tooltip:l.t("button.splitcells.tooltip"),icon:"aloha-icon aloha-icon-splitcells",scope:this.name+".cell",click:function(){k.activeTable&&k.activeTable.selection.splitCells()}}),this._mergecellsRowButton=u.adopt("mergecellsRow",e,{tooltip:l.t("button.mergecells.tooltip"),icon:"aloha-icon aloha-icon-mergecells",scope:this.name+".row",click:function(){k.activeTable&&k.activeTable.selection.mergeCells()}}),this._splitcellsRowButton=u.adopt("splitcellsRow",e,{tooltip:l.t("button.splitcells.tooltip"),icon:"aloha-icon aloha-icon-splitcells",scope:this.name+".row",click:function(){k.activeTable&&k.activeTable.selection.splitCells()}}),this._mergecellsColumnButton=u.adopt("mergecellsColumn",e,{tooltip:l.t("button.mergecells.tooltip"),icon:"aloha-icon aloha-icon-mergecells",scope:this.name+".column",click:function(){k.activeTable&&k.activeTable.selection.mergeCells()}}),this._splitcellsColumnButton=u.adopt("splitcellsColumn",e,{tooltip:l.t("button.splitcells.tooltip"),icon:"aloha-icon aloha-icon-splitcells",scope:this.name+".column",click:function(){k.activeTable&&k.activeTable.selection.splitCells()}})},k.initNaturalFitBtn=function(){var n=this;(this.colResize||this.rowResize)&&(this._tableNaturalFitButton=u.adopt("naturalFit",e,{tooltip:l.t("button.naturalfit.tooltip"),icon:"aloha-icon aloha-icon-table-naturalfit",scope:this.name+".cell",click:function(){if(n.activeTable){var i=n.activeTable.obj;i.find("td").each(function(){t(this).find("div").css("width",""),t(this).css("width","")}),i.find("tr").each(function(){t(this).css("height","")})}}}))},k.initRowsBtns=function(){var i=this;this._addrowbeforeButton=u.adopt("addrowbefore",e,{tooltip:l.t("button.addrowbefore.tooltip"),icon:"aloha-icon aloha-icon-addrowbefore",scope:this.name+".row",click:function(){i.activeTable&&i.activeTable.addRowBeforeSelection()}}),this._addrowafterButton=u.adopt("addrowafter",e,{tooltip:l.t("button.addrowafter.tooltip"),icon:"aloha-icon aloha-icon-addrowafter",scope:this.name+".row",click:function(){i.activeTable&&i.activeTable.addRowAfterSelection()}}),this._deleterowsButton=u.adopt("deleterows",e,{tooltip:l.t("button.delrows.tooltip"),icon:"aloha-icon aloha-icon-deleterows",scope:this.name+".row",click:function(){if(i.activeTable){var n=i.activeTable;s.confirm({title:l.t("Table"),text:l.t("deleterows.confirm"),yes:function(){n.deleteRows()}})}}}),this._rowheaderButton=u.adopt("rowheader",o,{tooltip:l.t("button.rowheader.tooltip"),icon:"aloha-icon aloha-icon-rowheader",scope:this.name+".row",click:function(){var r;if(i.activeTable){var e=i.activeTable.selection.selectedRowIdxs,u,o=i.activeTable.selection.isHeader(),f=!0;for(r=0;r<i.activeTable.selection.selectedCells.length;r++)if(u=i.activeTable.selection.selectedCells[r],!o){f=!1;break}for(r=0;r<i.activeTable.selection.selectedCells.length;r++)u=i.activeTable.selection.selectedCells[r],u=f?n.Markup.transformDomObject(u,"td").removeAttr("scope").get(0):n.Markup.transformDomObject(u,"th").attr("scope","col").get(0),t(i.activeTable.selection.selectedCells[r]).bind("mousedown",function(){var n=t(this).children("div").eq(0);window.setTimeout(function(){n.trigger("focus")},1)});i.activeTable.refresh(),i.activeTable.selection.unselectCells(),i.activeTable.selection.selectRows(e)}}}),this.rowMSItems=[],t.each(this.rowConfig,function(n,r){i.rowMSItems.push({name:r.name,text:l.t(r.text),tooltip:l.t(r.tooltip),iconClass:"aloha-icon aloha-row-layout "+r.iconClass,click:function(){var u,n,f;if(i.activeTable){for(u=i.activeTable.selection.selectedCells,n=0;n<u.length;n++)if(t(u[n]).attr("class").indexOf(r.cssClass)>-1)t(u[n]).removeClass(r.cssClass);else for(t(u[n]).addClass(r.cssClass),f=0;f<i.rowConfig.length;f++)i.rowConfig[f].cssClass!=r.cssClass&&t(u[n]).removeClass(i.rowConfig[f].cssClass);i.activeTable.selectRows()}}})}),this.rowMSItems.length>0&&this.rowMSItems.push({name:"removeFormat",text:l.t("button.removeFormat.text"),tooltip:l.t("button.removeFormat.tooltip"),cls:"aloha-ui-multisplit-fullwidth",wide:!0,click:function(){var u,n,r;if(i.activeTable){for(u=i.activeTable.selection.selectedCells,n=0;n<u.length;n++)for(r=0;r<i.rowConfig.length;r++)t(u[n]).removeClass(i.rowConfig[r].cssClass);i.activeTable.selectRows()}}}),this.rowMSButton=c({items:this.rowMSItems,name:"formatRow",hideIfEmpty:!0,scope:this.name+".row"})},k.initColumnBtns=function(){var i=this;this._addcolumnleftButton=u.adopt("addcolumnleft",e,{tooltip:l.t("button.addcolleft.tooltip"),icon:"aloha-icon aloha-icon-addcolumnleft",scope:this.name+".column",click:function(){i.activeTable&&i.activeTable.addColumnsLeft()}}),this._addcolumnrightButton=u.adopt("addcolumnright",e,{tooltip:l.t("button.addcolright.tooltip"),icon:"aloha-icon aloha-icon-addcolumnright",scope:this.name+".column",click:function(){i.activeTable&&i.activeTable.addColumnsRight()}}),this._deletecolumnsButton=u.adopt("deletecolumns",e,{tooltip:l.t("button.delcols.tooltip"),icon:"aloha-icon aloha-icon-deletecolumns",scope:this.name+".column",click:function(){if(i.activeTable){var n=i.activeTable;s.confirm({title:l.t("Table"),text:l.t("deletecolumns.confirm"),yes:function(){n.deleteColumns()}})}}}),this._columnheaderButton=u.adopt("columnheader",o,{tooltip:l.t("button.columnheader.tooltip"),icon:"aloha-icon aloha-icon-columnheader",scope:this.name+".column",click:function(){var r;if(i.activeTable){var e=i.activeTable.selection.selectedColumnIdxs,u,o=i.activeTable.selection.isHeader(),f=!0;for(r=0;r<i.activeTable.selection.selectedCells.length;r++)if(u=i.activeTable.selection.selectedCells[r],!o){f=!1;break}for(r=0;r<i.activeTable.selection.selectedCells.length;r++)u=i.activeTable.selection.selectedCells[r],u=f?n.Markup.transformDomObject(u,"td").removeAttr("scope").get(0):n.Markup.transformDomObject(u,"th").attr("scope","row").get(0),t(i.activeTable.selection.selectedCells[r]).bind("mousedown",function(){var n=t(this).children("div").eq(0);window.setTimeout(function(){n.trigger("focus")},1)});i.activeTable.refresh(),i.activeTable.selection.unselectCells(),i.activeTable.selection.selectColumns(e)}}}),this.columnMSItems=[],t.each(this.columnConfig,function(n,r){var u={name:r.name,text:l.t(r.text),tooltip:l.t(r.tooltip),iconClass:"aloha-icon aloha-column-layout "+r.iconClass,click:function(){var u,n,f;if(i.activeTable){for(u=i.activeTable.selection.selectedCells,n=0;n<u.length;n++)if(t(u[n]).attr("class").indexOf(r.cssClass)>-1)t(u[n]).removeClass(r.cssClass);else for(t(u[n]).addClass(r.cssClass),f=0;f<i.columnConfig.length;f++)i.columnConfig[f].cssClass!=r.cssClass&&t(u[n]).removeClass(i.columnConfig[f].cssClass);i.activeTable.selectColumns()}}};i.columnMSItems.push(u)}),this.columnMSItems.length>0&&this.columnMSItems.push({name:"removeFormat",text:l.t("button.removeFormat.text"),tooltip:l.t("button.removeFormat.tooltip"),cls:"aloha-ui-multisplit-fullwidth",wide:!0,click:function(){var u,n,r;if(i.activeTable){for(u=i.activeTable.selection.selectedCells,n=0;n<u.length;n++)for(r=0;r<i.columnConfig.length;r++)t(u[n]).removeClass(i.columnConfig[r].cssClass);i.activeTable.selectColumns()}}}),this.columnMSButton=c({items:this.columnMSItems,name:"formatColumn",hideIfEmpty:!0,scope:this.name+".column"})},k.initCellBtns=function(){var n=this;this.cellMSItems=[],t.each(this.cellConfig,function(i,r){var u={name:r.name,text:l.t(r.text),tooltip:l.t(r.tooltip),iconClass:"aloha-icon aloha-column-layout "+r.iconClass,click:function(){var u,i,f;if(n.activeTable){for(u=n.selectedOrActiveCells(),i=0;i<u.length;i++)if(t(u[i]).attr("class").indexOf(r.cssClass)>-1)t(u[i]).removeClass(r.cssClass);else for(t(u[i]).addClass(r.cssClass),f=0;f<n.cellConfig.length;f++)n.cellConfig[f].cssClass!=r.cssClass&&t(u[i]).removeClass(n.cellConfig[f].cssClass);n.setActiveCellStyle()}}};n.cellMSItems.push(u)}),this.cellMSItems.length>0&&this.cellMSItems.push({name:"removeFormat",text:l.t("button.removeFormat.text"),tooltip:l.t("button.removeFormat.tooltip"),cls:"aloha-ui-multisplit-fullwidth",wide:!0,click:function(){var u,i,r;if(n.activeTable){for(u=n.selectedOrActiveCells(),i=0;i<u.length;i++)for(r=0;r<n.cellConfig.length;r++)t(u[i]).removeClass(n.cellConfig[r].cssClass);n.setActiveCellStyle()}}}),this.cellMSButton=c({items:this.cellMSItems,name:"formatCell",hideIfEmpty:!0,scope:this.name+".cell"})},k.initTableButtons=function(){var i=this,r;f.createScope(this.name+".row","Aloha.continuoustext"),f.createScope(this.name+".column","Aloha.continuoustext"),f.createScope(this.name+".cell","Aloha.continuoustext"),this._createTableButton=u.adopt("createTable",e,{tooltip:l.t("button.createtable.tooltip"),icon:"aloha-icon aloha-icon-createTable",scope:"Aloha.continuoustext",click:function(){k.createDialog(this.element)}}),this.initColumnBtns(),this.initRowsBtns(),this.initCellBtns(),this.initMergeSplitCellsBtns(),this.initNaturalFitBtn(),this.tableMSItems=[],r=this.tableConfig,t.each(r,function(n,t){i.tableMSItems.push({name:t.name,text:l.t(t.text),tooltip:l.t(t.tooltip),iconClass:"aloha-icon aloha-table-layout "+t.iconClass,click:function(){if(i.activeTable){for(var n=0;n<r.length;n++)i.activeTable.obj.removeClass(r[n].cssClass);i.activeTable.obj.addClass(t.cssClass)}}})}),this.tableMSItems.length>0&&this.tableMSItems.push({name:"removeFormat",text:l.t("button.removeFormat.text"),tooltip:l.t("button.removeFormat.tooltip"),cls:"aloha-ui-multisplit-fullwidth",wide:!0,click:function(){if(i.activeTable)for(var n=0;n<r.length;n++)i.activeTable.obj.removeClass(i.tableConfig[n].cssClass)}}),this.tableMSButton=c({items:this.tableMSItems,name:"formatTable",hideIfEmpty:!0,scope:this.name+".cell"}),this._tableCaptionButton=u.adopt("tableCaption",o,{tooltip:l.t("button.caption.tooltip"),icon:"aloha-icon aloha-icon-table-caption",scope:this.name+".cell",click:function(){var o,u,e,f,r;i.activeTable&&(i.activeTable.obj.children("caption").is("caption")?i.activeTable.obj.children("caption").remove():(o=l.t("empty.caption"),u=t("<caption><\/caption>"),i.activeTable.obj.prepend(u),i.makeCaptionEditable(u,o),e=u.find("div").eq(0),f=e.contents().eq(0),f.length>0&&(r=new d.Utils.RangeObject,r.startContainer=r.endContainer=f.get(0),r.startOffset=0,r.endOffset=f.text().length,i.activeTable.obj.find("div.aloha-table-cell-editable").blur(),e.focus(),r.select(),n.Selection.updateSelection())))}}),this.summary=h({width:275,name:"tableSummary",noTargetHighlight:!0,scope:this.name+".cell"}),this.summary.addListener("keyup",function(){i.activeTable&&i.activeTable.checkWai()})},k.makeCaptionEditable=function(n,i){var u=this,r=n.children("div");r.length===0?(r=t("<div><\/div>"),t(r).addClass("aloha-ui"),t(r).addClass("aloha-editable-caption"),n.contents().length>0?(r.append(n.contents()),n.append(r)):(i&&r.text(i),n.append(r))):r.length>1&&(n.children("div:not(:first-child)").each(function(){$this=t(this),r.eq(0).append($this.contents()),$this.remove()}),r=r.eq(0)),r.contentEditable(!0)},k.createDialog=function(n){this.createLayer.set("target",n),this.createLayer.show()},k.createTable=function(i,r){var e,o,s,l,h,a,u;if(!this.preventNestedTables())if(n.activeEditable&&typeof n.activeEditable.obj!="undefined"){var f=document.createElement("table"),v=f.id=d.Utils.guid(),c=document.createElement("tbody");for(e=0;e<r;e++){for(o=document.createElement("tr"),s=0;s<i;s++)l=document.createTextNode(" "),h=document.createElement("td"),h.appendChild(l),o.appendChild(h);c.appendChild(o)}f.appendChild(c),st(n.Selection.getRangeObject(),f),d.Utils.Dom.insertIntoDOM(t(f),n.Selection.getRangeObject(),n.activeEditable.obj),ht(),a=document.getElementById(v),u=nt(a),u&&(it.browser.msie?window.setTimeout(function(){u.cells[0].wrapper.get(0).focus()},20):u.cells[0].wrapper.get(0).focus()),u.focus(),k.activeTable.selection.selectionType="cell",k.updateFloatingMenuScope()}else this.error("There is no active Editable where the table can be\t\t\t\tinserted!")},k.setFocusedTable=function(n){var r=this,i,t;for(null==n&&null!=this.activeTable&&this.activeTable.selection.unselectCells(),t=0;t<k.TableRegistry.length;t++)k.TableRegistry[t].hasFocus=!1;for(typeof n!="undefined"&&(this.summary.setTargetObject(n.obj,"summary"),n.obj.children("caption").is("caption")&&(this._tableCaptionButton.setState(!0),i=n.obj.children("caption"),r.makeCaptionEditable(i)),n.hasFocus=!0),k.activeTable=n,t=0;t<this.tableMSItems.length;t++)this.tableMSButton.showItem(this.tableMSItems[t].name);if(this.tableMSButton.setActiveItem(),this.activeTable)for(t=0;t<this.tableConfig.length;t++)this.activeTable.obj.hasClass(this.tableConfig[t].cssClass)&&this.tableMSButton.setActiveItem(this.tableConfig[t].name)},k.error=function(t){n.Log.error(this,t)},k.debug=function(t){n.Log.debug(this,t)},k.info=function(t){n.Log.info(this,t)},k.log=function(t){n.log("log",this,t)},k.get=function(n){return this.config[n]?this.config[n]:this.parameters[n]?this.parameters[n]:undefined},k.set=function(n,t){this.config[n]?this.config[n]=t:this.parameters[n]=t},k.makeClean=function(n){var i=this;n.find("table").each(function(){i.getTableFromRegistry(this)&&(new y(this,i).deactivate(),t(this).attr("id",null))})},k.toString=function(){return this.prefix},k.updateFloatingMenuScope=function(){null!=k.activeTable&&null!=k.activeTable.selection.selectionType&&f.setScope(k.name+"."+k.activeTable.selection.selectionType)},k.setActiveCellStyle=function(){var n=this,i;this.cellMSButton.setActiveItem(),i=n.selectedOrActiveCells(),t(i).each(function(){for(var i=0;i<n.cellConfig.length;i++)t(this).hasClass(n.cellConfig[i].cssClass)&&(n.cellMSButton.setActiveItem(n.cellConfig[i].name),i=n.cellConfig.length)})},k.selectedOrActiveCells=function(){var u=this,t=this.activeTable.selection.selectedCells,r,i;return!t||t.length<1?(r=function(){var t=n.Selection.getRangeObject();return n.activeEditable?t.findMarkup(function(){return this.nodeName.toLowerCase()==="td"},n.activeEditable.obj):null},i=r(),i?[i]:[]):t},r.register(k),k}),define("format/nls/i18n",{root:{"button.strong.tooltip":"Strong","button.em.tooltip":"Emphasize","button.b.tooltip":"Bold","button.i.tooltip":"Italic","button.u.tooltip":"Underline","button.cite.tooltip":"Cite","button.q.tooltip":"Tooltip","button.code.tooltip":"Code","button.abbr.tooltip":"Abbreviation","button.del.tooltip":"Strikethrough","button.s.tooltip":"Strikethrough","button.sub.tooltip":"Subscript","button.sup.tooltip":"Superscript","button.p.tooltip":"Paragraph","button.span.tooltip":"Span","button.h1.tooltip":"Heading 1","button.h2.tooltip":"Heading 2","button.h3.tooltip":"Heading 3","button.h4.tooltip":"Heading 4","button.h5.tooltip":"Heading 5","button.h6.tooltip":"Heading 6","button.pre.tooltip":"Preformatted text","button.title.tooltip":"Title","button.removeFormat.tooltip":"Remove formatting","button.removeFormat.text":"Remove formatting",GENTICS_button_p:"GENTICS_button_p",GENTICS_button_h1:"GENTICS_button_h1",GENTICS_button_h2:"GENTICS_button_h2",GENTICS_button_h3:"GENTICS_button_h3",GENTICS_button_h4:"GENTICS_button_h4",GENTICS_button_h5:"GENTICS_button_h5",GENTICS_button_h6:"GENTICS_button_h6",GENTICS_button_pre:"GENTICS_button_pre",GENTICS_button_title:"GENTICS_button_title",formatBold:"Ctrl+b",formatItalic:"Ctrl+i",formatUnderline:"Ctrl+u",formatParagraph:"Alt+Ctrl+0",formatH1:"Alt+Ctrl+1",formatH2:"Alt+Ctrl+2",formatH3:"Alt+Ctrl+3",formatH4:"Alt+Ctrl+4",formatH5:"Alt+Ctrl+5",formatH6:"Alt+Ctrl+6",formatPre:"Alt+Ctrl+P",formatDel:"Ctrl+\\",formatSub:"Ctrl+,",formatSup:"Ctrl+.","floatingmenu.tab.format":"Format","format.class.legend":"CSS class","format.class.none":"none"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("format/format-plugin",["aloha","aloha/plugin","aloha/state-override","jquery","util/arrays","util/maps","ui/ui","ui/toggleButton","ui/port-helper-multi-split","PubSub","i18n!format/nls/i18n","i18n!aloha/nls/i18n","aloha/selection"],function(n,t,i,r,u,f,e,o,s,h,c){function w(n){var t=r(".aloha-cell-selected"),i;return t.length>0?(i=0,t.each(function(){var t=r(this).find("div"),u=t.find(n);u.length>0&&(u.contents().unwrap(),i++),t.contents().wrap("<"+n+"><\/"+n+">")}),i===t.length&&t.find(n).contents().unwrap(),!0):!1}function g(n,t){return w(t)?!1:(n.addMarkup(t),!1)}function nt(t,i){if(w(i))return!1;t.changeMarkup(i),n.activeEditable&&r.browser.mozilla&&n.activeEditable.obj.focus(),n.activeEditable&&n.trigger("aloha-format-block")}function tt(n,t){var r=v[t],i=r;return y.hasOwnProperty(t)&&(i=y[t]),e.adopt(i,o,{tooltip:c.t("button."+t+".tooltip"),icon:"aloha-icon aloha-icon-"+i,scope:"Aloha.continuoustext",click:function(){return g(n,t)}})}function it(n,t){return{name:t,tooltip:c.t("button."+t+".tooltip"),iconClass:"aloha-icon "+c.t("aloha-large-icon-"+t),markup:r("<"+t+">"),click:function(){return nt(n,t)}}}function rt(n,t){return{name:t,text:c.t("button."+t+".text"),tooltip:c.t("button."+t+".tooltip"),wide:!0,cls:"aloha-ui-multisplit-fullwidth",click:function(){n.removeFormat()}}}function ut(t){n.Selection.changeMarkupOnSelection(r("<"+t+">"))}function ft(t){var h=this,o=r("<"+t+">"),f=n.Selection.rangeObject,s,e;if(typeof t!="undefined"&&t!=""){if(s=p[o[0].nodeName]||[o[0].nodeName],e=f.findMarkup(function(){return-1!==u.indexOf(s,this.nodeName)},n.activeEditable.obj),e)f.isCollapsed()?l.Utils.Dom.removeFromDOM(e,f,!0):l.Utils.Dom.removeMarkup(f,r(e),n.activeEditable.obj);else{if(f.isCollapsed()&&(l.Utils.Dom.extendToWord(f),f.isCollapsed()&&i.enabled())){i.setWithRangeObject(v[t],!0,f);return}l.Utils.Dom.addMarkup(f,o)}f.select(),b(h,n.Selection.getRangeObject())}}function b(t,i){var o,e,u,f,s;if(r.each(t.buttons,function(t,e){var s=!1,h=p[e.markup[0].nodeName]||[e.markup[0].nodeName];for(u=0;u<i.markupEffectiveAtStart.length;u++)for(o=i.markupEffectiveAtStart[u],f=0;f<h.length;f++)n.Selection.standardTextLevelSemanticsComparator(o,r("<"+h[f]+">"))&&(e.handle.setState(!0),s=!0);s||e.handle.setState(!1)}),t.multiSplitItems.length>0){for(e=!1,u=0;u<i.markupEffectiveAtStart.length&&!e;u++)for(o=i.markupEffectiveAtStart[u],f=0;f<t.multiSplitItems.length&&!e;f++)(s=t.multiSplitItems[f],s.markup)&&n.Selection.standardTextLevelSemanticsComparator(o,s.markup)&&(t.multiSplitButton.setActiveItem(s.name),e=!0);e||t.multiSplitButton.setActiveItem(null)}}var l=window.GENTICS,a="aloha-format",v={b:"bold",strong:"bold",i:"italic",em:"italic",del:"strikethrough",sub:"subscript",sup:"superscript",u:"underline",s:"strikethrough"},y={strong:"strong",em:"emphasis",s:"strikethrough2"},k={u:!0,em:!0,strong:!0,b:!0,i:!0,cite:!0,q:!0,code:!0,abbr:!0,del:!0,s:!0,sub:!0,sup:!0},d={p:!0,span:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,pre:!0},p={B:["STRONG","B"],I:["EM","I"],STRONG:["STRONG","B"],EM:["EM","I"]};return t.create("format",{config:["b","i","sub","sup","p","span","h1","h2","h3","h4","h5","h6","pre","removeFormat"],availableButtons:["u","strong","del","em","b","i","s","sub","sup","p","span","h1","h2","h3","h4","h5","h6","pre","removeFormat"],hotKey:{formatBold:"ctrl+b",formatItalic:"ctrl+i",formatParagraph:"alt+ctrl+0",formatH1:"alt+ctrl+1",formatH2:"alt+ctrl+2",formatH3:"alt+ctrl+3",formatH4:"alt+ctrl+4",formatH5:"alt+ctrl+5",formatH6:"alt+ctrl+6",formatPre:"ctrl+p",formatDel:"ctrl+d",formatSub:"alt+shift+s",formatSup:"ctrl+shift+s"},init:function(){var t=this;typeof this.settings.hotKey!="undefined"&&r.extend(!0,this.hotKey,this.settings.hotKey),this.initButtons(),n.bind("aloha-plugins-loaded",function(){t.initSidebar(n.Sidebar.right)}),n.bind("aloha-editable-activated",function(n,i){t.applyButtonConfig(i.editable.obj),i.editable.obj.bind("keydown.aloha.format",t.hotKey.formatBold,function(){return t.addMarkup("b"),!1}),i.editable.obj.bind("keydown.aloha.format",t.hotKey.formatItalic,function(){return t.addMarkup("i"),!1}),i.editable.obj.bind("keydown.aloha.format",t.hotKey.formatParagraph,function(){return t.changeMarkup("p"),!1}),i.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH1,function(){return t.changeMarkup("h1"),!1}),i.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH2,function(){return t.changeMarkup("h2"),!1}),i.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH3,function(){return t.changeMarkup("h3"),!1}),i.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH4,function(){return t.changeMarkup("h4"),!1}),i.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH5,function(){return t.changeMarkup("h5"),!1}),i.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH6,function(){return t.changeMarkup("h6"),!1}),i.editable.obj.bind("keydown.aloha.format",t.hotKey.formatPre,function(){return t.changeMarkup("pre"),!1}),i.editable.obj.bind("keydown.aloha.format",t.hotKey.formatDel,function(){return t.addMarkup("del"),!1}),i.editable.obj.bind("keydown.aloha.format",t.hotKey.formatSub,function(){return t.addMarkup("sub"),!1}),i.editable.obj.bind("keydown.aloha.format",t.hotKey.formatSup,function(){return t.addMarkup("sup"),!1})}),n.bind("aloha-editable-deactivated",function(n,t){t.editable.obj.unbind("keydown.aloha.format")})},applyButtonConfig:function(n){var t=this.getEditableConfig(n),u,i,e,f;typeof t=="object"&&(f=[],r.each(t,function(n,t){typeof n=="number"&&typeof t=="string"||f.push(n)}),f.length>0&&(t=f)),this.formatOptions=t;for(u in this.buttons)this.buttons.hasOwnProperty(u)&&(r.inArray(u,t)!==-1?this.buttons[u].handle.show():this.buttons[u].handle.hide());for(e=this.multiSplitItems.length,i=0;i<e;i++)r.inArray(this.multiSplitItems[i].name,t)!==-1?this.multiSplitButton.showItem(this.multiSplitItems[i].name):this.multiSplitButton.hideItem(this.multiSplitItems[i].name)},initButtons:function(){var t=this;this.buttons={},this.multiSplitItems=[],r.each(this.availableButtons,function(i,u){var f=!1;typeof i!="number"&&typeof u!="string"&&(f=u,u=i),k[u]?t.buttons[u]={handle:tt(t,u),markup:r("<"+u+">",{"class":f||""})}:d[u]?t.multiSplitItems.push(it(t,u)):"removeFormat"===u?t.multiSplitItems.push(rt(t,u)):n.log("warn",t,'Button "'+u+'" is not defined')}),this.multiSplitButton=s({name:"formatBlock",items:this.multiSplitItems,hideIfEmpty:!0,scope:"Aloha.continuoustext"}),h.sub("aloha.selection.context-change",function(n){b(t,n.range)})},initSidebar:function(n){var t=this;t.sidebar=n,n.addPanel({id:t.nsClass("sidebar-panel-class"),title:c.t("floatingmenu.tab.format"),content:"",expanded:!0,activeOn:this.formatOptions||!1,onInit:function(){},onActivate:function(n){var i=this,e,f,u,o;(i.effective=n,n[0])&&(i.format=n[0].nodeName.toLowerCase(),e=r("<div>").attr("class",t.nsClass("target-container")),f=r("<fieldset>"),f.append(r("<legend>"+i.format+" "+c.t("format.class.legend")).append(r("<select>"))),e.append(f),u='<div class="'+t.nsClass("target-container")+'"><fieldset><legend>'+c.t("format.class.legend")+'<\/legend><select name="targetGroup" class="'+t.nsClass("radioTarget")+'"><option value="">'+c.t("format.class.none")+"<\/option>",t.config[i.format]&&t.config[i.format]["class"]&&r.each(t.config[i.format]["class"],function(n,t){u+='<option value="'+n+'" >'+t+"<\/option>"}),u+="<\/select><\/fieldset><\/div>",i=this,o=this.setContent(u).content,r(t.nsSel("framename")).live("keyup",function(){r(i.effective).attr("target",r(this).val().replace('"',"&quot;").replace("'","&#39;"))}),i=this,i.effective=n,r(t.nsSel("linkTitle")).val(r(i.effective).attr("title")))}}),n.show()},nsClass:function(){var n=[],t=a;return r.each(arguments,function(){n.push(this==""?t:t+"-"+this)}),r.trim(n.join(" "))},nsSel:function(){var n=[],t=a;return r.each(arguments,function(){n.push("."+(this==""?t:t+"-"+this))}),r.trim(n.join(" "))},addMarkup:ft,changeMarkup:ut,removeFormat:function(){var i=["u","strong","em","b","i","q","del","s","code","sub","sup","p","span","h1","h2","h3","h4","h5","h6","pre","quote","blockquote"],u=n.Selection.rangeObject,t;if(this.settings.removeFormats&&(i=this.settings.removeFormats),!u.isCollapsed()){for(t=0;t<i.length;t++)l.Utils.Dom.removeMarkup(u,r("<"+i[t]+">"),n.activeEditable.obj);u.select()}},toString:function(){return"format"}})}),define("list/nls/i18n",{root:{"button.createulist.tooltip":"Insert Unordered List","button.createolist.tooltip":"Insert Ordered List","button.indentlist.tooltip":"Indent List","button.outdentlist.tooltip":"Outdent List","floatingmenu.tab.list":"Lists"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("list/list-plugin",["aloha","jquery","aloha/plugin","ui/ui","ui/scopes","ui/button","ui/toggleButton","i18n!list/nls/i18n","i18n!aloha/nls/i18n","aloha/engine","PubSub"],function(n,t,r,u,f,e,o,s,h,c,l){function y(i,r){t(i).find(i.nodeName).each(function(){w(this)&&n.Markup.transformDomObject(this,r,n.Selection.rangeObject)}),n.Markup.transformDomObject(i,r,n.Selection.rangeObject)}function w(t){var i=n.Selection.getSelectionTree();return p(i,t)}function p(n,i){var r=!1;return t.each(n,function(n,t){(t.domobj===i&&t.selection!=="none"||p(t.children,i))&&(r=!0)}),r}function b(i){var r=!1;return i.children("ul, ol").each(function(){n.Log.debug("performing list-nesting cleanup"),t(this).prev("li").append(this).length||t(this).parent().prepend(document.createElement("li")).append(this),r=!0}),r}var a=window.GENTICS,v=r.create("list",{config:["ul","ol"],transformableElements:{p:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,ul:!0,ol:!0},init:function(){var i=this;this._orderedListButton=u.adopt("orderedList",o,{tooltip:s.t("button.createolist.tooltip"),icon:"aloha-icon aloha-icon-orderedlist",scope:"Aloha.continuoustext",click:function(){i.transformList(!0)}}),this._unorderedListButton=u.adopt("unorderedList",o,{tooltip:s.t("button.createulist.tooltip"),icon:"aloha-icon aloha-icon-unorderedlist",scope:"Aloha.continuoustext",click:function(){i.transformList(!1)}}),this._indentListButton=u.adopt("indentList",e,{tooltip:s.t("button.indentlist.tooltip"),icon:"aloha-icon aloha-icon-indent",scope:"Aloha.continuoustext",click:function(){i.indentList()}}),this._outdentListButton=u.adopt("outdentList",e,{tooltip:s.t("button.outdentlist.tooltip"),icon:"aloha-icon aloha-icon-outdent",scope:"Aloha.continuoustext",click:function(){i.outdentList()}}),f.createScope("Aloha.List","Aloha.continuoustext"),l.sub("aloha.selection.context-change",function(r){var u,f,e=r.range;for(i._outdentListButton.show(!1),i._indentListButton.show(!1),i._unorderedListButton.setState(!1),i._orderedListButton.setState(!1),u=0;u<e.markupEffectiveAtStart.length;u++){if(f=e.markupEffectiveAtStart[u],n.Selection.standardTagNameComparator(f,t("<ul><\/ul>"))){i._unorderedListButton.setState(!0),i._outdentListButton.show(!0),i._indentListButton.show(!0);break}if(n.Selection.standardTagNameComparator(f,t("<ol><\/ol>"))){i._orderedListButton.setState(!0),i._outdentListButton.show(!0),i._indentListButton.show(!0);break}}n.activeEditable&&i.applyButtonConfig(n.activeEditable.obj)}),n.Markup.addKeyHandler(9,function(n){return i.processTab(n)})},applyButtonConfig:function(i){var r=this.getEditableConfig(i);n.Selection.rangeObject.unmodifiableMarkupAtStart[0]&&(t.inArray("ul",r)!=-1&&n.Selection.canTag1WrapTag2(n.Selection.rangeObject.unmodifiableMarkupAtStart[0].nodeName,"ul")!=-1?this._unorderedListButton.show(!0):this._unorderedListButton.show(!1),t.inArray("ol",r)!=-1&&n.Selection.canTag1WrapTag2(n.Selection.rangeObject.unmodifiableMarkupAtStart[0].nodeName,"ol")!=-1?this._orderedListButton.show(!0):this._orderedListButton.show(!1))},processTab:function(n){return n.keyCode===9?n.shiftKey?this.outdentList():this.indentList():!0},getStartingDomObjectToTransform:function(){for(var r=n.Selection.rangeObject,i,t=0;t<r.markupEffectiveAtStart.length;t++)if(i=r.markupEffectiveAtStart[t],this.transformableElements[i.nodeName.toLowerCase()])return i;return!1},getNearestSelectedListItem:function(){for(var r=n.Selection.rangeObject,i,t=0;t<r.markupEffectiveAtStart.length;t++)if(i=r.markupEffectiveAtStart[t],a.Utils.Dom.isListElement(i))return i;return!1},transformList:function(i){var u=this.getStartingDomObjectToTransform(),s,h,f,r,l,e,v,b,k,g,d,o,p,w;if(this._outdentListButton.show(!0),this._indentListButton.show(!0),!u&&(n.Selection.changeMarkupOnSelection(t("<p><\/p>")),u=this.getStartingDomObjectToTransform(),!u)){if(n.Selection.rangeObject.startContainer.contentEditable){r=i?t("<ol><\/ol>"):t("<ul><\/ul>"),f=t("<li><\/li>"),r.append(f),o=f.get(0),g=n.getActiveEditable().obj,o.appendChild(document.createTextNode("")),g.append(r),g.focus(),p=n.createRange(),w=n.getSelection(),p.setStart(o.firstChild,0),p.setEnd(o.firstChild,0),w.removeAllRanges(),w.addRange(p),n.Selection.updateSelection();return}n.Log.error(this,"Could not transform selection into a list");return}if(k=u.nodeName.toLowerCase(),k!="ul"||i)if(k=="ul"&&i)y(u,"ol"),this.mergeAdjacentLists(t(u));else if(k!="ol"||i)if(k=="ol"&&i)r=t(u),e=r.parent(),e.length>0&&a.Utils.Dom.isListElement(e.get(0))?e.get(0).nodeName.toLowerCase()==="li"?(e.after(r.children()),r.remove()):r.children().unwrap():(b=t(u),t.each(b.children("li"),function(t,i){v=n.Markup.transformDomObject(i,"p",n.Selection.rangeObject),v.after(v.children("ol,ul")),c.ensureContainerEditable(v.get(0))}),b.children().unwrap());else{if(l=n.Selection.rangeObject.getSelectedSiblings(u),r=i?t("<ol><\/ol>"):t("<ul><\/ul>"),f=t("<li><\/li>"),r.append(f),t(u).contents().appendTo(f),t(u).replaceWith(r),n.Selection.rangeObject.startContainer==u&&(n.Selection.rangeObject.startContainer=f.get(0)),n.Selection.rangeObject.endContainer==u&&(n.Selection.rangeObject.endContainer=f.get(0)),d=f,l)for(s=!1,h=0;h<l.length;++h)if(a.Utils.Dom.isBlockLevelElement(l[h]))s&&(s=!1),f=n.Markup.transformDomObject(l[h],"li",n.Selection.rangeObject),r.append(f),d=f;else{if(l[h].nodeType==3&&t.trim(l[h].data).length===0)continue;s||(s=t("<li><\/li>"),r.append(s),d=s),s.append(l[h])}this.mergeAdjacentLists(r),o=d.get(0),a.Utils.Dom.isEmpty(o)&&(p=n.createRange(),w=n.getSelection(),o.appendChild(document.createTextNode("")),p.selectNodeContents(o.lastChild),w.removeAllRanges(),w.addRange(p),n.Selection.updateSelection())}else y(u,"ul"),this.mergeAdjacentLists(t(u));else r=t(u),e=r.parent(),e.length>0&&a.Utils.Dom.isListElement(e.get(0))?e.get(0).nodeName.toLowerCase()==="li"?(e.after(r.children()),r.remove()):r.children().unwrap():(b=t(u),t.each(b.children("li"),function(t,i){v=n.Markup.transformDomObject(i,"p",n.Selection.rangeObject),v.after(v.children("ol,ul")),c.ensureContainerEditable(v.get(0))}),b.children().unwrap());this.refreshSelection()},indentList:function(){var i=this.getNearestSelectedListItem(),u,r,f,o,e;if(i){if(e=t(i).prev("li"),e.length===0)return!1;if(o=t(i).parent(),f=n.Selection.rangeObject.getSelectedSiblings(i),r=t(i).parent().clone(!1).empty(),r.append(i),e.append(r),f)for(u=0;u<f.length;++u)r.append(t(f[u]));return this.mergeAdjacentLists(r,!0),this.refreshSelection(),!1}return!0},outdentList:function(){var s=this.getNearestSelectedListItem(),e,h,u,r,c,f,i,o;if(s){if(u=t(s),r=u.parent(),c=r.parents("ul,ol"),f=r.parent("li"),c.length>0&&a.Utils.Dom.isListElement(c.get(0))){if(i=n.Selection.rangeObject.getSelectedSiblings(s),o=i&&i.length>0?t(i[i.length-1]):u,o.nextAll("li").length>0&&(h=r.clone(!1).empty(),h.append(o.nextAll()),o.append(h)),f.length>0?f.after(u):r.before(u),i&&i.length>0)for(e=i.length-1;e>=0;--e)u.after(t(i[e]));r.contents("li").length===0&&r.remove(),f.length>0&&f.contents().length===0&&f.remove(),this.refreshSelection()}return!1}return!0},refreshSelection:function(){n.Selection.rangeObject.update(),n.Selection.rangeObject.select(),n.Selection.updateSelection()},mergeAdjacentLists:function(n,i){for(var r=n.get(0),u;r.previousSibling&&r.previousSibling.nodeType===1&&this.isMergable(r.previousSibling,r,i);)r=r.previousSibling;for(n=t(r);r.nextSibling&&(r.nextSibling.nodeType===1&&this.isMergable(r.nextSibling,r,i)||r.nextSibling.nodeType===3&&t.trim(r.nextSibling.data).length===0);)u=t(r.nextSibling),r.nextSibling.nodeType==1&&u.contents().appendTo(n),u.remove()},isMergable:function(n,t,i){return i?n.nodeName.toLowerCase()=="ul"||n.nodeName.toLowerCase()=="ol":n.nodeName==t.nodeName}});return c.commands.insertorderedlist={action:function(t,i){v.transformList(!0),i&&n.Selection.rangeObject&&(i.startContainer=n.Selection.rangeObject.startContainer,i.startOffset=n.Selection.rangeObject.startOffset,i.endContainer=n.Selection.rangeObject.endContainer,i.endOffset=n.Selection.rangeObject.endOffset)},indeterm:function(){},state:function(){for(i=0;i<rangeObject.markupEffectiveAtStart.length;i++){if(effectiveMarkup=rangeObject.markupEffectiveAtStart[i],n.Selection.standardTagNameComparator(effectiveMarkup,t("<ul><\/ul>")))return!1;if(n.Selection.standardTagNameComparator(effectiveMarkup,t("<ol><\/ol>")))return!0}return!1}},c.commands.insertunorderedlist={action:function(t,i){v.transformList(!1),i&&n.Selection.rangeObject&&(i.startContainer=n.Selection.rangeObject.startContainer,i.startOffset=n.Selection.rangeObject.startOffset,i.endContainer=n.Selection.rangeObject.endContainer,i.endOffset=n.Selection.rangeObject.endOffset)},indeterm:function(){},state:function(){for(i=0;i<rangeObject.markupEffectiveAtStart.length;i++){if(effectiveMarkup=rangeObject.markupEffectiveAtStart[i],n.Selection.standardTagNameComparator(effectiveMarkup,t("<ul><\/ul>")))return!0;if(n.Selection.standardTagNameComparator(effectiveMarkup,t("<ol><\/ol>")))return!1}return!1}},c.commands.indent={action:function(t,i){v.indentList(),i&&n.Selection.rangeObject&&(i.startContainer=n.Selection.rangeObject.startContainer,i.startOffset=n.Selection.rangeObject.startOffset,i.endContainer=n.Selection.rangeObject.endContainer,i.endOffset=n.Selection.rangeObject.endOffset)},indeterm:function(){},state:function(){return!1}},c.commands.outdent={action:function(t,i){v.outdentList(),i&&n.Selection.rangeObject&&(i.startContainer=n.Selection.rangeObject.startContainer,i.startOffset=n.Selection.rangeObject.startOffset,i.endContainer=n.Selection.rangeObject.endContainer,i.endOffset=n.Selection.rangeObject.endOffset)},indeterm:function(){},state:function(){return!1}},v}),define("image/nls/i18n",{root:{"size.natural":"Original size","button.addimg.tooltip":"add image ref","floatingmenu.tab.img":"Image","floatingmenu.tab.formatting":"Formatting","floatingmenu.tab.resize":"Resize","floatingmenu.tab.crop":"Crop","button.uploadimg.tooltip":"Upload img","button.uploadimg.label":"Upload","button.img.align.left.tooltip":"Left align","button.img.align.right.tooltip":"Right Align","button.img.align.none.tooltip":"No alignment","field.img.title.label":"Title","field.img.title.tooltip":"Title","field.img.label":"URL","field.img.tooltip":"Source","border ":"Add Border to Image","padding.increase ":"Increase Padding","padding.decrease ":"Decrease Padding","size.increase ":"Increase Size","size.decrease ":"Decrease Size",Resize:"Resize",Crop:"Crop",Reset:"Reset",Accept:"Accept",Cancel:"Cancel",height:"Height",width:"Width","button.toggle.tooltip":"Toggle keep aspect ratio","field.img.src.label":"Source","field.img.src.tooltip":"Source"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("image/image-floatingMenu",["jquery","util/class","i18n!image/nls/i18n","i18n!aloha/nls/i18n","ui/ui","ui/scopes","ui/button","ui/toggleButton","ui/port-helper-attribute-field"],function(n,t,i,r,u,f,e,o,s){var h=n,c=window.GENTICS,l=window.Aloha;return t.extend({_constructor:function(){},init:function(n){n.floatingMenuControl=this,this.plugin=n,f.createScope(n.name,"Aloha.empty"),this._addUIInsertButton(),this._addUIMetaButtons(),this._addUIResetButton(),this._addUIAlignButtons(),this._addUIMarginButtons(),this._addUICropButtons(),this._addUIResizeButtons(),this._addUIAspectRatioToggleButton()},_addUIAspectRatioToggleButton:function(){var n=this.plugin;this._imageCnrRatioButton=u.adopt("imageCnrRatio",o,{tooltip:i.t("button.toggle.tooltip"),icon:"aloha-icon-cnr-ratio",scope:n.name,click:function(){n.toggleKeepAspectRatio()}}),n.settings.fixedAspectRatio!==!1&&(this._imageCnrRatioButton.setState(!0),n.keepAspectRatio=!0)},_addUIResetButton:function(){var n=this.plugin;this._imageCnrResetButton=u.adopt("imageCnrReset",e,{tooltip:i.t("Reset"),icon:"aloha-icon-cnr-reset",scope:n.name,click:function(){n.reset()}})},_addUIInsertButton:function(){var n=this.plugin;this._insertImageButton=u.adopt("insertImage",e,{tooltip:i.t("button.addimg.tooltip"),icon:"aloha-button aloha-image-insert",scope:"Aloha.continuoustext",click:function(){n.insertImg()}})},_addUIMetaButtons:function(){var n=this.plugin;this.imgSrcField=s({label:i.t("field.img.src.label"),labelClass:"aloha-image-input-label",tooltip:i.t("field.img.src.tooltip"),name:"imageSource",scope:n.name}),this.imgSrcField.setTemplate("<span><b>{name}<\/b><br/>{url}<\/span>"),this.imgSrcField.setObjectTypeFilter(n.objectTypeFilter),this.imgTitleField=s({label:i.t("field.img.title.label"),labelClass:"aloha-image-input-label",tooltip:i.t("field.img.title.tooltip"),name:"imageTitle",scope:n.name}),this.imgTitleField.setObjectTypeFilter()},_addUIAlignButtons:function(){var t=this.plugin;this._imageAlignLeftButton=u.adopt("imageAlignLeft",e,{tooltip:i.t("button.img.align.left.tooltip"),icon:"aloha-img aloha-image-align-left",scope:t.name,click:function(){var i=n(t.getPluginFocus());i.add(i.parent()).css("float","left")}}),this._imageAlignRightButton=u.adopt("imageAlignRight",e,{tooltip:i.t("button.img.align.right.tooltip"),icon:"aloha-img aloha-image-align-right",scope:t.name,click:function(){var i=n(t.getPluginFocus());i.add(i.parent()).css("float","right")}}),this._imageAlignNoneButton=u.adopt("imageAlignNone",e,{tooltip:i.t("button.img.align.none.tooltip"),icon:"aloha-img aloha-image-align-none",scope:t.name,click:function(){var i=n(t.getPluginFocus());i.add(i.parent()).css({float:"none",display:"inline-block"})}})},_addUIMarginButtons:function(){var t=this.plugin;this._imageIncPaddingButton=u.adopt("imageIncPadding",e,{tooltip:i.t("padding.increase"),icon:"aloha-img aloha-image-padding-increase",scope:t.name,click:function(){n(t.getPluginFocus()).increase("padding")}}),this._imageDecPaddingButton=u.adopt("imageDecPadding",e,{tooltip:i.t("padding.decrease"),icon:"aloha-img aloha-image-padding-decrease",scope:t.name,click:function(){n(t.getPluginFocus()).decrease("padding")}})},_addUICropButtons:function(){var n=this.plugin;f.createScope("Aloha.img",["Aloha.global"]),this._imageCropButton=u.adopt("imageCropButton",o,{tooltip:i.t("Crop"),icon:"aloha-icon-cnr-crop",scope:n.name,click:function(){this.getState()?n.crop():n.endCrop()}})},_addUIResizeButtons:function(){var n=this.plugin;this.imgResizeHeightField=s({label:i.t("height"),labelClass:"aloha-image-input-label",name:"imageResizeHeight",width:50,scope:n.name}),this.imgResizeHeightField.maxValue=n.settings.maxHeight,this.imgResizeHeightField.minValue=n.settings.minHeight,this.imgResizeWidthField=s({label:i.t("width"),labelClass:"aloha-image-input-label",name:"imageResizeWidth",width:50,scope:n.name}),this.imgResizeWidthField.maxValue=n.settings.maxWidth,this.imgResizeWidthField.minValue=n.settings.minWidth},setScope:function(){f.setScope(this.plugin.name)},doLayout:function(){}})}),define("image/vendor/jcrop/jquery.jcrop.min",["jquery"],function(n){(function(n){n.Jcrop=function(t,r){function f(n){return""+parseInt(n)+"px"}function k(n){return""+parseInt(n)+"%"}function ot(n){return u.baseClass+"-"+n}function at(t){var i=n(t).offset();return[i.left,i.top]}function st(n){return[n.pageX-et[0],n.pageY-et[1]]}function oi(n){n!=dt&&(y.setCursor(n),dt=n)}function si(n,t){if(et=at(l),y.setCursor(n=="move"?n:n+"-resize"),n=="move")return y.activateHandlers(ci(t),yt);var r=e.getFixed(),i=ti(n),u=e.getCorner(ti(i));e.setPressed(e.getCorner(i)),e.setCurrent(u),y.activateHandlers(hi(n,r),yt)}function hi(n,t){return function(i){if(u.aspectRatio)switch(n){case"e":i[1]=t.y+1;break;case"w":i[1]=t.y+1;break;case"n":i[0]=t.x+1;break;case"s":i[0]=t.x+1}else switch(n){case"e":i[1]=t.y2;break;case"w":i[1]=t.y2;break;case"n":i[0]=t.x2;break;case"s":i[0]=t.x2}e.setCurrent(i),o.update()}}function ci(n){var t=n;return lt.watchKeys(),function(n){e.moveOffset([n[0]-t[0],n[1]-t[1]]),t=n,o.update()}}function ti(n){switch(n){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function ii(n){return function(t){return u.disabled?!1:n=="move"&&!u.allowMove?!1:(rt=!0,si(n,st(t)),t.stopPropagation(),t.preventDefault(),!1)}}function li(n,t,i){var r=n.width(),u=n.height();r>t&&t>0&&(r=t,u=t/n.width()*n.height()),u>i&&i>0&&(u=i,r=i/n.height()*n.width()),a=n.width()/r,v=n.height()/u,n.width(r).height(u)}function vt(n){return{x:parseInt(n.x*a),y:parseInt(n.y*v),x2:parseInt(n.x2*a),y2:parseInt(n.y2*v),w:parseInt(n.w*a),h:parseInt(n.h*v)}}function yt(){var n=e.getFixed();n.w>u.minSelect[0]&&n.h>u.minSelect[1]?(o.enableHandles(),o.done()):o.release(),y.setCursor(u.allowSelect?"crosshair":"default")}function ai(n){if(u.disabled||!u.allowSelect)return!1;rt=!0,et=at(l),o.disableHandles(),oi("crosshair");var t=st(n);return e.setPressed(t),y.activateHandlers(vi,yt),lt.watchKeys(),o.update(),n.stopPropagation(),n.preventDefault(),!1}function vi(n){e.setCurrent(n),o.update()}function ri(){var t=n("<div><\/div>").addClass(ot("tracker"));return n.browser.msie&&t.css({opacity:0,backgroundColor:"white"}),t}function yi(n){function l(){window.setTimeout(c,w)}var y=n[0]/a,p=n[1]/v,s=n[2]/a,h=n[3]/v,c;if(!gt){var r=e.flipCoords(y,p,s,h),f=e.getFixed(),t=initcr=[f.x,f.y,f.x2,f.y2],w=u.animationDelay,b=t[0],k=t[1],s=t[2],h=t[3],d=r[0]-initcr[0],g=r[1]-initcr[1],nt=r[2]-initcr[2],tt=r[3]-initcr[3],i=0,it=u.swingSpeed;o.animMode(!0),c=function(){return function(){i+=(100-i)/it,t[0]=b+i/100*d,t[1]=k+i/100*g,t[2]=s+i/100*nt,t[3]=h+i/100*tt,i<100?l():o.done(),i>=99.8&&(i=100),fi(t)}}(),l()}}function ui(n){fi([n[0]/a,n[1]/v,n[2]/a,n[3]/v])}function fi(n){e.setPressed([n[0],n[1]]),e.setCurrent([n[2],n[3]]),o.update()}function ei(t){typeof t!="object"&&(t={}),u=n.extend(u,t),typeof u.onChange!="function"&&(u.onChange=function(){}),typeof u.onSelect!="function"&&(u.onSelect=function(){})}function pi(){return vt(e.getFixed())}function wi(){return e.getFixed()}function bi(n){ei(n),pt()}function ki(){u.disabled=!0,o.disableHandles(),o.setCursor("default"),y.setCursor("default")}function di(){u.disabled=!1,pt()}function gi(){o.done(),y.activateHandlers(null,null)}function nr(){ht.remove(),p.show()}function pt(n){u.allowResize?n?o.enableOnly():o.enableHandles():o.disableHandles(),y.setCursor(u.allowSelect?"crosshair":"default"),o.setCursor(u.allowMove?"move":"default"),ht.css("backgroundColor",u.bgColor),"setSelect"in u&&(ui(r.setSelect),o.done(),delete u.setSelect),"trueSize"in u&&(a=u.trueSize[0]/c,v=u.trueSize[1]/s),g=u.maxSize[0]||0,nt=u.maxSize[1]||0,tt=u.minSize[0]||0,it=u.minSize[1]||0,"outerImage"in u&&(l.attr("src",u.outerImage),delete u.outerImage),o.refresh()}var t=t,r=r,bt,u,p,l,wt;typeof t!="object"&&(t=n(t)[0]),typeof r!="object"&&(r={}),"trackDocument"in r||(r.trackDocument=n.browser.msie?!1:!0,n.browser.msie&&n.browser.version.split(".")[0]=="8"&&(r.trackDocument=!0)),"keySupport"in r||(r.keySupport=n.browser.msie?!1:!0),bt={trackDocument:!1,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,borderOpacity:.4,handleOpacity:.5,handlePad:5,handleSize:9,handleOffset:5,edgeMargin:14,aspectRatio:0,keySupport:!0,cornerHandles:!0,sideHandles:!0,drawBorders:!0,dragEdges:!0,boxWidth:0,boxHeight:0,boundary:8,animationDelay:20,swingSpeed:3,allowSelect:!0,allowMove:!0,allowResize:!0,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){}},u=bt,ei(r),p=n(t),l=p.clone().removeAttr("id").css({position:"absolute"}),l.width(p.width()),l.height(p.height()),p.after(l).hide(),li(l,u.boxWidth,u.boxHeight);var c=l.width(),s=l.height(),ht=n("<div />").width(c).height(s).addClass(ot("holder")).css({position:"relative",backgroundColor:u.bgColor}).insertAfter(p).append(l);u.addClass&&ht.addClass(u.addClass);var kt=n("<img />").attr("src",l.attr("src")).css("position","absolute").width(c).height(s),ct=n("<div />").width(k(100)).height(k(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(kt),b=n("<div />").width(k(100)).height(k(100)).css("zIndex",320),ut=n("<div />").css({position:"absolute",zIndex:300}).insertBefore(l).append(ct,b),ft=u.boundary,d=ri().width(c+ft*2).height(s+ft*2).css({position:"absolute",top:f(-ft),left:f(-ft),zIndex:290}).mousedown(ai),g,nt,tt,it,a,v,et=at(l),rt,dt,gt,ni,e=function(){function b(u){var u=y(u);r=n=u[0],i=t=u[1]}function k(n){var n=y(n);e=n[0]-r,o=n[1]-i,r=n[0],i=n[1]}function d(){return[e,o]}function rt(u){var f=u[0],e=u[1];0>n+f&&(f-=f+n),0>t+e&&(e-=e+t),s<i+e&&(e+=s-(i+e)),c<r+f&&(f+=c-(r+f)),n+=f,r+=f,t+=e,i+=e}function ut(n){var t=l();switch(n){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function l(){if(!u.aspectRatio)return ft();var l=u.aspectRatio,b=u.minSize[0]/a,rt=u.minSize[1]/v,y=u.maxSize[0]/a,g=u.maxSize[1]/v,k=r-n,d=i-t,nt=Math.abs(k),tt=Math.abs(d),it=nt/tt,e,o;return y==0&&(y=c*10),g==0&&(g=s*10),it<l?(o=i,w=tt*l,e=k<0?n-w:w+n,e<0?(e=0,h=Math.abs((e-n)/l),o=d<0?t-h:h+t):e>c&&(e=c,h=Math.abs((e-n)/l),o=d<0?t-h:h+t)):(e=r,h=nt/l,o=d<0?t-h:t+h,o<0?(o=0,w=Math.abs((o-t)*l),e=k<0?n-w:w+n):o>s&&(o=s,w=Math.abs(o-t)*l,e=k<0?n-w:w+n)),e>n?(e-n<b?e=n+b:e-n>y&&(e=n+y),o=o>t?t+(e-n)/l:t-(e-n)/l):e<n&&(n-e<b?e=n-b:n-e>y&&(e=n-y),o=o>t?t+(n-e)/l:t-(n-e)/l),e<0?(n-=e,e=0):e>c&&(n-=e-c,e=c),o<0?(t-=o,o=0):o>s&&(t-=o-s,o=s),last=p(f(n,t,e,o))}function y(n){return n[0]<0&&(n[0]=0),n[1]<0&&(n[1]=0),n[0]>c&&(n[0]=c),n[1]>s&&(n[1]=s),[n[0],n[1]]}function f(n,t,i,r){var u=n,f=i,e=t,o=r;return i<n&&(u=i,f=n),r<t&&(e=r,o=t),[Math.round(u),Math.round(e),Math.round(f),Math.round(o)]}function ft(){var e=r-n,o=i-t,u;return g&&Math.abs(e)>g&&(r=e>0?n+g:n-g),nt&&Math.abs(o)>nt&&(i=o>0?t+nt:t-nt),it&&Math.abs(o)<it&&(i=o>0?t+it:t-it),tt&&Math.abs(e)<tt&&(r=e>0?n+tt:n-tt),n<0&&(r-=n,n-=n),t<0&&(i-=t,t-=t),r<0&&(n-=r,r-=r),i<0&&(t-=i,i-=i),r>c&&(u=r-c,n-=u,r-=u),i>s&&(u=i-s,t-=u,i-=u),n>c&&(u=n-s,i-=u,t-=u),t>s&&(u=t-s,i-=u,t-=u),p(f(n,t,r,i))}function p(n){return{x:n[0],y:n[1],x2:n[2],y2:n[3],w:n[2]-n[0],h:n[3]-n[1]}}var n=0,t=0,r=0,i=0,e,o;return{flipCoords:f,setPressed:b,setCurrent:k,getOffset:d,moveOffset:rt,getCorner:ut,getFixed:l}}(),o=function(){function h(t){var i=n("<div />").css({position:"absolute",opacity:u.borderOpacity}).addClass(ot(t));return ct.append(i),i}function d(t,i){var r=n("<div />").mousedown(ii(t)).css({cursor:t+"-resize",position:"absolute",zIndex:i});return b.append(r),r}function et(n){return d(n,w++).css({top:f(-r+1),left:f(-r+1),opacity:u.handleOpacity}).addClass(ot("handle"))}function c(n){var t=u.handleSize,i=r,e=t,o=t,s=i,h=i;switch(n){case"n":case"s":o=k(100);break;case"e":case"w":e=k(100)}return d(n,w++).width(o).height(e).css({top:f(-s+1),left:f(-h+1)})}function g(n){for(i in n)t[n[i]]=et(n[i])}function y(n){var e=Math.round(n.h/2-r),o=Math.round(n.w/2-r),s=west=-r+1,i=n.w-r,u=n.h-r;"e"in t&&t.e.css({top:f(e),left:f(i)})&&t.w.css({top:f(e)})&&t.s.css({top:f(u),left:f(o)})&&t.n.css({left:f(o)}),"ne"in t&&t.ne.css({left:f(i)})&&t.se.css({top:f(u),left:f(i)})&&t.sw.css({top:f(u)}),"b"in t&&t.b.css({top:f(u)})&&t.r.css({left:f(i)})}function st(n,t){kt.css({top:f(-t),left:f(-n)}),ut.css({top:f(t),left:f(n)})}function ht(n,t){ut.width(n).height(t)}function nt(){var n=e.getFixed();e.setPressed([n.x,n.y]),e.setCurrent([n.x2,n.y2]),tt()}function tt(){if(s)return it()}function it(){var n=e.getFixed();ht(n.w,n.h),st(n.x,n.y),u.drawBorders&&v.right.css({left:f(n.w-1)})&&v.bottom.css({top:f(n.h-1)}),o&&y(n),s||lt();u.onChange(vt(n))}function lt(){ut.show(),l.css("opacity",u.bgOpacity),s=!0}function at(){a(),ut.hide(),l.css("opacity",1),s=!1}function yt(){o&&(y(e.getFixed()),b.show())}function rt(){return o=!0,u.allowResize?(y(e.getFixed()),b.show(),!0):void 0}function a(){o=!1,b.hide()}function ft(n){(gt=n)?a():rt()}function pt(){ft(!1),nt()}var s,w=370,v={},t={},o=!1,r=u.handleOffset,p;return u.drawBorders&&(v={top:h("hline").css("top",n.browser.msie?f(-1):f(0)),bottom:h("hline"),left:h("vline"),right:h("vline")}),u.dragEdges&&(t.t=c("n"),t.b=c("s"),t.r=c("e"),t.l=c("w")),u.sideHandles&&g(["n","s","e","w"]),u.cornerHandles&&g(["sw","nw","ne","se"]),p=ri().mousedown(ii("move")).css({cursor:"move",position:"absolute",zIndex:360}),ct.append(p),a(),{updateVisible:tt,update:it,release:at,refresh:nt,setCursor:function(n){p.css("cursor",n)},enableHandles:rt,enableOnly:function(){o=!0},showHandles:yt,disableHandles:a,animMode:ft,done:pt}}(),y=function(){function s(){d.css({zIndex:450}),f&&n(document).mousemove(o).mouseup(t)}function h(){d.css({zIndex:290}),f&&n(document).unbind("mousemove",o).unbind("mouseup",t)}function o(n){i(st(n))}function t(n){if(n.preventDefault(),n.stopPropagation(),rt){rt=!1,r(st(n));u.onSelect(vt(e.getFixed()));h(),i=function(){},r=function(){}}return!1}function c(n,t){return rt=!0,i=n,r=t,s(),!1}function a(n){d.css("cursor",n)}var i=function(){},r=function(){},f=u.trackDocument;return f||d.mousemove(o).mouseup(t).mouseout(t),l.before(d),{activateHandlers:c,setCursor:a}}(),lt=function(){function f(){u.keySupport&&(t.show(),t.focus())}function s(){t.hide()}function i(n,t,i){u.allowMove&&(e.moveOffset([t,i]),o.updateVisible()),n.preventDefault(),n.stopPropagation()}function h(n){if(n.ctrlKey)return!0;ni=n.shiftKey?!0:!1;var t=ni?10:1;switch(n.keyCode){case 37:i(n,-t,0);break;case 39:i(n,t,0);break;case 38:i(n,0,-t);break;case 40:i(n,0,t);break;case 27:o.release();break;case 9:return!0}return nothing(n)}var t=n('<input type="radio" />').css({position:"absolute",left:"-30px"}).keypress(h).blur(s),r=n("<div />").css({position:"absolute",overflow:"hidden"}).append(t);return u.keySupport&&r.insertBefore(l),{watchKeys:f}}();return b.hide(),pt(!0),wt={animateTo:yi,setSelect:ui,setOptions:bi,tellSelect:pi,tellScaled:wi,disable:ki,enable:di,cancel:gi,focus:lt.watchKeys,getBounds:function(){return[c*a,s*v]},getWidgetSize:function(){return[c,s]},release:o.release,destroy:nr},p.data("Jcrop",wt),wt},n.fn.Jcrop=function(t){function i(i){var u=t.useImg||i.src,r=new Image;r.onload=function(){n.Jcrop(i,t)},r.src=u}return typeof t!="object"&&(t={}),this.each(function(){if(n(this).data("Jcrop")){if(t=="api")return n(this).data("Jcrop");n(this).data("Jcrop").setOptions(t)}else i(this)}),this}})(n)}),define("image/vendor/mousewheel/mousewheel",["jquery"],function(n){(function(n){function r(t){var i=t||window.event,e=[].slice.call(arguments,1),r=0,f=0,u=0;return t=n.event.fix(i),t.type="mousewheel",i.wheelDelta&&(r=i.wheelDelta/120),i.detail&&(r=-i.detail/3),u=r,i.axis!==undefined&&i.axis===i.HORIZONTAL_AXIS&&(u=0,f=-1*r),i.wheelDeltaY!==undefined&&(u=i.wheelDeltaY/120),i.wheelDeltaX!==undefined&&(f=i.wheelDeltaX/-120),e.unshift(t,r,f,u),(n.event.dispatch||n.event.handle).apply(this,e)}var t=["DOMMouseScroll","mousewheel"],i;if(n.event.fixHooks)for(i=t.length;i;)n.event.fixHooks[t[--i]]=n.event.mouseHooks;n.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var n=t.length;n;)this.addEventListener(t[--n],r,!1);else this.onmousewheel=r},teardown:function(){if(this.removeEventListener)for(var n=t.length;n;)this.removeEventListener(t[--n],r,!1);else this.onmousewheel=null}},n.fn.extend({mousewheel:function(n){return n?this.bind("mousewheel",n):this.trigger("mousewheel")},unmousewheel:function(n){return this.unbind("mousewheel",n)}})})(n)}),define("image/image-plugin",["jquery","aloha/plugin","image/image-floatingMenu","i18n!aloha/nls/i18n","i18n!image/nls/i18n","jqueryui","image/vendor/jcrop/jquery.jcrop.min","image/vendor/mousewheel/mousewheel"],function(n,t,i,r,u){var f=n,e=n,h=window.GENTICS,o=window.Aloha,s=!1;return String.prototype.toInteger=String.prototype.toInteger||function(){return parseInt(String(this).replace(/px$/,"")||0,10)},String.prototype.toFloat=String.prototype.toInteger||function(){return parseFloat(String(this).replace(/px$/,"")||0,10)},Number.prototype.toInteger=Number.prototype.toInteger||String.prototype.toInteger,Number.prototype.toFloat=Number.prototype.toFloat||String.prototype.toFloat,f.extend(!0,f.fn,{increase:f.fn.increase||function(n){var t=f(this),r,i;return t.length?(r=t.css(n).toFloat(),i=Math.round((r||1)*1.2),r===i&&i++,t.css(n,i),t):t},decrease:f.fn.decrease||function(n){var t=f(this),r,i;return t.length?(r=t.css(n).toFloat(),i=Math.round((r||0)*.8),r===i&&i>0&&i--,t.css(n,i),t):t}}),t.create("image",{defaultSettings:{maxWidth:1600,minWidth:3,maxHeight:1200,minHeight:3,autoCorrectManualInput:!0,fixedAspectRatio:!1,autoResize:!1,ui:{meta:!0,crop:!0,resizable:!0},handles:"ne, se, sw, nw",onCropped:function(n,t){o.Log.info("Default onCropped invoked",n,t)},onReset:function(n){return o.Log.info("Default onReset invoked",n),!1},onResize:function(n){o.Log.info("Default onResize invoked",n)},onResized:function(n){o.Log.info("Default onResized invoked",n)}},_onCropped:function(n,t){e("body").trigger("aloha-image-cropped",[n,t]),this.keepAspectRatio&&(this.aspectRatioValue=this.imageObj.width()/this.imageObj.height());this.onCropped(n,t)},_onReset:function(n){e("body").trigger("aloha-image-reset",n),e("#"+this.ui.imgResizeHeightField.getInputId()).val(n.height()),e("#"+this.ui.imgResizeWidthField.getInputId()).val(n.width());return this.onReset(n)},_onResize:function(n){e("body").trigger("aloha-image-resize",n),e("#"+this.ui.imgResizeHeightField.getInputId()).val(n.height()),e("#"+this.ui.imgResizeWidthField.getInputId()).val(n.width());this.onResize(n)},_onResized:function(n){e("body").trigger("aloha-image-resized",n),e("#"+this.ui.imgResizeHeightField.getInputId()).val(n.height()),e("#"+this.ui.imgResizeWidthField.getInputId()).val(n.width());this.onResized(n)},imageObj:null,jcAPI:null,keepAspectRatio:!1,aspectRatioValue:!1,restoreProps:[],objectTypeFilter:[],init:function(){var n=this,t=o.getPluginUrl("image");typeof this.settings.objectTypeFilter!="undefined"&&(this.objectTypeFilter=this.settings.objectTypeFilter),n.config=n.defaultSettings,n.settings=f.extend(!0,n.defaultSettings,n.settings),typeof this.settings.fixedAspectRatio=="number"?(this.aspectRatioValue=this.settings.fixedAspectRatio,n.keepAspectRatio=!0):n.keepAspectRatio=n.settings.fixedAspectRatio===!0?!0:!1,n.initializeUI(),n.bindInteractions(),n.subscribeEvents()},initializeUI:function(){var n=this;this.ui=new i,this.ui.init(this)},bindInteractions:function(){var n=this;if(n.settings.ui.resizable)try{document.execCommand("enableObjectResizing",!1,!1)}catch(t){o.Log.info(t,"Could not disable enableObjectResizing")}n.settings.ui.meta&&(n.ui.imgSrcField.addListener("keyup",function(){n.srcChange()}),n.ui.imgSrcField.addListener("blur",function(){var t=f(n.ui.imgSrcField.getTargetObject());t.attr("src")===""&&t.remove()})),n.settings.onCropped&&typeof n.settings.onCropped=="function"&&(n.onCropped=n.settings.onCropped),n.settings.onReset&&typeof n.settings.onReset=="function"&&(n.onReset=n.settings.onReset),n.settings.onResized&&typeof n.settings.onResized=="function"&&(n.onResized=n.settings.onResized),n.settings.onResize&&typeof n.settings.onResize=="function"&&(n.onResize=this.settings.onResize)},subscribeEvents:function(){var n=this,t=this.settings;f("img").filter(t.globalselector).unbind(),f("img").filter(t.globalselector).click(function(t){n.clickImage(t)}),o.bind("aloha-drop-files-in-editable",function(t,i){for(var r,e=i.filesObjs.length,u,s;--e>=0;)u=i.filesObjs[e],u.file.type.match(/image\//)&&(s=n.getEditableConfig(i.editable),r=f("<img/>"),r.css({"max-width":that.maxWidth,"max-height":that.maxHeight}),r.attr("id",u.id),typeof u.src=="undefined"?r.attr("src",u.data):r.attr("src",u.src),h.Utils.Dom.insertIntoDOM(r,i.range,f(o.activeEditable.obj)))}),o.bind("aloha-selection-changed",function(t,i,r){var e,u;if(r&&r.target&&n.settings.ui.resizable&&!f(r.target).hasClass("ui-resizable-handle")&&(n.endResize(),n.imageObj=null,o.trigger("aloha-image-unselected")),o.activeEditable!==null){if(u=n.findImgMarkup(i),e=n.getEditableConfig(o.activeEditable.obj),typeof e!="undefined")n.ui._insertImageButton.show();else{n.ui._insertImageButton.hide();return}u?(n.ui._insertImageButton.show(),n.ui.setScope(),n.settings.ui.meta&&(n.ui.imgSrcField.setTargetObject(u,"src"),n.ui.imgTitleField.setTargetObject(u,"title")),n.ui.imgSrcField.foreground(),n.ui.imgSrcField.focus()):n.settings.ui.meta&&n.ui.imgSrcField.setTargetObject(null),n.ui.doLayout()}}),o.bind("aloha-editable-created",function(t,i){try{document.execCommand("enableObjectResizing",!1,!1)}catch(r){o.Log.info(r,"Could not disable enableObjectResizing")}i.obj.delegate("img","mouseup",function(t){s||(n.clickImage(t),t.stopPropagation())})}),n._subscribeToResizeFieldEvents()},autoResize:function(n){var t=this,o=f("#"+t.ui.imgResizeWidthField.getInputId()),s=f("#"+t.ui.imgResizeHeightField.getInputId()),i=t.imageObj.width(),r=t.imageObj.height(),e=!1,u;return((i<t.settings.minWidth||i>t.settings.maxWidth||r<t.settings.minHeight||r>t.settings.maxHeight)&&(e=!0),u=i/r,e)?(i>t.settings.maxWidth&&(i=t.settings.maxWidth,r=i/u),r>t.settings.maxHeight&&(r=t.settings.maxHeight,i=r*u),i<t.settings.minWidth&&n&&(i=t.settings.minWidth,r=i/u),r<t.settings.minHeight&&n&&(r=t.settings.minHeight,i=i*u),o.val(i),s.val(r),t.setSizeByFieldValue(),!0):!1},toggleKeepAspectRatio:function(){this.keepAspectRatio=!this.keepAspectRatio,typeof this.jcAPI!="undefined"&&this.jcAPI!==null||(this.endResize(),this.aspectRatioValue=this.keepAspectRatio?typeof this.settings.fixedAspectRatio!="number"?this.imageObj.width()/this.imageObj.height():this.settings.fixedAspectRatio:!1,this.startResize())},_subscribeToResizeFieldEvents:function(){function r(t){var o=t.data.minValue,s=t.data.maxValue,r=t.data.fieldName,i,u,f;return t.keyCode===8||t.keyCode===46?n._updateFields(r,e(this).val(),!1)&&(typeof n.jcAPI!="undefined"&&n.jcAPI!==null?n.setCropAreaByFieldValue():n.setSizeByFieldValue()):t.keyCode<=57&&t.keyCode>=48||t.keyCode<=105&&t.keyCode>=96?n._updateFields(r,e(this).val(),!1)&&(typeof n.jcAPI!="undefined"&&n.jcAPI!==null?n.setCropAreaByFieldValue():n.setSizeByFieldValue()):(i=0,t.keyCode===38||t.keyCode===107?i=1:(t.keyCode===40||t.keyCode===109)&&(i=-1),(t.shiftKey||t.metaKey||t.ctrlKey)&&(i=i*10),u=!1,i<0&&(u=!0),f=parseInt(e(this).val(),10)+i,n._updateFields(r,f,u)&&(typeof n.jcAPI!="undefined"&&n.jcAPI!==null?n.setCropAreaByFieldValue():n.setSizeByFieldValue())),t.preventDefault(),!1}function u(t,i){var o=t.data.minValue,s=t.data.maxValue,f=t.data.fieldName,u,r;return(t.shiftKey||t.metaKey||t.ctrlKey)&&(i=i*10),u=parseInt(e(this).val(),10)+i,r=!1,i<0&&(r=!0),n._updateFields(f,u,r)&&(typeof n.jcAPI!="undefined"&&n.jcAPI!==null?n.setCropAreaByFieldValue():n.setSizeByFieldValue()),!1}var n=this,f=e("#"+n.ui.imgResizeHeightField.getInputId()),o={fieldName:"height",maxValue:n.ui.imgResizeHeightField.maxValue,minValue:n.ui.imgResizeHeightField.minValue},t,i;f.live("keyup",o,r),f.live("mousewheel",o,u),t=e("#"+n.ui.imgResizeWidthField.getInputId()),i={fieldName:"width",maxValue:n.ui.imgResizeWidthField.maxValue,minValue:n.ui.imgResizeWidthField.minValue},t.live("keyup",i,r),t.live("mousewheel",i,u)},setSize:function(n,t){var i=this,r;i.imageObj.width(n),i.imageObj.height(t),r=i.imageObj.closest(".Aloha_Image_Resize"),r.height(t),r.width(n),i._onResize(i.imageObj),i._onResized(i.imageObj)},clickImage:function(n){var t=this,i,s,r,u;if(t.endResize(),t.imageObj=f(n.target),i=t.imageObj,!i.hasClass("aloha-ui")){t.ui.setScope(),s=i.closest(".aloha-editable"),this.ui._imageCnrRatioButton.setState(this.keepAspectRatio),this.restoreProps.push({obj:n.srcElement,src:t.imageObj.attr("src"),width:t.imageObj.width(),height:t.imageObj.height()}),r=e("#"+t.ui.imgResizeHeightField.getInputId()),r.val(t.imageObj.height()),r.css("background-color",""),u=e("#"+t.ui.imgResizeWidthField.getInputId()),u.val(t.imageObj.width()),u.css("background-color",""),t.settings.ui.meta&&(t.ui.imgSrcField.setTargetObject(t.imageObj,"src"),t.ui.imgTitleField.setTargetObject(t.imageObj,"title")),o.Selection.preventSelectionChanged();try{t.ui.imgSrcField.focus()}catch(n){}t.aspectRatioValue=t.imageObj.width()/t.imageObj.height(),t.settings.ui.resizable&&t.startResize(),t.settings.autoResize&&t.autoResize(!0),o.Selection.preventSelectionChangedFlag=!1,o.trigger("aloha-image-selected")}},findImgMarkup:function(n){var u=this,e=this.config,t,i;typeof n=="undefined"&&(n=o.Selection.getRangeObject()),i=f(n.startContainer);try{if(o.activeEditable)return typeof n.startContainer!="undefined"&&typeof n.startContainer.childNodes!="undefined"&&typeof n.startOffset!="undefined"&&typeof n.startContainer.childNodes[n.startOffset]!="undefined"&&n.startContainer.childNodes[n.startOffset].nodeName.toLowerCase()==="img"&&n.startOffset+1===n.endOffset||i.hasClass("Aloha_Image_Resize")?(t=i.find("img")[0],t.css||(t.css=""),t.title||(t.title=""),t.src||(t.src=""),t):null}catch(r){o.Log.debug(r,"Error finding img markup.")}return null},getPluginFocus:function(){return this.imageObj},_updateFields:function(n,t,i){var r=this,u=null,e=null,c=null,l=null,a=null,v=null,y=null,o,s,h;if(n=="width")u=f("#"+r.ui.imgResizeWidthField.getInputId()),e=f("#"+r.ui.imgResizeHeightField.getInputId()),c=1/r.aspectRatioValue,l=r.settings.minWidth,a=r.settings.maxWidth,v=r.settings.minHeight,y=r.settings.maxHeight;else if(n=="height")u=f("#"+r.ui.imgResizeHeightField.getInputId()),e=f("#"+r.ui.imgResizeWidthField.getInputId()),c=r.aspectRatioValue,l=r.settings.minHeight,a=r.settings.maxHeight,v=r.settings.minWidth,y=r.settings.maxWidth;else return!1;return isNaN(t)?(u.css("background-color","red"),!1):(u.val(t),o=!0,t>a?r.settings.autoCorrectManualInput?(u.val(a),t=u.val(),u.css("background-color",""),o=!0):(u.css("background-color","red"),o=!1):t<l?i?(u.val(l),t=u.val(),o=!0):r.settings.autoCorrectManualInput?(u.css("background-color","wheat"),o=!1):(u.css("background-color","red"),o=!1):(u.css("background-color",""),o=!0),s=!0,r.keepAspectRatio&&(h=Math.round(t*c),h>y?r.settings.autoCorrectManualInput?(e.val(y),u.val(e.val()/c),t=u.val(),u.css("background-color",""),e.css("background-color",""),s=!0):(h.css("background-color","red"),s=!1):h<v?i?(e.val(v),u.val(e.val()/c),t=u.val(),o=!0):r.settings.autoCorrectManualInput?(e.val(h),e.css("background-color","wheat"),s=!1):(e.css("background-color","red"),s=!1):(e.val(h),e.css("background-color",""),s=!0)),o&&s)?!0:!1},setSizeByFieldValue:function(){var n=this,t=e("#"+n.ui.imgResizeWidthField.getInputId()).val(),i=e("#"+n.ui.imgResizeHeightField.getInputId()).val();n.setSize(t,i)},setCropAreaByFieldValue:function(){var n=this,t=n.jcAPI.tellSelect(),r=e("#"+n.ui.imgResizeWidthField.getInputId()).val(),i,u;r=parseInt(r,10),i=e("#"+n.ui.imgResizeHeightField.getInputId()).val(),i=parseInt(i,10),u=[t.x,t.y,t.x+r,t.y+i],n.jcAPI.setSelect(u)},insertImg:function(){var n=o.Selection.getRangeObject(),t=this.getEditableConfig(o.activeEditable.obj),e=o.getPluginUrl("image"),i,r,u;n.isCollapsed()?(i="max-width: "+t.maxWidth+"; max-height: "+t.maxHeight,r='<img style="'+i+'" src="'+e+'/img/blank.jpg" title="" />',u=f(r),h.Utils.Dom.insertIntoDOM(u,n,f(o.activeEditable.obj))):o.Log.error("img cannot markup a selection")},srcChange:function(){this.imageObj.attr("src",this.ui.imgSrcField.getValue())},positionCropButtons:function(){var i=f(".jcrop-tracker:first"),u=i.offset(),n=u.top,t=u.left,s=i.height(),h=i.width(),e=0,o=0,r=f("#aloha-CropNResize-btns");n===0&&t===0&&r.hide(),n=parseInt(n+s+3,10),t=parseInt(t+h/2-r.width()/2+10,10),(e!=t||o!=n)&&r.offset({top:n,left:t}),e=t,o=n},initCropButtons:function(){var n=this,t;f("body").append('<div id="aloha-CropNResize-btns" display="none"><button class="cnr-crop-apply" title="'+u.t("Accept")+'"><\/button><button class="cnr-crop-cancel" title="'+u.t("Cancel")+'"><\/button><\/div>'),t=f("#aloha-CropNResize-btns"),t.find(".cnr-crop-apply").click(function(){n.acceptCrop()}),t.find(".cnr-crop-cancel").click(function(){n.endCrop()}),this.interval=setInterval(function(){n.positionCropButtons()},10)},destroyCropButtons:function(){f("#aloha-CropNResize-btns").remove(),clearInterval(this.interval)},_disableSelection:function(n){n.find("*").attr("unselectable","on").css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"})},crop:function(){var n=this,t=this.config;n.initCropButtons(),n.settings.ui.resizable&&n.endResize(),n.jcAPI=f.Jcrop(n.imageObj,{onSelect:function(){n._onCropSelect(),window.setTimeout(function(){n.ui.setScope()},10)}}),n._disableSelection(e(".jcrop-holder")),n._disableSelection(e("#imageContainer")),n._disableSelection(e("#aloha-CropNResize-btns")),e("body").trigger("aloha-image-crop-start",[n.imageObj])},_onCropSelect:function(){var n=this;if(f("#aloha-CropNResize-btns").fadeIn("slow"),f(".jcrop-handle").mousedown(function(){f("#aloha-CropNResize-btns").hide()}),f(".jcrop-tracker").mousedown(function(){f("#aloha-CropNResize-btns").hide()}),typeof n.jcAPI!="undefined"&&n.jcAPI!==null){n.positionCropButtons();var t=n.jcAPI.tellSelect(),i=f("#"+n.ui.imgResizeWidthField.getInputId()).val(t.w),r=f("#"+n.ui.imgResizeHeightField.getInputId()).val(t.h)}},endCrop:function(){this.jcAPI&&(this.jcAPI.destroy(),this.jcAPI=null),this.destroyCropButtons(),this.ui._imageCropButton.setState(!1),this.settings.ui.resizable&&this.startResize(),e("body").trigger("aloha-image-crop-stop",[this.imageObj]),e("#"+this.ui.imgResizeHeightField.getInputId()).val(this.imageObj.height()),e("#"+this.ui.imgResizeWidthField.getInputId()).val(this.imageObj.width())},acceptCrop:function(){this._onCropped(this.imageObj,this.jcAPI.tellSelect()),this.endCrop()},startResize:function(){var n=this,t=this.imageObj,i=n.keepAspectRatio?n.aspectRatioValue:!1;t=this.imageObj.css({height:this.imageObj.height(),width:this.imageObj.width(),position:"relative","max-height":"","max-width":""}),t.resizable({maxHeight:n.settings.maxHeight,minHeight:n.settings.minHeight,maxWidth:n.settings.maxWidth,minWidth:n.settings.minWidth,aspectRatio:i,handles:n.settings.handles,grid:n.settings.grid,resize:function(){s=!0,n._onResize(n.imageObj)},stop:function(t){s=!1,n._onResized(n.imageObj),this.enableCrop&&window.setTimeout(function(){n.ui.setScope(),that.done(t)},10)}}),t.css("display","inline-block"),f(".ui-wrapper").attr("contentEditable",!1).addClass("aloha-image-box-active Aloha_Image_Resize aloha").css({position:"relative",display:"inline-block",float:n.imageObj.css("float")}).bind("resizestart",function(n){n.preventDefault()}).bind("mouseup",function(n){n.originalEvent.stopSelectionUpdate=!0})},endResize:function(){if(this.imageObj)var n=this.imageObj.closest(".aloha-editable");this.imageObj&&this.imageObj.is(":ui-resizable")&&this.imageObj.resizable("destroy").css({top:0,left:0})},resetSize:function(){var n=this,t=new Image;t.onload=function(){var i=n.getPluginFocus();n.settings.ui.resizable&&n.endResize(),f(i).add(i.parent()).css({width:t.width+"px",height:t.height+"px","max-width":"","max-height":""}),n.settings.ui.resizable&&n.resize()},t.src=n.getPluginFocus().attr("src")},reset:function(){if(this.settings.ui.crop&&this.endCrop(),this.settings.ui.resizable&&this.endResize(),!this._onReset(this.imageObj))for(var n=0;n<this.restoreProps.length;n++)if(this.imageObj.get(0)===this.restoreProps[n].obj){this.imageObj.attr("src",this.restoreProps[n].src),this.imageObj.width(this.restoreProps[n].width),this.imageObj.height(this.restoreProps[n].height);return}}})}),define("highlighteditables/highlighteditables-plugin",["aloha","jquery","aloha/plugin"],function(n,t,i){var r=window.GENTICS;return i.create("highlighteditables",{config:["highlight"],init:function(){var t=this,i;r.Utils.Position.addMouseMoveCallback(function(){for(var u,r=0;r<n.editables.length;r++)u=n.editables[r],i=t.getEditableConfig(u.obj),n.activeEditable||u.isDisabled()||i!="highlight"||u.obj.addClass("aloha-editable-highlight")}),r.Utils.Position.addMouseStopCallback(function(){t.fade()}),n.bind("aloha-editable-activated",function(){t.fade()})},fade:function(){for(var i,u=function(){t(this).css("outline","")},r=0;r<n.editables.length;r++)i=n.editables[r].obj,i.hasClass("aloha-editable-highlight")&&i.css("outline",i.css("outlineColor")+" "+i.css("outlineStyle")+" 5px").removeClass("aloha-editable-highlight").animate({outlineWidth:"0px"},300,"swing",u)}})}),define("dom-to-xhtml/dom-to-xhtml",["jquery","util/dom2","util/misc","util/browser","aloha/ephemera","aloha/console"],function(n,t,i,r,u,f){function s(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;")}function p(n){return s(n).replace(/"/g,"&quot;")}function h(n,i){var o=t.attrs(n),a="",f,h,s,l;if(r.ie7)for(s in e)if(e.hasOwnProperty(s)&&n[s]){for(f=0,h=o.length;f<h;f++)if(s===o[f][0].toLowerCase()){o.splice(f,1);break}o.push([s,s])}for(f=0,h=o.length;f<h;f++){var v=o[f],c=v[0].toLowerCase(),y=v[1];i&&u.isAttrEphemeral(n,c,i.attrMap||{},i.attrRxs||{})||(l=e[c],l||""!==y)&&(a+=" "+c+'="'+p(l?c:y)+'"')}return a}function c(n){var r=n.nodeName,t=o[r],u,i;if(null!=t)return t;for(u="/"+n.nodeName,i=n.nextSibling,t=!1;null!=i;){if(u==i.nodeName){t=!0;break}i=i.nextSibling}return o[r]=t,t}function l(n,t,i,r,u){while(null!=t)if(1===t.nodeType&&i&&"/"+n.nodeName==t.nodeName){t=t.nextSibling;break}else 1===t.nodeType&&c(t)?t=a(t,t.nextSibling,!0,r,u):(v(t,r,u),t=t.nextSibling);return t}function a(n,t,i,r,u){var f=n.nodeName.toLowerCase();return n.scopeName&&"HTML"!=n.scopeName&&-1===f.indexOf(":")&&(f=n.scopeName.toLowerCase()+":"+f),!i&&null==t&&y[f]?u.push("<"+f+h(n,r)+"/>"):(u.push("<"+f+h(n,r)+">"),t=l(n,t,i,r,u),u.push("<\/"+f+">")),t}function v(n,t,i){var r=n.nodeType;1===r?a(n,n.firstChild,c(n),t,i):3===n.nodeType?i.push(s(n.nodeValue)):8===n.nodeType?i.push("<!--"+n.nodeValue+"-->"):f.warn("Unknown node type encountered during serialization, ignoring it: type="+n.nodeType+" name="+n.nodeName+" value="+n.nodeValue)}var y={area:!0,base:!0,basefont:!0,br:!0,col:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,link:!0,meta:!0,param:!0,embed:!0},e={checked:!0,compact:!0,declare:!0,defer:!0,disabled:!0,ismap:!0,multiple:!0,nohref:!0,noresize:!0,noshade:!0,nowrap:!0,readonly:!0,selected:!0},o={DIV:!1,SPAN:!1,UL:!1,OL:!1,LI:!1,TABLE:!1,TR:!1,TD:!1,TH:!1,I:!1,B:!1,EM:!1,STRONG:!1,A:!1,P:!1};return{contentsToXhtml:function(n,t){var i=[];return l(n,n.firstChild,!1,t,i),i.join("")},nodeToXhtml:function(n,t){var i=[];return v(n,t,i),i.join("")}}}),define("dom-to-xhtml/dom-to-xhtml-plugin",["aloha","jquery","aloha/plugin","aloha/ephemera","dom-to-xhtml/dom-to-xhtml"],function(n,t,i,r,u){return i.create("dom-to-xhtml",{init:function(){var i=this;n.Editable.setContentSerializer(function(n){return!i.settings.editables&&!i.settings.config?u.contentsToXhtml(n):i.settings.editables&&i.settings.editables["#"+t(n).attr("id")]=="dom-to-xhtml"?u.contentsToXhtml(n,r.ephemera()):i.settings.config&&i.settings.config=="dom-to-xhtml"&&!i.settings.editables["#"+t(n).attr("id")]?u.contentsToXhtml(n,r.ephemera()):t(n).html()})}})}),define("contenthandler/contenthandler-utils",["jquery"],function(n){function t(t){var u=n.trim(t),i,f,r;return u?(i=n("<div>"+u+"<\/div>")[0],f=i.firstChild===i.lastChild&&"p"===i.firstChild.nodeName.toLowerCase(),f)?(r=i.firstChild.children,r&&1===r.length&&"br"===r[0].nodeName.toLowerCase()):!1:!1}function i(t){return typeof t=="string"?n("<div>"+t+"<\/div>"):t instanceof n?n("<div>").append(t):null}return{wrapContent:i,isProppedParagraph:t}}),define("contenthandler/wordcontenthandler",["jquery","aloha","aloha/contenthandlermanager","contenthandler/contenthandler-utils","util/dom"],function(n,t,i,r){function o(t){switch(t[0].nodeName.toLowerCase()){case"table":return 0===t.find("tbody,tr").length;case"tbody":return 0===t.find("tr").length;case"tr":return 0===t.find("td,th").length;default:return""===n.trim(t.text())}}function s(n){if(0===n.length||!f.test(n[0].outerHTML))return!1;for(var i=n.find("*"),r,u,t=0;t<i.length;t++)if((r=i.eq(t).attr("style"),r&&r.toLowerCase().indexOf("mso")>=0)||(u=i.eq(t).attr("class"),u&&u.toLowerCase().indexOf("mso")>=0))return!0;return!1}function h(t){for(var s=t.find("*"),r,i,f,u=0;u<s.length;u++)i=s.eq(u),r=i[0].nodeName.toLowerCase(),"a"===r?(f=i.attr("href"),f&&e.test(n.trim(f))&&i.contents().unwrap()):"div"===r||"span"===r?i.contents().unwrap():"td"!==r&&o(i)&&i.contents().unwrap()}function c(i){i.find("p.MsoTitle").each(function(){t.Markup.transformDomObject(n(this),"h1")}),i.find("p.MsoSubtitle").each(function(){t.Markup.transformDomObject(n(this),"h2")})}var u=n,f=/mso/,e=/^#(.*)/;return i.createHandler({handleContent:function(n){var t=r.wrapContent(n);return t?(s(t)&&this.transformWordContent(t),t.html()):n},isOrderedList:function(n){return n.css("fontFamily")=="Wingdings"||n.css("fontFamily")=="Symbol"?!1:n.text().match(/^([0-9]{1,3}\.)|([0-9]{1,3}\)|([a-zA-Z]{1,5}\.)|([a-zA-Z]{1,5}\)))$/)?!0:!1},transformListsFromWord:function(n){var e=this,o,i,s,r,f,t;t="aloha-list-element",f="aloha-list-bullet",i="p.MsoListParagraphCxSpFirst,p.MsoListParagraphCxSpMiddle,p.MsoListParagraphCxSpLast,p.MsoListParagraph,p span",r=n.find(i),r.each(function(){var n=u(this),i=n.css("font-family")||"",r=n.css("mso-list")||"",f=n.attr("style")||"";n.hasClass("MsoListParagraphCxSpFirst")||n.hasClass("MsoListParagraph")?n.addClass(t):i.indexOf("Symbol")>=0?n.closest("p").addClass(t):i.indexOf("Wingdings")>=0?n.closest("p").addClass(t):r!==""?n.closest("p").addClass(t):f.indexOf("mso-list")>=0&&n.closest("p").addClass(t)}),i="p span span span",s=n.find(i),s.each(function(){var n=u(this),r=u.trim(n.text()).replace(/&nbsp;/g,""),i;r.length===0&&(i=u.trim(n.parent().parent().text()).replace(/&nbsp;/g,""),i.match(/^([0-9]{1,3}\.)|([0-9]{1,3}\))|([a-zA-Z]{1,5}\.)|([a-zA-Z]{1,5}\))|(.)$/)&&(n.closest("p").addClass(t),n.parent().parent().addClass(f)))}),i="p."+t,o=":not("+i+", font)",r=n.find(i),r.length>0&&r.each(function(){var r=u(this),c,i,a,n,v,l,s,h;r.removeClass(t),r.find("font").each(function(){u(this).contents().unwrap()}),h=[],s=parseFloat(r.css("marginLeft")),isNaN(s)&&(s=0),l=[],v=r.nextUntil(o),n=u(r.find("span."+f)),n.length===0&&(n=r.find("span").eq(0)),a=e.isOrderedList(n),n.remove(),i=u(a?"<ol><\/ol>":"<ul><\/ul>"),l.push(i),c=u("<li><\/li>"),i.append(c),r.contents().appendTo(c),r.replaceWith(i),v.each(function(){var r=u(this),t,o;if(!r.is("font")){if(r.find("font").each(function(){u(this).contents().unwrap()}),t=parseFloat(r.css("marginLeft")),isNaN(t)&&(t=0),n=u(r.find("span."+f)),n.length===0&&(n=r.find("span").eq(0)),a=e.isOrderedList(n),n.remove(),t>s)o=u(a?"<ol><\/ol>":"<ul><\/ul>"),i.children(":last").append(o),i=o,l.push(i),h.push(t),s=t;else if(t<s&&h.length>0){while(h.length>0&&h[h.length-1]>t)h.pop(),l.pop();i=l[l.length-1],s=t}c=u("<li><\/li>"),i.append(c),r.contents().appendTo(c),r.remove()}})})},removeParagraphNumbering:function(n){var t=n.find("h1,h2,h3,h4,h5,h6");t.length>0&&t.each(function(){var n=u(this),t=n.find("span"),i=n.find("a");t.each(function(){u.trim(u(this).text()).match(/^([\.\(]?[\d\D][\.\(]?){1,4}$/)&&u(this).remove()}),i.each(function(){typeof u(this).attr("href")=="undefined"&&u(this).contents().unwrap()})})},transformToc:function(n){var t=n.find("[class*=MsoToc]");t.each(function(){var n=u(this),t=n.find("span"),i=n.find("a");t.each(function(){u(this).attr("style")&&u(this).attr("style").search("mso-hide")>-1&&u(this).remove(),u(this).contents().unwrap()}),i.each(function(){u(this).contents().unwrap()})})},transformWordContent:function(n){this.transformToc(n),this.removeParagraphNumbering(n),this.transformListsFromWord(n),c(n),h(n)}})}),define("contenthandler/genericcontenthandler",["jquery","aloha","aloha/contenthandlermanager","contenthandler/contenthandler-utils"],function(n,t,i,r){function u(t){var u=n.trim(t),i,f,r;return u?(i=n("<div>"+u+"<\/div>")[0],f=i.firstChild===i.lastChild&&"p"===i.firstChild.nodeName.toLowerCase(),f)?(r=i.firstChild.children,r&&1===r.length&&"br"===r[0].nodeName.toLowerCase()):!1:!1}function f(t){t.find("table").removeAttr("cellpadding").removeAttr("cellspacing").removeAttr("border").removeAttr("border-top").removeAttr("border-bottom").removeAttr("border-left").removeAttr("border-right"),t.find("td").each(function(){var t=this,i;u(t.innerHTML)&&(t.innerHTML="&nbsp;"),i=n(">p",t),1===i.length&&i.contents().unwrap()}),t.find("td,tr").removeAttr("width").removeAttr("height").removeAttr("valign"),t.find("colgroup").remove()}return i.createHandler({handleContent:function(n){var i=r.wrapContent(n),u;return i?i.find(".aloha-block").length?i.html():(f(i),this.cleanLists(i),this.removeComments(i),this.unwrapTags(i),this.removeStyles(i),this.removeNamespacedElements(i),u=!0,t.settings.contentHandler&&t.settings.contentHandler.handler&&t.settings.contentHandler.handler.generic&&typeof t.settings.contentHandler.handler.generic.transformFormattings!="undefinded"&&!t.settings.contentHandler.handler.generic.transformFormattings&&(u=!1),u&&this.transformFormattings(i),i.html()):n},cleanLists:function(n){n.find("ul,ol").find(">:not(li)").remove()},transformFormattings:function(i){i.find("strong,em,s,u,strike").each(function(){this.nodeName==="STRONG"?t.Markup.transformDomObject(n(this),"b"):this.nodeName==="EM"?t.Markup.transformDomObject(n(this),"i"):this.nodeName==="S"||this.nodeName=="STRIKE"?t.Markup.transformDomObject(n(this),"del"):this.nodeName==="U"&&n(this).contents().unwrap()})},transformLinks:function(t){t.find("a").each(function(){typeof n(this).attr("href")=="undefined"&&n(this).contents().unwrap()})},removeComments:function(t){var i=this;t.contents().each(function(){this.nodeType===8?n(this).remove():i.removeComments(n(this))})},unwrapTags:function(i){var r=this;i.find("span,font,div").not(".aloha-wai-lang").each(function(){this.nodeName=="DIV"?this.innerHTML==="<br>"?n(this).contents().unwrap():n(t.Markup.transformDomObject(n(this),"p").append("<br>")).contents().unwrap():n(this).contents().unwrap()})},removeStyles:function(t){var i=this;t.children("style").filter(function(){return this.contentEditable!=="false"}).remove(),t.children().filter(function(){return this.contentEditable!=="false"}).each(function(){n(this).removeAttr("style").removeClass(),i.removeStyles(n(this))})},removeNamespacedElements:function(t){t.find("*").each(function(){var r=this.prefix?this.prefix:this.scopeName?this.scopeName:undefined,t,i;(r&&r!=="HTML"||this.nodeName.indexOf(":")>=0)&&(t=n(this),i=t.contents(),i.length?i.unwrap():t.remove())})}})}),t.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i,t.RELATIVE="__relative__",t.prototype.clean_node=function(n){function u(n,t){for(var i=0;i<t.length;i++)if(t[i]==n)return i;return-1}function f(){for(var i=[],r={},t,n=0;n<arguments.length;n++)if(arguments[n]&&arguments[n].length)for(t=0;t<arguments[n].length;t++)r[arguments[n][t]]||(r[arguments[n][t]]=!0,i.push(arguments[n][t]));return i}function e(n){for(var t,i=0;i<this.filters.length;i++)if(!this.filters[i](n)){t=n.cloneNode(!0),this.current_element.appendChild(t);return}switch(n.nodeType){case 1:o.call(this,n);break;case 3:t=n.cloneNode(!1),this.current_element.appendChild(t);break;case 5:t=n.cloneNode(!1),this.current_element.appendChild(t);break;case 8:this.config.allow_comments&&(t=n.cloneNode(!1),this.current_element.appendChild(t))}}function o(n){var o,c,i,v,l,r,h,y,p,w,b=s.call(this,n),k=this.jQuery,a=k.browser.msie&&k.browser.version==="7.0";if(n=b.node,i=n.nodeName.toLowerCase(),c=this.current_element,this.allowed_elements[i]||b.whitelist){for(this.current_element=this.dom.createElement(n.nodeName),c.appendChild(this.current_element),v=f(this.config.attributes[i],this.config.attributes.__ALL__,b.attr_whitelist),o=0;o<v.length;o++)r=v[o],l=n.attributes[r],l&&(w=!0,this.config.protocols[i]&&this.config.protocols[i][r]&&(y=this.config.protocols[i][r],p=l.nodeValue.toLowerCase().match(t.REGEX_PROTOCOL),w=p?u(p[1],y)!=-1:u(t.RELATIVE,y)!=-1),w&&(!a||a&&"style"!==r)&&(h=document.createAttribute(r),h.value=l.nodeValue,this.current_element.setAttributeNode(h)));if(this.config.add_attributes[i])for(r in this.config.add_attributes[i])(!a||a&&"style"!==r)&&(h=document.createAttribute(r),h.value=this.config.add_attributes[i][r],this.current_element.setAttributeNode(h))}else if(u(n,this.whitelist_nodes)!=-1){for(this.current_element=n.cloneNode(!0);this.current_element.childNodes.length>0;)this.current_element.removeChild(this.current_element.firstChild);c.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[i])for(o=0;o<n.childNodes.length;o++)e.call(this,n.childNodes[o]);this.current_element.normalize&&this.current_element.normalize(),this.current_element=c}function s(n){for(var i={attr_whitelist:[],node:n,whitelist:!1},r,t,e=0;e<this.transformers.length;e++)if(t=this.transformers[e]({allowed_elements:this.allowed_elements,config:this.config,node:n,node_name:n.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom}),t==null)continue;else if(typeof t=="object"){if(t.whitelist_nodes&&t.whitelist_nodes instanceof Array)for(r=0;r<t.whitelist_nodes.length;r++)u(t.whitelist_nodes[r],this.whitelist_nodes)==-1&&this.whitelist_nodes.push(t.whitelist_nodes[r]);i.whitelist=t.whitelist?!0:!1,t.attr_whitelist&&(i.attr_whitelist=f(i.attr_whitelist,t.attr_whitelist)),i.node=t.node?t.node:i.node}else throw new Error("transformer output must be an object or null");return i}var r=this.dom.createDocumentFragment();for(this.current_element=r,this.whitelist_nodes=[],i=0;i<n.childNodes.length;i++)e.call(this,n.childNodes[i]);return r.normalize&&r.normalize(),r},define("vendor/sanitize",function(){}),define("contenthandler/sanitizecontenthandler",["aloha/core","jquery","aloha/contenthandlermanager","aloha/plugin","aloha/console","vendor/sanitize"],function(n,i,r){function f(r){var f=n.defaults.supports;f=n.settings.contentHandler.sanitize&&i.inArray(n.settings.contentHandler.sanitize,["restricted","basic","relaxed"])>-1?n.defaults.sanitize[n.settings.contentHandler.sanitize]:n.defaults.sanitize.relaxed,n.settings.contentHandler.allows&&(f=n.settings.contentHandler.allows),r&&(f=r),f.filters=[function(n){return n.contentEditable!="false"}],u=new t(f,i)}var u;return n.defaults.sanitize||(n.defaults.sanitize={}),n.defaults.sanitize.restricted={elements:["b","em","i","strong","u","del","p","span","div","br"]},n.defaults.sanitize.basic={elements:["a","abbr","b","blockquote","br","cite","code","dd","del","dl","dt","em","i","li","ol","p","pre","q","small","strike","strong","sub","sup","u","ul"],attributes:{a:["href"],blockquote:["cite"],q:["cite"],abbr:["title"]},protocols:{a:{href:["ftp","http","https","mailto","__relative__"]},blockquote:{cite:["http","https","__relative__"]},q:{cite:["http","https","__relative__"]}}},n.defaults.sanitize.relaxed={elements:["a","abbr","b","blockquote","br","caption","cite","code","col","colgroup","dd","del","dl","dt","em","h1","h2","h3","h4","h5","h6","i","img","li","ol","p","pre","q","small","strike","strong","sub","sup","table","tbody","td","tfoot","th","thead","tr","u","ul","span","hr","object","div"],attributes:{a:["href","title","id","class","target","data-gentics-aloha-repository","data-gentics-aloha-object-id"],div:["id","class","style"],abbr:["title"],blockquote:["cite"],br:["class"],col:["span","width"],colgroup:["span","width"],img:["align","alt","height","src","title","width","class","data-caption","data-align","data-width","data-original-image"],ol:["start","type"],p:["class","style","id"],q:["cite"],table:["summary","width"],td:["abbr","axis","colspan","rowspan","width"],th:["abbr","axis","colspan","rowspan","scope","width"],ul:["type"],span:["class","style","lang","xml:lang","role"]},protocols:{a:{href:["ftp","http","https","mailto","__relative__"]},blockquote:{cite:["http","https","__relative__"]},img:{src:["http","https","__relative__"]},q:{cite:["http","https","__relative__"]}}},r.createHandler({handleContent:function(t){var o,r,h,s,e;if(n.activeEditable&&n.settings.contentHandler&&n.settings.contentHandler.handler&&n.settings.contentHandler.handler.sanitize)if(n.settings.contentHandler.handler.sanitize&&(r=n.settings.contentHandler.handler.sanitize),h=r["#"+n.activeEditable.getId()],typeof h!="undefined")o=r;else for(s=n.activeEditable.obj.attr("class").split(" "),e=0;e<s.length;e++)typeof r["."+s[e]]!="undefined"&&(o=r["."+s[e]]);return(typeof u=="undefined"||typeof o!="undefined")&&f(o),typeof t=="string"?t=i("<div>"+t+"<\/div>").get(0):t instanceof i&&(t=i("<div>").append(t).get(0)),i("<div>").append(u.clean_node(t)).html()}})}),define("contenthandler/blockelementcontenthandler",["aloha","jquery","aloha/contenthandlermanager"],function(n,t,i){var o={h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,p:!0,pre:!0,blockquote:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,P:!0,PRE:!0,BLOCKQUOTE:!0},s={br:!0,BR:!0},r=function(n){return o[n.nodeName]&&!(n.lastChild&&s[n.lastChild.nodeName])},u=function(n,i){var f=t(i);f.filter("h1:empty,h2:empty,h3:empty,h4:empty,h5:empty,h6:empty,p:empty,pre:empty,blockquote:empty").remove(),t.browser.msie?f.filter("br.aloha-end-br").remove():f.filter("li").each(function(){r(this)&&t(this).append("<br/>")}),f.children(":not(.aloha-block)").each(u)},f=function(n,i){var r=t(i);r.filter("h1:empty,h2:empty,h3:empty,h4:empty,h5:empty,h6:empty,p:empty,pre:empty,blockquote:empty").append("​"),r.children(":not(.aloha-block)").each(f)},e=function(n,i){var u=t(i);u.filter("p,h1,h2,h3,h4,h5,h6,pre,blockquote").length>0&&r(i)&&t(i).append("<br/>"),u.children(":not(.aloha-block)").each(e)};return i.createHandler({handleContent:function(n,i){return typeof n=="string"?n=t("<div>"+n+"<\/div>"):n instanceof t&&(n=t("<div>").append(n)),i=i||{},i.command==="initEditable"?(n.children(":not(.aloha-block)").each(u),t.browser.msie&&t.browser.version<=7&&n.children(":not(.aloha-block)").each(f)):i.command==="getContents"&&(n.children(":not(.aloha-block)").each(e),n.find("li>br:last").remove()),n.html()}})}),define("contenthandler/contenthandler-plugin",["jquery","aloha/plugin","aloha/contenthandlermanager","contenthandler/wordcontenthandler","contenthandler/genericcontenthandler","contenthandler/sanitizecontenthandler","contenthandler/blockelementcontenthandler"],function(n,t,i,r,u,f,e){var o={word:r,generic:u,sanitize:f,blockelement:e};return t.create("contenthandler",{init:function(){var n;for(n in o)o.hasOwnProperty(n)&&i.register(n,o[n])}})}),define("characterpicker/nls/i18n",{root:{"button.addcharacter.tooltip":"pick special characters"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("characterpicker/characterpicker-plugin",["aloha","jquery","aloha/plugin","ui/ui","ui/button","ui/floating","PubSub","i18n!characterpicker/nls/i18n"],function(n,t,i,r,u,f,e,o){function v(n){return n.$element.css("display")==="table"}function b(n){n.$element.click(function($event){$event.stopPropagation();}),$("body").click(function($event){!n._overlayActive||$event.target===n.$element[0]||$($event.target).is(".aloha-icon-characterpicker")||$($event.target).find(".aloha-icon-characterpicker").length||n.hide()})}function k(n){c.keyup(function(t){27===t.keyCode&&v(n)&&n.hide()})}function h(n,t,i){var u=function(n){return n.replace(/\-(\w)/g,function(n,t){return t.toUpperCase()})},r;return r=n.currentStyle?n.currentStyle[u(i)]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(n,null).getPropertyValue(i):n.style[u(i)],r?t.css(i,r):null}function d(n,i){var r={13:function(t){n.hide(),i(t.text())},37:function(n){var t=n.prev();t.length&&(t.addClass("focused"),n.removeClass("focused"))},38:function(n){var i=n.parent().prev(),r;i.length&&(r=t(i.children()[n.index()]).addClass("focused"),r.length&&n.removeClass("focused"))},39:function(n){var t=n.next().addClass("focused");t.length&&n.removeClass("focused")},40:function(n){var i=n.parent().next(),r;i.length&&(r=t(i.children()[n.index()]).addClass("focused"),r.length&&n.removeClass("focused"))}};c.keydown(function(t){return t.stopPropagation(),r[t.keyCode]&&v(n)?(r[t.keyCode](n.$element.find(".focused")),!1):void 0})}function g(n,i){var f=document.createElement("textarea");f.innerHTML=i;for(var o=t.grep(f.value.split(" "),function(n){return""!==n}),r=["<tr>"],u=0,e;e=o[u];)0!==u&&0==u%15&&r.push("<\/tr><tr>"),r.push('<td unselectable="on">'+e+"<\/td>"),u++;r.push("<\/tr>"),n.$tbody.empty().append(r.join("")),n.$element.delegate("td","mouseover",function(){n.$element.find(".focused").removeClass("focused"),t(this).addClass("focused")}).delegate("td","mouseout",function(){t(this).removeClass("focused")}).delegate("td","click",function(){n.$element.hide();n.onSelect(t(this).text())})}function y(n,t){var i=t.offset();return"fixed"===f.POSITION_STYLE&&(i.top-=l.scrollTop(),i.left-=l.scrollLeft()),{top:n.offset.top+(i.top-n.offset.top),left:n.offset.left+(i.left-n.offset.left)}}function nt(t){n.activeEditable&&(s.select(),n.execCommand("insertHTML",!1,t),s.endContainer=s.startContainer,s.endOffset=++s.startOffset,s.select())}function p(i){var r=this;r.$element=t('<table class="aloha-character-picker-overlay" unselectable="on" role="dialog"><tbody><\/tbody><\/table>'),r.$element.mousedown(function(){return!1}),r.onSelect=i,r.$tbody=r.$element.find("tbody"),r.$element.appendTo(t("body")),b(r),k(r),d(r,i),n.bind("aloha-editable-deactivated",function(){r.hide()})}function w(n,i){var u=n.getEditableConfig(i),f,r;return u?(f=t.isArray(u)?u.join(" "):u,r=a[f],r||(r=new p(nt),g(r,f),a[f]=r),r):null}var c=t(document),l=t(window),s,a={};return p.prototype={offset:{top:0,left:0},show:function(n){var t=this;t.$element.css(y(t,n)).css("position",f.POSITION_STYLE).show().find(".focused").removeClass("focused"),t.$element.find("td").eq(0).addClass("focused"),t._overlayActive=!0},hide:function(){this.$element.hide(),this._overlayActive=!1}},i.create("characterpicker",{settings:{},config:"&#38; &#34; &#162; &#8364; &#163; &#165; &#169; &#174; &#8482; &#8240; &#181; &#183; &#8226; &#8230; &#8242; &#8243; &#167; &#182; &#223; &#8249; &#8250; &#171; &#187; &#8216; &#8217; &#8220; &#8221; &#8218; &#8222; &#60; &#62; &#8804; &#8805; &#8211; &#8212; &#175; &#8254; &#164; &#166; &#168; &#161; &#191; &#710; &#732; &#176; &#8722; &#177; &#247; &#8260; &#215; &#185; &#178; &#179; &#188; &#189; &#190; &#402; &#8747; &#8721; &#8734; &#8730; &#8764; &#8773; &#8776; &#8800; &#8801; &#8712; &#8713; &#8715; &#8719; &#8743; &#8744; &#172; &#8745; &#8746; &#8706; &#8704; &#8707; &#8709; &#8711; &#8727; &#8733; &#8736; &#180; &#184; &#170; &#186; &#8224; &#8225; &#192; &#193; &#194; &#195; &#196; &#197; &#198; &#199; &#200; &#201; &#202; &#203; &#204; &#205; &#206; &#207; &#208; &#209; &#210; &#211; &#212; &#213; &#214; &#216; &#338; &#352; &#217; &#218; &#219; &#220; &#221; &#376; &#222; &#224; &#225; &#226; &#227; &#228; &#229; &#230; &#231; &#232; &#233; &#234; &#235; &#236; &#237; &#238; &#239; &#240; &#241; &#242; &#243; &#244; &#245; &#246; &#248; &#339; &#353; &#249; &#250; &#251; &#252; &#253; &#254; &#255; &#913; &#914; &#915; &#916; &#917; &#918; &#919; &#920; &#921; &#922; &#923; &#924; &#925; &#926; &#927; &#928; &#929; &#931; &#932; &#933; &#934; &#935; &#936; &#937; &#945; &#946; &#947; &#948; &#949; &#950; &#951; &#952; &#953; &#954; &#955; &#956; &#957; &#958; &#959; &#960; &#961; &#962; &#963; &#964; &#965; &#966; &#967; &#968; &#969; &#8501; &#982; &#8476; &#977; &#978; &#8472; &#8465; &#8592; &#8593; &#8594; &#8595; &#8596; &#8629; &#8656; &#8657; &#8658; &#8659; &#8660; &#8756; &#8834; &#8835; &#8836; &#8838; &#8839; &#8853; &#8855; &#8869; &#8901; &#8968; &#8969; &#8970; &#8971; &#9001; &#9002; &#9674; &#9824; &#9827; &#9829; &#9830;",_constructor:function(){this._super("characterpicker")},init:function(){function f(i){i<n.editables.length&&(w(t,n.editables[i]),setTimeout(function(){f(i+1)},100))}var t=this,i;n.settings.plugins&&n.settings.plugins.characterpicker&&(t.settings=n.settings.plugins.characterpicker),i=r.adopt("characterPicker",u,{tooltip:o.t("button.addcharacter.tooltip"),icon:"aloha-icon-characterpicker",scope:"Aloha.continuoustext",click:function(){if(t.overlay){s=n.Selection.rangeObject;var i=s.startContainer.parentNode,r=t.overlay.$element;h(i,r,"font-family"),h(i,r,"font-weight"),h(i,r,"font-style"),t.overlay.show(this.element)}}}),setTimeout(function(){f(0)},100),n.bind("aloha-editable-activated",function(n,r){t.overlay=w(t,r.editable),t.overlay?i.show():i.hide()}),e.sub("aloha.floating.changed",function(n){t.overlay&&(t.overlay.offset=n.position.offset,t.overlay.$element.css(y(t.overlay,i.element)))})}})}),define("commands/inserthtml",["aloha/core","jquery","aloha/command","aloha/selection","util/dom","aloha/contenthandlermanager","aloha/console"],function(n,t,i,r,u,f,e){i.register("inserthtml",{action:function(i,r){function h(n){var f=t(n),i;if(!u.insertIntoDOM(f,r,c,!1))for(i=f.contents(),(u.isBlockLevelElement(n)||u.isListElement(n))&&h(t("<br/>").get(0)),o=i.length-1;o>=0;--o)h(i[o])}var c=t(u.getEditingHostOf(r.startContainer)),l=r.commonAncestorContainer,o,s=[];if(i=f.handleContent(i,{contenthandler:n.settings.contentHandler.insertHtml}),typeof i=="string")i=t("<div>"+i+"<\/div>");else if(i instanceof t)i=t("<div>").append(i);else throw"INVALID_VALUE_ERR";for(s=i.contents(),u.removeRange(r),o=s.length-1;o>=0;--o)h(s[o]);s.length>0?r=u.setCursorAfter(s.get(s.length-1)):r.select(),u.doCleanup({merge:!0,removeempty:!0},r,l);try{r.select()}catch(a){e.warn("Error:",a)}}})}),define("commands/commands-plugin",["aloha/command","./inserthtml"],function(){}),define("block/blockmanager",["aloha","jquery","ui/scopes","aloha/observable","aloha/registry","util/class","util/strings","util/maps"],function(n,t,i,r,u,f,e,o){var s=t,c=window.GENTICS,h=new(f.extend(r,{defaults:{"aloha-block-type":"DefaultBlock"},blockTypes:null,blocks:null,_highlightedBlocks:null,_activeBlock:null,_dragdropEnabled:!0,_constructor:function(){i.createScope("Aloha.Block"),this.blockTypes=new u,this.blocks=new u,this._highlightedBlocks={}},registerEventHandlers:function(){var t=this;this._registerEventHandlersForDeactivatingAlohaBlock(),this._registerEventHandlersForDeterminingCurrentlyActiveBlock(),this._registerEventHandlersForBlockDeletion(),this._registerEventHandlersForCutCopyPaste(),this._registerEventHandlersForEditableActivated(),n.bind("aloha-selection-changed",function(n,i){i&&s(i.getCommonAncestorContainer()).parents(".aloha-block").length>0||t._deactivateHighlightedBlocks()})},_registerEventHandlersForDeactivatingAlohaBlock:function(){var n=this;s(document).bind("click",function(t){o.isEmpty(n._highlightedBlocks)||s(t.target).closest(".aloha-ui,.aloha-block-do-not-deactivate,.aloha-block").length>0||n._deactivateHighlightedBlocks()})},_registerEventHandlersForDeterminingCurrentlyActiveBlock:function(){var n=this;this.bind("block-selection-change",function(t){n._activeBlock=t.length>0?t[0]:null})},_registerEventHandlersForBlockDeletion:function(){var t=this;n.bind("aloha-command-will-execute",function(i,r){var u=r.commandId,e=n.getSelection().getRangeCount()===0||n.getSelection().getRangeCount()===1&&n.getSelection().getRangeAt(0).endContainer===n.getSelection().getRangeAt(0).startContainer&&n.getSelection().getRangeAt(0).endContainer===s("body")[0]||n.getSelection().getRangeCount()===1&&n.getSelection().getRangeAt(0).endContainer===n.getSelection().getRangeAt(0).startContainer&&n.getSelection().getRangeAt(0).startOffset+1===n.getSelection().getRangeAt(0).endOffset,f;t._activeBlock&&(u==="delete"||u==="forwarddelete")&&e?(r.preventDefault=!0,t._activeBlock.destroy()):t._activeBlock||u!=="delete"&&u!=="forwarddelete"||n.getSelection().getRangeCount()!==1||n.getSelection().getRangeAt(0).collapsed!==!1||(f=function(n){for(var t,r,i=0,u=n.length;i<u;i++)t=n[i],t.domobj.nodeType===1&&(r=s(t.domobj),t.selection==="full"&&r.is(".aloha-block")?r.remove():f(t.children))},f(n.Selection.getSelectionTree()))}),s(window.document).keydown(function(n){return typeof n.srcElement!="undefined"&&typeof n.srcElement.form!="undefined"?!0:t._activeBlock&&(n.which===46||n.which===8)&&t._activeBlock._isInsideNestedEditable===!1&&(s.browser.msie&&parseInt(s.browser.version,10)<=8&&t._activeBlock.$element.parents(".aloha-editable,.aloha-block").first().hasClass("aloha-editable")||t._activeBlock.shouldDestroy())?(t._activeBlock.destroy(),n.preventDefault(),!1):void 0})},_registerEventHandlersForCutCopyPaste:function(){var t=this,r=!1,i=!1,u=null;s(window.document).keydown(function(u){n.activeEditable&&t._activeBlock&&s.contains(t._activeBlock.$element.get(0),n.activeEditable.obj.get(0))||(t._activeBlock&&(u.ctrlKey||u.metaKey)&&u.which===67&&(r=!0,t._activeBlock.$element.attr("data-aloha-block-copy-only-block","true"),c.Utils.Dom.selectDomNode(t._activeBlock.$element[0])),t._activeBlock&&(u.ctrlKey||u.metaKey)&&u.which===88&&(i=!0,t._activeBlock.$element.attr("data-aloha-block-copy-only-block","true"),c.Utils.Dom.selectDomNode(t._activeBlock.$element[0])))}),s(window.document).keyup(function(n){!i&&r&&(n.which===67||n.which===18||n.which===91)&&(r=!1,t._activeBlock.$element.removeAttr("data-aloha-block-copy-only-block"),u&&(u=null)),i&&(n.which===67||n.which===18||n.which===88)&&(i=!1)})},_registerEventHandlersForEditableActivated:function(){var t=this;n.bind("aloha-editable-activated",function(n,i){if(i.editable){var r=t.getBlock(i.editable.obj.closest(".aloha-block"));r&&r.activate()}})},initializeBlockLevelDragDrop:function(){var t=this;s.each(n.editables,function(n,i){i.obj.data("block-dragdrop",t._dragdropEnabled),t.createBlockLevelSortableForEditableOrBlockCollection(i.obj)}),n.bind("aloha-editable-created",function(n,i){i.obj.data("block-dragdrop",t._dragdropEnabled),t.createBlockLevelSortableForEditableOrBlockCollection(i.obj)})},createBlockLevelSortableForEditableOrBlockCollection:function(n){var t=this;n.hasClass("aloha-block-blocklevel-sortable")||(n.addClass("aloha-block-blocklevel-sortable").sortable({revert:100,handle:".aloha-block-draghandle-blocklevel",connectWith:".aloha-block-blocklevel-sortable.aloha-block-dropzone",disabled:!t._dragdropEnabled,start:function(n,t){t.item.data("block-sort-allowed",t.item.parents(".aloha-block-dropzone").length>0)},change:function(n,t){t.item.data("block-sort-allowed",t.placeholder.parents(".aloha-block-dropzone").length>0)},stop:function(n,t){t.item.data("block-sort-allowed")||s(this).sortable("cancel"),t.item.removeData("block-sort-allowed")}}),n.get(0).ondragstart=function(n,t){!t||!t.helper||!t.helper.is(".aloha-block")})},setDragDropState:function(n){this._dragdropEnabled=n},getDragDropState:function(){return this._dragdropEnabled},registerBlockType:function(n,t){i.createScope("Aloha.Block."+n,"Aloha.Block"),this.blockTypes.register(n,t)},_blockify:function(t,i){var h=this,f=s(t),e=n.require("block/block-plugin"),o=f[0].tagName.toLowerCase(),r,u;if(s.inArray(o,e.settings.rootTags)===-1){n.Log.error("block/blockmanager","Blocks can only be created from ["+e.settings.rootTags.join(", ")+"] element. You passed "+o+".");return}if(r=this.getConfig(f,i),!this.blockTypes.has(r["aloha-block-type"])){n.Log.error("block/blockmanager","Block Type "+r["aloha-block-type"]+" not found!");return}u=new(this.blockTypes.get(r["aloha-block-type"]))(f,r),u.$element.addClass("aloha-block-"+r["aloha-block-type"]),this.blocks.register(u.getId(),u)},_unblockify:function(n){var t=this.getBlock(n);t&&t.unblock()},getConfig:function(n,t){var u=n.clone(!0),r=u.data(),f={},i;u.removeData();for(i in r)r.hasOwnProperty(i)&&(f[e.camelCaseToDashes(i)]=r[i]);return s.extend({},this.defaults,t,f)},getBlock:function(n){var i,t;return typeof n=="object"?(t=s(n),t.hasClass("aloha-block-inner")&&(t=t.parent()),i=t.attr("id")):i=n,this.blocks.get(i)},_unregisterBlock:function(n){var t;t=typeof n=="object"?n.getId():n,this.blocks.unregister(t)},_deactivateHighlightedBlocks:function(){s.each(s.extend({},this._highlightedBlocks),function(n){var t=h.getBlock(n);t&&t.deactivate()})},_getHighlightedBlocks:function(){var n={};return s.each(this.blocks.getEntries(),function(t,i){i.isActive()&&(n[t]=i)}),n},_setHighlighted:function(n){this._highlightedBlocks[n.id]=!0},_setUnhighlighted:function(n){delete this._highlightedBlocks[n.id]}}));return n.Block=n.Block||{},n.Block.BlockManager=h,h}),define("block/editormanager",["aloha/registry"],function(n){return new(n.extend({createEditor:function(n){if(!this.has(n.type))throw'Editor for type "'+n.type+'" not found.';var t=this.get(n.type);return new t(n)}}))}),define("block/sidebarattributeeditor",["jquery","block/blockmanager","aloha/sidebar","block/editormanager","util/class"],function(n,t,i,r,u){return new(u.extend({_sidebar:null,init:function(){this._sidebar=i.right.show(),t.bind("block-selection-change",this._onBlockSelectionChange,this)},_onBlockSelectionChange:function(t){var i=this;this._sidebar&&n.each(t,function(){var u=this.getSchema(),t=this,f=[];u&&i._sidebar.addPanel({title:t.getTitle(),expanded:!0,onInit:function(){var i=n("<form />");i.submit(function(){return!1}),n.each(u,function(n,u){var e=r.createEditor(u);e.bind("change",function(i){t.attr(n,i)}),t.bind("change",function(){e.setValue(t.attr(n))}),i.append(e.render()),e.setValue(t.attr(n)),f.push(e)}),this.setContent(i)},deactivate:function(){n.each(f,function(n,t){t._deactivate()}),this.isActive=!1,this.effectiveElement=null}})})}}))}),define("block/block",["aloha","jquery","block/blockmanager","aloha/observable","ui/scopes","util/class","PubSub"],function(n,t,i,r,u,f,e){function h(n){var t=n.closest(".aloha-editable");return t.length?!!t.data("block-dragdrop"):!0}var s=window.GENTICS,o=f.extend(r,{title:null,id:null,$element:null,_currentlyRendering:!1,_initialized:!1,_isInsideNestedEditable:!1,_constructor:function(n,i){var r=this;this.$element=n,n.attr("id")?this.id=n.attr("id"):(this.id=s.Utils.guid(),n.attr("id",this.id)),n.contentEditable(!1),n.addClass("aloha-block"),this.isDraggable()&&(n.find("img").attr("draggable","false"),n.find("a").attr("draggable","false")),t.each(i,function(n,t){r._setAttribute(n,t)}),this._onElementClickHandler=function(n){t(n.target).closest(".aloha-block").get(0)===r.$element.get(0)&&(r._fixScrollPositionBugsInIE(),r.activate(n.target,n))},this._connectThisBlockToDomElement(n,function(){e.pub("aloha.block.initialized",{block:r})}),this._initialized=!0},_onElementClickHandler:null,_preventSelectionChangedEventHandler:function(i){"dblclick"===i.type||t(i.target).is(".aloha-editable")||n.Selection.preventSelectionChanged()},_connectThisBlockToDomElement:function(n,i){var r=this,u=t(n);this._disconnectFromDomElement(),this.$element=u,this.$element.bind("click",this._onElementClickHandler),this.$element.bind("mousedown",this._preventSelectionChangedEventHandler),this.$element.bind("focus",this._preventSelectionChangedEventHandler),this.$element.bind("dblclick",this._preventSelectionChangedEventHandler),this.init(this.$element,function(){window.setTimeout(function(){r._postProcessElementIfNeeded(),i&&i()},5)})},_disconnectFromDomElement:function(){this.$element&&(this.$element.unbind("click",this._onElementClickHandler),this.$element.unbind("mousedown",this._preventSelectionChangedEventHandler),this.$element.unbind("focus",this._preventSelectionChangedEventHandler),this.$element.unbind("dblclick",this._preventSelectionChangedEventHandler))},_fixScrollPositionBugsInIE:function(){var n=t(window).scrollTop();window.setTimeout(function(){t(window).scrollTop()!==n&&t(window).scrollTop(n)},10)},init:function(n,t){t()},shouldDestroy:function(){var n=this.$element.parent().closest(".aloha-block,.aloha-editable,.aloha-block-collection");return n.hasClass("aloha-block-collection")&&this.$element[0].tagName.toLowerCase()==="div"?!0:n.hasClass("aloha-editable")},destroy:function(n){var r,t,u;(this.shouldDestroy()||n===!0)&&(r=this,t=new s.Utils.RangeObject,t.startContainer=t.endContainer=this.$element.parent()[0],t.startOffset=t.endOffset=s.Utils.Dom.getIndexInParent(this.$element[0]),i.trigger("block-delete",this),this.free(),u=this.$element[0].tagName.toLowerCase()==="span",this.$element.fadeOut("fast",function(){r.$element.remove(),i.trigger("block-selection-change",[]),window.setTimeout(function(){u&&t.select()},5)}))},unblock:function(){this.deactivate(),this._disconnectFromDomElement(),this.$element.removeClass("aloha-block"),this.$element.children(".aloha-block-handle").remove(),this.free()},free:function(){i._unregisterBlock(this),this.unbindAll()},getId:function(){return this.id},getSchema:function(){return null},getTitle:function(){return this.title},isDraggable:function(){return this.$element[0].tagName.toLowerCase()==="div"&&this.$element.parents(".aloha-editable,.aloha-block,.aloha-block-collection").first().hasClass("aloha-block-collection")?!0:this.$element.parents(".aloha-editable,.aloha-block").first().hasClass("aloha-editable")},activate:function(r,f){var e=[];t.each(i._getHighlightedBlocks(),function(){this.deactivate()}),this.$element.attr("data-block-skip-scope")!=="true"&&u.setScope("Aloha.Block."+this.attr("aloha-block-type")),this.$element.addClass("aloha-block-active"),this._highlight(),e.push(this),this.$element.parents(".aloha-block").each(function(){var n=i.getBlock(this);n&&(n._highlight(),e.push(n))}),t(r).closest(".aloha-editable,.aloha-block,.aloha-table-cell-editable,.aloha-table-cell_active").first().hasClass("aloha-block")?(this._isInsideNestedEditable=!1,n.getSelection().removeAllRanges()):(this._isInsideNestedEditable=!0,f&&n.Selection.updateSelection(f)),i.trigger("block-activate",e),i.trigger("block-selection-change",e)},deactivate:function(){var t=this,n=[this];this._unhighlight(),this.$element.parents(".aloha-block").each(function(){n.push(this),t._unhighlight()}),this.$element.removeClass("aloha-block-active"),i.trigger("block-deactivate",n),i.trigger("block-selection-change",[])},isActive:function(){return this.$element.hasClass("aloha-block-active")},_highlight:function(){this.$element.addClass("aloha-block-highlighted"),i._setHighlighted(this)},_unhighlight:function(){this.$element.removeClass("aloha-block-highlighted"),i._setUnhighlighted(this)},_update:function(){var n=this;this._currentlyRendering||this._initialized&&(this._currentlyRendering=!0,this.update(this.$element,function(){n._postProcessElementIfNeeded()}),this._currentlyRendering=!1)},update:function(n,t){t()},_postProcessElementIfNeeded:function(){this.createEditablesIfNeeded(),this._checkThatNestedBlocksAreStillConsistent(),this._makeNestedBlockCollectionsSortable(),this.renderBlockHandlesIfNeeded(),this.isDraggable()&&this.$element[0].tagName.toLowerCase()==="span"?(this._setupDragDropForInlineElements(),this._disableUglyInternetExplorerDragHandles()):this.isDraggable()&&this.$element[0].tagName.toLowerCase()==="div"&&(this._setupDragDropForBlockElements(),this._disableUglyInternetExplorerDragHandles()),this._hideDragHandlesIfDragDropDisabled(),this._attachDropzoneHighlightEvents()},_checkThatNestedBlocksAreStillConsistent:function(){this.$element.find(".aloha-block").each(function(){var n=i.getBlock(this);n&&n.$element[0]!==this&&n._connectThisBlockToDomElement(this)})},_makeNestedBlockCollectionsSortable:function(){var n=this;this.$element.find(".aloha-block-collection").each(function(){var r=t(this);r.closest(".aloha-block").get(0)===n.$element.get(0)&&i.createBlockLevelSortableForEditableOrBlockCollection(r)})},_disableUglyInternetExplorerDragHandles:function(){t.browser.msie&&(this.$element.get(0).onresizestart=function(){return!1},this.$element.get(0).oncontrolselect=function(){return!1},this.$element.get(0).onmovestart=function(){return!1})},_hideDragHandlesIfDragDropDisabled:function(){this._dd_isDragdropEnabled()||this.$element.find(".aloha-block-draghandle").each(function(){var n=t(this);h(n)||n.removeClass("aloha-block-draghandle")})},_attachDropzoneHighlightEvents:function(){var n=this;this.$element.delegate(".aloha-block-draghandle","mousedown",function(){var i=n.$element.parents(".aloha-editable").first().data("block-dropzones")||[];t.each(i,function(n,i){var r=t(i);t(r).each(function(){t(this).data("block-dragdrop")&&t(this).addClass("aloha-block-dropzone")})});t(document).one("mouseup.aloha-block-dropzone",function(){var i=n.$element.parents(".aloha-editable").first().data("block-dropzones")||[];t.each(i,function(n,i){t(i).removeClass("aloha-block-dropzone")})})})},_setupDragDropForInlineElements:function(){var f=this,n=null,e=!1,i=null,u=null,o=function(){if(n){var r=t(n);r.is(".aloha-block-dropInlineElementIntoEmptyBlock")?(r.children().remove(),r.append(i)):r.is(".aloha-block-droppable-right")?(r.html(r.html()+" "),r.after(i)):(r.prev("[data-i]").length>0&&r.prev("[data-i]").html(r.prev("[data-i]").html()+" "),r.html(" "+r.html()),r.before(i)),i.removeClass("ui-draggable").css({left:0,top:0}),f._fixScrollPositionBugsInIE()}t(".aloha-block-dropInlineElementIntoEmptyBlock").removeClass("aloha-block-dropInlineElementIntoEmptyBlock"),u.droppable("destroy"),u=null,e=!0},r=[];this.$element.draggable({handle:".aloha-block-draghandle",scope:"aloha-block-inlinedragdrop",disabled:!this._dd_isDragdropEnabled(),revert:function(){return n===null||!e},revertDuration:250,stop:function(){t.browser.msie&&7===parseInt(t.browser.version,10)&&o(),t.each(r,function(){f._dd_traverseDomTreeAndRemoveSpans(this)}),i=null,r=[]},start:function(){e=!1,r=[],t(".aloha-editable").children("p:empty").html("&nbsp;");var s={tolerance:"pointer",addClasses:!1,scope:"aloha-block-inlinedragdrop",over:function(u,e){t.inArray(this,r)===-1&&r.push(this);var o=1===t(this).contents().length&&1===t(this).children("br").length;if(i=e.draggable,t(this).is(":empty")||o||t(this).html()==="&nbsp;"){t(this).addClass("aloha-block-dropInlineElementIntoEmptyBlock"),n=this;return}f._dd_traverseDomTreeAndWrapCharactersWithSpans(this),t("span[data-i]",this).droppable({tolerance:"pointer",addClasses:!1,scope:"aloha-block-inlinedragdrop",over:function(){n&&t(n).removeClass("aloha-block-droppable"),n=this,t(this).addClass("aloha-block-droppable")},out:function(){t(this).removeClass("aloha-block-droppable"),n===this&&(n=null)}}),t.ui.ddmanager.prepareOffsets(e.draggable.data("draggable"),u)},out:function(){t(this).removeClass("aloha-block-dropInlineElementIntoEmptyBlock")},drop:function(){t.browser.msie&&7===parseInt(t.browser.version,10)||o()}};u=t(".aloha-editable.aloha-block-dropzone").children(":not(.aloha-block)"),u.droppable(s),t(".aloha-table-cell-editable").droppable(s)}})},_dd_traverseDomTreeAndWrapCharactersWithSpans:function(n){for(var t,u,i=0,r=n.childNodes.length;i<r;i++)if(t=n.childNodes[i],t.nodeType===1)if(~t.className.indexOf("aloha-block")||t.attributes["data-i"]!==undefined){if(t.attributes["data-i"])return}else this._dd_traverseDomTreeAndWrapCharactersWithSpans(t);else t.nodeType===3&&(u=this._dd_insertSpans(t),i+=u,r+=u)},_dd_splitText:function(n){for(var r=n.split(/(?=\b)/),i=[],u=!1,t=0,f=r.length;t<f;t++)/[^\t\n\r ]/.test(r[t])?u?(i.push(" "+r[t]),u=!1):i.push(r[t]):u=!0;return u&&(i[i.length-1]+=" "),i},_dd_insertSpans:function(n){var h=n.nodeValue,r,s;if(!/[^\t\n\r ]/.test(h))return 0;var e=document.createDocumentFragment(),c=this._dd_splitText(h),a=c.length,i,u,f,l,o=0;for(r=0;r<a;r++)(u=c[r],u.length!==0)&&(f=Math.floor(u.length/2),s=parseInt(t.browser.version,10),t.browser.msie&&(7===s||8===s)&&(f=0),f>0&&(i=document.createElement("span"),i.appendChild(document.createTextNode(u.substr(0,f))),i.setAttribute("data-i",r),e.appendChild(i),o++),i=document.createElement("span"),l=u.substr(f),i.appendChild(document.createTextNode(l)),i.setAttribute("data-i",r),i.setAttribute("class","aloha-block-droppable-right"),e.appendChild(i),o++);return n.parentNode.replaceChild(e,n),o-1},_dd_traverseDomTreeAndRemoveSpans:function(n){var i=[],r,t,u;for(r=function(n){for(var f=!1,e,t,u,o=0,s=n.childNodes.length;o<s;o++)u=n.childNodes[o],u.nodeType===1&&(u.attributes["data-i"]!==undefined?(f||(f=!0,e="",t=undefined),f&&(e+=u.firstChild.nodeValue,t&&i.push(t),t=u)):(f&&(f=!1,t.parentNode.replaceChild(document.createTextNode(e),t)),~u.className.indexOf("aloha-block")||r(u)));f&&t.parentNode.replaceChild(document.createTextNode(e),t)},r(n),t=0,u=i.length;t<u;t++)i[t].parentNode.removeChild(i[t])},_dd_isDragdropEnabled:function(){return h(this.$element.parent())},_setupDragDropForBlockElements:function(){this.$element.find(".aloha-block-draghandle").addClass("aloha-block-draghandle-blocklevel")},createEditablesIfNeeded:function(){this.$element.find(".aloha-editable").aloha()},renderBlockHandlesIfNeeded:function(){this.isDraggable()&&this.$element.children(".aloha-block-draghandle").length===0&&this.$element.prepend('<span class="aloha-block-handle aloha-block-draghandle aloha-cleanme"><\/span>')},attr:function(i,r,u){var e=this,f=!1;if(arguments.length>=2){if(i.substr(0,12)==="aloha-block-"){n.Log.error("block/block","It is not allowed to set internal block attributes (starting with aloha-block-) through Block.attr() (You tried to set "+i+")");return}this._getAttribute(i)!==r&&(f=!0),this._setAttribute(i,r)}else if(typeof i=="object")t.each(i,function(t,i){if(t.substr(0,12)==="aloha-block-"){n.Log.error("block/block","It is not allowed to set internal block attributes (starting with aloha-block-) through Block.attr() (You tried to set "+t+")");return}e._getAttribute(t)!==i&&(f=!0),e._setAttribute(t,i)});else return typeof i=="string"?this._getAttribute(i):this._getAttributes();return f&&!u&&(this._update(),this.trigger("change"),n.activeEditable&&n.activeEditable.smartContentChange({type:"block-change"})),null},_setAttribute:function(n,t){this.$element.attr("data-"+n.toLowerCase(),t)},_getAttribute:function(n){return this.$element.attr("data-"+n.toLowerCase())},_getAttributes:function(){var n={};return t.each(this.$element[0].attributes,function(t,i){i.name.substr(0,5)==="data-"&&(n[i.name.substr(5).toLowerCase()]=i.value)}),n}}),c=o.extend({update:function(n,t){t()}}),l=o.extend({title:"Debugging",init:function(n,t){this.update(n,t)},update:function(n,i){n.css({display:"block"});var r='<table class="debug-block">';t.each(this.attr(),function(n,t){r+="<tr><th>"+n+"<\/th><td>"+t+"<\/td><\/tr>"}),r+="<\/table>",n.html(r),i()}}),a=o.extend({title:"EmptyBlock",init:function(){},activate:function(){},deactivate:function(){},renderBlockHandlesIfNeeded:function(){}});return{AbstractBlock:o,DefaultBlock:c,DebugBlock:l,EmptyBlock:a}}),define("block/blockcontenthandler",["jquery","aloha/contenthandlermanager","block/blockmanager"],function(n,t,i){return t.createHandler({handleContent:function(t){return typeof t=="string"?t=n("<div>"+t+"<\/div>"):t instanceof n&&(t=n("<div>").append(t)),t.find('.aloha-block[data-aloha-block-copy-only-block="true"]').length>0&&(t.find(".aloha-block:not([id])").remove(),t.find(".aloha-block + span:empty").remove(),t.find("div:empty").remove(),t.find("br.Apple-interchange-newline").remove(),t.find(".aloha-block").prev("br").remove(),t.find("div > br:only-child").parent().remove()),t.find(".aloha-block").each(function(){var t=n(this),u={},f={},r,e;n.each(t[0].attributes,function(n,t){t.nodeName!=="id"&&(t.nodeName.match(/^data-/)?f[t.nodeName.substr(5)]=t.nodeValue:u[t.nodeName]=t.nodeValue)}),r=GENTICS.Utils.guid(),e=n("<"+this.tagName+"/>").attr(u).attr("id",r).removeClass("aloha-block-active").removeClass("aloha-block").html(t.html()),t.replaceWith(e),window.setTimeout(function(){i._blockify(n("#"+r),f)},50)}),t.html()}})}),define("block/editor",["jquery","aloha/observable","util/class"],function(n,t,i){var u=i.extend(t,{schema:null,_constructor:function(n){this.schema=n},render:function(){},getValue:function(){},setValue:function(){},destroy:function(){},_deactivate:function(){this.trigger("change",this.getValue()),this.destroy()}}),r=u.extend({formInputElementDefinition:null,_$formInputElement:null,render:function(){var t=n('<div class="aloha-block-editor" />'),i=GENTICS.Utils.guid();return t.append(this.renderLabel().attr("id",i)),t.append(this.renderFormElement().attr("id",i)),t},renderLabel:function(){var t=n("<label />");return t.html(this.schema.label),t},renderFormElement:function(){var t=this;return this._$formInputElement=n(this.formInputElementDefinition),this.afterRenderFormElement(this._$formInputElement),this._$formInputElement.change(function(){t.trigger("change",t.getValue())}),this._$formInputElement},afterRenderFormElement:function(){},getValue:function(){return this._$formInputElement.val()},setValue:function(n){this._$formInputElement.val(n)},destroy:function(){this._$formInputElement.remove()}}),f=r.extend({formInputElementDefinition:'<input type="text" />'}),e=r.extend({formInputElementDefinition:'<input type="range" />',afterRenderFormElement:function(n){this.schema.range&&(this.schema.range.min&&n.attr("min",this.schema.range.min),this.schema.range.max&&n.attr("max",this.schema.range.max),this.schema.range.step&&n.attr("step",this.schema.range.step))}}),o=r.extend({formInputElementDefinition:'<input type="url" />'}),s=r.extend({formInputElementDefinition:'<input type="email" />'}),h=r.extend({formInputElementDefinition:"<select />",afterRenderFormElement:function(t){n.each(this.schema.values,function(){var i=this;t.append(n("<option />").attr("value",i.key).html(i.label))})}}),c=r.extend({formInputElementDefinition:"<button />",afterRenderFormElement:function(n){var t=this;n.html(this.schema.buttonLabel),n.click(function(){t.schema.callback()})}});return{AbstractEditor:u,AbstractFormElementEditor:r,StringEditor:f,NumberEditor:e,UrlEditor:o,EmailEditor:s,SelectEditor:h,ButtonEditor:c}}),define("block/nls/i18n",{root:{"button.toggledragdrop.tooltip":"Toggle Drag & Drop"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("block/block-plugin",["aloha","aloha/plugin","jquery","aloha/contenthandlermanager","block/blockmanager","block/sidebarattributeeditor","block/block","block/editormanager","block/blockcontenthandler","block/editor","ui/ui","ui/toggleButton","i18n!block/nls/i18n","i18n!aloha/nls/i18n","jqueryui"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){var v=["div","span"],y=t.create("block",{config:[],settings:{},init:function(){var t=this;this.settings.rootTags||(this.settings.rootTags=v),u.registerBlockType("DebugBlock",e.DebugBlock),u.registerBlockType("DefaultBlock",e.DefaultBlock),u.registerBlockType("EmptyBlock",e.EmptyBlock),o.register("string",h.StringEditor),o.register("number",h.NumberEditor),o.register("url",h.UrlEditor),o.register("email",h.EmailEditor),o.register("select",h.SelectEditor),o.register("button",h.ButtonEditor),r.register("block",s),u.setDragDropState(t.isDragDropEnabled()),u.registerEventHandlers(),u.initializeBlockLevelDragDrop(),n.bind("aloha-plugins-loaded",function(){t._createBlocks(),!1!==t.settings.sidebarAttributeEditor&&f.init()}),this.createButtons(),n.bind("aloha-editable-created",function(n,i){t.setDropzones(i.obj)}),n.bind("aloha-editable-activated",function(n,i){t.applyButtonConfig(i.editable)})},applyButtonConfig:function(n){this._isDragdropToggleEnabled(n)?(this._toggleDragDropButton.show(),this._toggleDragDropButton.setState(this._getDragdropState(n))):this._toggleDragDropButton.hide()},_isDragdropToggleEnabled:function(n){var t=this.getEditableConfig(n.obj),i=function(){return t[0]==="toggleDragdrop"||t.toggleDragdrop==!0||t.toggleDragdrop=="true"||t.toggleDragdrop==1||t.toggleDragdrop=="1"},r=this.settings&&this.settings.config&&this.settings.config.toggleDragdropGlobal||i();return r&&this.isDragDropEnabled()},_getDragdropState:function(n){return this.settings&&this.settings.config&&this.settings.config.toggleDragdropGlobal?u.getDragDropState():n.obj.data("block-dragdrop")},_toggleDragdropState:function(t){var r,i,t,f;if(this.settings&&this.settings.config&&this.settings.config.toggleDragdropGlobal)for(r=!u.getDragDropState(),u.setDragDropState(r),i=0;i<n.editables.length;i++)t=n.editables[i],this._setDragDropStateForEditable(t.obj,r);else f=!t.obj.data("block-dragdrop"),this._setDragDropStateForEditable(t.obj,f)},createButtons:function(){var t=this;this._toggleDragDropButton=c.adopt("toggleDragDrop",l,{tooltip:a.t("button.toggledragdrop.tooltip"),icon:"aloha-icon aloha-icon-toggledragdrop",scope:"Aloha.continuoustext",click:function(){t._toggleDragdropState(n.activeEditable)}})},setDropzones:function(n){var t=this,i=t.getEditableConfig(n),r=i&&i.dropzones||t.settings.dropzones;r?n.data("block-dropzones",r):n.data("block-dropzones",[".aloha-editable"])},isDragDropEnabled:function(){return this.settings&&typeof this.settings.dragdrop!="undefined"?this.settings.dragdrop===!0||this.settings.dragdrop==="true"||this.settings.dragdrop===1||this.settings.dragdrop==="1":!0},_createBlocks:function(){this.settings.defaults||(this.settings.defaults={}),i.each(this.settings.defaults,function(n,t){i(n).alohaBlock(t)})},_setDragDropStateForEditable:function(n,t){n.data("block-dragdrop",t),n.hasClass("ui-sortable")&&n.sortable("option","disabled",!t),n.find(".aloha-block.ui-draggable").each(function(){i(this).draggable("option","disabled",!t)}),n.find(".aloha-block-handle").each(function(){t?i(this).addClass("aloha-block-draghandle"):i(this).removeClass("aloha-block-draghandle")})}});return i.fn.alohaBlock=function(n){return n=n||{},i(this).each(function(t,i){u._blockify(i,n)}),i(this)},i.fn.mahaloBlock=function(){i(this).each(function(n,t){u._unblockify(t)})},y}),define("align/nls/i18n",{root:{"button.alignright.tooltip":"Align to the right","button.alignleft.tooltip":"Align to the left","button.aligncenter.tooltip":"Center","button.alignjustify.tooltip":"Justify","button.aligntop.tooltip":"Align to the top","button.alignmiddle.tooltip":"Align to the middle","button.alignbottom.tooltip":"Align to the bottom"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("align/align-plugin",["aloha","aloha/plugin","ui/ui","ui/toggleButton","i18n!align/nls/i18n","i18n!aloha/nls/i18n","jquery","PubSub"],function(n,t,i,r,u,f,e,o){var s=window.GENTICS;return t.create("align",{_constructor:function(){this._super("align")},config:{alignment:["right","left","center","justify","top","middle","bottom"]},alignment:"",verticalAlignment:"",lastAlignment:"",lastVerticalAlignment:"",init:function(){this.createButtons();var t=this;n.bind("aloha-editable-activated",function(n,i){t.applyButtonConfig(i.editable.obj)}),o.sub("aloha.selection.context-change",function(i){var r=i.range;n.activeEditable&&t.buttonPressed(r)})},buttonPressed:function(n){this.horizontalButtonPressed(n),this.verticalButtonPressed(n)},horizontalButtonPressed:function(t){var i=this;if(this.lastAlignment=this.alignment,this.alignment="",t.findMarkup(function(){if(this.style.textAlign!=="")return i.alignment=this.style.textAlign,!0;i.alignment=e(this).css("text-align")},n.activeEditable.obj),this.alignment!=this.lastAlignment){this._alignRightButton.setState(!1),this._alignLeftButton.setState(!1),this._alignCenterButton.setState(!1),this._alignJustifyButton.setState(!1);switch(this.alignment){case"right":this._alignRightButton.setState(!0);break;case"center":this._alignCenterButton.setState(!0);break;case"justify":this._alignJustifyButton.setState(!0);break;default:this._alignLeftButton.setState(!0),this.alignment="left"}}},verticalButtonPressed:function(t){var i=this;if(this.lastVerticalAlignment=this.verticalAlignment,this.verticalAlignment="",t.findMarkup(function(){if(this.style.verticalAlign!=="")return i.verticalAlignment=this.style.verticalAlign,!0;i.verticalAlignment=e(this).css("vertical-align")},n.activeEditable.obj),this.verticalAlignment!=this.lastVerticalAlignment){this._alignTopButton.setState(!1),this._alignMiddleButton.setState(!1),this._alignBottomButton.setState(!1);switch(this.verticalAlignment){case"top":this._alignTopButton.setState(!0);break;case"middle":this._alignMiddleButton.setState(!0);break;case"bottom":this._alignBottomButton.setState(!0);break;default:this._alignTopButton.setState(!0),this.verticalAlignment="top"}}},applyButtonConfig:function(n){var t=this.getEditableConfig(n);t&&t.alignment&&!this.settings.alignment?t=t:t[0]&&t[0].alignment?t=t[0]:this.settings.alignment&&(t.alignment=this.settings.alignment),typeof t.alignment=="undefined"&&(t=this.config),e.inArray("right",t.alignment)!=-1?this._alignRightButton.show(!0):this._alignRightButton.show(!1),e.inArray("left",t.alignment)!=-1?this._alignLeftButton.show(!0):this._alignLeftButton.show(!1),e.inArray("center",t.alignment)!=-1?this._alignCenterButton.show(!0):this._alignCenterButton.show(!1),e.inArray("justify",t.alignment)!=-1?this._alignJustifyButton.show(!0):this._alignJustifyButton.show(!1),e.inArray("top",t.alignment)!=-1?this._alignTopButton.show(!0):this._alignTopButton.show(!1),e.inArray("middle",t.alignment)!=-1?this._alignMiddleButton.show(!0):this._alignMiddleButton.show(!1),e.inArray("bottom",t.alignment)!=-1?this._alignBottomButton.show(!0):this._alignBottomButton.show(!1)},createButtons:function(){var n=this;this._alignLeftButton=i.adopt("alignLeft",r,{tooltip:u.t("button.alignleft.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-left",scope:"Aloha.continuoustext",click:function(){n.align("left")}}),this._alignCenterButton=i.adopt("alignCenter",r,{tooltip:u.t("button.aligncenter.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-center",scope:"Aloha.continuoustext",click:function(){n.align("center")}}),this._alignRightButton=i.adopt("alignRight",r,{tooltip:u.t("button.alignright.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-right",scope:"Aloha.continuoustext",click:function(){n.align("right")}}),this._alignJustifyButton=i.adopt("alignJustify",r,{tooltip:u.t("button.alignjustify.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-justify",scope:"Aloha.continuoustext",click:function(){n.align("justify")}}),this._alignTopButton=i.adopt("alignTop",r,{tooltip:u.t("button.aligntop.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-top",scope:"table.cell",click:function(){n.verticalAlign("top")}}),this._alignMiddleButton=i.adopt("alignMiddle",r,{tooltip:u.t("button.alignmiddle.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-middle",scope:"table.cell",click:function(){n.verticalAlign("middle")}}),this._alignBottomButton=i.adopt("alignBottom",r,{tooltip:u.t("button.alignbottom.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-bottom",scope:"table.cell",click:function(){n.verticalAlign("bottom")}})},verticalAlign:function(t){var u=this,r=n.Selection.getRangeObject(),i;if(this.lastVerticalAlignment=this.verticalAlignment,this.verticalAlignment=t,i=this.getSelectedCells(r),i&&u.toggleAlign(i,"vertical-align"),this.verticalAlignment!=this.lastVerticalAlignment)switch(this.lastVerticalAlignment){case"top":this._alignTopButton.setState(!1);break;case"middle":this._alignMiddleButton.setState(!1);break;case"bottom":this._alignBottomButton.setState(!1)}r.select()},align:function(t){var i=this,r=n.Selection.getRangeObject(),u,f,o;if(this.lastAlignment=this.alignment,this.alignment=t,u=r.getCommonAncestorContainer(),f=this.getSelectedCells(r),f?i.toggleAlign(f):s.Utils.Dom.isEditingHost(u)?(o=[],e.each(n.Selection.getRangeObject().getSelectionTree(),function(){this.selection!=="none"&&this.domobj.nodeType!==3&&o.push(this.domobj)}),i.toggleAlign(o)):i.toggleAlign(u),this.alignment!=this.lastAlignment)switch(this.lastAlignment){case"right":this._alignRightButton.setState(!1);break;case"left":this._alignLeftButton.setState(!1);break;case"center":this._alignCenterButton.setState(!1);break;case"justify":this._alignJustifyButton.setState(!1)}r.select()},getSelectedCells:function(t){var i,u=t.findMarkup(function(){return e(this).is("td,th")&&(i=this),e(this).is("table.aloha-table")},n.activeEditable.obj),r=e(u).find(".aloha-cell-selected");return r.length?r:i},toggleAlign:function(n,t){var u=this,i,r;t=t||"text-align",i=t==="vertical-align"?u.verticalAlignment:u.alignment,r=!0,e(n).each(function(){var n=e(this).css(t);if(n!=i)return r=!1,!1}),e(n).each(function(){var n=e(this).css(t);n==i&&r?e(this).css(t,""):e(this).css(t,i)})}})}),define("abbr/nls/i18n",{root:{"floatingmenu.tab.abbr":"Abbreviation","button.addabbr.tooltip":"insert abbreviation","button.abbr.tooltip":"format as abbreviation","button.remabbr.tooltip":"remove abbreviation","newabbr.defaulttext":"Abbr"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("abbr/abbr-plugin",["aloha","jquery","aloha/plugin","ui/ui","ui/toggleButton","ui/button","ui/scopes","ui/port-helper-attribute-field","i18n!abbr/nls/i18n","i18n!aloha/nls/i18n"],function(n,t,i,r,u,f,e,o,s){var h=window.GENTICS;return i.create("abbr",{config:["abbr"],init:function(){this.createButtons(),this.subscribeEvents(),this.bindInteractions()},createButtons:function(){var n=this;this._formatAbbrButton=r.adopt("formatAbbr",u,{tooltip:s.t("button.abbr.tooltip"),icon:"aloha-icon aloha-icon-abbr",scope:"Aloha.continuoustext",click:function(){n.formatAbbr()}}),this._insertAbbrButton=r.adopt("insertAbbr",f,{tooltip:s.t("button.addabbr.tooltip"),icon:"aloha-icon aloha-icon-abbr",scope:"Aloha.continuoustext",click:function(){n.insertAbbr(!1)}}),e.createScope("abbr","Aloha.continuoustext"),this.abbrField=o({width:320,name:"abbrText",scope:"abbr"}),this.remAbbrButton=r.adopt("removeAbbr",f,{tooltip:s.t("button.remabbr.tooltip"),icon:"aloha-icon aloha-icon-abbr-rem",scope:"abbr",click:function(){n.removeAbbr()}})},bindInteractions:function(){var t=this,i;for(this.abbrField.addListener("blur",function(){this.getValue()==""&&t.removeAbbr()}),i=0;i<n.editables.length;i++)n.editables[i].obj.keydown(function(n){if(n.metaKey&&n.which==71)return t.findAbbrMarkup()?(t.abbrField.foreground(),t.abbrField.focus()):t.insertAbbr(),n.stopPropagation(),n.preventDefault(),!1})},subscribeEvents:function(){var i=this,r={};n.bind("aloha-editable-activated",function(){if(n.activeEditable&&n.activeEditable.obj){var u=i.getEditableConfig(n.activeEditable.obj);r[n.activeEditable.getId()]=t.inArray("abbr",u)!==-1}}),n.bind("aloha-editable-destroyed",function(){n.activeEditable&&n.activeEditable.obj&&delete r[n.activeEditable.getId()]}),n.bind("aloha-selection-changed",function(t,u){if(n.activeEditable){if(r[n.activeEditable.getId()])i._formatAbbrButton.show(),i._insertAbbrButton.show();else{i._formatAbbrButton.hide(),i._insertAbbrButton.hide();return}var f=i.findAbbrMarkup(u);f?(i._insertAbbrButton.hide(),i._formatAbbrButton.setState(!0),e.setScope("abbr"),i.abbrField.setTargetObject(f,"title")):(i._formatAbbrButton.setState(!1),i.abbrField.setTargetObject(null))}})},findAbbrMarkup:function(t){if(typeof t=="undefined")var t=n.Selection.getRangeObject();return n.activeEditable?t.findMarkup(function(){return this.nodeName.toLowerCase()=="abbr"},n.activeEditable.obj):null},formatAbbr:function(){var t=n.Selection.getRangeObject();n.activeEditable&&(this.findAbbrMarkup(t)?this.removeAbbr():this.insertAbbr())},insertAbbr:function(i){var r=n.Selection.getRangeObject(),f,u;this.findAbbrMarkup(r)||(r.isCollapsed()&&i!=!1&&h.Utils.Dom.extendToWord(r),r.isCollapsed()?(f=s.t("newabbr.defaulttext"),u=t('<abbr title="">'+f+"<\/abbr>"),h.Utils.Dom.insertIntoDOM(u,r,t(n.activeEditable.obj)),r.startContainer=r.endContainer=u.contents().get(0),r.startOffset=0,r.endOffset=f.length):(u=t('<abbr title=""><\/abbr>'),h.Utils.Dom.addMarkup(r,u,!1)),r.select(),this.abbrField.foreground(),this.abbrField.focus())},removeAbbr:function(){var t=n.Selection.getRangeObject(),i=this.findAbbrMarkup();i&&(h.Utils.Dom.removeFromDOM(i,t,!0),t.select())},makeClean:function(){},toString:function(){return"abbr"}})}),define("horizontalruler/nls/i18n",{root:{"button.addhr.tooltip":"Add a horizontal ruler"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("horizontalruler/horizontalruler-plugin",["aloha","jquery","aloha/plugin","ui/ui","ui/button","i18n!horizontalruler/nls/i18n","i18n!aloha/nls/i18n"],function(n,t,i,r,u,f){var e=window.GENTICS;return i.create("horizontalruler",{_constructor:function(){this._super("horizontalruler")},config:["hr"],init:function(){var i=this;this._insertHorizontalRuleButton=r.adopt("insertHorizontalRule",u,{tooltip:f.t("button.addhr.tooltip"),iconOnly:!0,icon:"aloha-icon-horizontalruler",scope:"Aloha.continuoustext",click:function(){i.insertHR()}}),n.bind("aloha-editable-activated",function(){if(n.activeEditable)if(i.cfg=i.getEditableConfig(n.activeEditable.obj),t.inArray("hr",i.cfg)!=-1)i._insertHorizontalRuleButton.show(!0);else{i._insertHorizontalRuleButton.show(!1);return}})},insertHR:function(){var u=this,i=n.Selection.getRangeObject(),r;n.activeEditable&&(r=t("<hr>"),e.Utils.Dom.insertIntoDOM(r,i,t(n.activeEditable.obj),!0),i.select())}})}),define("paste/paste-plugin",["jquery","aloha/core","aloha/plugin","aloha/command","contenthandler/contenthandler-utils","aloha/console","aloha/copypaste"],function(n,t,i,r,u,f,e){function y(n){var t=e.getEditableAt(n);t&&t.obj.focus(),e.setSelectionAt(n)}function l(n,t){t.css({top:c.scrollTop(),left:c.scrollLeft()-200}).contents().remove();var i=e.getEditableAt(n);i&&i.obj.blur(),e.setSelectionAt({startContainer:t[0],endContainer:t[0],startOffset:0,endOffset:0}),t.focus()}function p(n){var t=n.startContainer;return 1===t.nodeType?"p"===t.nodeName.toLowerCase()&&u.isProppedParagraph(t.outerHTML):3===t.nodeType&&"p"===t.parentNode.nodeName.toLowerCase()&&1===t.parentNode.childNodes.length&&v.test(window.escape(t.data))}function w(n){p(n)&&(3===n.startContainer.nodeType?n.startContainer.data="":n.startContainer.innerHTML=" ",n.startOffset=0,n.endContainer===n.startContainer&&(n.endOffset=0))}function b(n,i,r){if(i){var u=n.html();s&&/^&nbsp;/.test(u)&&(u=u.substring(6)),y(i),w(i),t.queryCommandSupported("insertHTML")?t.execCommand("insertHTML",!1,u):f.error("Common.Paste",'Command "insertHTML" not available. Enable the plugin "common/commands".')}n.contents().remove(),typeof r=="function"&&r()}function a(n,i,r){n.metaKey=null,n.stopPropagation(),window.setTimeout(function(){b(o,i,r),t.activeEditable.smartContentChange(n)},10)}function k(n){s?n.bind("beforepaste",function(n){h=e.getRange(),l(h,o),n.stopPropagation()}):n.bind("paste",function(n){var t=e.getRange(),i;l(t,o),s&&(i=document.selection.createRange(),i.execCommand("paste")),a(n,t)})}var c=n(window),s=!!n.browser.msie,v=/^(\s|%A0)$/,o=n('<div style="position:absolute; clip:rect(0px,0px,0px,0px); width:1px; height:1px;"><\/div>').contentEditable(!0),h=null;return i.create("paste",{settings:{},init:function(){n("body").append(o);var i=!this.settings.noclipboardaccess;t.bind("aloha-editable-created",function(n,t){k(t.obj,i)}),s&&o.bind("paste",function(n){a(n,h,function(){h=null})})},register:function(){f.deprecated("Plugins.Paste","register() for pasteHandler is deprecated.  Use the ContentHandler Plugin instead.")}})}),define("toc/nls/i18n",{root:{"button.addtoc.tooltip":"Table of contents"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("toc/toc-plugin",["aloha","aloha/plugin","jquery","ui/ui","ui/button","i18n!toc/nls/i18n","i18n!aloha/nls/i18n","aloha/console"],function(n,t,i,r,u,f){function e(n){return n[n.length-1]}function w(n){return n[0]}function a(n){return n.slice(1)}function b(n,t){return h(n,function(n){return n===t})}function h(n,t){for(var i=0;i<n.length;i++)if(t(n[i]))return n[i];return null}function v(n,t){for(var r=[],i=0;i<n.length;i++)r.push(t(n[i]));return r}function k(n,t){v(n,t)}function c(){return i(v(n.editables,function(n){return document.getElementById(n.getId())}))}function d(n,t){return t?n.find('a[href $= "#'+t+'"]'):i()}function o(n){var u,t,r,f;for(typeof n=="object"?u=i(n).text().replace(/[^a-zA-Z-]+/g,"-").replace(/^[^a-zA-Z]+/,""):n&&(u=n),t=0;;t++)if(r=u,t&&(r+="-"+t),f=document.getElementById(r),!f||typeof n=="object"&&f===n)return r}var y=window.GENTICS,s="toc",l=null,p=[];return t.create(s,{minEntries:0,updateInterval:5e3,config:["toc"],init:function(){var t=this;typeof this.settings.minEntries=="undefined"&&(this.settings.minEntries=this.minEntries),typeof this.settings.updateInterval=="undefined"&&(this.settings.updateInterval=this.updateInterval),n.bind("aloha-editable-activated",function(){if(n.activeEditable)if(t.cfg=t.getEditableConfig(n.activeEditable.obj),i.inArray("toc",t.cfg)!=-1)t._insertTocButton.show(!0);else{t._insertTocButton.show(!1);return}}),this.initButtons(),i(document).ready(function(){t.spawn()})},initButtons:function(){var n=this;this._insertTocButton=r.adopt("insertToc",u,{tooltip:f.t("button.addtoc.tooltip"),icon:"aloha-icon aloha-icon-orderedlist",scope:"Aloha.continuoustext",click:function(){n.insertAtSelection(l)}})},register:function(n){l=n},insertAtSelection:function(t){t=t||c();var r=o("toc"),u=i("<ol class='toc_root'><\/ol>").attr("id",r).attr("contentEditable","false"),f=n.Selection.getRangeObject(),e=n.activeEditable,s=i(document.getElementById(e.getId()));y.Utils.Dom.insertIntoDOM(u,f,s),this.create(r).register(t).update().tickTock()},spawn:function(n,t){n=n||i("body"),t=t||c(),n.find("ol.toc_root").each(function(){var n=i(this).attr("id");n||(n=o("toc"),i(this).attr("id",n)),that.create(n).register(t).tickTock()})},create:function(n){return p.push(this),{id:n,$containers:i(),settings:this.settings,root:function(){return i(document.getElementById(this.id))},register:function(n){var t=this;return t.$containers=t.$containers.add(n),t.$containers.filter(function(){return!i(this).data(s+"."+t.id+".listening")}).each(function(){var n=i(this);n.data(s+"."+t.id+".listening",!0),n.bind("blur",function(){t.cleanupIds(n.get(0)),t.update(n)})}),t},tickTock:function(n){var t=this;if(n=n||this.settings.updateInterval,n)return window.setInterval(function(){t.register(c()),t.update()},n),t},cleanupIds:function(n){var t=[],r=this;return this.headings(this.$containers).each(function(){var r=i(this).attr("id");(r&&-1!=i.inArray(r,t)||n&&(i.contains(n,this)||n===this))&&i(this).attr("id",o(this)),t.push(r)}),this},update:function(n){var t=this,r;n=n||t.$containers;var u=this.outline(t.$containers),i=[t.root()];return e(i).empty(),function f(n){var r=[];k(n,function(n){var e=w(n),u=t.linkSection(e,i,r);i.push(u),f(a(n)),i.pop(),r.push(u)})}(a(u)),r=t.root().attr("data-TOC-minEntries")||this.settings.minEntries,t.root().find("li").length>=r?t.root().show():t.root().hide(),this},linkSection:function(n,t,r){var f=n.eq(0).attr("id"),s,u,h;return f||(f=o(n.get(0)),n.eq(0).attr("id",f)),s=this.root(),u=d(s,f),u.length||(u=i("<li><a/><\/li>")),u.find("a").attr("href","#"+f).text(n.eq(0).text()),e(r)?e(r).after(u):e(t).get(0)==s.get(0)?s.append(u):(h=i("<ol/>").append(u),e(t).append(h)),u},outline:function(n){var r=[i()],t=[r];return this.headings(n).each(function(){var n=i(this),e=this.nodeName.toLowerCase(),r=["h6","h5","h4","h3","h2","h1"],o=i.inArray(e,r),s=r.slice(o).join(","),c=n.nextUntil(s).andSelf(),u=[c],f=h(t,function(t){var r=t[0];return!r.length||h(r,function(t){return n.get(0)===t||i.contains(t,n.get(0))})});f.push(u),t.splice(0,b(t,f),u)}),r},headings:function(n){return n.find(":header").add(n.filter(":header"))}}}})}),define("cite/nls/i18n",{root:{"cite.button.add.quote":"Format selection as quote","cite.button.add.blockquote":"Format selection as blockquote"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("cite/cite-plugin",["aloha","jquery","aloha/plugin","ui/ui","ui/toggleButton","format/format-plugin","util/dom","PubSub","i18n!cite/nls/i18n","i18n!aloha/nls/i18n"],function(n,t,i,r,u,f,e,o,s){function l(n,t){return n.replace(/\{([a-z0-9\-\_]+)\}/ig,function(n,i){var r=t[i]||n;return typeof r=="function"?r():r})}function p(n){return typeof n=="string"?l(n,y):n}function a(){var n=[],i=v;return t.each(arguments,function(){n.push("."+(""===this?i:i+"-"+this))}),t.trim(n.join(" "))}function h(){var n=[],i=v;return t.each(arguments,function(){n.push(""===this?i:i+"-"+this)}),t.trim(n.join(" "))}var w=t,v="aloha-cite",c=(new Date).getTime(),y={quote:h("quote"),blockquote:h("blockquote"),"panel-label":h("panel-label"),"panel-field":h("panel-field"),"panel-btns":h("panel-btns"),"link-field":h("link-field"),"note-field":h("note-field"),references:h("references")};return i.create("cite",{citations:[],referenceContainer:null,settings:null,sidebar:null,config:["quote","blockquote"],init:function(){var i=this,l,e;n.settings&&n.settings.plugins&&n.settings.plugins.cite&&(l=t(n.settings.plugins.cite.referenceContainer),l.length&&(i.referenceContainer=l),typeof n.settings.plugins.cite!="undefined"&&(i.settings=n.settings.plugins.cite),typeof i.settings.sidebar=="undefined"&&(i.settings.sidebar={}),typeof i.settings.sidebar.open=="undefined"&&(i.settings.sidebar.open=!0),typeof i.settings.sidebar.open=="string"&&(i.settings.sidebar.open=i.settings.sidebar.open.toLowerCase(),i.settings.sidebar.open=i.settings.sidebar.open==="false"||i.settings.sidebar.open==="0"?!1:!0)),this._quoteButton=r.adopt("quote",u,{tooltip:s.t("cite.button.add.quote"),icon:h("button","inline-button"),scope:"Aloha.continuoustext",click:function(){i.addInlineQuote()}}),f.multiSplitButton.pushItem({name:"blockquote",tooltip:s.t("cite.button.add.blockquote"),icon:h("button","block-button"),click:function(){i.addBlockQuote()}}),e=this,n.ready(function(){e.sidebar=n.Sidebar.right.show(),e.sidebar.addPanel({id:h("sidebar-panel"),title:"Citation",content:"",expanded:!0,activeOn:"q, blockquote",onInit:function(){var n=this,t="",i;e.referenceContainer&&(t='<div class="{panel-label}">Note:<\/div> <div class="{panel-field} {note-field}" style="margin: 5px;"><textarea><\/textarea><\/div>'),i=this.setContent(p('<div class="{panel-label}">Link:<\/div><div class="{panel-field} {link-field}" style="margin: 5px;"><input type="text" /><\/div>'+t)).content,i.find("input, textarea").bind("keypress change",function(){e.addCiteDetails(n.content.attr("data-cite-id"),n.content.find(a("link-field input")).val(),n.content.find(a("note-field textarea")).val())})},onActivate:function(n){var t=n.attr("data-cite-id"),u,r;t||(t=++c,u=[h("wrapper")].join(" "),n.addClass(u),n.attr("data-cite-id",t)),r=i.getIndexOfCitation(t),-1===r&&(r=i.citations.push({uid:t,link:null,notes:null})-1),this.content.attr("data-cite-id",t),this.content.find(a("link-field input")).val(n.attr("cite")),this.content.find(a("note-field textarea")).val(i.citations[r].note)}})}),n.bind("aloha-editable-activated",function(n,r){var u=i.getEditableConfig(r.editable.obj);u&&(t.inArray("quote",u)!==-1?i._quoteButton.show(!0):i._quoteButton.show(!1),t.inArray("blockquote",u)!==-1?f.multiSplitButton.showItem("blockquote"):f.multiSplitButton.hideItem("blockquote"))}),o.sub("aloha.selection.context-change",function(r){for(var l=r.range,o=t("button.aloha-cite-button"),s=!1,u,h=l.markupEffectiveAtStart,c=h.length,e;c;)if(u=h[--c].nodeName,u==="Q"||u==="BLOCKQUOTE"){s=!0;break}if(o.filter(".aloha-cite-block-button").removeClass("aloha-cite-pressed"),i._quoteButton.setState(!1),s)return"Q"===u?i._quoteButton.setState(!0):o.filter(".aloha-cite-block-button").addClass("aloha-cite-pressed"),!1;e=[],n.activeEditable&&(e=i.getEditableConfig(n.activeEditable.obj)),t.inArray("quote",e)!=-1?i._quoteButton.show(!0):i._quoteButton.show(!1),t.inArray("blockquote",e)!=-1?f.multiSplitButton.showItem("blockquote"):f.multiSplitButton.hideItem("blockquote")})},getIndexOfCitation:function(n){for(var f=this.citations,r=f.length,u=0,t,i;u<r;){if(t=u+r>>1,i=f[t].uid,i==n)return t;i>n?r=t:i<n&&(u=t+1)}return-1},addBlockQuote:function(){var i=[h("wrapper"),h(++c)].join(" "),r=t(l('<blockquote class="{classes}" data-cite-id="{uid}"><\/blockquote>',{uid:c,classes:i}));n.activeEditable&&t(n.activeEditable.obj[0]).click(),n.Selection.changeMarkupOnSelection(r),this.referenceContainer&&this.addCiteToReferences(c),this.sidebar&&this.settings&&this.settings.sidebar&&this.settings.sidebar.open&&this.sidebar.open()},addInlineQuote:function(){var f=[h("wrapper"),h(++c)].join(" "),r=t(l('<q class="{classes}" data-cite-id="{uid}"><\/q>',{uid:c,classes:f})),i=n.Selection.rangeObject,u;return n.activeEditable&&t(n.activeEditable.obj[0]).click(),u=i.findMarkup(function(){return this.nodeName&&r.length&&typeof this.nodeName=="string"&&typeof r[0].nodeName=="string"?this.nodeName.toLowerCase()===r[0].nodeName.toLowerCase():!1},n.activeEditable.obj),u?i.isCollapsed()?e.removeFromDOM(u,i,!0):e.removeMarkup(i,r,n.activeEditable.obj):(i.isCollapsed()&&e.extendToWord(i),e.addMarkup(i,r)),i.select(),this.referenceContainer&&this.addCiteToReferences(c),this.sidebar&&this.settings&&this.settings.sidebar&&this.settings.sidebar.open&&this.sidebar.open(),!1},addCiteToReferences:function(n){var i=this.getIndexOfCitation(n);if(-1!==i){var f=t(".aloha-editable-active "+a(n)),r="cite-note-"+n,u="cite-ref-"+n;f.append(l('<sup id="{ref}" contenteditable="false"><a href="#{note}">[{count}]<\/a><\/sup>',{ref:u,note:r,count:i+1})),0===this.referenceContainer.find("ol.references").length&&this.referenceContainer.append("<h2>References<\/h2>").append('<ol class="references"><\/ol>'),this.referenceContainer.find("ol.references").append(l('<li id="{note}"><a href="#{ref}">^<\/a> &nbsp; <span><\/span><\/li>',{ref:u,note:r}))}},addCiteDetails:function(n,i,r){if(this.citations[this.getIndexOfCitation(n)]={uid:n,link:i,note:r},i)var u=t(a(n)).attr("cite",i);this.referenceContainer&&t("li#cite-note-"+n+" span").html(l(i?'<a class="external" target="_blank" href="{url}">{url}<\/a>':"",{url:i})+(r?". "+r:""))},toString:function(){return"aloha-citiation-plugin"},makeClean:function(n){n.find("q, blockquote").each(function(){t.trim(t(this).attr("class"))===""&&t(this).removeAttr("class"),this.referenceContainer||(t(this).removeClass("aloha-cite-"+t(this).attr("data-cite-id")),t(this).attr("data-cite-id")!=null&&t(this).removeAttr("data-cite-id")),t(this).removeClass("aloha-cite-wrapper")})}})}),define("flag-icons/flag-icons-plugin",[],function(){"use strict";return{path:Aloha.getPluginUrl("flag-icons")}}),define("numerated-headers/nls/i18n",{root:{"headerids.label.target":"Target","headerids.button.reset":"Reset","headerids.button.set":"Set"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("numerated-headers/numerated-headers-plugin",["aloha/core","jquery","aloha/plugin","ui/ui","ui/toggleButton","i18n!numerated-headers/nls/i18n","i18n!aloha/nls/i18n"],function(n,t,i,r,u,f){var e={};return n.bind("aloha-editable-destroyed",function(n,t){delete e[t.getId()]}),i.create("numerated-headers",{config:{numeratedactive:!0,headingselector:"h1, h2, h3, h4, h5, h6",trailingdot:!1},init:function(){var t=this;this._formatNumeratedHeadersButton=r.adopt("formatNumeratedHeaders",u,{tooltip:f.t("button.numeratedHeaders.tooltip"),icon:"aloha-icon aloha-icon-numerated-headers",scope:"Aloha.continuoustext",click:function(){var n=t._formatNumeratedHeadersButton.getState();n?t.createNumeratedHeaders():t.removeNumerations()}}),n.bind("aloha-smart-content-changed",function(){t.cleanNumerations(),t.showNumbers()&&t.createNumeratedHeaders()}),n.bind("aloha-format-block",function(){t.cleanNumerations(),t.showNumbers()&&t.createNumeratedHeaders()}),n.bind("aloha-editable-activated",function(){t.isNumeratingOn()?(t._formatNumeratedHeadersButton.show(),t.initForEditable(n.activeEditable.obj)):t._formatNumeratedHeadersButton.hide()})},initForEditable:function(n){var t=n.attr("aloha-numerated-headers");t!=="true"&&t!=="false"&&(t=!0===this.getCurrentConfig().numeratedactive?"true":"false",n.attr("aloha-numerated-headers",t)),t==="true"?(this.createNumeratedHeaders(),this._formatNumeratedHeadersButton.setState(!0)):this._formatNumeratedHeadersButton.setState(!1)},getCurrentConfig:function(){var i=this.getEditableConfig(n.activeEditable.obj);return i.numeratedactive=i.numeratedactive===!0||i.numeratedactive==="true"||i.numeratedactive==="1"?!0:!1,typeof i.headingselector!="string"&&(i.headingselector="h1, h2, h3, h4, h5, h6"),i.headingselector=t.trim(i.headingselector),i.trailingdot=i.trailingdot===!0||i.trailingdot==="true"||i.trailingdot==="1"?!0:!1,i},isNumeratingOn:function(){return this.getCurrentConfig().headingselector!==""},showNumbers:function(){return n.activeEditable&&this.isNumeratingOn()&&n.activeEditable.obj.attr("aloha-numerated-headers")==="true"},cleanNumerations:function(){var i=this,n=this.getBaseElement();n&&this._saveRemoveAnnotations(t(n).find("span[role=annotation]"))},_saveRemoveAnnotations:function(i){var f=this,r=n.Selection.getRangeObject(),u=!1;i.each(function(){(r.startContainer===this||t.inArray(this,t(r.startContainer).parents())>-1)&&(r.startContainer=f._prevNode(this),r.startOffset=0,u=!0),r.startContainer===this.parentNode&&r.startOffset>=t(this).index()&&r.startOffset>0&&(r.startOffset--,u=!0),(r.endContainer===this||t.inArray(this,t(r.endContainer).parents())>-1)&&(r.endContainer=f._prevNode(this),r.endOffset=0,u=!0),r.endContainer===this.parentNode&&r.endOffset>=t(this).index()&&r.endOffset>0&&(r.endOffset--,u=!0),t(this).remove()}),u===!0&&(r.update(),r.select())},_prependAnnotation:function(i,r){var u=n.Selection.getRangeObject(),f=!1;u.startContainer===r&&(u.startOffset++,f=!0),u.endContainer===r&&(u.endOffset++,f=!0),t(r).prepend('<span role="annotation">'+i+"<\/span>"),f===!0&&(u.update(),u.select())},_prevNode:function(n){var t=n.previousSibling;if(!t)return n.parentNode;while(t.lastChild)t=t.lastChild;return t},removeNumerations:function(){t(n.activeEditable.obj).attr("aloha-numerated-headers","false"),this.cleanNumerations()},getBaseElement:function(){return typeof this.baseobjectSelector!="undefined"?t(this.baseobjectSelector).length>0?t(this.baseobjectSelector):null:n.activeEditable?n.activeEditable.obj:null},hasNote:function(n){return!n||t(n).length<=0?!1:t(n).find("span[role=annotation]").length>0},hasContent:function(n){if(!n||0===t(n).length)return!1;var i=t(n).clone().find("span[role=annotation]").remove().end();return t.trim(i.text()).length>0},createNumeratedHeaders:function(){var h=this.getBaseElement(),u,r;if(h){var c=this.getCurrentConfig(),l=c.headingselector,o=h.find(l);if((n.activeEditable.obj.attr("aloha-numerated-headers","true"),typeof o!="undefined"&&o.length!==0)&&(u=7,r=this,o.each(function(){if(r.hasContent(this)){var n=parseInt(this.nodeName.substr(1),10);n<u&&(u=n)}}),!(u>6))){for(var f=null,i=[],e=0,s=0;s<7-u;s++)i[s]=0;o.each(function(){var s,l,h,o,n;if(r.hasContent(this)){if(s=parseInt(this.nodeName.substr(1),10),f===null&&s!==u){r._saveRemoveAnnotations(t(this).find("span[role=annotation]"));return}if(f===null)i[e]++;else if(s>f)i[++e]++;else if(s===f)i[e]++;else if(s<f){for(l=s-u,h=e;h>l;h--)i[h]=0;e=l,i[e]++}if(f=s,o="",c.trailingdot===!0)for(o="",n=0;n<i.length;n++)i[n]!==0&&(o+=i[n]+".");else for(o=i[0],n=1;n<i.length;n++)i[n]!==0&&(o+="."+i[n]);o+="&nbsp;",r.hasNote(this)?t(this).find("span[role=annotation]").html(o):r._prependAnnotation(o,this)}else r.hasNote(this)&&r._saveRemoveAnnotations(t(this).find("span[role=annotation]"))})}}}})}),define("formatlesspaste/formatlesshandler",["aloha","jquery","aloha/contenthandlermanager"],function(n,t,i){function r(n,i){n.find(i.join(",")).each(function(){t(this).contents().unwrap()})}return i.createHandler({enabled:!1,handleContent:function(n){var i;if(typeof n=="string"?i=t("<div>"+n+"<\/div>"):n instanceof t&&(i=t("<div>").append(n)),!i.find(".aloha-block").length)return this.enabled&&r(i,this.strippedElements),i.html()}})}),define("formatlesspaste/nls/i18n",{root:{"button.formatlessPaste.tooltip":"Toggle Formatless Pasting"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("formatlesspaste/formatlesspaste-plugin",["aloha/core","aloha/plugin","jquery","ui/ui","ui/toggleButton","formatlesspaste/formatlesshandler","aloha/contenthandlermanager","i18n!formatlesspaste/nls/i18n"],function(n,t,i,r,u,f,e,o){function h(n){return n?typeof n=="string"?"0"!==n&&"false"!==n.toLowerCase():!0:!1}function c(n){var t={};return typeof n.formatlessPasteOption!="undefined"&&(t.formatlessPasteOption=h(n.formatlessPasteOption)),typeof n.strippedElements!="undefined"&&(t.strippedElements=n.strippedElements),typeof n.button!="undefined"&&(t.button=h(n.button)),t}function l(n,t){i.extend(n,t)}function a(n){e.register("formatless",f),f.strippedElements=n.strippedElements,n._toggleFormatlessPasteButton=r.adopt("toggleFormatlessPaste",u,{tooltip:o.t("button.formatlessPaste.tooltip"),icon:"aloha-icon aloha-icon-formatless-paste",scope:"Aloha.continuoustext",click:function(){f.enabled=!f.enabled}}),n._toggleFormatlessPasteButton.show(n.button),!0===n.formatlessPasteOption?(n._toggleFormatlessPasteButton.setState(!0),f.enabled=!0):!1===n.formatlessPasteOption&&(n._toggleFormatlessPasteButton.setState(!1),f.enabled=!1)}function v(n,t){var i=t.getId(),r;return i?s[i]?s[i]:(r=n.getEditableConfig(t.obj),!r)?null:(s[i]=c(r),s[i]):null}function y(n){var t=n.getId();t&&s[t]&&delete s[t]}var s={};return n.bind("aloha-editable-destroyed",function(n,t){y(t)}),t.create("formatlesspaste",{formatlessPasteOption:!1,button:!0,strippedElements:["a","abbr","b","bdi","bdo","cite","code","del","dfn","em","i","ins","kbd","mark","q","rp","rt","ruby","s","samp","small","strong","sub","sup","time","u","var"],init:function(){var t=this,i=t.settings.config||t.settings;l(t,c(i)),a(t),n.bind("aloha-editable-activated",function(n,i){var r=v(t,i.editable),u;r&&(u=t._toggleFormatlessPasteButton,!0===r.formatlessPasteOption?(u.setState(!0),f.enabled=!0):!1===r.formatlessPasteOption&&(u.setState(!1),f.enabled=!1),u.show(!1!==r.button))})}})}),function(){var n=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(){function u(){!n&&this.init&&this.init.apply(this,arguments)}var o=this.prototype,e,f,r,i;for(n=!0,e=new this,n=!1,f=0;f<arguments.length;f++){r=arguments[f];for(i in r)e[i]=typeof r[i]=="function"&&typeof o[i]=="function"&&t.test(r[i])?function(n,t){return function(){var r=this._super,i;return this._super=o[n],i=t.apply(this,arguments),this._super=r,i}}(i,r[i]):r[i]}return u.prototype=e,u.constructor=u,u.extend=arguments.callee,u}}(),typeof define=="function"&&define("Class",[],function(){return Class}),define("jstree",["jquery"],function(n){var t=n;(function(){if(!n||!n.jstree){var t=!1,i=!1,r=!1;(function(n){n.vakata={},n.vakata.css={get_css:function(n,t,i){n=n.toLowerCase();var u=i.cssRules||i.rules,r=0;do{if(u.length&&r>u.length+5)return!1;if(u[r].selectorText&&u[r].selectorText.toLowerCase()==n)return t===!0?(i.removeRule&&i.removeRule(r),i.deleteRule&&i.deleteRule(r),!0):u[r]}while(u[++r]);return!1},add_css:function(t,i){return n.jstree.css.get_css(t,!1,i)?!1:(i.insertRule?i.insertRule(t+" { }",0):i.addRule(t,null,0),n.vakata.css.get_css(t))},remove_css:function(t,i){return n.vakata.css.get_css(t,!0,i)},add_sheet:function(t){var i=!1,r=!0;if(t.str)return t.title&&(i=n("style[id='"+t.title+"-stylesheet']")[0]),i?r=!1:(i=document.createElement("style"),i.setAttribute("type","text/css"),t.title&&i.setAttribute("id",t.title+"-stylesheet")),i.styleSheet?r?(document.getElementsByTagName("head")[0].appendChild(i),i.styleSheet.cssText=t.str):i.styleSheet.cssText=i.styleSheet.cssText+" "+t.str:(i.appendChild(document.createTextNode(t.str)),document.getElementsByTagName("head")[0].appendChild(i)),i.sheet||i.styleSheet;if(t.url)if(document.createStyleSheet)try{i=document.createStyleSheet(t.url)}catch(u){}else return i=document.createElement("link"),i.rel="stylesheet",i.type="text/css",i.media="all",i.href=t.url,document.getElementsByTagName("head")[0].appendChild(i),i.styleSheet}};var u=[],e=-1,o={},f={};n.fn.jstree=function(t){var f=typeof t=="string",r=Array.prototype.slice.call(arguments,1),i=this;if(f){if(t.substring(0,1)=="_")return i;this.each(function(){var f=u[n.data(this,"jstree-instance-id")],e=f&&n.isFunction(f[t])?f[t].apply(f,r):f;if(typeof e!="undefined"&&(t.indexOf("is_")===0||e!==!0&&e!==!1))return i=e,!1})}else this.each(function(){var i=n.data(this,"jstree-instance-id"),s=[],f=t?n.extend({},!0,t):{},h=n(this),e=!1,c=[];s=s.concat(r),h.data("jstree")&&s.push(h.data("jstree")),f=s.length?n.extend.apply(null,[!0,f].concat(s)):f,typeof i!="undefined"&&u[i]&&u[i].destroy(),i=parseInt(u.push({}),10)-1,n.data(this,"jstree-instance-id",i),f.plugins=n.isArray(f.plugins)?f.plugins:n.jstree.defaults.plugins.slice(),f.plugins.unshift("core"),f.plugins=f.plugins.sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(","),e=n.extend(!0,{},n.jstree.defaults,f),e.plugins=f.plugins,n.each(o,function(t){n.inArray(t,e.plugins)===-1?(e[t]=null,delete e[t]):c.push(t)}),e.plugins=c,u[i]=new n.jstree._instance(i,n(this).addClass("jstree jstree-"+i),e),n.each(u[i]._get_settings().plugins,function(n,t){u[i].data[t]={}}),n.each(u[i]._get_settings().plugins,function(n,t){o[t]&&o[t].__init.apply(u[i])}),setTimeout(function(){u[i].init()},0)});return i},n.jstree={defaults:{plugins:[]},_focused:function(){return u[e]||null},_reference:function(t){if(u[t])return u[t];var i=n(t);return(i.length||typeof t!="string"||(i=n("#"+t)),!i.length)?null:u[i.closest(".jstree").data("jstree-instance-id")]||null},_instance:function(t,i,r){this.data={core:{}},this.get_settings=function(){return n.extend(!0,{},r)},this._get_settings=function(){return r},this.get_index=function(){return t},this.get_container=function(){return i},this.get_container_ul=function(){return i.children("ul:eq(0)")},this._set_settings=function(t){r=n.extend(!0,{},r,t)}},_fn:{},plugin:function(t,i){i=n.extend({},{__init:n.noop,__destroy:n.noop,_fn:{},defaults:!1},i),o[t]=i,n.jstree.defaults[t]=i.defaults,n.each(i._fn,function(i,r){r.plugin=t,r.old=n.jstree._fn[i],n.jstree._fn[i]=function(){var u,t=r,f=Array.prototype.slice.call(arguments),o=new n.Event("before.jstree"),e=!1;if(this.data.core.locked!==!0||i==="unlock"||i==="is_locked"){do{if(t&&t.plugin&&n.inArray(t.plugin,this._get_settings().plugins)!==-1)break;t=t.old}while(t);if(t){if(i.indexOf("_")===0)u=t.apply(this,f);else{if(u=this.get_container().triggerHandler(o,{func:i,inst:this,args:f,plugin:t.plugin}),u===!1)return;typeof u!="undefined"&&(f=u),u=t.apply(n.extend({},this,{__callback:function(n){this.get_container().triggerHandler(i+".jstree",{inst:this,args:f,rslt:n,rlbk:e})},__rollback:function(){return e=this.get_rollback()},__call_old:function(n){return t.old.apply(this,n?Array.prototype.slice.call(arguments,1):f)}}),f)}return u}}},n.jstree._fn[i].old=r.old,n.jstree._fn[i].plugin=t})},rollback:function(t){t&&(n.isArray(t)||(t=[t]),n.each(t,function(n,t){u[t.i].set_rollback(t.h,t.d)}))}},n.jstree._fn=n.jstree._instance.prototype={},n(function(){var u=navigator.userAgent.toLowerCase(),e=(u.match(/.+?(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],f=".jstree ul, .jstree li { display:block; margin:0 0 0 0; padding:0 0 0 0; list-style-type:none; } .jstree li { display:block; min-height:18px; line-height:18px; white-space:nowrap; margin-left:18px; min-width:18px; } .jstree-rtl li { margin-left:0; margin-right:18px; } .jstree > ul > li { margin-left:0px; } .jstree-rtl > ul > li { margin-right:0px; } .jstree ins { display:inline-block; text-decoration:none; width:18px; height:18px; margin:0 0 0 0; padding:0; } .jstree a { display:inline-block; line-height:16px; height:16px; color:black; white-space:nowrap; text-decoration:none; padding:1px 2px; margin:0; } .jstree a:focus { outline: none; } .jstree a > ins { height:16px; width:16px; } .jstree a > .jstree-icon { margin-right:3px; } .jstree-rtl a > .jstree-icon { margin-left:3px; margin-right:0; } li.jstree-open > ul { display:block; } li.jstree-closed > ul { display:none; } ";if(/msie/.test(u)&&parseInt(e,10)==6){t=!0;try{document.execCommand("BackgroundImageCache",!1,!0)}catch(o){}f+=".jstree li { height:18px; margin-left:0; margin-right:0; } .jstree li li { margin-left:18px; } .jstree-rtl li li { margin-left:0px; margin-right:18px; } li.jstree-open ul { display:block; } li.jstree-closed ul { display:none !important; } .jstree li a { display:inline; border-width:0 !important; padding:0px 2px !important; } .jstree li a ins { height:16px; width:16px; margin-right:3px; } .jstree-rtl li a ins { margin-right:0px; margin-left:3px; } "}/msie/.test(u)&&parseInt(e,10)==7&&(i=!0,f+=".jstree li a { border-width:0 !important; padding:0px 2px !important; } "),!/compatible/.test(u)&&/mozilla/.test(u)&&parseFloat(e,10)<1.9&&(r=!0,f+=".jstree ins { display:-moz-inline-box; } .jstree li { line-height:12px; } .jstree a { display:-moz-inline-box; } .jstree .jstree-no-icons .jstree-checkbox { display:-moz-inline-stack !important; } "),n.vakata.css.add_sheet({str:f,title:"jstree"})}),n.jstree.plugin("core",{__init:function(){this.data.core.locked=!1,this.data.core.to_open=this.get_settings().core.initially_open,this.data.core.to_load=this.get_settings().core.initially_load},defaults:{html_titles:!1,animation:500,initially_open:[],initially_load:[],open_parents:!0,notify_plugins:!0,rtl:!1,load_open:!1,strings:{loading:"Loading ...",new_node:"New node",multiple_selection:"Multiple selection"}},_fn:{init:function(){this.set_focus(),this._get_settings().core.rtl&&this.get_container().addClass("jstree-rtl").css("direction","rtl"),this.get_container().html("<ul><li class='jstree-last jstree-leaf'><ins>&#160;<\/ins><a class='jstree-loading' href='#'><ins class='jstree-icon'>&#160;<\/ins>"+this._get_string("loading")+"<\/a><\/li><\/ul>"),this.data.core.li_height=this.get_container_ul().find("li.jstree-closed, li.jstree-leaf").eq(0).height()||18,this.get_container().delegate("li > ins","click.jstree",n.proxy(function(t){var i=n(t.target);i.is("ins")&&t.pageY-i.offset().top<this.data.core.li_height&&this.toggle_node(i)},this)).bind("mousedown.jstree",n.proxy(function(){this.set_focus()},this)).bind("dblclick.jstree",function(){var n;if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){n=window.getSelection();try{n.removeAllRanges(),n.collapse()}catch(t){}}}),this._get_settings().core.notify_plugins&&this.get_container().bind("load_node.jstree",n.proxy(function(t,i){var r=this._get_node(i.rslt.obj),u=this;(r===-1&&(r=this.get_container_ul()),r.length)&&r.find("li").each(function(){var t=n(this);t.data("jstree")&&n.each(t.data("jstree"),function(i,r){u.data[i]&&n.isFunction(u["_"+i+"_notify"])&&u["_"+i+"_notify"].call(u,t,r)})})},this)),this._get_settings().core.load_open&&this.get_container().bind("load_node.jstree",n.proxy(function(t,i){var r=this._get_node(i.rslt.obj),u=this;(r===-1&&(r=this.get_container_ul()),r.length)&&r.find("li.jstree-open:not(:has(ul))").each(function(){u.load_node(this,n.noop,n.noop)})},this)),this.__callback(),this.load_node(-1,function(){this.loaded(),this.reload_nodes()})},destroy:function(){var i,t=this.get_index(),r=this._get_settings(),f=this;if(n.each(r.plugins,function(n,t){try{o[t].__destroy.apply(f)}catch(i){}}),this.__callback(),this.is_focused())for(i in u)if(u.hasOwnProperty(i)&&i!=t){u[i].set_focus();break}t===e&&(e=-1),this.get_container().unbind(".jstree").undelegate(".jstree").removeData("jstree-instance-id").find("[class^='jstree']").andSelf().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")}),n(document).unbind(".jstree-"+t).undelegate(".jstree-"+t),u[t]=null,delete u[t]},_core_notify:function(n,t){t.opened&&this.open_node(n,!1,!0)},lock:function(){this.data.core.locked=!0,this.get_container().children("ul").addClass("jstree-locked").css("opacity","0.7"),this.__callback({})},unlock:function(){this.data.core.locked=!1,this.get_container().children("ul").removeClass("jstree-locked").css("opacity","1"),this.__callback({})},is_locked:function(){return this.data.core.locked},save_opened:function(){var n=this;this.data.core.to_open=[],this.get_container_ul().find("li.jstree-open").each(function(){this.id&&n.data.core.to_open.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"))}),this.__callback(n.data.core.to_open)},save_loaded:function(){},reload_nodes:function(t){var i=this,u=!0,r=[],f=[];t||(this.data.core.reopen=!1,this.data.core.refreshing=!0,this.data.core.to_open=n.map(n.makeArray(this.data.core.to_open),function(n){return"#"+n.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}),this.data.core.to_load=n.map(n.makeArray(this.data.core.to_load),function(n){return"#"+n.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}),this.data.core.to_open.length&&(this.data.core.to_load=this.data.core.to_load.concat(this.data.core.to_open))),this.data.core.to_load.length&&(n.each(this.data.core.to_load,function(t,i){if(i=="#")return!0;n(i).length?r.push(i):f.push(i)}),r.length&&(this.data.core.to_load=f,n.each(r,function(n,t){i._is_loaded(t)||(i.load_node(t,function(){i.reload_nodes(!0)},function(){i.reload_nodes(!0)}),u=!1)}))),this.data.core.to_open.length&&n.each(this.data.core.to_open,function(n,t){i.open_node(t,!1,!0)}),u&&(this.data.core.reopen&&clearTimeout(this.data.core.reopen),this.data.core.reopen=setTimeout(function(){i.__callback({},i)},50),this.data.core.refreshing=!1,this.reopen())},reopen:function(){var t=this;this.data.core.to_open.length&&n.each(this.data.core.to_open,function(n,i){t.open_node(i,!1,!0)}),this.__callback({})},refresh:function(n){var t=this;this.save_opened(),n||(n=-1),n=this._get_node(n),n||(n=-1),n!==-1?n.children("UL").remove():this.get_container_ul().empty(),this.load_node(n,function(){t.__callback({obj:n}),t.reload_nodes()})},loaded:function(){this.__callback()},set_focus:function(){if(!this.is_focused()){var t=n.jstree._focused();t&&t.unset_focus(),this.get_container().addClass("jstree-focused"),e=this.get_index(),this.__callback()}},is_focused:function(){return e==this.get_index()},unset_focus:function(){this.is_focused()&&(this.get_container().removeClass("jstree-focused"),e=-1),this.__callback()},_get_node:function(t){var i=n(t,this.get_container());return i.is(".jstree")||t==-1?-1:(i=i.closest("li",this.get_container()),i.length?i:!1)},_get_next:function(n,t){return(n=this._get_node(n),n===-1)?this.get_container().find("> ul > li:first-child"):n.length?t?n.nextAll("li").size()>0?n.nextAll("li:eq(0)"):!1:n.hasClass("jstree-open")?n.find("li:eq(0)"):n.nextAll("li").size()>0?n.nextAll("li:eq(0)"):n.parentsUntil(".jstree","li").next("li").eq(0):!1},_get_prev:function(n,t){if(n=this._get_node(n),n===-1)return this.get_container().find("> ul > li:last-child");if(!n.length)return!1;if(t)return n.prevAll("li").length>0?n.prevAll("li:eq(0)"):!1;if(n.prev("li").length){for(n=n.prev("li").eq(0);n.hasClass("jstree-open");)n=n.children("ul:eq(0)").children("li:last");return n}var i=n.parentsUntil(".jstree","li:eq(0)");return i.length?i:!1},_get_parent:function(n){if(n=this._get_node(n),n==-1||!n.length)return!1;var t=n.parentsUntil(".jstree","li:eq(0)");return t.length?t:-1},_get_children:function(n){return(n=this._get_node(n),n===-1)?this.get_container().children("ul:eq(0)").children("li"):n.length?n.children("ul:eq(0)").children("li"):!1},get_path:function(n,t){var i=[],r=this;return(n=this._get_node(n),n===-1||!n||!n.length)?!1:(n.parentsUntil(".jstree","li").each(function(){i.push(t?this.id:r.get_text(this))}),i.reverse(),i.push(t?n.attr("id"):this.get_text(n)),i)},_get_string:function(n){return this._get_settings().core.strings[n]||n},is_open:function(n){return n=this._get_node(n),n&&n!==-1&&n.hasClass("jstree-open")},is_closed:function(n){return n=this._get_node(n),n&&n!==-1&&n.hasClass("jstree-closed")},is_leaf:function(n){return n=this._get_node(n),n&&n!==-1&&n.hasClass("jstree-leaf")},correct_state:function(n){if(n=this._get_node(n),!n||n===-1)return!1;n.removeClass("jstree-closed jstree-open").addClass("jstree-leaf").children("ul").remove(),this.__callback({obj:n})},open_node:function(n,i,r){if(n=this._get_node(n),!n.length)return!1;if(!n.hasClass("jstree-closed"))return i&&i.call(),!1;var f=r||t?0:this._get_settings().core.animation,u=this;this._is_loaded(n)?(this._get_settings().core.open_parents&&n.parentsUntil(".jstree",".jstree-closed").each(function(){u.open_node(this,!1,!0)}),f&&n.children("ul").css("display","none"),n.removeClass("jstree-closed").addClass("jstree-open").children("a").removeClass("jstree-loading"),f?n.children("ul").stop(!0,!0).slideDown(f,function(){this.style.display="",u.after_open(n)}):u.after_open(n),this.__callback({obj:n}),i&&i.call()):(n.children("a").addClass("jstree-loading"),this.load_node(n,function(){u.open_node(n,i,r)},i))},after_open:function(n){this.__callback({obj:n})},close_node:function(n,i){n=this._get_node(n);var r=i||t?0:this._get_settings().core.animation,u=this;if(!n.length||!n.hasClass("jstree-open"))return!1;r&&n.children("ul").attr("style","display:block !important"),n.removeClass("jstree-open").addClass("jstree-closed"),r?n.children("ul").stop(!0,!0).slideUp(r,function(){this.style.display="",u.after_close(n)}):u.after_close(n),this.__callback({obj:n})},after_close:function(n){this.__callback({obj:n})},toggle_node:function(n){return(n=this._get_node(n),n.hasClass("jstree-closed"))?this.open_node(n):n.hasClass("jstree-open")?this.close_node(n):void 0},open_all:function(n,t,i){n=n?this._get_node(n):-1,n&&n!==-1||(n=this.get_container_ul()),i?n=n.find("li.jstree-closed"):(i=n,n=n.is(".jstree-closed")?n.find("li.jstree-closed").andSelf():n.find("li.jstree-closed"));var r=this;n.each(function(){var n=this;r._is_loaded(this)?r.open_node(this,!1,!t):r.open_node(this,function(){r.open_all(n,t,i)},!t)}),i.find("li.jstree-closed").length===0&&this.__callback({obj:i})},close_all:function(n,t){var i=this;n=n?this._get_node(n):this.get_container(),n&&n!==-1||(n=this.get_container_ul()),n.find("li.jstree-open").andSelf().each(function(){i.close_node(this,!t)}),this.__callback({obj:n})},clean_node:function(t){t=t&&t!=-1?n(t):this.get_container_ul(),t=t.is("li")?t.find("li").andSelf():t.find("li"),t.removeClass("jstree-last").filter("li:last-child").addClass("jstree-last").end().filter(":has(li)").not(".jstree-open").removeClass("jstree-leaf").addClass("jstree-closed"),t.not(".jstree-open, .jstree-closed").addClass("jstree-leaf").children("ul").remove(),this.__callback({obj:t})},get_rollback:function(){return this.__callback(),{i:this.get_index(),h:this.get_container().children("ul").clone(!0),d:this.data}},set_rollback:function(n,t){this.get_container().empty().append(n),this.data=t,this.__callback()},load_node:function(n){this.__callback({obj:n})},_is_loaded:function(){return!0},create_node:function(t,i,r,u,f){t=this._get_node(t),i=typeof i=="undefined"?"last":i;var o=n("<li />"),s=this._get_settings().core,e;if(t!==-1&&!t.length)return!1;if(!f&&!this._is_loaded(t))return this.load_node(t,function(){this.create_node(t,i,r,u,!0)}),!1;this.__rollback(),typeof r=="string"&&(r={data:r}),r||(r={}),r.attr&&o.attr(r.attr),r.metadata&&o.data(r.metadata),r.state&&o.addClass("jstree-"+r.state),r.data||(r.data=this._get_string("new_node")),n.isArray(r.data)||(e=r.data,r.data=[],r.data.push(e)),n.each(r.data,function(t,i){e=n("<a />"),n.isFunction(i)&&(i=i.call(this,r)),typeof i=="string"?e.attr("href","#")[s.html_titles?"html":"text"](i):(i.attr||(i.attr={}),i.attr.href||(i.attr.href="#"),e.attr(i.attr)[s.html_titles?"html":"text"](i.title),i.language&&e.addClass(i.language)),e.prepend("<ins class='jstree-icon'>&#160;<\/ins>"),i.icon&&(i.icon.indexOf("/")===-1?e.children("ins").addClass(i.icon):e.children("ins").css("background","url('"+i.icon+"') center center no-repeat")),o.append(e)}),o.prepend("<ins class='jstree-icon'>&#160;<\/ins>"),t===-1&&(t=this.get_container(),i==="before"&&(i="first"),i==="after"&&(i="last"));switch(i){case"before":t.before(o),e=this._get_parent(t);break;case"after":t.after(o),e=this._get_parent(t);break;case"inside":case"first":t.children("ul").length||t.append("<ul />"),t.children("ul").prepend(o),e=t;break;case"last":t.children("ul").length||t.append("<ul />"),t.children("ul").append(o),e=t;break;default:t.children("ul").length||t.append("<ul />"),i||(i=0),e=t.children("ul").children("li").eq(i),e.length?e.before(o):t.children("ul").append(o),e=t}return(e===-1||e.get(0)===this.get_container().get(0))&&(e=-1),this.clean_node(e),this.__callback({obj:o,parent:e}),u&&u.call(this,o),o},get_text:function(n){if(n=this._get_node(n),!n.length)return!1;var t=this._get_settings().core.html_titles;return n=n.children("a:eq(0)"),t?(n=n.clone(),n.children("INS").remove(),n.html()):(n=n.contents().filter(function(){return this.nodeType==3})[0],n.nodeValue)},set_text:function(n,t){if(n=this._get_node(n),!n.length)return!1;if(n=n.children("a:eq(0)"),this._get_settings().core.html_titles){var i=n.children("INS").clone();return n.html(t).prepend(i),this.__callback({obj:n,name:t}),!0}return n=n.contents().filter(function(){return this.nodeType==3})[0],this.__callback({obj:n,name:t}),n.nodeValue=t},rename_node:function(n,t){n=this._get_node(n),this.__rollback(),n&&n.length&&this.set_text.apply(this,Array.prototype.slice.call(arguments))&&this.__callback({obj:n,name:t})},delete_node:function(t){if(t=this._get_node(t),!t.length)return!1;this.__rollback();var i=this._get_parent(t),r=n([]),u=this;return t.each(function(){r=r.add(u._get_prev(this))}),t=t.detach(),i!==-1&&i.find("> ul > li").length===0&&i.removeClass("jstree-open jstree-closed").addClass("jstree-leaf"),this.clean_node(i),this.__callback({obj:t,prev:r,parent:i}),t},prepare_move:function(t,i,r,u,e){var o={};if(o.ot=n.jstree._reference(t)||this,o.o=o.ot._get_node(t),o.r=i===-1?-1:this._get_node(i),o.p=typeof r=="undefined"||r===!1?"last":r,!e&&f.o&&f.o[0]===o.o[0]&&f.r[0]===o.r[0]&&f.p===o.p){this.__callback(f),u&&u.call(this,f);return}if(o.ot=n.jstree._reference(o.o)||this,o.rt=n.jstree._reference(o.r)||this,o.r!==-1&&o.r){if(!/^(before|after)$/.test(o.p)&&!this._is_loaded(o.r))return this.load_node(o.r,function(){this.prepare_move(t,i,r,u,!0)});switch(o.p){case"before":o.cp=o.r.index(),o.cr=o.rt._get_parent(o.r);break;case"after":o.cp=o.r.index()+1,o.cr=o.rt._get_parent(o.r);break;case"inside":case"first":o.cp=0,o.cr=o.r;break;case"last":o.cp=o.r.find(" > ul > li").length,o.cr=o.r;break;default:o.cp=o.p,o.cr=o.r}}else{o.cr=-1;switch(o.p){case"first":case"before":case"inside":o.cp=0;break;case"after":case"last":o.cp=o.rt.get_container().find(" > ul > li").length;break;default:o.cp=o.p}}o.np=o.cr==-1?o.rt.get_container():o.cr,o.op=o.ot._get_parent(o.o),o.cop=o.o.index(),o.op===-1&&(o.op=o.ot?o.ot.get_container():this.get_container()),!/^(before|after)$/.test(o.p)&&o.op&&o.np&&o.op[0]===o.np[0]&&o.o.index()<o.cp&&o.cp++,o.or=o.np.find(" > ul > li:nth-child("+(o.cp+1)+")"),f=o,this.__callback(f),u&&u.call(this,f)},check_move:function(){var n=f,t=!0,i=n.r===-1?this.get_container():n.r;return!n||!n.o||n.or[0]===n.o[0]?!1:n.op&&n.np&&n.op[0]===n.np[0]&&n.cp-1===n.o.index()?!1:(n.o.each(function(){if(i.parentsUntil(".jstree","li").andSelf().index(this)!==-1)return t=!1,!1}),t)},move_node:function(t,i,r,u,e,o){if(!e)return this.prepare_move(t,i,r,function(n){this.move_node(n,!1,!1,u,!0,o)});if(u&&(f.cy=!0),!o&&!this.check_move())return!1;this.__rollback();var s=!1;u?(s=t.o.clone(!0),s.find("*[id]").andSelf().each(function(){this.id&&(this.id="copy_"+this.id)})):s=t.o,t.or.length?t.or.before(s):(t.np.children("ul").length||n("<ul />").appendTo(t.np),t.np.children("ul:eq(0)").append(s));try{t.ot.clean_node(t.op),t.rt.clean_node(t.np),t.op.find("> ul > li").length||t.op.removeClass("jstree-open jstree-closed").addClass("jstree-leaf").children("ul").remove()}catch(h){}return u&&(f.cy=!0,f.oc=s),this.__callback(f),f},_get_move:function(){return f}}})})(n),function(n){var i,t,r;n(function(){/msie/.test(navigator.userAgent.toLowerCase())?(t=n('<textarea cols="10" rows="2"><\/textarea>').css({position:"absolute",top:-1e3,left:0}).appendTo("body"),r=n('<textarea cols="10" rows="2" style="overflow: hidden;"><\/textarea>').css({position:"absolute",top:-1e3,left:0}).appendTo("body"),i=t.width()-r.width(),t.add(r).remove()):(t=n("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1e3,left:0}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200}),i=100-t.width(),t.parent().remove())}),n.jstree.plugin("ui",{__init:function(){this.data.ui.selected=n(),this.data.ui.last_selected=!1,this.data.ui.hovered=null,this.data.ui.to_select=this.get_settings().ui.initially_select,this.get_container().delegate("a","click.jstree",n.proxy(function(t){t.preventDefault(),t.currentTarget.blur(),n(t.currentTarget).hasClass("jstree-loading")||this.select_node(t.currentTarget,!0,t)},this)).delegate("a","mouseenter.jstree",n.proxy(function(t){n(t.currentTarget).hasClass("jstree-loading")||this.hover_node(t.target)},this)).delegate("a","mouseleave.jstree",n.proxy(function(t){n(t.currentTarget).hasClass("jstree-loading")||this.dehover_node(t.target)},this)).bind("reopen.jstree",n.proxy(function(){this.reselect()},this)).bind("get_rollback.jstree",n.proxy(function(){this.dehover_node(),this.save_selected()},this)).bind("set_rollback.jstree",n.proxy(function(){this.reselect()},this)).bind("close_node.jstree",n.proxy(function(t,i){var u=this._get_settings().ui,r=this._get_node(i.rslt.obj),f=r&&r.length?r.children("ul").find("a.jstree-clicked"):n(),e=this;u.selected_parent_close!==!1&&f.length&&f.each(function(){e.deselect_node(this),u.selected_parent_close==="select_parent"&&e.select_node(r)})},this)).bind("delete_node.jstree",n.proxy(function(n,t){var f=this._get_settings().ui.select_prev_on_delete,i=this._get_node(t.rslt.obj),r=i&&i.length?i.find("a.jstree-clicked"):[],u=this;r.each(function(){u.deselect_node(this)}),f&&r.length&&t.rslt.prev.each(function(){if(this.parentNode)return u.select_node(this),!1})},this)).bind("move_node.jstree",n.proxy(function(n,t){t.rslt.cy&&t.rslt.oc.find("a.jstree-clicked").removeClass("jstree-clicked")},this))},defaults:{select_limit:-1,select_multiple_modifier:"ctrl",select_range_modifier:"shift",selected_parent_close:"select_parent",selected_parent_open:!0,select_prev_on_delete:!0,disable_selecting_children:!1,initially_select:[]},_fn:{_get_node:function(t,i){if(typeof t=="undefined"||t===null)return i?this.data.ui.selected:this.data.ui.last_selected;var r=n(t,this.get_container());return r.is(".jstree")||t==-1?-1:(r=r.closest("li",this.get_container()),r.length?r:!1)},_ui_notify:function(n,t){t.selected&&this.select_node(n,!1)},save_selected:function(){var n=this;this.data.ui.to_select=[],this.data.ui.selected.each(function(){this.id&&n.data.ui.to_select.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"))}),this.__callback(this.data.ui.to_select)},reselect:function(){var i=this,t=this.data.ui.to_select;t=n.map(n.makeArray(t),function(n){return"#"+n.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}),n.each(t,function(n,t){t&&t!=="#"&&i.select_node(t)}),this.data.ui.selected=this.data.ui.selected.filter(function(){return this.parentNode}),this.__callback()},refresh:function(){return this.save_selected(),this.__call_old()},hover_node:function(n){if(n=this._get_node(n),!n.length)return!1;n.hasClass("jstree-hovered")||this.dehover_node(),this.data.ui.hovered=n.children("a").addClass("jstree-hovered").parent(),this._fix_scroll(n),this.__callback({obj:n})},dehover_node:function(){var n=this.data.ui.hovered,t;if(!n||!n.length)return!1;t=n.children("a").removeClass("jstree-hovered").parent(),this.data.ui.hovered[0]===t[0]&&(this.data.ui.hovered=null),this.__callback({obj:n})},select_node:function(n,t,i){if(n=this._get_node(n),n==-1||!n||!n.length)return!1;var r=this._get_settings().ui,e=r.select_multiple_modifier=="on"||r.select_multiple_modifier!==!1&&i&&i[r.select_multiple_modifier+"Key"],s=r.select_range_modifier!==!1&&i&&i[r.select_range_modifier+"Key"]&&this.data.ui.last_selected&&this.data.ui.last_selected[0]!==n[0]&&this.data.ui.last_selected.parent()[0]===n.parent()[0],u=this.is_selected(n),f=!0,o=this;if(t){if(r.disable_selecting_children&&e&&(n.parentsUntil(".jstree","li").children("a.jstree-clicked").length||n.children("ul").find("a.jstree-clicked:eq(0)").length))return!1;f=!1;switch(!0){case s:this.data.ui.last_selected.addClass("jstree-last-selected"),n=n[n.index()<this.data.ui.last_selected.index()?"nextUntil":"prevUntil"](".jstree-last-selected").andSelf(),r.select_limit==-1||n.length<r.select_limit?(this.data.ui.last_selected.removeClass("jstree-last-selected"),this.data.ui.selected.each(function(){this!==o.data.ui.last_selected[0]&&o.deselect_node(this)}),u=!1,f=!0):f=!1;break;case u&&!e:this.deselect_all(),u=!1,f=!0;break;case!u&&!e:(r.select_limit==-1||r.select_limit>0)&&(this.deselect_all(),f=!0);break;case u&&e:this.deselect_node(n);break;case!u&&e:(r.select_limit==-1||this.data.ui.selected.length+1<=r.select_limit)&&(f=!0)}}f&&!u&&(s||(this.data.ui.last_selected=n),n.children("a").addClass("jstree-clicked"),r.selected_parent_open&&n.parents(".jstree-closed").each(function(){o.open_node(this,!1,!0)}),this.data.ui.selected=this.data.ui.selected.add(n),this._fix_scroll(n.eq(0)),this.__callback({obj:n,e:i}))},_fix_scroll:function(n){var t=this.get_container()[0],r;if(t.scrollHeight>t.offsetHeight){if(n=this._get_node(n),!n||n===-1||!n.length||!n.is(":visible"))return;r=n.offset().top-this.get_container().offset().top,r<0&&(t.scrollTop=t.scrollTop+r-1),r+this.data.core.li_height+(t.scrollWidth>t.offsetWidth?i:0)>t.offsetHeight&&(t.scrollTop=t.scrollTop+(r-t.offsetHeight+this.data.core.li_height+1+(t.scrollWidth>t.offsetWidth?i:0)))}},deselect_node:function(n){if(n=this._get_node(n),!n.length)return!1;this.is_selected(n)&&(n.children("a").removeClass("jstree-clicked"),this.data.ui.selected=this.data.ui.selected.not(n),this.data.ui.last_selected.get(0)===n.get(0)&&(this.data.ui.last_selected=this.data.ui.selected.eq(0)),this.__callback({obj:n}))},toggle_select:function(n){if(n=this._get_node(n),!n.length)return!1;this.is_selected(n)?this.deselect_node(n):this.select_node(n)},is_selected:function(n){return this.data.ui.selected.index(this._get_node(n))>=0},get_selected:function(t){return t?n(t).find("a.jstree-clicked").parent():this.data.ui.selected},deselect_all:function(t){var i=t?n(t).find("a.jstree-clicked").parent():this.get_container().find("a.jstree-clicked").parent();i.children("a.jstree-clicked").removeClass("jstree-clicked"),this.data.ui.selected=n([]),this.data.ui.last_selected=!1,this.__callback({obj:i})}}}),n.jstree.defaults.plugins.push("ui")}(n),function(n){n.jstree.plugin("crrm",{__init:function(){this.get_container().bind("move_node.jstree",n.proxy(function(n,t){if(this._get_settings().crrm.move.open_onmove){var i=this;t.rslt.np.parentsUntil(".jstree").andSelf().filter(".jstree-closed").each(function(){i.open_node(this,!1,!0)})}},this))},defaults:{input_width_limit:200,move:{always_copy:!1,open_onmove:!0,default_position:"last",check_move:function(){return!0}}},_fn:{_show_input:function(t,i){t=this._get_node(t);var e=this._get_settings().core.rtl,o=this._get_settings().crrm.input_width_limit,s=t.children("ins").width(),h=t.find("> a:visible > ins").width()*t.find("> a:visible > ins").length,u=this.get_text(t),f=n("<div />",{css:{position:"absolute",top:"-200px",left:e?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),r=t.css("position","relative").append(n("<input />",{value:u,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver",position:"absolute",left:e?"auto":s+h+4+"px",right:e?s+h+4+"px":"auto",top:"0px",height:this.data.core.li_height-2+"px",lineHeight:this.data.core.li_height-2+"px",width:"150px"},blur:n.proxy(function(){var r=t.children(".jstree-rename-input"),n=r.val();n===""&&(n=u),f.remove(),r.remove(),this.set_text(t,u),this.rename_node(t,n),i.call(this,t,n,u),t.css("position","")},this),keyup:function(n){var t=n.keyCode||n.which;if(t==27){this.value=u,this.blur();return}if(t==13){this.blur();return}r.width(Math.min(f.text("pW"+this.value).width(),o))},keypress:function(n){var t=n.keyCode||n.which;if(t==13)return!1}})).children(".jstree-rename-input");this.set_text(t,""),f.css({fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""}),r.width(Math.min(f.text("pW"+r[0].value).width(),o))[0].select()},rename:function(n){n=this._get_node(n),this.__rollback();var t=this.__callback;this._show_input(n,function(n,i,r){t.call(this,{obj:n,new_name:i,old_name:r})})},create:function(t,i,r,u,f){var e=this;return t=this._get_node(t),t||(t=-1),this.__rollback(),this.create_node(t,i,r,function(t){var i=this._get_parent(t),r=n(t).index();u&&u.call(this,t),i.length&&i.hasClass("jstree-closed")&&this.open_node(i,!1,!0),f?e.__callback({obj:t,name:this.get_text(t),parent:i,position:r}):this._show_input(t,function(n,t){e.__callback({obj:n,name:t,parent:i,position:r})})})},remove:function(n){n=this._get_node(n,!0);var t=this._get_parent(n),i=this._get_prev(n);this.__rollback(),n=this.delete_node(n),n!==!1&&this.__callback({obj:n,prev:i,parent:t})},check_move:function(){if(!this.__call_old())return!1;var n=this._get_settings().crrm.move;return n.check_move.call(this,this._get_move())?!0:!1},move_node:function(n,t,i,r,u,f){var e=this._get_settings().crrm.move;if(!u)return typeof i=="undefined"&&(i=e.default_position),i!=="inside"||e.default_position.match(/^(before|after)$/)||(i=e.default_position),this.__call_old(!0,n,t,i,r,!1,f);(e.always_copy===!0||e.always_copy==="multitree"&&n.rt.get_index()!==n.ot.get_index())&&(r=!0),this.__call_old(!0,n,t,i,r,!0,f)},cut:function(n){if(n=this._get_node(n,!0),!n||!n.length)return!1;this.data.crrm.cp_nodes=!1,this.data.crrm.ct_nodes=n,this.__callback({obj:n})},copy:function(n){if(n=this._get_node(n,!0),!n||!n.length)return!1;this.data.crrm.ct_nodes=!1,this.data.crrm.cp_nodes=n,this.__callback({obj:n})},paste:function(n){if(n=this._get_node(n),!n||!n.length)return!1;var t=this.data.crrm.ct_nodes?this.data.crrm.ct_nodes:this.data.crrm.cp_nodes;if(!this.data.crrm.ct_nodes&&!this.data.crrm.cp_nodes)return!1;this.data.crrm.ct_nodes&&(this.move_node(this.data.crrm.ct_nodes,n),this.data.crrm.ct_nodes=!1),this.data.crrm.cp_nodes&&this.move_node(this.data.crrm.cp_nodes,n,!1,!0),this.__callback({obj:n,nodes:t})}}})}(n),function(n){var t=[];n.jstree._themes=!1,n.jstree.plugin("themes",{__init:function(){this.get_container().bind("init.jstree",n.proxy(function(){var n=this._get_settings().themes;this.data.themes.dots=n.dots,this.data.themes.icons=n.icons,this.set_theme(n.theme,n.url)},this)).bind("loaded.jstree",n.proxy(function(){this.data.themes.dots?this.show_dots():this.hide_dots(),this.data.themes.icons?this.show_icons():this.hide_icons()},this))},defaults:{theme:"default",url:!1,dots:!0,icons:!0},_fn:{set_theme:function(i,r){if(!i)return!1;r||(r=n.jstree._themes+i+"/style.css"),n.inArray(r,t)==-1&&(n.vakata.css.add_sheet({url:r}),t.push(r)),this.data.themes.theme!=i&&(this.get_container().removeClass("jstree-"+this.data.themes.theme),this.data.themes.theme=i),this.get_container().addClass("jstree-"+i),this.data.themes.dots?this.show_dots():this.hide_dots(),this.data.themes.icons?this.show_icons():this.hide_icons(),this.__callback()},get_theme:function(){return this.data.themes.theme},show_dots:function(){this.data.themes.dots=!0,this.get_container().children("ul").removeClass("jstree-no-dots")},hide_dots:function(){this.data.themes.dots=!1,this.get_container().children("ul").addClass("jstree-no-dots")},toggle_dots:function(){this.data.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this.data.themes.icons=!0,this.get_container().children("ul").removeClass("jstree-no-icons")},hide_icons:function(){this.data.themes.icons=!1,this.get_container().children("ul").addClass("jstree-no-icons")},toggle_icons:function(){this.data.themes.icons?this.hide_icons():this.show_icons()}}}),n(function(){n.jstree._themes===!1&&n("script").each(function(){if(this.src.toString().match(/jquery\.jstree[^\/]*?\.js(\?.*)?$/))return n.jstree._themes=this.src.toString().replace(/jquery\.jstree[^\/]*?\.js(\?.*)?$/,"")+"themes/",!1}),n.jstree._themes===!1&&(n.jstree._themes="themes/")}),n.jstree.defaults.plugins.push("themes")}(n),function(n){function i(t,i){var r=n.jstree._focused(),u;if(r&&r.data&&r.data.hotkeys&&r.data.hotkeys.enabled&&(u=r._get_settings().hotkeys[t],u))return u.call(r,i)}var t=[];n.jstree.plugin("hotkeys",{__init:function(){if(typeof n.hotkeys=="undefined")throw"jsTree hotkeys: jQuery hotkeys plugin not included.";if(!this.data.ui)throw"jsTree hotkeys: jsTree UI plugin not included.";n.each(this._get_settings().hotkeys,function(r,u){u!==!1&&n.inArray(r,t)==-1&&(n(document).bind("keydown",r,function(n){return i(r,n)}),t.push(r))}),this.get_container().bind("lock.jstree",n.proxy(function(){this.data.hotkeys.enabled&&(this.data.hotkeys.enabled=!1,this.data.hotkeys.revert=!0)},this)).bind("unlock.jstree",n.proxy(function(){this.data.hotkeys.revert&&(this.data.hotkeys.enabled=!0)},this)),this.enable_hotkeys()},defaults:{up:function(){var n=this.data.ui.hovered||this.data.ui.last_selected||-1;return this.hover_node(this._get_prev(n)),!1},"ctrl+up":function(){var n=this.data.ui.hovered||this.data.ui.last_selected||-1;return this.hover_node(this._get_prev(n)),!1},"shift+up":function(){var n=this.data.ui.hovered||this.data.ui.last_selected||-1;return this.hover_node(this._get_prev(n)),!1},down:function(){var n=this.data.ui.hovered||this.data.ui.last_selected||-1;return this.hover_node(this._get_next(n)),!1},"ctrl+down":function(){var n=this.data.ui.hovered||this.data.ui.last_selected||-1;return this.hover_node(this._get_next(n)),!1},"shift+down":function(){var n=this.data.ui.hovered||this.data.ui.last_selected||-1;return this.hover_node(this._get_next(n)),!1},left:function(){var n=this.data.ui.hovered||this.data.ui.last_selected;return n&&(n.hasClass("jstree-open")?this.close_node(n):this.hover_node(this._get_prev(n))),!1},"ctrl+left":function(){var n=this.data.ui.hovered||this.data.ui.last_selected;return n&&(n.hasClass("jstree-open")?this.close_node(n):this.hover_node(this._get_prev(n))),!1},"shift+left":function(){var n=this.data.ui.hovered||this.data.ui.last_selected;return n&&(n.hasClass("jstree-open")?this.close_node(n):this.hover_node(this._get_prev(n))),!1},right:function(){var n=this.data.ui.hovered||this.data.ui.last_selected;return n&&n.length&&(n.hasClass("jstree-closed")?this.open_node(n):this.hover_node(this._get_next(n))),!1},"ctrl+right":function(){var n=this.data.ui.hovered||this.data.ui.last_selected;return n&&n.length&&(n.hasClass("jstree-closed")?this.open_node(n):this.hover_node(this._get_next(n))),!1},"shift+right":function(){var n=this.data.ui.hovered||this.data.ui.last_selected;return n&&n.length&&(n.hasClass("jstree-closed")?this.open_node(n):this.hover_node(this._get_next(n))),!1},space:function(){return this.data.ui.hovered&&this.data.ui.hovered.children("a:eq(0)").click(),!1},"ctrl+space":function(n){return n.type="click",this.data.ui.hovered&&this.data.ui.hovered.children("a:eq(0)").trigger(n),!1},"shift+space":function(n){return n.type="click",this.data.ui.hovered&&this.data.ui.hovered.children("a:eq(0)").trigger(n),!1},f2:function(){this.rename(this.data.ui.hovered||this.data.ui.last_selected)},del:function(){this.remove(this.data.ui.hovered||this._get_node(null))}},_fn:{enable_hotkeys:function(){this.data.hotkeys.enabled=!0},disable_hotkeys:function(){this.data.hotkeys.enabled=!1}}})}(n),function(n){n.jstree.plugin("json_data",{__init:function(){var n=this._get_settings().json_data;n.progressive_unload&&this.get_container().bind("after_close.jstree",function(n,t){t.rslt.obj.children("ul").remove()})},defaults:{data:!1,ajax:!1,correct_state:!0,progressive_render:!1,progressive_unload:!1},_fn:{load_node:function(n,t,i){var r=this;this.load_node_json(n,function(){r.__callback({obj:r._get_node(n)}),t.call(this)},i)},_is_loaded:function(t){var i=this._get_settings().json_data;return t=this._get_node(t),t==-1||!t||!i.ajax&&!i.progressive_render&&!n.isFunction(i.data)||t.is(".jstree-open, .jstree-leaf")||t.children("ul").children("li").length>0},refresh:function(t){t=this._get_node(t);var i=this._get_settings().json_data;return t&&t!==-1&&i.progressive_unload&&(n.isFunction(i.data)||!!i.ajax)&&t.removeData("jstree-children"),this.__call_old()},load_node_json:function(t,i,r){var u=this.get_settings().json_data,f,e=function(){},o=function(){};if(t=this._get_node(t),t&&t!==-1&&(u.progressive_render||u.progressive_unload)&&!t.is(".jstree-open, .jstree-leaf")&&t.children("ul").children("li").length===0&&t.data("jstree-children")){f=this._parse_json(t.data("jstree-children"),t),f&&(t.append(f),u.progressive_unload||t.removeData("jstree-children")),this.clean_node(t),i&&i.call(this);return}if(t&&t!==-1){if(t.data("jstree-is-loading"))return;t.data("jstree-is-loading",!0)}switch(!0){case!u.data&&!u.ajax:throw"Neither data nor ajax settings supplied.";case n.isFunction(u.data):u.data.call(this,t,n.proxy(function(n){n=this._parse_json(n,t),n?(t!==-1&&t?(t.append(n).children("a.jstree-loading").removeClass("jstree-loading"),t.removeData("jstree-is-loading")):this.get_container().children("ul").empty().append(n.children()),this.clean_node(t),i&&i.call(this)):(t!==-1&&t?(t.children("a.jstree-loading").removeClass("jstree-loading"),t.removeData("jstree-is-loading"),u.correct_state&&this.correct_state(t)):u.correct_state&&this.get_container().children("ul").empty(),r&&r.call(this))},this));break;case!!u.data&&!u.ajax||!!u.data&&!!u.ajax&&(!t||t===-1):t&&t!=-1||(f=this._parse_json(u.data,t),f?(this.get_container().children("ul").empty().append(f.children()),this.clean_node()):u.correct_state&&this.get_container().children("ul").empty()),i&&i.call(this);break;case!u.data&&!!u.ajax||!!u.data&&!!u.ajax&&t&&t!==-1:e=function(n,i,f){var e=this.get_settings().json_data.ajax.error;e&&e.call(this,n,i,f),t!=-1&&t.length?(t.children("a.jstree-loading").removeClass("jstree-loading"),t.removeData("jstree-is-loading"),i==="success"&&u.correct_state&&this.correct_state(t)):i==="success"&&u.correct_state&&this.get_container().children("ul").empty(),r&&r.call(this)},o=function(r,f,o){var s=this.get_settings().json_data.ajax.success;if(s&&(r=s.call(this,r,f,o)||r),r===""||r&&r.toString&&r.toString().replace(/^[\s\n]+$/,"")===""||!n.isArray(r)&&!n.isPlainObject(r))return e.call(this,o,f,"");r=this._parse_json(r,t),r?(t!==-1&&t?(t.append(r).children("a.jstree-loading").removeClass("jstree-loading"),t.removeData("jstree-is-loading")):this.get_container().children("ul").empty().append(r.children()),this.clean_node(t),i&&i.call(this)):t!==-1&&t?(t.children("a.jstree-loading").removeClass("jstree-loading"),t.removeData("jstree-is-loading"),u.correct_state&&(this.correct_state(t),i&&i.call(this))):u.correct_state&&(this.get_container().children("ul").empty(),i&&i.call(this))},u.ajax.context=this,u.ajax.error=e,u.ajax.success=o,u.ajax.dataType||(u.ajax.dataType="json"),n.isFunction(u.ajax.url)&&(u.ajax.url=u.ajax.url.call(this,t)),n.isFunction(u.ajax.data)&&(u.ajax.data=u.ajax.data.call(this,t)),n.ajax(u.ajax)}},_parse_json:function(t,i,r){var u=!1,c=this._get_settings(),o=c.json_data,l=c.core.html_titles,f,e,a,s,h;if(!t)return u;if(o.progressive_unload&&i&&i!==-1&&i.data("jstree-children",u),n.isArray(t)){if(u=n(),!t.length)return!1;for(e=0,a=t.length;e<a;e++)f=this._parse_json(t[e],i,!0),f.length&&(u=u.add(f))}else{if(typeof t=="string"&&(t={data:t}),!t.data&&t.data!=="")return u;u=n("<li />"),t.attr&&u.attr(t.attr),t.metadata&&u.data(t.metadata),t.state&&u.addClass("jstree-"+t.state),n.isArray(t.data)||(f=t.data,t.data=[],t.data.push(f)),n.each(t.data,function(i,r){f=n("<a />"),n.isFunction(r)&&(r=r.call(this,t)),typeof r=="string"?f.attr("href","#")[l?"html":"text"](r):(r.attr||(r.attr={}),r.attr.href||(r.attr.href="#"),f.attr(r.attr)[l?"html":"text"](r.title),r.language&&f.addClass(r.language)),f.prepend("<ins class='jstree-icon'>&#160;<\/ins>"),!r.icon&&t.icon&&(r.icon=t.icon),r.icon&&(r.icon.indexOf("/")===-1?f.children("ins").addClass(r.icon):f.children("ins").css("background","url('"+r.icon+"') center center no-repeat")),u.append(f)}),u.prepend("<ins class='jstree-icon'>&#160;<\/ins>"),t.children&&(o.progressive_render&&t.state!=="open"?u.addClass("jstree-closed").data("jstree-children",t.children):(o.progressive_unload&&u.data("jstree-children",t.children),n.isArray(t.children)&&t.children.length&&(f=this._parse_json(t.children,i,!0),f.length&&(h=n("<ul />"),h.append(f),u.append(h)))))}return r||(s=n("<ul />"),s.append(u),u=s),u},get_json:function(t,i,r,u){var v=[],s=this._get_settings(),c=this,h,f,o,l,e,a;return t=this._get_node(t),t&&t!==-1||(t=this.get_container().find("> ul > li")),i=n.isArray(i)?i:["id","class"],!u&&this.data.types&&i.push(s.types.type_attr),r=n.isArray(r)?r:[],t.each(function(){o=n(this),h={data:[]},i.length&&(h.attr={}),n.each(i,function(n,t){f=o.attr(t),f&&f.length&&f.replace(/jstree[^ ]*/ig,"").length&&(h.attr[t]=(" "+f).replace(/ jstree[^ ]*/ig,"").replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,""))}),o.hasClass("jstree-open")&&(h.state="open"),o.hasClass("jstree-closed")&&(h.state="closed"),o.data()&&(h.metadata=o.data()),l=o.children("a"),l.each(function(){e=n(this),r.length||n.inArray("languages",s.plugins)!==-1||e.children("ins").get(0).style.backgroundImage.length||e.children("ins").get(0).className&&e.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").length?(a=!1,n.inArray("languages",s.plugins)!==-1&&n.isArray(s.languages)&&s.languages.length&&n.each(s.languages,function(n,t){if(e.hasClass(t))return a=t,!1}),f={attr:{},title:c.get_text(e,a)},n.each(r,function(n,t){f.attr[t]=(" "+(e.attr(t)||"")).replace(/ jstree[^ ]*/ig,"").replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,"")}),n.inArray("languages",s.plugins)!==-1&&n.isArray(s.languages)&&s.languages.length&&n.each(s.languages,function(n,t){if(e.hasClass(t))return f.language=t,!0}),e.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").replace(/^\s+$/ig,"").length&&(f.icon=e.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,"")),e.children("ins").get(0).style.backgroundImage.length&&(f.icon=e.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")",""))):f=c.get_text(e),l.length>1?h.data.push(f):h.data=f}),o=o.find("> ul > li"),o.length&&(h.children=c.get_json(o,i,r,!0)),v.push(h)}),v}}})}(n),function(n){n.jstree.plugin("languages",{__init:function(){this._load_css()},defaults:[],_fn:{set_lang:function(t){var r=this._get_settings().languages,i=!1,u=".jstree-"+this.get_index()+" a";if(!n.isArray(r)||r.length===0)return!1;if(n.inArray(t,r)==-1){if(!r[t])return!1;t=r[t]}return t==this.data.languages.current_language?!0:(i=n.vakata.css.get_css(u+"."+this.data.languages.current_language,!1,this.data.languages.language_css),i!==!1&&(i.style.display="none"),i=n.vakata.css.get_css(u+"."+t,!1,this.data.languages.language_css),i!==!1&&(i.style.display=""),this.data.languages.current_language=t,this.__callback(t),!0)},get_lang:function(){return this.data.languages.current_language},_get_string:function(t,i){var u=this._get_settings().languages,r=this._get_settings().core.strings;return(n.isArray(u)&&u.length&&(i=i&&n.inArray(i,u)!=-1?i:this.data.languages.current_language),r[i]&&r[i][t])?r[i][t]:r[t]?r[t]:t},get_text:function(t,i){if(t=this._get_node(t)||this.data.ui.last_selected,!t.size())return!1;var r=this._get_settings().languages,u=this._get_settings().core.html_titles;return n.isArray(r)&&r.length?(i=i&&n.inArray(i,r)!=-1?i:this.data.languages.current_language,t=t.children("a."+i)):t=t.children("a:eq(0)"),u?(t=t.clone(),t.children("INS").remove(),t.html()):(t=t.contents().filter(function(){return this.nodeType==3})[0],t.nodeValue)},set_text:function(t,i,r){if(t=this._get_node(t)||this.data.ui.last_selected,!t.size())return!1;var u=this._get_settings().languages,e=this._get_settings().core.html_titles,f;return n.isArray(u)&&u.length?(r=r&&n.inArray(r,u)!=-1?r:this.data.languages.current_language,t=t.children("a."+r)):t=t.children("a:eq(0)"),e?(f=t.children("INS").clone(),t.html(i).prepend(f),this.__callback({obj:t,name:i,lang:r}),!0):(t=t.contents().filter(function(){return this.nodeType==3})[0],this.__callback({obj:t,name:i,lang:r}),t.nodeValue=i)},_load_css:function(){var t=this._get_settings().languages,r="/* languages css */",u=".jstree-"+this.get_index()+" a",i;if(n.isArray(t)&&t.length){for(this.data.languages.current_language=t[0],i=0;i<t.length;i++)r+=u+"."+t[i]+" {",t[i]!=this.data.languages.current_language&&(r+=" display:none; "),r+=" } ";this.data.languages.language_css=n.vakata.css.add_sheet({str:r,title:"jstree-languages"})}},create_node:function(t,i,r,u){return this.__call_old(!0,t,i,r,function(t){var i=this._get_settings().languages,f=t.children("a"),r;if(n.isArray(i)&&i.length){for(r=0;r<i.length;r++)f.is("."+i[r])||t.append(f.eq(0).clone().removeClass(i.join(" ")).addClass(i[r]));f.not("."+i.join(", .")).remove()}u&&u.call(this,t)})}}})}(n),function(n){n.jstree.plugin("cookies",{__init:function(){if(typeof n.cookie=="undefined")throw"jsTree cookie: jQuery cookie plugin not included.";var i=this._get_settings().cookies,t;!i.save_loaded||(t=n.cookie(i.save_loaded),t&&t.length&&(this.data.core.to_load=t.split(","))),!i.save_opened||(t=n.cookie(i.save_opened),t&&t.length&&(this.data.core.to_open=t.split(","))),!i.save_selected||(t=n.cookie(i.save_selected),t&&t.length&&this.data.ui&&(this.data.ui.to_select=t.split(",")));this.get_container().one((this.data.ui?"reselect":"reopen")+".jstree",n.proxy(function(){this.get_container().bind("open_node.jstree close_node.jstree select_node.jstree deselect_node.jstree",n.proxy(function(n){this._get_settings().cookies.auto_save&&this.save_cookie((n.handleObj.namespace+n.handleObj.type).replace("jstree",""))},this))},this))},defaults:{save_loaded:"jstree_load",save_opened:"jstree_open",save_selected:"jstree_select",auto_save:!0,cookie_options:{}},_fn:{save_cookie:function(t){if(!this.data.core.refreshing){var i=this._get_settings().cookies;if(!t){i.save_loaded&&(this.save_loaded(),n.cookie(i.save_loaded,this.data.core.to_load.join(","),i.cookie_options)),i.save_opened&&(this.save_opened(),n.cookie(i.save_opened,this.data.core.to_open.join(","),i.cookie_options)),i.save_selected&&this.data.ui&&(this.save_selected(),n.cookie(i.save_selected,this.data.ui.to_select.join(","),i.cookie_options));return}switch(t){case"open_node":case"close_node":!i.save_opened||(this.save_opened(),n.cookie(i.save_opened,this.data.core.to_open.join(","),i.cookie_options)),!i.save_loaded||(this.save_loaded(),n.cookie(i.save_loaded,this.data.core.to_load.join(","),i.cookie_options));break;case"select_node":case"deselect_node":!!i.save_selected&&this.data.ui&&(this.save_selected(),n.cookie(i.save_selected,this.data.ui.to_select.join(","),i.cookie_options))}}}}})}(n),function(n){n.jstree.plugin("sort",{__init:function(){this.get_container().bind("load_node.jstree",n.proxy(function(n,t){var i=this._get_node(t.rslt.obj);i=i===-1?this.get_container().children("ul"):i.children("ul"),this.sort(i)},this)).bind("rename_node.jstree create_node.jstree create.jstree",n.proxy(function(n,t){this.sort(t.rslt.obj.parent())},this)).bind("move_node.jstree",n.proxy(function(n,t){var i=t.rslt.np==-1?this.get_container():t.rslt.np;this.sort(i.children("ul"))},this))},defaults:function(n,t){return this.get_text(n)>this.get_text(t)?1:-1},_fn:{sort:function(t){var r=this._get_settings().sort,i=this;t.append(n.makeArray(t.children("li")).sort(n.proxy(r,i))),t.find("> li > ul").each(function(){i.sort(n(this))}),this.clean_node(t)}}})}(n),function(n){var u=!1,t=!1,r=!1,i=!1,f=!1,e=!1,o=!1,s=!1,h=!1;n.vakata.dnd={is_down:!1,is_drag:!1,helper:!1,scroll_spd:10,init_x:0,init_y:0,threshold:5,helper_left:5,helper_top:10,user_data:{},drag_start:function(t,i,r){n.vakata.dnd.is_drag&&n.vakata.drag_stop({});try{t.currentTarget.unselectable="on",t.currentTarget.onselectstart=function(){return!1},t.currentTarget.style&&(t.currentTarget.style.MozUserSelect="none")}catch(u){}return n.vakata.dnd.init_x=t.pageX,n.vakata.dnd.init_y=t.pageY,n.vakata.dnd.user_data=i,n.vakata.dnd.is_down=!0,n.vakata.dnd.helper=n("<div id='vakata-dragged' />").html(r),n(document).bind("mousemove",n.vakata.dnd.drag),n(document).bind("mouseup",n.vakata.dnd.drag_stop),!1},drag:function(t){if(n.vakata.dnd.is_down){if(!n.vakata.dnd.is_drag)if(Math.abs(t.pageX-n.vakata.dnd.init_x)>5||Math.abs(t.pageY-n.vakata.dnd.init_y)>5)n.vakata.dnd.helper.appendTo("body"),n.vakata.dnd.is_drag=!0,n(document).triggerHandler("drag_start.vakata",{event:t,data:n.vakata.dnd.user_data});else return;if(t.type==="mousemove"){var i=n(document),r=i.scrollTop(),u=i.scrollLeft();t.pageY-r<20?(e&&o==="down"&&(clearInterval(e),e=!1),e||(o="up",e=setInterval(function(){n(document).scrollTop(n(document).scrollTop()-n.vakata.dnd.scroll_spd)},150))):e&&o==="up"&&(clearInterval(e),e=!1),n(window).height()-(t.pageY-r)<20?(e&&o==="up"&&(clearInterval(e),e=!1),e||(o="down",e=setInterval(function(){n(document).scrollTop(n(document).scrollTop()+n.vakata.dnd.scroll_spd)},150))):e&&o==="down"&&(clearInterval(e),e=!1),t.pageX-u<20?(f&&s==="right"&&(clearInterval(f),f=!1),f||(s="left",f=setInterval(function(){n(document).scrollLeft(n(document).scrollLeft()-n.vakata.dnd.scroll_spd)},150))):f&&s==="left"&&(clearInterval(f),f=!1),n(window).width()-(t.pageX-u)<20?(f&&s==="left"&&(clearInterval(f),f=!1),f||(s="right",f=setInterval(function(){n(document).scrollLeft(n(document).scrollLeft()+n.vakata.dnd.scroll_spd)},150))):f&&s==="right"&&(clearInterval(f),f=!1)}n.vakata.dnd.helper.css({left:t.pageX+n.vakata.dnd.helper_left+"px",top:t.pageY+n.vakata.dnd.helper_top+"px"}),n(document).triggerHandler("drag.vakata",{event:t,data:n.vakata.dnd.user_data})}},drag_stop:function(t){f&&clearInterval(f),e&&clearInterval(e),n(document).unbind("mousemove",n.vakata.dnd.drag),n(document).unbind("mouseup",n.vakata.dnd.drag_stop),n(document).triggerHandler("drag_stop.vakata",{event:t,data:n.vakata.dnd.user_data}),n.vakata.dnd.helper.remove(),n.vakata.dnd.init_x=0,n.vakata.dnd.init_y=0,n.vakata.dnd.user_data={},n.vakata.dnd.is_down=!1,n.vakata.dnd.is_drag=!1}},n(function(){n.vakata.css.add_sheet({str:"#vakata-dragged { display:block; margin:0 0 0 0; padding:4px 4px 4px 24px; position:absolute; top:-2000px; line-height:16px; z-index:10000; } ",title:"vakata"})}),n.jstree.plugin("dnd",{__init:function(){this.data.dnd={active:!1,after:!1,inside:!1,before:!1,off:!1,prepared:!1,w:0,to1:!1,to2:!1,cof:!1,cw:!1,ch:!1,i1:!1,i2:!1,mto:!1},this.get_container().bind("mouseenter.jstree",n.proxy(function(t){if(n.vakata.dnd.is_drag&&n.vakata.dnd.user_data.jstree&&(this.data.themes&&(r.attr("class","jstree-"+this.data.themes.theme),i&&i.attr("class","jstree-"+this.data.themes.theme),n.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme)),t.currentTarget===t.target&&n.vakata.dnd.user_data.obj&&n(n.vakata.dnd.user_data.obj).length&&n(n.vakata.dnd.user_data.obj).parents(".jstree:eq(0)")[0]!==t.target)){var f=n.jstree._reference(t.target),e;f.data.dnd.foreign?(e=f._get_settings().dnd.drag_check.call(this,{o:u,r:f.get_container(),is_root:!0}),(e===!0||e.inside===!0||e.before===!0||e.after===!0)&&n.vakata.dnd.helper.children("ins").attr("class","jstree-ok")):(f.prepare_move(u,f.get_container(),"last"),f.check_move()&&n.vakata.dnd.helper.children("ins").attr("class","jstree-ok"))}},this)).bind("mouseup.jstree",n.proxy(function(t){if(n.vakata.dnd.is_drag&&n.vakata.dnd.user_data.jstree&&t.currentTarget===t.target&&n.vakata.dnd.user_data.obj&&n(n.vakata.dnd.user_data.obj).length&&n(n.vakata.dnd.user_data.obj).parents(".jstree:eq(0)")[0]!==t.target){var i=n.jstree._reference(t.currentTarget),r;i.data.dnd.foreign?(r=i._get_settings().dnd.drag_check.call(this,{o:u,r:i.get_container(),is_root:!0}),(r===!0||r.inside===!0||r.before===!0||r.after===!0)&&i._get_settings().dnd.drag_finish.call(this,{o:u,r:i.get_container(),is_root:!0})):i.move_node(u,i.get_container(),"last",t[i._get_settings().dnd.copy_modifier+"Key"])}},this)).bind("mouseleave.jstree",n.proxy(function(t){if(t.relatedTarget&&t.relatedTarget.id&&t.relatedTarget.id==="jstree-marker-line")return!1;n.vakata.dnd.is_drag&&n.vakata.dnd.user_data.jstree&&(this.data.dnd.i1&&clearInterval(this.data.dnd.i1),this.data.dnd.i2&&clearInterval(this.data.dnd.i2),this.data.dnd.to1&&clearTimeout(this.data.dnd.to1),this.data.dnd.to2&&clearTimeout(this.data.dnd.to2),n.vakata.dnd.helper.children("ins").hasClass("jstree-ok")&&n.vakata.dnd.helper.children("ins").attr("class","jstree-invalid"))},this)).bind("mousemove.jstree",n.proxy(function(t){if(n.vakata.dnd.is_drag&&n.vakata.dnd.user_data.jstree){var i=this.get_container()[0];t.pageX+24>this.data.dnd.cof.left+this.data.dnd.cw?(this.data.dnd.i1&&clearInterval(this.data.dnd.i1),this.data.dnd.i1=setInterval(n.proxy(function(){this.scrollLeft+=n.vakata.dnd.scroll_spd},i),100)):t.pageX-24<this.data.dnd.cof.left?(this.data.dnd.i1&&clearInterval(this.data.dnd.i1),this.data.dnd.i1=setInterval(n.proxy(function(){this.scrollLeft-=n.vakata.dnd.scroll_spd},i),100)):this.data.dnd.i1&&clearInterval(this.data.dnd.i1),t.pageY+24>this.data.dnd.cof.top+this.data.dnd.ch?(this.data.dnd.i2&&clearInterval(this.data.dnd.i2),this.data.dnd.i2=setInterval(n.proxy(function(){this.scrollTop+=n.vakata.dnd.scroll_spd},i),100)):t.pageY-24<this.data.dnd.cof.top?(this.data.dnd.i2&&clearInterval(this.data.dnd.i2),this.data.dnd.i2=setInterval(n.proxy(function(){this.scrollTop-=n.vakata.dnd.scroll_spd},i),100)):this.data.dnd.i2&&clearInterval(this.data.dnd.i2)}},this)).bind("scroll.jstree",n.proxy(function(){n.vakata.dnd.is_drag&&n.vakata.dnd.user_data.jstree&&r&&i&&(r.hide(),i.hide())},this)).delegate("a","mousedown.jstree",n.proxy(function(n){if(n.which===1)return this.start_drag(n.currentTarget,n),!1},this)).delegate("a","mouseenter.jstree",n.proxy(function(t){n.vakata.dnd.is_drag&&n.vakata.dnd.user_data.jstree&&this.dnd_enter(t.currentTarget)},this)).delegate("a","mousemove.jstree",n.proxy(function(i){n.vakata.dnd.is_drag&&n.vakata.dnd.user_data.jstree&&(t&&t.length&&t.children("a")[0]===i.currentTarget||this.dnd_enter(i.currentTarget),typeof this.data.dnd.off.top=="undefined"&&(this.data.dnd.off=n(i.target).offset()),this.data.dnd.w=(i.pageY-(this.data.dnd.off.top||0))%this.data.core.li_height,this.data.dnd.w<0&&(this.data.dnd.w+=this.data.core.li_height),this.dnd_show())},this)).delegate("a","mouseleave.jstree",n.proxy(function(t){if(n.vakata.dnd.is_drag&&n.vakata.dnd.user_data.jstree){if(t.relatedTarget&&t.relatedTarget.id&&t.relatedTarget.id==="jstree-marker-line")return!1;r&&r.hide(),i&&i.hide(),this.data.dnd.mto=setTimeout(function(n){return function(){n.dnd_leave(t)}}(this),0)}},this)).delegate("a","mouseup.jstree",n.proxy(function(t){n.vakata.dnd.is_drag&&n.vakata.dnd.user_data.jstree&&this.dnd_finish(t)},this)),n(document).bind("drag_stop.vakata",n.proxy(function(){this.data.dnd.to1&&clearTimeout(this.data.dnd.to1),this.data.dnd.to2&&clearTimeout(this.data.dnd.to2),this.data.dnd.i1&&clearInterval(this.data.dnd.i1),this.data.dnd.i2&&clearInterval(this.data.dnd.i2),this.data.dnd.after=!1,this.data.dnd.before=!1,this.data.dnd.inside=!1,this.data.dnd.off=!1,this.data.dnd.prepared=!1,this.data.dnd.w=!1,this.data.dnd.to1=!1,this.data.dnd.to2=!1,this.data.dnd.i1=!1,this.data.dnd.i2=!1,this.data.dnd.active=!1,this.data.dnd.foreign=!1,r&&r.css({top:"-2000px"}),i&&i.css({top:"-2000px"})},this)).bind("drag_start.vakata",n.proxy(function(t,i){if(i.data.jstree){var r=n(i.event.target);r.closest(".jstree").hasClass("jstree-"+this.get_index())&&this.dnd_enter(r)}},this));var f=this._get_settings().dnd;f.drag_target&&n(document).delegate(f.drag_target,"mousedown.jstree-"+this.get_index(),n.proxy(function(t){u=t.target,n.vakata.dnd.drag_start(t,{jstree:!0,obj:t.target},"<ins class='jstree-icon'><\/ins>"+n(t.target).text()),this.data.themes&&(r&&r.attr("class","jstree-"+this.data.themes.theme),i&&i.attr("class","jstree-"+this.data.themes.theme),n.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme)),n.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");var f=this.get_container();this.data.dnd.cof=f.offset(),this.data.dnd.cw=parseInt(f.width(),10),this.data.dnd.ch=parseInt(f.height(),10),this.data.dnd.foreign=!0,t.preventDefault()},this)),f.drop_target&&n(document).delegate(f.drop_target,"mouseenter.jstree-"+this.get_index(),n.proxy(function(t){this.data.dnd.active&&this._get_settings().dnd.drop_check.call(this,{o:u,r:n(t.target),e:t})&&n.vakata.dnd.helper.children("ins").attr("class","jstree-ok")},this)).delegate(f.drop_target,"mouseleave.jstree-"+this.get_index(),n.proxy(function(){this.data.dnd.active&&n.vakata.dnd.helper.children("ins").attr("class","jstree-invalid")},this)).delegate(f.drop_target,"mouseup.jstree-"+this.get_index(),n.proxy(function(t){this.data.dnd.active&&n.vakata.dnd.helper.children("ins").hasClass("jstree-ok")&&this._get_settings().dnd.drop_finish.call(this,{o:u,r:n(t.target),e:t})},this))},defaults:{copy_modifier:"ctrl",check_timeout:100,open_timeout:500,drop_target:".jstree-drop",drop_check:function(){return!0},drop_finish:n.noop,drag_target:".jstree-draggable",drag_finish:n.noop,drag_check:function(){return{after:!1,before:!1,inside:!0}}},_fn:{dnd_prepare:function(){if(t&&t.length){if(this.data.dnd.off=t.offset(),this._get_settings().core.rtl&&(this.data.dnd.off.right=this.data.dnd.off.left+t.width()),this.data.dnd.foreign){var n=this._get_settings().dnd.drag_check.call(this,{o:u,r:t});return this.data.dnd.after=n.after,this.data.dnd.before=n.before,this.data.dnd.inside=n.inside,this.data.dnd.prepared=!0,this.dnd_show()}return this.prepare_move(u,t,"before"),this.data.dnd.before=this.check_move(),this.prepare_move(u,t,"after"),this.data.dnd.after=this.check_move(),this._is_loaded(t)?(this.prepare_move(u,t,"inside"),this.data.dnd.inside=this.check_move()):this.data.dnd.inside=!1,this.data.dnd.prepared=!0,this.dnd_show()}},dnd_show:function(){if(this.data.dnd.prepared){var f=["before","inside","after"],u=!1,e=this._get_settings().core.rtl,t;f=this.data.dnd.w<this.data.core.li_height/3?["before","inside","after"]:this.data.dnd.w<=this.data.core.li_height*2/3?this.data.dnd.w<this.data.core.li_height/2?["inside","before","after"]:["inside","after","before"]:["after","inside","before"],n.each(f,n.proxy(function(t,i){if(this.data.dnd[i])return n.vakata.dnd.helper.children("ins").attr("class","jstree-ok"),u=i,!1},this)),u===!1&&n.vakata.dnd.helper.children("ins").attr("class","jstree-invalid"),t=e?this.data.dnd.off.right-18:this.data.dnd.off.left+10;switch(u){case"before":r.css({left:t+"px",top:this.data.dnd.off.top-6+"px"}).show(),i&&i.css({left:t+8+"px",top:this.data.dnd.off.top-1+"px"}).show();break;case"after":r.css({left:t+"px",top:this.data.dnd.off.top+this.data.core.li_height-6+"px"}).show(),i&&i.css({left:t+8+"px",top:this.data.dnd.off.top+this.data.core.li_height-1+"px"}).show();break;case"inside":r.css({left:t+(e?-4:4)+"px",top:this.data.dnd.off.top+this.data.core.li_height/2-5+"px"}).show(),i&&i.hide();break;default:r.hide(),i&&i.hide()}return h=u,u}},dnd_open:function(){this.data.dnd.to2=!1,this.open_node(t,n.proxy(this.dnd_prepare,this),!0)},dnd_finish:function(n){this.data.dnd.foreign?(this.data.dnd.after||this.data.dnd.before||this.data.dnd.inside)&&this._get_settings().dnd.drag_finish.call(this,{o:u,r:t,p:h}):(this.dnd_prepare(),this.move_node(u,t,h,n[this._get_settings().dnd.copy_modifier+"Key"])),u=!1,t=!1,r.hide(),i&&i.hide()},dnd_enter:function(i){this.data.dnd.mto&&(clearTimeout(this.data.dnd.mto),this.data.dnd.mto=!1);var r=this._get_settings().dnd;this.data.dnd.prepared=!1,t=this._get_node(i),r.check_timeout?(this.data.dnd.to1&&clearTimeout(this.data.dnd.to1),this.data.dnd.to1=setTimeout(n.proxy(this.dnd_prepare,this),r.check_timeout)):this.dnd_prepare(),r.open_timeout?(this.data.dnd.to2&&clearTimeout(this.data.dnd.to2),t&&t.length&&t.hasClass("jstree-closed")&&(this.data.dnd.to2=setTimeout(n.proxy(this.dnd_open,this),r.open_timeout))):t&&t.length&&t.hasClass("jstree-closed")&&this.dnd_open()},dnd_leave:function(u){this.data.dnd.after=!1,this.data.dnd.before=!1,this.data.dnd.inside=!1,n.vakata.dnd.helper.children("ins").attr("class","jstree-invalid"),r.hide(),i&&i.hide(),t&&t[0]===u.target.parentNode&&(this.data.dnd.to1&&(clearTimeout(this.data.dnd.to1),this.data.dnd.to1=!1),this.data.dnd.to2&&(clearTimeout(this.data.dnd.to2),this.data.dnd.to2=!1))},start_drag:function(t,f){u=this._get_node(t),this.data.ui&&this.is_selected(u)&&(u=this._get_node(null,!0));var e=u.length>1?this._get_string("multiple_selection"):this.get_text(u),o=this.get_container();this._get_settings().core.html_titles||(e=e.replace(/</ig,"&lt;").replace(/>/ig,"&gt;")),n.vakata.dnd.drag_start(f,{jstree:!0,obj:u},"<ins class='jstree-icon'><\/ins>"+e),this.data.themes&&(r&&r.attr("class","jstree-"+this.data.themes.theme),i&&i.attr("class","jstree-"+this.data.themes.theme),n.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme)),this.data.dnd.cof=o.offset(),this.data.dnd.cw=parseInt(o.width(),10),this.data.dnd.ch=parseInt(o.height(),10),this.data.dnd.active=!0}}}),n(function(){n.vakata.css.add_sheet({str:"#vakata-dragged ins { display:block; text-decoration:none; width:16px; height:16px; margin:0 0 0 0; padding:0; position:absolute; top:4px; left:4px;  -moz-border-radius:4px; border-radius:4px; -webkit-border-radius:4px; } #vakata-dragged .jstree-ok { background:green; } #vakata-dragged .jstree-invalid { background:red; } #jstree-marker { padding:0; margin:0; font-size:12px; overflow:hidden; height:12px; width:8px; position:absolute; top:-30px; z-index:10001; background-repeat:no-repeat; display:none; background-color:transparent; text-shadow:1px 1px 1px white; color:black; line-height:10px; } #jstree-marker-line { padding:0; margin:0; line-height:0%; font-size:1px; overflow:hidden; height:1px; width:100px; position:absolute; top:-30px; z-index:10000; background-repeat:no-repeat; display:none; background-color:#456c43;  cursor:pointer; border:1px solid #eeeeee; border-left:0; -moz-box-shadow: 0px 0px 2px #666; -webkit-box-shadow: 0px 0px 2px #666; box-shadow: 0px 0px 2px #666;  -moz-border-radius:1px; border-radius:1px; -webkit-border-radius:1px; }",title:"jstree"}),r=n("<div />").attr({id:"jstree-marker"}).hide().html("&raquo;").bind("mouseleave mouseenter",function(n){return r.hide(),i.hide(),n.preventDefault(),n.stopImmediatePropagation(),!1}).appendTo("body"),i=n("<div />").attr({id:"jstree-marker-line"}).hide().bind("mouseup",function(n){if(t&&t.length)return t.children("a").trigger(n),n.preventDefault(),n.stopImmediatePropagation(),!1}).bind("mouseleave",function(u){var f=n(u.relatedTarget);if((f.is(".jstree")||f.closest(".jstree").length===0)&&t&&t.length)return t.children("a").trigger(u),r.hide(),i.hide(),u.preventDefault(),u.stopImmediatePropagation(),!1}).appendTo("body"),n(document).bind("drag_start.vakata",function(n,t){t.data.jstree&&(r.show(),i&&i.show())}),n(document).bind("drag_stop.vakata",function(n,t){t.data.jstree&&(r.hide(),i&&i.hide())})})}(n),function(n){n.jstree.plugin("checkbox",{__init:function(){this.data.checkbox.noui=this._get_settings().checkbox.override_ui,this.data.ui&&this.data.checkbox.noui&&(this.select_node=this.deselect_node=this.deselect_all=n.noop,this.get_selected=this.get_checked),this.get_container().bind("open_node.jstree create_node.jstree clean_node.jstree refresh.jstree",n.proxy(function(n,t){this._prepare_checkboxes(t.rslt.obj)},this)).bind("loaded.jstree",n.proxy(function(){this._prepare_checkboxes()},this)).delegate(this.data.ui&&this.data.checkbox.noui?"a":"ins.jstree-checkbox","click.jstree",n.proxy(function(n){if(n.preventDefault(),this._get_node(n.target).hasClass("jstree-checked")?this.uncheck_node(n.target):this.check_node(n.target),this.data.ui&&this.data.checkbox.noui)this.save_selected(),this.data.cookies&&this.save_cookie("select_node");else return n.stopImmediatePropagation(),!1},this))},defaults:{override_ui:!1,two_state:!1,real_checkboxes:!1,checked_parent_open:!0,real_checkboxes_names:function(n){return["check_"+(n[0].id||Math.ceil(Math.random()*1e4)),1]}},__destroy:function(){this.get_container().find("input.jstree-real-checkbox").removeClass("jstree-real-checkbox").end().find("ins.jstree-checkbox").remove()},_fn:{_checkbox_notify:function(n,t){t.checked&&this.check_node(n,!1)},_prepare_checkboxes:function(t){if(t=!t||t==-1?this.get_container().find("> ul > li"):this._get_node(t),t!==!1){var u,i=this,r,f=this._get_settings().checkbox.two_state,e=this._get_settings().checkbox.real_checkboxes,o=this._get_settings().checkbox.real_checkboxes_names;t.each(function(){r=n(this),u=r.is("li")&&(r.hasClass("jstree-checked")||e&&r.children(":checked").length)?"jstree-checked":"jstree-unchecked",r.find("li").andSelf().each(function(){var t=n(this),r;t.children("a"+(i.data.languages?"":":eq(0)")).not(":has(.jstree-checkbox)").prepend("<ins class='jstree-checkbox'>&#160;<\/ins>").parent().not(".jstree-checked, .jstree-unchecked").addClass(f?"jstree-unchecked":u),e&&(t.children(":checkbox").length?t.children(":checkbox").addClass("jstree-real-checkbox"):(r=o.call(i,t),t.prepend("<input type='checkbox' class='jstree-real-checkbox' id='"+r[0]+"' name='"+r[0]+"' value='"+r[1]+"' />")),u==="jstree-checked"&&t.children(":checkbox").attr("checked","checked")),u!=="jstree-checked"||f||t.find("li").addClass("jstree-checked")})}),f||(t.length===1&&t.is("li")&&this._repair_state(t),t.is("li")?t.each(function(){i._repair_state(this)}):t.find("> ul > li").each(function(){i._repair_state(this)}),t.find(".jstree-checked").parent().parent().each(function(){i._repair_state(this)}))}},change_state:function(t,i){t=this._get_node(t);var r=!1,u=this._get_settings().checkbox.real_checkboxes;if(!t||t===-1)return!1;if(i=i===!1||i===!0?i:t.hasClass("jstree-checked"),this._get_settings().checkbox.two_state)i?(t.removeClass("jstree-checked").addClass("jstree-unchecked"),u&&t.children(":checkbox").removeAttr("checked")):(t.removeClass("jstree-unchecked").addClass("jstree-checked"),u&&t.children(":checkbox").attr("checked","checked"));else{if(i){if(r=t.find("li").andSelf(),!r.filter(".jstree-checked, .jstree-undetermined").length)return!1;r.removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked"),u&&r.children(":checkbox").removeAttr("checked")}else{if(r=t.find("li").andSelf(),!r.filter(".jstree-unchecked, .jstree-undetermined").length)return!1;r.removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked"),u&&r.children(":checkbox").attr("checked","checked"),this.data.ui&&(this.data.ui.last_selected=t),this.data.checkbox.last_selected=t}t.parentsUntil(".jstree","li").each(function(){var t=n(this);if(i){if(t.children("ul").children("li.jstree-checked, li.jstree-undetermined").length)return t.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined"),u&&t.parentsUntil(".jstree","li").andSelf().children(":checkbox").removeAttr("checked"),!1;t.removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked"),u&&t.children(":checkbox").removeAttr("checked")}else{if(t.children("ul").children("li.jstree-unchecked, li.jstree-undetermined").length)return t.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined"),u&&t.parentsUntil(".jstree","li").andSelf().children(":checkbox").removeAttr("checked"),!1;t.removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked"),u&&t.children(":checkbox").attr("checked","checked")}})}return this.data.ui&&this.data.checkbox.noui&&(this.data.ui.selected=this.get_checked()),this.__callback(t),!0},check_node:function(n){if(this.change_state(n,!1)){if(n=this._get_node(n),this._get_settings().checkbox.checked_parent_open){var t=this;n.parents(".jstree-closed").each(function(){t.open_node(this,!1,!0)})}this.__callback({obj:n})}},uncheck_node:function(n){this.change_state(n,!0)&&this.__callback({obj:this._get_node(n)})},check_all:function(){var n=this,t=this._get_settings().checkbox.two_state?this.get_container_ul().find("li"):this.get_container_ul().children("li");t.each(function(){n.change_state(this,!1)}),this.__callback()},uncheck_all:function(){var n=this,t=this._get_settings().checkbox.two_state?this.get_container_ul().find("li"):this.get_container_ul().children("li");t.each(function(){n.change_state(this,!0)}),this.__callback()},is_checked:function(n){return n=this._get_node(n),n.length?n.is(".jstree-checked"):!1},get_checked:function(n,t){return n=!n||n===-1?this.get_container():this._get_node(n),t||this._get_settings().checkbox.two_state?n.find(".jstree-checked"):n.find("> ul > .jstree-checked, .jstree-undetermined > ul > .jstree-checked")},get_unchecked:function(n,t){return n=!n||n===-1?this.get_container():this._get_node(n),t||this._get_settings().checkbox.two_state?n.find(".jstree-unchecked"):n.find("> ul > .jstree-unchecked, .jstree-undetermined > ul > .jstree-unchecked")},show_checkboxes:function(){this.get_container().children("ul").removeClass("jstree-no-checkboxes")},hide_checkboxes:function(){this.get_container().children("ul").addClass("jstree-no-checkboxes")},_repair_state:function(n){if(n=this._get_node(n),n.length){var r=this._get_settings().checkbox.real_checkboxes,t=n.find("> ul > .jstree-checked").length,u=n.find("> ul > .jstree-undetermined").length,i=n.find("> ul > li").length;i===0?n.hasClass("jstree-undetermined")&&this.change_state(n,!1):t===0&&u===0?this.change_state(n,!0):t===i?this.change_state(n,!1):(n.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined"),r&&n.parentsUntil(".jstree","li").andSelf().children(":checkbox").removeAttr("checked"))}},reselect:function(){if(this.data.ui&&this.data.checkbox.noui){var i=this,t=this.data.ui.to_select;t=n.map(n.makeArray(t),function(n){return"#"+n.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}),this.deselect_all(),n.each(t,function(n,t){i.check_node(t)}),this.__callback()}else this.__call_old()},save_loaded:function(){var n=this;this.data.core.to_load=[],this.get_container_ul().find("li.jstree-closed.jstree-undetermined").each(function(){this.id&&n.data.core.to_load.push("#"+this.id)})}}}),n(function(){n.vakata.css.add_sheet({str:".jstree .jstree-real-checkbox { display:none; } ",title:"jstree"})})}(n),function(n){n.vakata.xslt=function(t,i,r){var f="",e,o,u,s;return document.recalc?(e=document.createElement("xml"),o=document.createElement("xml"),e.innerHTML=t,o.innerHTML=i,n("body").append(e).append(o),setTimeout(function(t,i,r){return function(){r.call(null,t.transformNode(i.XMLDocument)),setTimeout(function(t,i){return function(){n(t).remove(),n(i).remove()}}(t,i),200)}}(e,o,r),100),!0):(typeof window.DOMParser!="undefined"&&typeof window.XMLHttpRequest!="undefined"&&typeof window.XSLTProcessor=="undefined"&&(t=(new DOMParser).parseFromString(t,"text/xml"),i=(new DOMParser).parseFromString(i,"text/xml")),typeof window.DOMParser!="undefined"&&typeof window.XMLHttpRequest!="undefined"&&typeof window.XSLTProcessor!="undefined")?(u=new XSLTProcessor,s=n.isFunction(u.transformDocument)?typeof window.XMLSerializer!="undefined":!0,!s)?!1:(t=(new DOMParser).parseFromString(t,"text/xml"),i=(new DOMParser).parseFromString(i,"text/xml"),n.isFunction(u.transformDocument)?(f=document.implementation.createDocument("","",null),u.transformDocument(t,i,f,null),r.call(null,(new XMLSerializer).serializeToString(f)),!0):(u.importStylesheet(i),f=u.transformToFragment(t,document),r.call(null,n("<div />").append(f).html()),!0)):!1};var i={nest:'<?xml version="1.0" encoding="utf-8" ?><xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" ><xsl:output method="html" encoding="utf-8" omit-xml-declaration="yes" standalone="no" indent="no" media-type="text/html" /><xsl:template match="/">\t<xsl:call-template name="nodes">\t\t<xsl:with-param name="node" select="/root" />\t<\/xsl:call-template><\/xsl:template><xsl:template name="nodes">\t<xsl:param name="node" />\t<ul>\t<xsl:for-each select="$node/item">\t\t<xsl:variable name="children" select="count(./item) &gt; 0" />\t\t<li>\t\t\t<xsl:attribute name="class">\t\t\t\t<xsl:if test="position() = last()">jstree-last <\/xsl:if>\t\t\t\t<xsl:choose>\t\t\t\t\t<xsl:when test="@state = \'open\'">jstree-open <\/xsl:when>\t\t\t\t\t<xsl:when test="$children or @hasChildren or @state = \'closed\'">jstree-closed <\/xsl:when>\t\t\t\t\t<xsl:otherwise>jstree-leaf <\/xsl:otherwise>\t\t\t\t<\/xsl:choose>\t\t\t\t<xsl:value-of select="@class" />\t\t\t<\/xsl:attribute>\t\t\t<xsl:for-each select="@*">\t\t\t\t<xsl:if test="name() != \'class\' and name() != \'state\' and name() != \'hasChildren\'">\t\t\t\t\t<xsl:attribute name="{name()}"><xsl:value-of select="." /><\/xsl:attribute>\t\t\t\t<\/xsl:if>\t\t\t<\/xsl:for-each>\t<ins class="jstree-icon"><xsl:text>&#xa0;<\/xsl:text><\/ins>\t\t\t<xsl:for-each select="content/name">\t\t\t\t<a>\t\t\t\t<xsl:attribute name="href">\t\t\t\t\t<xsl:choose>\t\t\t\t\t<xsl:when test="@href"><xsl:value-of select="@href" /><\/xsl:when>\t\t\t\t\t<xsl:otherwise>#<\/xsl:otherwise>\t\t\t\t\t<\/xsl:choose>\t\t\t\t<\/xsl:attribute>\t\t\t\t<xsl:attribute name="class"><xsl:value-of select="@lang" /> <xsl:value-of select="@class" /><\/xsl:attribute>\t\t\t\t<xsl:attribute name="style"><xsl:value-of select="@style" /><\/xsl:attribute>\t\t\t\t<xsl:for-each select="@*">\t\t\t\t\t<xsl:if test="name() != \'style\' and name() != \'class\' and name() != \'href\'">\t\t\t\t\t\t<xsl:attribute name="{name()}"><xsl:value-of select="." /><\/xsl:attribute>\t\t\t\t\t<\/xsl:if>\t\t\t\t<\/xsl:for-each>\t\t\t\t\t<ins>\t\t\t\t\t\t<xsl:attribute name="class">jstree-icon \t\t\t\t\t\t\t<xsl:if test="string-length(attribute::icon) > 0 and not(contains(@icon,\'/\'))"><xsl:value-of select="@icon" /><\/xsl:if>\t\t\t\t\t\t<\/xsl:attribute>\t\t\t\t\t\t<xsl:if test="string-length(attribute::icon) > 0 and contains(@icon,\'/\')"><xsl:attribute name="style">background:url(<xsl:value-of select="@icon" />) center center no-repeat;<\/xsl:attribute><\/xsl:if>\t\t\t\t\t\t<xsl:text>&#xa0;<\/xsl:text>\t\t\t\t\t<\/ins>\t\t\t\t\t<xsl:copy-of select="./child::node()" />\t\t\t\t<\/a>\t\t\t<\/xsl:for-each>\t\t\t<xsl:if test="$children or @hasChildren"><xsl:call-template name="nodes"><xsl:with-param name="node" select="current()" /><\/xsl:call-template><\/xsl:if>\t\t<\/li>\t<\/xsl:for-each>\t<\/ul><\/xsl:template><\/xsl:stylesheet>',flat:'<?xml version="1.0" encoding="utf-8" ?><xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" ><xsl:output method="html" encoding="utf-8" omit-xml-declaration="yes" standalone="no" indent="no" media-type="text/xml" /><xsl:template match="/">\t<ul>\t<xsl:for-each select="//item[not(@parent_id) or @parent_id=0 or not(@parent_id = //item/@id)]">\t\t<xsl:call-template name="nodes">\t\t\t<xsl:with-param name="node" select="." />\t\t\t<xsl:with-param name="is_last" select="number(position() = last())" />\t\t<\/xsl:call-template>\t<\/xsl:for-each>\t<\/ul><\/xsl:template><xsl:template name="nodes">\t<xsl:param name="node" />\t<xsl:param name="is_last" />\t<xsl:variable name="children" select="count(//item[@parent_id=$node/attribute::id]) &gt; 0" />\t<li>\t<xsl:attribute name="class">\t\t<xsl:if test="$is_last = true()">jstree-last <\/xsl:if>\t\t<xsl:choose>\t\t\t<xsl:when test="@state = \'open\'">jstree-open <\/xsl:when>\t\t\t<xsl:when test="$children or @hasChildren or @state = \'closed\'">jstree-closed <\/xsl:when>\t\t\t<xsl:otherwise>jstree-leaf <\/xsl:otherwise>\t\t<\/xsl:choose>\t\t<xsl:value-of select="@class" />\t<\/xsl:attribute>\t<xsl:for-each select="@*">\t\t<xsl:if test="name() != \'parent_id\' and name() != \'hasChildren\' and name() != \'class\' and name() != \'state\'">\t\t<xsl:attribute name="{name()}"><xsl:value-of select="." /><\/xsl:attribute>\t\t<\/xsl:if>\t<\/xsl:for-each>\t<ins class="jstree-icon"><xsl:text>&#xa0;<\/xsl:text><\/ins>\t<xsl:for-each select="content/name">\t\t<a>\t\t<xsl:attribute name="href">\t\t\t<xsl:choose>\t\t\t<xsl:when test="@href"><xsl:value-of select="@href" /><\/xsl:when>\t\t\t<xsl:otherwise>#<\/xsl:otherwise>\t\t\t<\/xsl:choose>\t\t<\/xsl:attribute>\t\t<xsl:attribute name="class"><xsl:value-of select="@lang" /> <xsl:value-of select="@class" /><\/xsl:attribute>\t\t<xsl:attribute name="style"><xsl:value-of select="@style" /><\/xsl:attribute>\t\t<xsl:for-each select="@*">\t\t\t<xsl:if test="name() != \'style\' and name() != \'class\' and name() != \'href\'">\t\t\t\t<xsl:attribute name="{name()}"><xsl:value-of select="." /><\/xsl:attribute>\t\t\t<\/xsl:if>\t\t<\/xsl:for-each>\t\t\t<ins>\t\t\t\t<xsl:attribute name="class">jstree-icon \t\t\t\t\t<xsl:if test="string-length(attribute::icon) > 0 and not(contains(@icon,\'/\'))"><xsl:value-of select="@icon" /><\/xsl:if>\t\t\t\t<\/xsl:attribute>\t\t\t\t<xsl:if test="string-length(attribute::icon) > 0 and contains(@icon,\'/\')"><xsl:attribute name="style">background:url(<xsl:value-of select="@icon" />) center center no-repeat;<\/xsl:attribute><\/xsl:if>\t\t\t\t<xsl:text>&#xa0;<\/xsl:text>\t\t\t<\/ins>\t\t\t<xsl:copy-of select="./child::node()" />\t\t<\/a>\t<\/xsl:for-each>\t<xsl:if test="$children">\t\t<ul>\t\t<xsl:for-each select="//item[@parent_id=$node/attribute::id]">\t\t\t<xsl:call-template name="nodes">\t\t\t\t<xsl:with-param name="node" select="." />\t\t\t\t<xsl:with-param name="is_last" select="number(position() = last())" />\t\t\t<\/xsl:call-template>\t\t<\/xsl:for-each>\t\t<\/ul>\t<\/xsl:if>\t<\/li><\/xsl:template><\/xsl:stylesheet>'},t=function(n){return n.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};n.jstree.plugin("xml_data",{defaults:{data:!1,ajax:!1,xsl:"flat",clean_node:!1,correct_state:!0,get_skip_empty:!1,get_include_preamble:!0},_fn:{load_node:function(n,t,i){var r=this;this.load_node_xml(n,function(){r.__callback({obj:r._get_node(n)}),t.call(this)},i)},_is_loaded:function(t){var i=this._get_settings().xml_data;return t=this._get_node(t),t==-1||!t||!i.ajax&&!n.isFunction(i.data)||t.is(".jstree-open, .jstree-leaf")||t.children("ul").children("li").size()>0},load_node_xml:function(t,i,r){var u=this.get_settings().xml_data,f=function(){},e=function(){};if(t=this._get_node(t),t&&t!==-1){if(t.data("jstree-is-loading"))return;t.data("jstree-is-loading",!0)}switch(!0){case!u.data&&!u.ajax:throw"Neither data nor ajax settings supplied.";case n.isFunction(u.data):u.data.call(this,t,n.proxy(function(r){this.parse_xml(r,n.proxy(function(r){r&&(r=r.replace(/ ?xmlns="[^"]*"/ig,""),r.length>10?(r=n(r),t!==-1&&t?(t.children("a.jstree-loading").removeClass("jstree-loading"),t.append(r),t.removeData("jstree-is-loading")):this.get_container().children("ul").empty().append(r.children()),u.clean_node&&this.clean_node(t),i&&i.call(this)):t&&t!==-1?(t.children("a.jstree-loading").removeClass("jstree-loading"),t.removeData("jstree-is-loading"),u.correct_state&&(this.correct_state(t),i&&i.call(this))):u.correct_state&&(this.get_container().children("ul").empty(),i&&i.call(this)))},this))},this));break;case!!u.data&&!u.ajax||!!u.data&&!!u.ajax&&(!t||t===-1):t&&t!=-1||this.parse_xml(u.data,n.proxy(function(r){r?(r=r.replace(/ ?xmlns="[^"]*"/ig,""),r.length>10&&(r=n(r),this.get_container().children("ul").empty().append(r.children()),u.clean_node&&this.clean_node(t),i&&i.call(this))):u.correct_state&&(this.get_container().children("ul").empty(),i&&i.call(this))},this));break;case!u.data&&!!u.ajax||!!u.data&&!!u.ajax&&t&&t!==-1:f=function(n,i,f){var e=this.get_settings().xml_data.ajax.error;e&&e.call(this,n,i,f),t!==-1&&t.length?(t.children("a.jstree-loading").removeClass("jstree-loading"),t.removeData("jstree-is-loading"),i==="success"&&u.correct_state&&this.correct_state(t)):i==="success"&&u.correct_state&&this.get_container().children("ul").empty(),r&&r.call(this)},e=function(r,e,o){r=o.responseText;var s=this.get_settings().xml_data.ajax.success;if(s&&(r=s.call(this,r,e,o)||r),r===""||r&&r.toString&&r.toString().replace(/^[\s\n]+$/,"")==="")return f.call(this,o,e,"");this.parse_xml(r,n.proxy(function(r){r&&(r=r.replace(/ ?xmlns="[^"]*"/ig,""),r.length>10?(r=n(r),t!==-1&&t?(t.children("a.jstree-loading").removeClass("jstree-loading"),t.append(r),t.removeData("jstree-is-loading")):this.get_container().children("ul").empty().append(r.children()),u.clean_node&&this.clean_node(t),i&&i.call(this)):t&&t!==-1?(t.children("a.jstree-loading").removeClass("jstree-loading"),t.removeData("jstree-is-loading"),u.correct_state&&(this.correct_state(t),i&&i.call(this))):u.correct_state&&(this.get_container().children("ul").empty(),i&&i.call(this)))},this))},u.ajax.context=this,u.ajax.error=f,u.ajax.success=e,u.ajax.dataType||(u.ajax.dataType="xml"),n.isFunction(u.ajax.url)&&(u.ajax.url=u.ajax.url.call(this,t)),n.isFunction(u.ajax.data)&&(u.ajax.data=u.ajax.data.call(this,t)),n.ajax(u.ajax)}},parse_xml:function(t,r){var u=this._get_settings().xml_data;n.vakata.xslt(t,i[u.xsl],r)},get_xml:function(i,r,u,f,e){var o="",c=this._get_settings(),v=this,h,l,s,y,a;return i||(i="flat"),e||(e=0),r=this._get_node(r),r&&r!==-1||(r=this.get_container().find("> ul > li")),u=n.isArray(u)?u:["id","class"],!e&&this.data.types&&n.inArray(c.types.type_attr,u)===-1&&u.push(c.types.type_attr),f=n.isArray(f)?f:[],e||(c.xml_data.get_include_preamble&&(o+='<?xml version="1.0" encoding="UTF-8"?>'),o+="<root>"),r.each(function(){o+="<item",s=n(this),n.each(u,function(n,i){var r=s.attr(i);c.xml_data.get_skip_empty&&typeof r=="undefined"||(o+=" "+i+'="'+t((" "+(r||"")).replace(/ jstree[^ ]*/ig,"").replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,""))+'"')}),s.hasClass("jstree-open")&&(o+=' state="open"'),s.hasClass("jstree-closed")&&(o+=' state="closed"'),i==="flat"&&(o+=' parent_id="'+t(e)+'"'),o+=">",o+="<content>",y=s.children("a"),y.each(function(){h=n(this),a=!1,o+="<name",n.inArray("languages",c.plugins)!==-1&&n.each(c.languages,function(n,i){if(h.hasClass(i))return o+=' lang="'+t(i)+'"',a=i,!1}),f.length&&n.each(f,function(n,i){var r=h.attr(i);c.xml_data.get_skip_empty&&typeof r=="undefined"||(o+=" "+i+'="'+t((" "+r||"").replace(/ jstree[^ ]*/ig,"").replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,""))+'"')}),h.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").replace(/^\s+$/ig,"").length&&(o+=' icon="'+t(h.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,""))+'"'),h.children("ins").get(0).style.backgroundImage.length&&(o+=' icon="'+t(h.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","").replace(/'/ig,"").replace(/"/ig,""))+'"'),o+=">",o+="<![CDATA["+v.get_text(h,a)+"]\]>",o+="<\/name>"}),o+="<\/content>",l=s[0].id||!0,s=s.find("> ul > li"),l=s.length?v.get_xml(i,s,u,f,l):"",i=="nest"&&(o+=l),o+="<\/item>",i=="flat"&&(o+=l)}),e||(o+="<\/root>"),o}}})}(n),function(n){n.expr[":"].jstree_contains=function(n,t,i){return(n.textContent||n.innerText||"").toLowerCase().indexOf(i[3].toLowerCase())>=0},n.expr[":"].jstree_title_contains=function(n,t,i){return(n.getAttribute("title")||"").toLowerCase().indexOf(i[3].toLowerCase())>=0},n.jstree.plugin("search",{__init:function(){this.data.search.str="",this.data.search.result=n(),this._get_settings().search.show_only_matches&&this.get_container().bind("search.jstree",function(t,i){n(this).children("ul").find("li").hide().removeClass("jstree-last"),i.rslt.nodes.parentsUntil(".jstree").andSelf().show().filter("ul").each(function(){n(this).children("li:visible").eq(-1).addClass("jstree-last")})}).bind("clear_search.jstree",function(){n(this).children("ul").find("li").css("display","").end().end().jstree("clean_node",-1)})},defaults:{ajax:!1,search_method:"jstree_contains",show_only_matches:!1},_fn:{search:function(t,i){if(n.trim(t)===""){this.clear_search();return}var r=this.get_settings().search,e=this,u=function(){},f=function(){};if(this.data.search.str=t,!i&&r.ajax!==!1&&this.get_container_ul().find("li.jstree-closed:not(:has(ul)):eq(0)").length>0){this.search.supress_callback=!0,u=function(){},f=function(n,t,i){var r=this.get_settings().search.ajax.success;r&&(n=r.call(this,n,t,i)||n),this.data.search.to_open=n,this._search_open()},r.ajax.context=this,r.ajax.error=u,r.ajax.success=f,n.isFunction(r.ajax.url)&&(r.ajax.url=r.ajax.url.call(this,t)),n.isFunction(r.ajax.data)&&(r.ajax.data=r.ajax.data.call(this,t)),r.ajax.data||(r.ajax.data={search_string:t}),(!r.ajax.dataType||/^json/.exec(r.ajax.dataType))&&(r.ajax.dataType="json"),n.ajax(r.ajax);return}this.data.search.result.length&&this.clear_search(),this.data.search.result=this.get_container().find("a"+(this.data.languages?"."+this.get_lang():"")+":"+r.search_method+"("+this.data.search.str+")"),this.data.search.result.addClass("jstree-search").parent().parents(".jstree-closed").each(function(){e.open_node(this,!1,!0)}),this.__callback({nodes:this.data.search.result,str:t})},clear_search:function(){this.data.search.result.removeClass("jstree-search"),this.__callback(this.data.search.result),this.data.search.result=n()},_search_open:function(){var i=this,r=!0,t=[],u=[];this.data.search.to_open.length&&(n.each(this.data.search.to_open,function(i,r){if(r=="#")return!0;n(r).length&&n(r).is(".jstree-closed")?t.push(r):u.push(r)}),t.length&&(this.data.search.to_open=u,n.each(t,function(n,t){i.open_node(t,function(){i._search_open(!0)})}),r=!1)),r&&this.search(this.data.search.str,!0)}}})}(n),function(n){n.vakata.context={hide_on_mouseleave:!1,cnt:n("<div id='vakata-contextmenu' />"),vis:!1,tgt:!1,par:!1,func:!1,data:!1,rtl:!1,show:function(t,i,r,u,f,e,o){n.vakata.context.rtl=!!o;var c=n.vakata.context.parse(t),s,h;if(c){if(n.vakata.context.vis=!0,n.vakata.context.tgt=i,n.vakata.context.par=e||i||null,n.vakata.context.data=f||null,n.vakata.context.cnt.html(c).css({visibility:"hidden",display:"block",left:0,top:0}),n.vakata.context.hide_on_mouseleave)n.vakata.context.cnt.one("mouseleave",function(){n.vakata.context.hide()});s=n.vakata.context.cnt.height(),h=n.vakata.context.cnt.width(),r+h>n(document).width()&&(r=n(document).width()-(h+5),n.vakata.context.cnt.find("li > ul").addClass("right")),u+s>n(document).height()&&(u=u-(s+i[0].offsetHeight),n.vakata.context.cnt.find("li > ul").addClass("bottom")),n.vakata.context.cnt.css({left:r,top:u}).find("li:has(ul)").bind("mouseenter",function(){var i=n(document).width(),r=n(document).height(),t=n(this).children("ul").show();i!==n(document).width()&&t.toggleClass("right"),r!==n(document).height()&&t.toggleClass("bottom")}).bind("mouseleave",function(){n(this).children("ul").hide()}).end().css({visibility:"visible"}).show(),n(document).triggerHandler("context_show.vakata")}},hide:function(){n.vakata.context.vis=!1,n.vakata.context.cnt.attr("class","").css({visibility:"hidden"}),n(document).triggerHandler("context_hide.vakata")},parse:function(t,i){if(!t)return!1;var r="",u=!1,f=!0;return i||(n.vakata.context.func={}),r+="<ul>",n.each(t,function(t,i){if(!i)return!0;n.vakata.context.func[t]=i.action,!f&&i.separator_before&&(r+="<li class='vakata-separator vakata-separator-before'><\/li>"),f=!1,r+="<li class='"+(i._class||"")+(i._disabled?" jstree-contextmenu-disabled ":"")+"'><ins ",i.icon&&i.icon.indexOf("/")===-1&&(r+=" class='"+i.icon+"' "),i.icon&&i.icon.indexOf("/")!==-1&&(r+=" style='background:url("+i.icon+") center center no-repeat;' "),r+=">&#160;<\/ins><a href='#' rel='"+t+"'>",i.submenu&&(r+="<span style='float:"+(n.vakata.context.rtl?"left":"right")+";'>&raquo;<\/span>"),r+=i.label+"<\/a>",i.submenu&&(u=n.vakata.context.parse(i.submenu,!0),u&&(r+=u)),r+="<\/li>",i.separator_after&&(r+="<li class='vakata-separator vakata-separator-after'><\/li>",f=!0)}),r=r.replace(/<li class\='vakata-separator vakata-separator-after'\><\/li\>$/,""),r+="<\/ul>",n(document).triggerHandler("context_parse.vakata"),r.length>10?r:!1},exec:function(t){return n.isFunction(n.vakata.context.func[t])?(n.vakata.context.func[t].call(n.vakata.context.data,n.vakata.context.par),!0):!1}},n(function(){n.vakata.css.add_sheet({str:"#vakata-contextmenu { display:block; visibility:hidden; left:0; top:-200px; position:absolute; margin:0; padding:0; min-width:180px; background:#ebebeb; border:1px solid silver; z-index:10000; *width:180px; } #vakata-contextmenu ul { min-width:180px; *width:180px; } #vakata-contextmenu ul, #vakata-contextmenu li { margin:0; padding:0; list-style-type:none; display:block; } #vakata-contextmenu li { line-height:20px; min-height:20px; position:relative; padding:0px; } #vakata-contextmenu li a { padding:1px 6px; line-height:17px; display:block; text-decoration:none; margin:1px 1px 0 1px; } #vakata-contextmenu li ins { float:left; width:16px; height:16px; text-decoration:none; margin-right:2px; } #vakata-contextmenu li a:hover, #vakata-contextmenu li.vakata-hover > a { background:gray; color:white; } #vakata-contextmenu li ul { display:none; position:absolute; top:-2px; left:100%; background:#ebebeb; border:1px solid gray; } #vakata-contextmenu .right { right:100%; left:auto; } #vakata-contextmenu .bottom { bottom:-1px; top:auto; } #vakata-contextmenu li.vakata-separator { min-height:0; height:1px; line-height:1px; font-size:1px; overflow:hidden; margin:0 2px; background:silver; /* border-top:1px solid #fefefe; */ padding:0; } ",title:"vakata"}),n.vakata.context.cnt.delegate("a","click",function(n){n.preventDefault()}).delegate("a","mouseup",function(){!n(this).parent().hasClass("jstree-contextmenu-disabled")&&n.vakata.context.exec(n(this).attr("rel"))?n.vakata.context.hide():n(this).blur()}).delegate("a","mouseover",function(){n.vakata.context.cnt.find(".vakata-hover").removeClass("vakata-hover")}).appendTo("body"),n(document).bind("mousedown",function(t){n.vakata.context.vis&&!n.contains(n.vakata.context.cnt[0],t.target)&&n.vakata.context.hide()}),typeof n.hotkeys!="undefined"&&n(document).bind("keydown","up",function(t){if(n.vakata.context.vis){var i=n.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").prevAll("li:not(.vakata-separator)").first();i.length||(i=n.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").last()),i.addClass("vakata-hover"),t.stopImmediatePropagation(),t.preventDefault()}}).bind("keydown","down",function(t){if(n.vakata.context.vis){var i=n.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").nextAll("li:not(.vakata-separator)").first();i.length||(i=n.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").first()),i.addClass("vakata-hover"),t.stopImmediatePropagation(),t.preventDefault()}}).bind("keydown","right",function(t){n.vakata.context.vis&&(n.vakata.context.cnt.find(".vakata-hover").children("ul").show().children("li:not(.vakata-separator)").removeClass("vakata-hover").first().addClass("vakata-hover"),t.stopImmediatePropagation(),t.preventDefault())}).bind("keydown","left",function(t){n.vakata.context.vis&&(n.vakata.context.cnt.find(".vakata-hover").children("ul").hide().children(".vakata-separator").removeClass("vakata-hover"),t.stopImmediatePropagation(),t.preventDefault())}).bind("keydown","esc",function(t){n.vakata.context.hide(),t.preventDefault()}).bind("keydown","space",function(t){n.vakata.context.cnt.find(".vakata-hover").last().children("a").click(),t.preventDefault()})}),n.jstree.plugin("contextmenu",{__init:function(){this.get_container().delegate("a","contextmenu.jstree",n.proxy(function(t){t.preventDefault(),n(t.currentTarget).hasClass("jstree-loading")||this.show_contextmenu(t.currentTarget,t.pageX,t.pageY)},this)).delegate("a","click.jstree",n.proxy(function(){this.data.contextmenu&&n.vakata.context.hide()},this)).bind("destroy.jstree",n.proxy(function(){this.data.contextmenu&&n.vakata.context.hide()},this)),n(document).bind("context_hide.vakata",n.proxy(function(){this.data.contextmenu=!1},this))},defaults:{select_node:!1,show_at_node:!0,items:{create:{separator_before:!1,separator_after:!0,label:"Create",action:function(n){this.create(n)}},rename:{separator_before:!1,separator_after:!1,label:"Rename",action:function(n){this.rename(n)}},remove:{separator_before:!1,icon:!1,separator_after:!1,label:"Delete",action:function(n){this.is_selected(n)?this.remove():this.remove(n)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(n){this.cut(n)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(n){this.copy(n)}},paste:{separator_before:!1,icon:!1,separator_after:!1,label:"Paste",action:function(n){this.paste(n)}}}}}},_fn:{show_contextmenu:function(t,i,r){t=this._get_node(t);var f=this.get_settings().contextmenu,o=t.children("a:visible:eq(0)"),e=!1,u=!1;f.select_node&&this.data.ui&&!this.is_selected(t)&&(this.deselect_all(),this.select_node(t,!0)),(f.show_at_node||typeof i=="undefined"||typeof r=="undefined")&&(e=o.offset(),i=e.left,r=e.top+this.data.core.li_height),u=t.data("jstree")&&t.data("jstree").contextmenu?t.data("jstree").contextmenu:f.items,n.isFunction(u)&&(u=u.call(this,t)),this.data.contextmenu=!0,n.vakata.context.show(u,o,i,r,this,t,this._get_settings().core.rtl),this.data.themes&&n.vakata.context.cnt.attr("class","jstree-"+this.data.themes.theme+"-context")}}})}(n),function(n){n.jstree.plugin("types",{__init:function(){var i=this._get_settings().types;this.data.types.attach_to=[],this.get_container().bind("init.jstree",n.proxy(function(){var u=i.types,f=i.type_attr,t="",r=this;n.each(u,function(i,u){if(n.each(u,function(n){/^(max_depth|max_children|icon|valid_children)$/.test(n)||r.data.types.attach_to.push(n)}),!u.icon)return!0;(u.icon.image||u.icon.position)&&(t+=i=="default"?".jstree-"+r.get_index()+" a > .jstree-icon { ":".jstree-"+r.get_index()+" li["+f+'="'+i+'"] > a > .jstree-icon { ',u.icon.image&&(t+=" background-image:url("+u.icon.image+"); "),t+=u.icon.position?" background-position:"+u.icon.position+"; ":" background-position:0 0; ",t+="} ")}),t!==""&&n.vakata.css.add_sheet({str:t,title:"jstree-types"})},this)).bind("before.jstree",n.proxy(function(t,i){var r,f,u=this._get_settings().types.use_data?this._get_node(i.args[0]):!1,e=u&&u!==-1&&u.length?u.data("jstree"):!1;if(e&&e.types&&e.types[i.func]===!1)return t.stopImmediatePropagation(),!1;if(n.inArray(i.func,this.data.types.attach_to)!==-1){if(!i.args[0]||!i.args[0].tagName&&!i.args[0].jquery)return;if(r=this._get_settings().types.types,f=this._get_type(i.args[0]),(r[f]&&typeof r[f][i.func]!="undefined"||r["default"]&&typeof r["default"][i.func]!="undefined")&&this._check(i.func,i.args[0])===!1)return t.stopImmediatePropagation(),!1}},this)),t&&this.get_container().bind("load_node.jstree set_type.jstree",n.proxy(function(t,i){var u=i&&i.rslt&&i.rslt.obj&&i.rslt.obj!==-1?this._get_node(i.rslt.obj).parent():this.get_container_ul(),r=!1,f=this._get_settings().types;n.each(f.types,function(n,t){t.icon&&(t.icon.image||t.icon.position)&&(r=n==="default"?u.find("li > a > .jstree-icon"):u.find("li["+f.type_attr+"='"+n+"'] > a > .jstree-icon"),t.icon.image&&r.css("backgroundImage","url("+t.icon.image+")"),r.css("backgroundPosition",t.icon.position||"0 0"))})},this))},defaults:{max_children:-1,max_depth:-1,valid_children:"all",use_data:!1,type_attr:"rel",types:{"default":{max_children:-1,max_depth:-1,valid_children:"all"}}},_fn:{_types_notify:function(n,t){t.type&&this._get_settings().types.use_data&&this.set_type(t.type,n)},_get_type:function(n){return n=this._get_node(n),!n||!n.length?!1:n.attr(this._get_settings().types.type_attr)||"default"},set_type:function(n,t){t=this._get_node(t);var i=!t.length||!n?!1:t.attr(this._get_settings().types.type_attr,n);return i&&this.__callback({obj:t,type:n}),i},_check:function(t,i,r){i=this._get_node(i);var u=!1,s=this._get_type(i),e=0,h=this,f=this._get_settings().types,o=!1;if(i===-1){if(!f[t])return;u=f[t]}else{if(s===!1)return;o=f.use_data?i.data("jstree"):!1,o&&o.types&&typeof o.types[t]!="undefined"?u=o.types[t]:!f.types[s]||typeof f.types[s][t]=="undefined"?!f.types["default"]||typeof f.types["default"][t]=="undefined"||(u=f.types["default"][t]):u=f.types[s][t]}return n.isFunction(u)&&(u=u.call(this,i)),t==="max_depth"&&i!==-1&&r!==!1&&f.max_depth!==-2&&u!==0&&i.children("a:eq(0)").parentsUntil(".jstree","li").each(function(n){if(f.max_depth!==-1&&f.max_depth-(n+1)<=0||(e=n===0?u:h._check(t,this,!1),e!==-1&&e-(n+1)<=0))return u=0,!1;e>=0&&(e-(n+1)<u||u<0)&&(u=e-(n+1)),f.max_depth>=0&&(f.max_depth-(n+1)<u||u<0)&&(u=f.max_depth-(n+1))}),u},check_move:function(){if(!this.__call_old())return!1;var t=this._get_move(),e=t.rt._get_settings().types,o=t.rt._check("max_children",t.cr),u=t.rt._check("max_depth",t.cr),f=t.rt._check("valid_children",t.cr),s=0,i=1,r;if(f==="none"||n.isArray(f)&&t.ot&&t.ot._get_type&&(t.o.each(function(){if(n.inArray(t.ot._get_type(this),f)===-1)return i=!1,!1}),i===!1)||e.max_children!==-2&&o!==-1&&(s=t.cr===-1?this.get_container().find("> ul > li").not(t.o).length:t.cr.find("> ul > li").not(t.o).length,s+t.o.length>o))return!1;if(e.max_depth!==-2&&u!==-1){if(i=0,u===0)return!1;if(typeof t.o.d=="undefined"){for(r=t.o;r.length>0;)r=r.find("> ul > li"),i++;t.o.d=i}if(u-t.o.d<0)return!1}return!0},create_node:function(t,i,r,u,f,e){if(!e&&(f||this._is_loaded(t))){var o=typeof i=="string"&&i.match(/^before|after$/i)&&t!==-1?this._get_parent(t):this._get_node(t),s=this._get_settings().types,c=this._check("max_children",o),l=this._check("max_depth",o),h=this._check("valid_children",o),a;if(typeof r=="string"&&(r={data:r}),r||(r={}),h==="none")return!1;if(n.isArray(h))if(r.attr&&r.attr[s.type_attr]){if(n.inArray(r.attr[s.type_attr],h)===-1)return!1}else r.attr||(r.attr={}),r.attr[s.type_attr]=h[0];if(s.max_children!==-2&&c!==-1&&(a=o===-1?this.get_container().find("> ul > li").length:o.find("> ul > li").length,a+1>c)||s.max_depth!==-2&&l!==-1&&l-1<0)return!1}return this.__call_old(!0,t,i,r,u,f,e)}}})}(n),function(n){n.jstree.plugin("html_data",{__init:function(){this.data.html_data.original_container_html=this.get_container().find(" > ul > li").clone(!0),this.data.html_data.original_container_html.find("li").andSelf().contents().filter(function(){return this.nodeType==3}).remove()},defaults:{data:!1,ajax:!1,correct_state:!0},_fn:{load_node:function(n,t,i){var r=this;this.load_node_html(n,function(){r.__callback({obj:r._get_node(n)}),t.call(this)},i)},_is_loaded:function(t){return t=this._get_node(t),t==-1||!t||!this._get_settings().html_data.ajax&&!n.isFunction(this._get_settings().html_data.data)||t.is(".jstree-open, .jstree-leaf")||t.children("ul").children("li").size()>0},load_node_html:function(t,i,r){var f,u=this.get_settings().html_data,e=function(){},o=function(){};if(t=this._get_node(t),t&&t!==-1){if(t.data("jstree-is-loading"))return;t.data("jstree-is-loading",!0)}switch(!0){case n.isFunction(u.data):u.data.call(this,t,n.proxy(function(r){r&&r!==""&&r.toString&&r.toString().replace(/^[\s\n]+$/,"")!==""?(r=n(r),r.is("ul")||(r=n("<ul />").append(r)),t!=-1&&t?(t.children("a.jstree-loading").removeClass("jstree-loading"),t.append(r).children("ul").find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS"}).prepend("<ins class='jstree-icon'>&#160;<\/ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),t.removeData("jstree-is-loading")):this.get_container().children("ul").empty().append(r.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS"}).prepend("<ins class='jstree-icon'>&#160;<\/ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),this.clean_node(t),i&&i.call(this)):t&&t!==-1?(t.children("a.jstree-loading").removeClass("jstree-loading"),t.removeData("jstree-is-loading"),u.correct_state&&(this.correct_state(t),i&&i.call(this))):u.correct_state&&(this.get_container().children("ul").empty(),i&&i.call(this))},this));break;case!u.data&&!u.ajax:t&&t!=-1||(this.get_container().children("ul").empty().append(this.data.html_data.original_container_html).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS"}).prepend("<ins class='jstree-icon'>&#160;<\/ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),this.clean_node()),i&&i.call(this);break;case!!u.data&&!u.ajax||!!u.data&&!!u.ajax&&(!t||t===-1):t&&t!=-1||(f=n(u.data),f.is("ul")||(f=n("<ul />").append(f)),this.get_container().children("ul").empty().append(f.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS"}).prepend("<ins class='jstree-icon'>&#160;<\/ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),this.clean_node()),i&&i.call(this);break;case!u.data&&!!u.ajax||!!u.data&&!!u.ajax&&t&&t!==-1:t=this._get_node(t),e=function(n,i,f){var e=this.get_settings().html_data.ajax.error;e&&e.call(this,n,i,f),t!=-1&&t.length?(t.children("a.jstree-loading").removeClass("jstree-loading"),t.removeData("jstree-is-loading"),i==="success"&&u.correct_state&&this.correct_state(t)):i==="success"&&u.correct_state&&this.get_container().children("ul").empty(),r&&r.call(this)},o=function(r,f,o){var s=this.get_settings().html_data.ajax.success;if(s&&(r=s.call(this,r,f,o)||r),r===""||r&&r.toString&&r.toString().replace(/^[\s\n]+$/,"")==="")return e.call(this,o,f,"");r?(r=n(r),r.is("ul")||(r=n("<ul />").append(r)),t!=-1&&t?(t.children("a.jstree-loading").removeClass("jstree-loading"),t.append(r).children("ul").find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS"}).prepend("<ins class='jstree-icon'>&#160;<\/ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),t.removeData("jstree-is-loading")):this.get_container().children("ul").empty().append(r.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS"}).prepend("<ins class='jstree-icon'>&#160;<\/ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),this.clean_node(t),i&&i.call(this)):t&&t!==-1?(t.children("a.jstree-loading").removeClass("jstree-loading"),t.removeData("jstree-is-loading"),u.correct_state&&(this.correct_state(t),i&&i.call(this))):u.correct_state&&(this.get_container().children("ul").empty(),i&&i.call(this))},u.ajax.context=this,u.ajax.error=e,u.ajax.success=o,u.ajax.dataType||(u.ajax.dataType="html"),n.isFunction(u.ajax.url)&&(u.ajax.url=u.ajax.url.call(this,t)),n.isFunction(u.ajax.data)&&(u.ajax.data=u.ajax.data.call(this,t)),n.ajax(u.ajax)}}}}),n.jstree.defaults.plugins.push("html_data")}(n),function(n){n.jstree.plugin("themeroller",{__init:function(){var t=this._get_settings().themeroller;this.get_container().addClass("ui-widget-content").addClass("jstree-themeroller").delegate("a","mouseenter.jstree",function(i){n(i.currentTarget).hasClass("jstree-loading")||n(this).addClass(t.item_h)}).delegate("a","mouseleave.jstree",function(){n(this).removeClass(t.item_h)}).bind("init.jstree",n.proxy(function(n,t){t.inst.get_container().find("> ul > li > .jstree-loading > ins").addClass("ui-icon-refresh"),this._themeroller(t.inst.get_container().find("> ul > li"))},this)).bind("open_node.jstree create_node.jstree",n.proxy(function(n,t){this._themeroller(t.rslt.obj)},this)).bind("loaded.jstree refresh.jstree",n.proxy(function(){this._themeroller()},this)).bind("close_node.jstree",n.proxy(function(n,t){this._themeroller(t.rslt.obj)},this)).bind("delete_node.jstree",n.proxy(function(n,t){this._themeroller(t.rslt.parent)},this)).bind("correct_state.jstree",n.proxy(function(n,i){i.rslt.obj.children("ins.jstree-icon").removeClass(t.opened+" "+t.closed+" ui-icon").end().find("> a > ins.ui-icon").filter(function(){return this.className.toString().replace(t.item_clsd,"").replace(t.item_open,"").replace(t.item_leaf,"").indexOf("ui-icon-")===-1}).removeClass(t.item_open+" "+t.item_clsd).addClass(t.item_leaf||"jstree-no-icon")},this)).bind("select_node.jstree",n.proxy(function(n,i){i.rslt.obj.children("a").addClass(t.item_a)},this)).bind("deselect_node.jstree deselect_all.jstree",n.proxy(function(){this.get_container().find("a."+t.item_a).removeClass(t.item_a).end().find("a.jstree-clicked").addClass(t.item_a)},this)).bind("dehover_node.jstree",n.proxy(function(n,i){i.rslt.obj.children("a").removeClass(t.item_h)},this)).bind("hover_node.jstree",n.proxy(function(n,i){this.get_container().find("a."+t.item_h).not(i.rslt.obj).removeClass(t.item_h),i.rslt.obj.children("a").addClass(t.item_h)},this)).bind("move_node.jstree",n.proxy(function(n,t){this._themeroller(t.rslt.o),this._themeroller(t.rslt.op)},this))},__destroy:function(){var i=this._get_settings().themeroller,t=["ui-icon"];n.each(i,function(n,i){i=i.split(" "),i.length&&(t=t.concat(i))}),this.get_container().removeClass("ui-widget-content").find("."+t.join(", .")).removeClass(t.join(" "))},_fn:{_themeroller:function(n){var t=this._get_settings().themeroller;n=!n||n==-1?this.get_container_ul():this._get_node(n).parent(),n.find("li.jstree-closed").children("ins.jstree-icon").removeClass(t.opened).addClass("ui-icon "+t.closed).end().children("a").addClass(t.item).children("ins.jstree-icon").addClass("ui-icon").filter(function(){return this.className.toString().replace(t.item_clsd,"").replace(t.item_open,"").replace(t.item_leaf,"").indexOf("ui-icon-")===-1}).removeClass(t.item_leaf+" "+t.item_open).addClass(t.item_clsd||"jstree-no-icon").end().end().end().end().find("li.jstree-open").children("ins.jstree-icon").removeClass(t.closed).addClass("ui-icon "+t.opened).end().children("a").addClass(t.item).children("ins.jstree-icon").addClass("ui-icon").filter(function(){return this.className.toString().replace(t.item_clsd,"").replace(t.item_open,"").replace(t.item_leaf,"").indexOf("ui-icon-")===-1}).removeClass(t.item_leaf+" "+t.item_clsd).addClass(t.item_open||"jstree-no-icon").end().end().end().end().find("li.jstree-leaf").children("ins.jstree-icon").removeClass(t.closed+" ui-icon "+t.opened).end().children("a").addClass(t.item).children("ins.jstree-icon").addClass("ui-icon").filter(function(){return this.className.toString().replace(t.item_clsd,"").replace(t.item_open,"").replace(t.item_leaf,"").indexOf("ui-icon-")===-1}).removeClass(t.item_clsd+" "+t.item_open).addClass(t.item_leaf||"jstree-no-icon")}},defaults:{opened:"ui-icon-triangle-1-se",closed:"ui-icon-triangle-1-e",item:"ui-state-default",item_h:"ui-state-hover",item_a:"ui-state-active",item_open:"ui-icon-folder-open",item_clsd:"ui-icon-folder-collapsed",item_leaf:"ui-icon-document"}}),n(function(){n.vakata.css.add_sheet({str:".jstree-themeroller .ui-icon { overflow:visible; } .jstree-themeroller a { padding:0 2px; } .jstree-themeroller .jstree-no-icon { display:none; }",title:"jstree"})})}(n),function(n){n.jstree.plugin("unique",{__init:function(){this.get_container().bind("before.jstree",n.proxy(function(t,i){var u=[],f=!0,r,e;return i.func=="move_node"&&i.args[4]===!0&&i.args[0].o&&i.args[0].o.length&&(i.args[0].o.children("a").each(function(){u.push(n(this).text().replace(/^\s+/g,""))}),f=this._check_unique(u,i.args[0].np.find("> ul > li").not(i.args[0].o),"move_node")),i.func=="create_node"&&(i.args[4]||this._is_loaded(i.args[0]))&&(r=this._get_node(i.args[0]),i.args[1]&&(i.args[1]==="before"||i.args[1]==="after")&&(r=this._get_parent(i.args[0]),r&&r!==-1||(r=this.get_container())),typeof i.args[2]=="string"?u.push(i.args[2]):i.args[2]&&i.args[2].data?u.push(i.args[2].data):u.push(this._get_string("new_node")),f=this._check_unique(u,r.find("> ul > li"),"create_node")),i.func=="rename_node"&&(u.push(i.args[1]),e=this._get_node(i.args[0]),r=this._get_parent(e),r&&r!==-1||(r=this.get_container()),f=this._check_unique(u,r.find("> ul > li").not(e),"rename_node")),f?void 0:(t.stopPropagation(),!1)},this))},defaults:{error_callback:n.noop},_fn:{_check_unique:function(t,i,r){var u=[];return(i.children("a").each(function(){u.push(n(this).text().replace(/^\s+/g,""))}),!u.length||!t.length)?!0:(u=u.sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(","),u.length+t.length!=u.concat(t).sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(",").length)?(this._get_settings().unique.error_callback.call(null,t,i,r),!1):!0},check_move:function(){if(!this.__call_old())return!1;var t=this._get_move(),i=[];return t.o&&t.o.length?(t.o.children("a").each(function(){i.push(n(this).text().replace(/^\s+/g,""))}),this._check_unique(i,t.np.find("> ul > li").not(t.o),"check_move")):!0}}})}(n),function(n){n.jstree.plugin("wholerow",{__init:function(){if(!this.data.ui)throw"jsTree wholerow: jsTree UI plugin not included.";this.data.wholerow.html=!1,this.data.wholerow.to=!1,this.get_container().bind("init.jstree",n.proxy(function(){this._get_settings().core.animation=0},this)).bind("open_node.jstree create_node.jstree clean_node.jstree loaded.jstree",n.proxy(function(n,t){this._prepare_wholerow_span(t&&t.rslt&&t.rslt.obj?t.rslt.obj:-1)},this)).bind("search.jstree clear_search.jstree reopen.jstree after_open.jstree after_close.jstree create_node.jstree delete_node.jstree clean_node.jstree",n.proxy(function(n,t){this.data.to&&clearTimeout(this.data.to),this.data.to=setTimeout(function(n,t){return function(){n._prepare_wholerow_ul(t)}}(this,t&&t.rslt&&t.rslt.obj?t.rslt.obj:-1),0)},this)).bind("deselect_all.jstree",n.proxy(function(){this.get_container().find(" > .jstree-wholerow .jstree-clicked").removeClass("jstree-clicked "+(this.data.themeroller?this._get_settings().themeroller.item_a:""))},this)).bind("select_node.jstree deselect_node.jstree ",n.proxy(function(t,i){i.rslt.obj.each(function(){var t=i.inst.get_container().find(" > .jstree-wholerow li:visible:eq("+parseInt((n(this).offset().top-i.inst.get_container().offset().top+i.inst.get_container()[0].scrollTop)/i.inst.data.core.li_height,10)+")");t.children("a").attr("class",i.rslt.obj.children("a").attr("class"))})},this)).bind("hover_node.jstree dehover_node.jstree",n.proxy(function(n,t){if(this.get_container().find(" > .jstree-wholerow .jstree-hovered").removeClass("jstree-hovered "+(this.data.themeroller?this._get_settings().themeroller.item_h:"")),n.type==="hover_node"){var i=this.get_container().find(" > .jstree-wholerow li:visible:eq("+parseInt((t.rslt.obj.offset().top-this.get_container().offset().top+this.get_container()[0].scrollTop)/this.data.core.li_height,10)+")");i.children("a").attr("class",t.rslt.obj.children(".jstree-hovered").attr("class"))}},this)).delegate(".jstree-wholerow-span, ins.jstree-icon, li","click.jstree",function(t){var i=n(t.currentTarget);t.target.tagName==="A"||t.target.tagName==="INS"&&i.closest("li").is(".jstree-open, .jstree-closed")||(i.closest("li").children("a:visible:eq(0)").click(),t.stopImmediatePropagation())}).delegate("li","mouseover.jstree",n.proxy(function(t){return(t.stopImmediatePropagation(),n(t.currentTarget).children(".jstree-hovered, .jstree-clicked").length)?!1:(this.hover_node(t.currentTarget),!1)},this)).delegate("li","mouseleave.jstree",n.proxy(function(t){n(t.currentTarget).children("a").hasClass("jstree-hovered").length||this.dehover_node(t.currentTarget)},this)),(i||t)&&n.vakata.css.add_sheet({str:".jstree-"+this.get_index()+" { position:relative; } ",title:"jstree"})},defaults:{},__destroy:function(){this.get_container().children(".jstree-wholerow").remove(),this.get_container().find(".jstree-wholerow-span").remove()},_fn:{_prepare_wholerow_span:function(t){(t=!t||t==-1?this.get_container().find("> ul > li"):this._get_node(t),t!==!1)&&t.each(function(){n(this).find("li").andSelf().each(function(){var t=n(this);if(t.children(".jstree-wholerow-span").length)return!0;t.prepend("<span class='jstree-wholerow-span' style='width:"+t.parentsUntil(".jstree","li").length*18+"px;'>&#160;<\/span>")})})},_prepare_wholerow_ul:function(){var n=this.get_container().children("ul").eq(0),t=n.html();n.addClass("jstree-wholerow-real"),this.data.wholerow.last_html!==t&&(this.data.wholerow.last_html=t,this.get_container().children(".jstree-wholerow").remove(),this.get_container().append(n.clone().removeClass("jstree-wholerow-real").wrapAll("<div class='jstree-wholerow' />").parent().width(n.parent()[0].scrollWidth).css("top",(n.height()+(i?5:0))*-1).find("li[id]").each(function(){this.removeAttribute("id")}).end()))}}}),n(function(){var u=".jstree .jstree-wholerow-real { position:relative; z-index:1; } .jstree .jstree-wholerow-real li { cursor:pointer; } .jstree .jstree-wholerow-real a { border-left-color:transparent !important; border-right-color:transparent !important; } .jstree .jstree-wholerow { position:relative; z-index:0; height:0; } .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li { width:100%; } .jstree .jstree-wholerow, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li, .jstree .jstree-wholerow a { margin:0 !important; padding:0 !important; } .jstree .jstree-wholerow, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li { background:transparent !important; }.jstree .jstree-wholerow ins, .jstree .jstree-wholerow span, .jstree .jstree-wholerow input { display:none !important; }.jstree .jstree-wholerow a, .jstree .jstree-wholerow a:hover { text-indent:-9999px; !important; width:100%; padding:0 !important; border-right-width:0px !important; border-left-width:0px !important; } .jstree .jstree-wholerow-span { position:absolute; left:0; margin:0px; padding:0; height:18px; border-width:0; padding:0; z-index:0; }";r&&(u+=".jstree .jstree-wholerow a { display:block; height:18px; margin:0; padding:0; border:0; } .jstree .jstree-wholerow-real a { border-color:transparent !important; } "),(i||t)&&(u+=".jstree .jstree-wholerow, .jstree .jstree-wholerow li, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow a { margin:0; padding:0; line-height:18px; } .jstree .jstree-wholerow a { display:block; height:18px; line-height:18px; overflow:hidden; } "),n.vakata.css.add_sheet({str:u,title:"jstree"})})}(n),function(n){var t=["getChildren","getChildrenCount","getAttr","getName","getProps"],i=function(t,i){var r=!0;return t=t||{},i=[].concat(i),n.each(i,function(i,u){if(!n.isFunction(t[u]))return r=!1,!1}),r};n.jstree.plugin("model",{__init:function(){if(!this.data.json_data)throw"jsTree model: jsTree json_data plugin not included.";this._get_settings().json_data.data=function(r,u){var f=r==-1?this._get_settings().model.object:r.data("jstree_model");if(!i(f,t))return u.call(null,!1);this._get_settings().model.async?f.getChildren(n.proxy(function(n){this.model_done(n,u)},this)):this.model_done(f.getChildren(),u)}},defaults:{object:!1,id_prefix:!1,async:!1},_fn:{model_done:function(t,i){var u=[],r=this._get_settings(),f=this;n.isArray(t)||(t=[t]),n.each(t,function(t,i){var e=i.getProps()||{};e.attr=i.getAttr()||{},i.getChildrenCount()&&(e.state="closed"),e.data=i.getName(),n.isArray(e.data)||(e.data=[e.data]),f.data.types&&n.isFunction(i.getType)&&(e.attr[r.types.type_attr]=i.getType()),e.attr.id&&r.model.id_prefix&&(e.attr.id=r.model.id_prefix+e.attr.id),e.metadata||(e.metadata={}),e.metadata.jstree_model=i,u.push(e)}),i.call(null,u)}}})}(n)}})()}),define("jqgrid",["jquery","jqgrid-locale-"+(window&&window.__DEPS__&&window.__DEPS__.lang||"en"),"jqueryui"],function(t){var u=t,r;(function(t){t.jgrid=t.jgrid||{},t.extend(t.jgrid,{htmlDecode:function(n){return n&&(n=="&nbsp;"||n=="&#160;"||n.length==1&&n.charCodeAt(0)==160)?"":n?String(n).replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"'):n},htmlEncode:function(n){return n?String(n).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\"/g,"&quot;"):n},format:function(n){var i=t.makeArray(arguments).slice(1);return n===undefined&&(n=""),n.replace(/\{(\d+)\}/g,function(n,t){return i[t]})},getCellIndex:function(n){return(n=t(n),n.is("tr"))?-1:(n=(!n.is("td")&&!n.is("th")?n.closest("td,th"):n)[0],t.browser.msie)?t.inArray(n,n.parentNode.cells):n.cellIndex},stripHtml:function(n){n+="";return n?(n=n.replace(/<("[^"]*"|'[^']*'|[^'">])*>/gi,""))&&n!=="&nbsp;"&&n!=="&#160;"?n.replace(/\"/g,"'"):"":n},stringToDoc:function(n){var t;if(typeof n!="string")return n;try{t=(new DOMParser).parseFromString(n,"text/xml")}catch(i){t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(n)}return t&&t.documentElement&&t.documentElement.tagName!="parsererror"?t:null},parse:function(f){return f.substr(0,9)=="while(1);"&&(f=f.substr(9)),f.substr(0,2)=="/*"&&(f=f.substr(2,f.length-4)),f||(f="{}"),t.jgrid.useJSON===!0&&typeof n=="object"&&typeof n.parse=="function"?n.parse(f):eval("("+f+")")},parseDate:function(n,i){var u={m:1,d:1,y:1970,h:0,i:0,s:0},r,o,f;if(r=/[\\\/:_;.,\t\T\s-]/,i&&i!==null&&i!==undefined){i=t.trim(i),i=i.split(r),n=n.split(r);var s=t.jgrid.formatter.date.monthNames,e=t.jgrid.formatter.date.AmPm,h=function(n,t){return n===0?t==12&&(t=0):t!=12&&(t+=12),t};for(r=0,o=n.length;r<o;r++)n[r]=="M"&&(f=t.inArray(i[r],s),f!==-1&&f<12&&(i[r]=f+1)),n[r]=="F"&&(f=t.inArray(i[r],s),f!==-1&&f>11&&(i[r]=f+1-12)),n[r]=="a"&&(f=t.inArray(i[r],e),f!==-1&&f<2&&i[r]==e[f]&&(i[r]=f,u.h=h(i[r],u.h))),n[r]=="A"&&(f=t.inArray(i[r],e),f!==-1&&f>1&&i[r]==e[f]&&(i[r]=f-2,u.h=h(i[r],u.h))),i[r]!==undefined&&(u[n[r].toLowerCase()]=parseInt(i[r],10));u.m=parseInt(u.m,10)-1,r=u.y,r>=70&&r<=99?u.y=1900+u.y:r>=0&&r<=69&&(u.y=2e3+u.y)}return new Date(u.y,u.m,u.d,u.h,u.i,u.s,0)},jqID:function(n){return n+="",n.replace(/([\.\:\[\]])/g,"\\$1")},guid:1,uidPref:"jqg",randId:function(n){return(n?n:t.jgrid.uidPref)+t.jgrid.guid++},getAccessor:function(n,t){var i,u,r=[],f;if(typeof t=="function")return t(n);if(i=n[t],i===undefined)try{if(typeof t=="string"&&(r=t.split(".")),f=r.length)for(i=n;i&&f--;)u=r.shift(),i=i[u]}catch(e){}return i},ajaxOptions:{},from:function(n){return new function(n,i){typeof n=="string"&&(n=t.data(n));var r=this,u=n,l=!0,e=!1,s=i,v=/[\$,%]/g,h=null,y=null,f=!1,a="",o=[],c=!0;if(typeof n=="object"&&n.push)n.length>0&&(c=typeof n[0]!="object"?!1:!0);else throw"data provides is not an array";return this._hasData=function(){return u===null?!1:u.length===0?!1:!0},this._getStr=function(n){var t=[];return e&&t.push("jQuery.trim("),t.push("String("+n+")"),e&&t.push(")"),l||t.push(".toLowerCase()"),t.join("")},this._strComp=function(n){return typeof n=="string"?".toString()":""},this._group=function(n,t){return{field:n.toString(),unique:t,items:[]}},this._toStr=function(n){return e&&(n=t.trim(n)),l||(n=n.toLowerCase()),n.toString().replace(/\\/g,"\\\\").replace(/\"/g,'\\"')},this._funcLoop=function(n){var i=[];return t.each(u,function(t,r){i.push(n(r))}),i},this._append=function(n){s===null?s="":s+=a===""?" && ":a,f&&(s+="!"),s+="("+n+")",f=!1,a=""},this._setCommand=function(n,t){h=n,y=t},this._resetNegate=function(){f=!1},this._repeatCommand=function(n,t){return h===null?r:n!==null&&t!==null?h(n,t):y===null?h(n):c?h(y,n):h(n)},this._equals=function(n,t){return r._compare(n,t,1)===0},this._compare=function(n,t,i){return(i===undefined&&(i=1),n===undefined&&(n=null),t===undefined&&(t=null),n===null&&t===null)?0:n===null&&t!==null?1:n!==null&&t===null?-1:(l||typeof n=="number"||typeof t=="number"||(n=String(n).toLowerCase(),t=String(t).toLowerCase()),n<t)?-i:n>t?i:0},this._performSort=function(){o.length!==0&&(u=r._doSort(u,0))},this._doSort=function(n,t){var u=o[t].by,f=o[t].dir,i=o[t].type,e=o[t].datefmt,s;if(t==o.length-1)return r._getOrder(n,u,f,i,e);for(t++,u=r._getGroup(n,u,f,i,e),f=[],i=0;i<u.length;i++)for(e=r._doSort(u[i].items,t),s=0;s<e.length;s++)f.push(e[s]);return f},this._getOrder=function(n,i,u,f,e){var h=[],s=[],a=u=="a"?1:-1,o,c,l;for(f===undefined&&(f="text"),c=f=="float"||f=="number"||f=="currency"||f=="numeric"?function(n){return n=parseFloat(String(n).replace(v,"")),isNaN(n)?0:n}:f=="int"||f=="integer"?function(n){return n?parseFloat(String(n).replace(v,"")):0}:f=="date"||f=="datetime"?function(n){return t.jgrid.parseDate(e,n).getTime()}:t.isFunction(f)?f:function(n){return n||(n=""),t.trim(String(n).toUpperCase())},t.each(n,function(n,r){o=i!==""?t.jgrid.getAccessor(r,i):r,o===undefined&&(o=""),o=c(o,r),s.push({vSort:o,index:n})}),s.sort(function(n,t){return n=n.vSort,t=t.vSort,r._compare(n,t,a)}),f=0,l=n.length;f<l;)u=s[f].index,h.push(n[u]),f++;return h},this._getGroup=function(n,i,u,f,e){var h=[],o=null,c=null,s;return t.each(r._getOrder(n,i,u,f,e),function(n,u){s=t.jgrid.getAccessor(u,i),s===undefined&&(s=""),r._equals(c,s)||(c=s,o!==null&&h.push(o),o=r._group(i,s)),o.items.push(u)}),o!==null&&h.push(o),h},this.ignoreCase=function(){return l=!1,r},this.useCase=function(){return l=!0,r},this.trim=function(){return e=!0,r},this.noTrim=function(){return e=!1,r},this.execute=function(){var n=s,i=[];return n===null?r:(t.each(u,function(){eval(n)&&i.push(this)}),u=i,r)},this.data=function(){return u},this.select=function(n){if(r._performSort(),!r._hasData())return[];if(r.execute(),t.isFunction(n)){var i=[];return t.each(u,function(t,r){i.push(n(r))}),i}return u},this.hasMatch=function(){return r._hasData()?(r.execute(),u.length>0):!1},this.andNot=function(n,t,i){return f=!f,r.and(n,t,i)},this.orNot=function(n,t,i){return f=!f,r.or(n,t,i)},this.not=function(n,t,i){return r.andNot(n,t,i)},this.and=function(n,t,i){return(a=" && ",n===undefined)?r:r._repeatCommand(n,t,i)},this.or=function(n,t,i){return(a=" || ",n===undefined)?r:r._repeatCommand(n,t,i)},this.isNot=function(n){return f=!f,r.is(n)},this.is=function(n){return r._append("this."+n),r._resetNegate(),r},this._compareValues=function(n,i,u,f,e){var s,o,h;if(s=c?"jQuery.jgrid.getAccessor(this,'"+i+"')":"this",u===undefined&&(u=null),o=u,h=e.stype===undefined?"text":e.stype,u!==null)switch(h){case"int":case"integer":o=isNaN(Number(o))||o===""?"0":o,s="parseInt("+s+",10)",o="parseInt("+o+",10)";break;case"float":case"number":case"numeric":o=String(o).replace(v,""),o=isNaN(Number(o))||o===""?"0":o,s="parseFloat("+s+")",o="parseFloat("+o+")";break;case"date":case"datetime":o=String(t.jgrid.parseDate(e.newfmt||"Y-m-d",o).getTime()),s='jQuery.jgrid.parseDate("'+e.srcfmt+'",'+s+").getTime()";break;default:s=r._getStr(s),o=r._getStr('"'+r._toStr(o)+'"')}return r._append(s+" "+f+" "+o),r._setCommand(n,i),r._resetNegate(),r},this.equals=function(n,t,i){return r._compareValues(r.equals,n,t,"==",i)},this.notEquals=function(n,t,i){return r._compareValues(r.equals,n,t,"!==",i)},this.isNull=function(n,t,i){return r._compareValues(r.equals,n,null,"===",i)},this.greater=function(n,t,i){return r._compareValues(r.greater,n,t,">",i)},this.less=function(n,t,i){return r._compareValues(r.less,n,t,"<",i)},this.greaterOrEquals=function(n,t,i){return r._compareValues(r.greaterOrEquals,n,t,">=",i)},this.lessOrEquals=function(n,t,i){return r._compareValues(r.lessOrEquals,n,t,"<=",i)},this.startsWith=function(n,i){var u=i===undefined||i===null?n:i;return u=e?t.trim(u.toString()).length:u.toString().length,c?r._append(r._getStr("jQuery.jgrid.getAccessor(this,'"+n+"')")+".substr(0,"+u+") == "+r._getStr('"'+r._toStr(i)+'"')):(u=e?t.trim(i.toString()).length:i.toString().length,r._append(r._getStr("this")+".substr(0,"+u+") == "+r._getStr('"'+r._toStr(n)+'"'))),r._setCommand(r.startsWith,n),r._resetNegate(),r},this.endsWith=function(n,i){var u=i===undefined||i===null?n:i;return u=e?t.trim(u.toString()).length:u.toString().length,c?r._append(r._getStr("jQuery.jgrid.getAccessor(this,'"+n+"')")+".substr("+r._getStr("jQuery.jgrid.getAccessor(this,'"+n+"')")+".length-"+u+","+u+') == "'+r._toStr(i)+'"'):r._append(r._getStr("this")+".substr("+r._getStr("this")+'.length-"'+r._toStr(n)+'".length,"'+r._toStr(n)+'".length) == "'+r._toStr(n)+'"'),r._setCommand(r.endsWith,n),r._resetNegate(),r},this.contains=function(n,t){return c?r._append(r._getStr("jQuery.jgrid.getAccessor(this,'"+n+"')")+'.indexOf("'+r._toStr(t)+'",0) > -1'):r._append(r._getStr("this")+'.indexOf("'+r._toStr(n)+'",0) > -1'),r._setCommand(r.contains,n),r._resetNegate(),r},this.groupBy=function(n,t,i,f){return r._hasData()?r._getGroup(u,n,t,i,f):null},this.orderBy=function(n,i,u,f){return i=i===undefined||i===null?"a":t.trim(i.toString().toLowerCase()),(u===null||u===undefined)&&(u="text"),(f===null||f===undefined)&&(f="Y-m-d"),(i=="desc"||i=="descending")&&(i="d"),(i=="asc"||i=="ascending")&&(i="a"),o.push({by:n,dir:i,type:u,datefmt:f}),r},r}(n,null)},extend:function(n){t.extend(t.fn.jqGrid,n),this.no_legacy_api||t.fn.extend(n)}}),t.fn.jqGrid=function(n){var i,r;if(typeof n=="string"){if(i=t.jgrid.getAccessor(t.fn.jqGrid,n),!i)throw"jqGrid - No such method: "+n;return r=t.makeArray(arguments).slice(1),i.apply(this,r)}return this.each(function(){var u,r,f,o,i,b,kt,ri,c,ui,p,ht,rt,ct,s,e,w,lt,at,ut,ft,l,v,y,vt,fi;if(!this.grid)if(u=t.extend(!0,{url:"",height:150,page:1,rowNum:20,rowTotal:null,records:0,pager:"",pgbuttons:!0,pginput:!0,colModel:[],rowList:[],colNames:[],sortorder:"asc",sortname:"",datatype:"xml",mtype:"GET",altRows:!1,selarrrow:[],savedRow:[],shrinkToFit:!0,xmlReader:{},jsonReader:{},subGrid:!1,subGridModel:[],reccount:0,lastpage:0,lastsort:0,selrow:null,beforeSelectRow:null,onSelectRow:null,onSortCol:null,ondblClickRow:null,onRightClickRow:null,onPaging:null,onSelectAll:null,loadComplete:null,gridComplete:null,loadError:null,loadBeforeSend:null,afterInsertRow:null,beforeRequest:null,onHeaderClick:null,viewrecords:!1,loadonce:!1,multiselect:!1,multikey:!1,editurl:null,search:!1,caption:"",hidegrid:!0,hiddengrid:!1,postData:{},userData:{},treeGrid:!1,treeGridModel:"nested",treeReader:{},treeANode:-1,ExpandColumn:null,tree_root_level:0,prmNames:{page:"page",rows:"rows",sort:"sidx",order:"sord",search:"_search",nd:"nd",id:"id",oper:"oper",editoper:"edit",addoper:"add",deloper:"del",subgridid:"id",npage:null,totalrows:"totalrows"},forceFit:!1,gridstate:"visible",cellEdit:!1,cellsubmit:"remote",nv:0,loadui:"enable",toolbar:[!1,""],scroll:!1,multiboxonly:!1,deselectAfterSort:!0,scrollrows:!1,autowidth:!1,scrollOffset:18,cellLayout:5,subGridWidth:20,multiselectWidth:20,gridview:!1,rownumWidth:25,rownumbers:!1,pagerpos:"center",recordpos:"right",footerrow:!1,userDataOnFooter:!1,hoverrows:!0,altclass:"ui-priority-secondary",viewsortcols:[!1,"vertical",!0],resizeclass:"",autoencode:!1,remapColumns:[],ajaxGridOptions:{},direction:"ltr",toppager:!1,headertitles:!1,scrollTimeout:40,data:[],_index:{},grouping:!1,groupingView:{groupField:[],groupOrder:[],groupText:[],groupColumnShow:[],groupSummary:[],showSummaryOnHide:!1,sortitems:[],sortnames:[],groupDataSorted:!1,summary:[],summaryval:[],plusicon:"ui-icon-circlesmall-plus",minusicon:"ui-icon-circlesmall-minus"},ignoreCase:!1,cmTemplate:{}},t.jgrid.defaults,n||{}),r={headers:[],cols:[],footers:[],dragStart:function(n,i,r){this.resizing={idx:n,startX:i.clientX,sOL:r[0]},this.hDiv.style.cursor="col-resize",this.curGbox=t("#rs_m"+t.jgrid.jqID(u.id),"#gbox_"+t.jgrid.jqID(u.id)),this.curGbox.css({display:"block",left:r[0],top:r[1],height:r[2]}),t.isFunction(u.resizeStart)&&u.resizeStart.call(this,i,n),document.onselectstart=function(){return!1}},dragMove:function(n){var t,i,r;this.resizing&&(t=n.clientX-this.resizing.startX,n=this.headers[this.resizing.idx],i=u.direction==="ltr"?n.width+t:n.width-t,i>33&&(this.curGbox.css({left:this.resizing.sOL+t}),u.forceFit===!0?(r=this.headers[this.resizing.idx+u.nv],t=u.direction==="ltr"?r.width-t:r.width+t,t>33&&(n.newWidth=i,r.newWidth=t)):(this.newWidth=u.direction==="ltr"?u.tblwidth+t:u.tblwidth-t,n.newWidth=i)))},dragEnd:function(){if(this.hDiv.style.cursor="default",this.resizing){var n=this.resizing.idx,i=this.headers[n].newWidth||this.headers[n].width;i=parseInt(i,10),this.resizing=!1,t("#rs_m"+t.jgrid.jqID(u.id)).css("display","none"),u.colModel[n].width=i,this.headers[n].width=i,this.headers[n].el.style.width=i+"px",this.cols[n].style.width=i+"px",this.footers.length>0&&(this.footers[n].style.width=i+"px"),u.forceFit===!0?(i=this.headers[n+u.nv].newWidth||this.headers[n+u.nv].width,this.headers[n+u.nv].width=i,this.headers[n+u.nv].el.style.width=i+"px",this.cols[n+u.nv].style.width=i+"px",this.footers.length>0&&(this.footers[n+u.nv].style.width=i+"px"),u.colModel[n+u.nv].width=i):(u.tblwidth=this.newWidth||u.tblwidth,t("table:first",this.bDiv).css("width",u.tblwidth+"px"),t("table:first",this.hDiv).css("width",u.tblwidth+"px"),this.hDiv.scrollLeft=this.bDiv.scrollLeft,u.footerrow&&(t("table:first",this.sDiv).css("width",u.tblwidth+"px"),this.sDiv.scrollLeft=this.bDiv.scrollLeft)),t.isFunction(u.resizeStop)&&u.resizeStop.call(this,i,n)}this.curGbox=null,document.onselectstart=function(){return!0}},populateVisible:function(){var h,e,i,n,l,o,s,f,c,a;if(r.timer&&clearTimeout(r.timer),r.timer=null,h=t(r.bDiv).height(),h){if(e=t("table:first",r.bDiv),e[0].rows.length)try{n=(i=e[0].rows[1])?t(i).outerHeight()||r.prevRowHeight:r.prevRowHeight}catch(v){n=r.prevRowHeight}n&&(r.prevRowHeight=n,l=u.rowNum,i=r.scrollTop=r.bDiv.scrollTop,o=Math.round(e.position().top)-i,s=o+e.height(),n*=l,s<h&&o<=0&&(u.lastpage===undefined||parseInt((s+i+n-1)/n,10)<=u.lastpage)&&(c=parseInt((h-s+n-1)/n,10),s>=0||c<2||u.scroll===!0?(f=Math.round((s+i)/n)+1,o=-1):o=1),o>0&&(f=parseInt(i/n,10)+1,c=parseInt((i+h)/n,10)+2-f,a=!0),c&&(u.lastpage&&f>u.lastpage||u.lastpage==1||f===u.page&&f===u.lastpage||(r.hDiv.loading?r.timer=setTimeout(r.populateVisible,u.scrollTimeout):(u.page=f,a&&(r.selectionPreserver(e[0]),r.emptyRows(r.bDiv,!1,!1)),r.populate(c)))))}},scrollGrid:function(n){if(u.scroll){var t=r.bDiv.scrollTop;r.scrollTop===undefined&&(r.scrollTop=0),t!=r.scrollTop&&(r.scrollTop=t,r.timer&&clearTimeout(r.timer),r.timer=setTimeout(r.populateVisible,u.scrollTimeout))}r.hDiv.scrollLeft=r.bDiv.scrollLeft,u.footerrow&&(r.sDiv.scrollLeft=r.bDiv.scrollLeft),n.stopPropagation()},selectionPreserver:function(n){var i=n.p,u=i.selrow,r=i.selarrrow?t.makeArray(i.selarrrow):null,e=n.grid.bDiv.scrollLeft,f=i.gridComplete;i.gridComplete=function(){if(i.selrow=null,i.selarrrow=[],i.multiselect&&r&&r.length>0)for(var o=0;o<r.length;o++)r[o]!=u&&t(n).jqGrid("setSelection",r[o],!1);u&&t(n).jqGrid("setSelection",u,!1),n.grid.bDiv.scrollLeft=e,i.gridComplete=f,i.gridComplete&&f()}}},this.tagName!="TABLE")alert("Element is not a table");else{if(t(this).empty().attr("tabindex","1"),this.p=u,this.p.colNames.length===0)for(f=0;f<this.p.colModel.length;f++)this.p.colNames[f]=this.p.colModel[f].label||this.p.colModel[f].name;if(this.p.colNames.length!==this.p.colModel.length)alert(t.jgrid.errors.model);else{var h=t("<div class='ui-jqgrid-view'><\/div>"),k,d=t.browser.msie?!0:!1,yt=t.browser.webkit||t.browser.safari?!0:!1;i=this,i.p.direction=t.trim(i.p.direction.toLowerCase()),t.inArray(i.p.direction,["ltr","rtl"])==-1&&(i.p.direction="ltr"),o=i.p.direction,t(h).insertBefore(this),t(this).appendTo(h).removeClass("scroll"),b=t("<div class='ui-jqgrid ui-widget ui-widget-content ui-corner-all'><\/div>"),t(b).insertBefore(h).attr({id:"gbox_"+this.id,dir:o}),t(h).appendTo(b).attr("id","gview_"+this.id),k=d&&t.browser.version<=6?'<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"><\/iframe>':"",t("<div class='ui-widget-overlay jqgrid-overlay' id='lui_"+this.id+"'><\/div>").append(k).insertBefore(h),t("<div class='loading ui-state-default ui-state-active' id='load_"+this.id+"'>"+this.p.loadtext+"<\/div>").insertBefore(h),t(this).attr({cellspacing:"0",cellpadding:"0",border:"0",role:"grid","aria-multiselectable":!!this.p.multiselect,"aria-labelledby":"gbox_"+this.id});var g=function(n,t){return n=parseInt(n,10),isNaN(n)?t?t:0:n},nt=function(n,u,f,e,o,s){var c=i.p.colModel[n],v=c.align,l='style="',a=c.classes,y=c.name,h=[];return v&&(l+="text-align:"+v+";"),c.hidden===!0&&(l+="display:none;"),u===0?l+="width: "+r.headers[n].width+"px;":c.cellattr&&t.isFunction(c.cellattr)&&(n=c.cellattr.call(i,o,f,e,c,s))&&typeof n=="string"&&(n=n.replace(/style/i,"style").replace(/title/i,"title"),n.indexOf("title")>-1&&(c.title=!1),n.indexOf("class")>-1&&(a=undefined),h=n.split("style"),h.length===2?(h[1]=t.trim(h[1].replace("=","")),(h[1].indexOf("'")===0||h[1].indexOf('"')===0)&&(h[1]=h[1].substring(1)),l+=h[1].replace(/'/gi,'"')):l+='"'),h.length||(h[0]="",l+='"'),l+=(a!==undefined?' class="'+a+'"':"")+(c.title&&f?' title="'+t.jgrid.stripHtml(f)+'"':""),l+=' aria-describedby="'+i.p.id+"_"+y+'"',l+h[0]},dt=function(n){return n===undefined||n===null||n===""?"&#160;":i.p.autoencode?t.jgrid.htmlEncode(n):n+""},gt=function(n,r,u,f,e){var o=i.p.colModel[u];return typeof o.formatter!="undefined"?(n={rowId:n,colModel:o,gid:i.p.id,pos:u},r=t.isFunction(o.formatter)?o.formatter.call(i,r,n,f,e):t.fmatter?t.fn.fmatter(o.formatter,r,n,f,e):dt(r)):r=dt(r),r},pt=function(n,t,i,r,u){return t=gt(n,t,i,u,"add"),'<td role="gridcell" '+nt(i,r,t,u,n,!0)+">"+t+"<\/td>"},ni=function(n,t,r){var u='<input role="checkbox" type="checkbox" id="jqg_'+i.p.id+"_"+n+'" class="cbox" name="jqg_'+i.p.id+"_"+n+'"/>';return'<td role="gridcell" '+nt(t,r,"",null,n,!0)+">"+u+"<\/td>"},ti=function(n,t,i,r){return i=(parseInt(i,10)-1)*parseInt(r,10)+1+t,'<td role="gridcell" class="ui-state-default jqgrid-rownum" '+nt(n,t,i,null,t,!0)+">"+i+"<\/td>"},ii=function(n){for(var t,u=[],f=0,r=0;r<i.p.colModel.length;r++)t=i.p.colModel[r],t.name!=="cb"&&t.name!=="subgrid"&&t.name!=="rn"&&(u[f]=n=="local"?t.name:n=="xml"?t.xmlmap||t.name:t.jsonmap||t.name,f++);return u},et=function(n){var r=i.p.remapColumns;return r&&r.length||(r=t.map(i.p.colModel,function(n,t){return t})),n&&(r=t.map(r,function(t){return t<n?null:t-n})),r},tt=function(n,r,u){if(i.p.deepempty)t("#"+t.jgrid.jqID(i.p.id)+" tbody:first tr:gt(0)").remove();else{var f=t("#"+t.jgrid.jqID(i.p.id)+" tbody:first tr:first")[0];t("#"+t.jgrid.jqID(i.p.id)+" tbody:first").empty().append(f)}r&&i.p.scroll&&(t(">div:first",n).css({height:"auto"}).children("div:first").css({height:0,display:"none"}),n.scrollTop=0),u===!0&&i.p.treeGrid===!0&&(i.p.data=[],i.p._index={})},wt=function(){var f=i.p.data.length,r,n,u;for(r=i.p.rownumbers===!0?1:0,n=i.p.multiselect===!0?1:0,u=i.p.subGrid===!0?1:0,r=i.p.keyIndex===!1||i.p.loadonce===!0?i.p.localReader.id:i.p.colModel[i.p.keyIndex+n+u+r].name,n=0;n<f;n++)u=t.jgrid.getAccessor(i.p.data[n],r),i.p._index[u]=n},bt=function(n,r,u,f,e){var yt=new Date,rt=i.p.datatype!="local"&&i.p.loadonce||i.p.datatype=="xmlstring",ut=i.p.datatype=="local"?"local":"xml",lt,ht,at,ct,st,vt;if(rt&&(i.p.data=[],i.p._index={},i.p.localReader.id="_id_"),i.p.reccount=0,t.isXMLDoc(n)){i.p.treeANode!==-1||i.p.scroll?u=u>1?u:1:(tt(r,!1,!0),u=1);var o,it,b=0,y,l=0,k=0,c=0,p,d=[],g,h={},a,v,s=[],wt=i.p.altRows===!0?" "+i.p.altclass:"";i.p.xmlReader.repeatitems||(d=ii(ut)),p=i.p.keyIndex===!1?i.p.xmlReader.id:i.p.keyIndex,d.length>0&&!isNaN(p)&&(i.p.remapColumns&&i.p.remapColumns.length&&(p=t.inArray(p,i.p.remapColumns)),p=d[p]),ut=(p+"").indexOf("[")===-1?d.length?function(n,i){return t(p,n).text()||i}:function(n,r){return t(i.p.xmlReader.cell,n).eq(p).text()||r}:function(n,t){return n.getAttribute(p.replace(/[\[\]]/g,""))||t},i.p.userData={},t(i.p.xmlReader.page,n).each(function(){i.p.page=this.textContent||this.text||0}),t(i.p.xmlReader.total,n).each(function(){i.p.lastpage=this.textContent||this.text,i.p.lastpage===undefined&&(i.p.lastpage=1)}),t(i.p.xmlReader.records,n).each(function(){i.p.records=this.textContent||this.text||0}),t(i.p.xmlReader.userdata,n).each(function(){i.p.userData[this.getAttribute("name")]=this.textContent||this.text}),(n=t(i.p.xmlReader.root+" "+i.p.xmlReader.row,n))||(n=[]);var nt=n.length,w=0,ft={},ot;if(n&&nt)for(ot=parseInt(i.p.rowNum,10),lt=i.p.scroll?t.jgrid.randId():1,e&&(ot*=e+1),e=t.isFunction(i.p.afterInsertRow),ht="",i.p.grouping&&i.p.groupingView.groupCollapse===!0&&(ht=' style="display:none;"');w<nt;){if(a=n[w],v=ut(a,lt+w),o=u===0?0:u+1,o=(o+w)%2==1?wt:"",s.push("<tr"+ht+' id="'+v+'" tabindex="-1" role="row" class ="ui-widget-content jqgrow ui-row-'+i.p.direction+""+o+'">'),i.p.rownumbers===!0&&(s.push(ti(0,w,i.p.page,i.p.rowNum)),c=1),i.p.multiselect===!0&&(s.push(ni(v,c,w)),l=1),i.p.subGrid===!0&&(s.push(t(i).jqGrid("addSubGridCell",l+c,w+u)),k=1),i.p.xmlReader.repeatitems)g||(g=et(l+k+c)),at=t(i.p.xmlReader.cell,a),t.each(g,function(n){var t=at[this];if(!t)return!1;y=t.textContent||t.text,h[i.p.colModel[n+l+k+c].name]=y,s.push(pt(v,y,n+l+k+c,w+u,a))});else for(o=0;o<d.length;o++)y=t(d[o],a).text(),h[i.p.colModel[o+l+k+c].name]=y,s.push(pt(v,y,o+l+k+c,w+u,a));if(s.push("<\/tr>"),i.p.grouping){for(o=i.p.groupingView.groupField.length,ct=[],st=0;st<o;st++)ct.push(h[i.p.groupingView.groupField[st]]);ft=t(i).jqGrid("groupingPrepare",s,ct,ft,h),s=[]}if((rt||i.p.treeGrid===!0)&&(h._id_=v,i.p.data.push(h),i.p._index[v]=i.p.data.length-1),i.p.gridview===!1&&(t("tbody:first",r).append(s.join("")),e&&i.p.afterInsertRow.call(i,v,h,a),s=[]),h={},b++,w++,b==ot)break}if(i.p.gridview===!0&&(it=i.p.treeANode>-1?i.p.treeANode:0,i.p.grouping?(t(i).jqGrid("groupingRender",ft,i.p.colModel.length),ft=null):i.p.treeGrid===!0&&it>0?t(i.rows[it]).after(s.join("")):t("tbody:first",r).append(s.join(""))),i.p.subGrid===!0)try{t(i).jqGrid("addSubGrid",l+c)}catch(bt){}if(i.p.totaltime=new Date-yt,b>0&&i.p.records===0&&(i.p.records=nt),s=null,i.p.treeGrid===!0)try{t(i).jqGrid("setTreeNode",it+1,b+it+1)}catch(kt){}if(i.p.treeGrid||i.p.scroll||(i.grid.bDiv.scrollTop=0),i.p.reccount=b,i.p.treeANode=-1,i.p.userDataOnFooter&&t(i).jqGrid("footerData","set",i.p.userData,!0),rt&&(i.p.records=nt,i.p.lastpage=Math.ceil(nt/ot)),f||i.updatepager(!1,!0),rt)for(;b<nt;){if(a=n[b],v=ut(a,b),i.p.xmlReader.repeatitems)g||(g=et(l+k+c)),vt=t(i.p.xmlReader.cell,a),t.each(g,function(n){var t=vt[this];if(!t)return!1;y=t.textContent||t.text,h[i.p.colModel[n+l+k+c].name]=y});else for(o=0;o<d.length;o++)y=t(d[o],a).text(),h[i.p.colModel[o+l+k+c].name]=y;h._id_=v,i.p.data.push(h),i.p._index[v]=i.p.data.length-1,h={},b++}}},ot=function(n,r,u,f,e){var ht=new Date,h,g,rt,ft,ut;if(n){i.p.treeANode!==-1||i.p.scroll?u=u>1?u:1:(tt(r,!1,!0),u=1),g=i.p.datatype!="local"&&i.p.loadonce||i.p.datatype=="jsonstring",g&&(i.p.data=[],i.p._index={},i.p.localReader.id="_id_"),i.p.reccount=0,i.p.datatype=="local"?(r=i.p.localReader,h="local"):(r=i.p.jsonReader,h="json");var v=0,l,s,nt=[],y,b=0,k=0,p=0,w,d,a={},it,o,c=[],ct=i.p.altRows===!0?" "+i.p.altclass:"";i.p.page=t.jgrid.getAccessor(n,r.page)||0,w=t.jgrid.getAccessor(n,r.total),i.p.lastpage=w===undefined?1:w,i.p.records=t.jgrid.getAccessor(n,r.records)||0,i.p.userData=t.jgrid.getAccessor(n,r.userdata)||{},r.repeatitems||(y=nt=ii(h)),h=i.p.keyIndex===!1?r.id:i.p.keyIndex,nt.length>0&&!isNaN(h)&&(i.p.remapColumns&&i.p.remapColumns.length&&(h=t.inArray(h,i.p.remapColumns)),h=nt[h]),(d=t.jgrid.getAccessor(n,r.root))||(d=[]),w=d.length,n=0,rt=parseInt(i.p.rowNum,10),ft=i.p.scroll?t.jgrid.randId():1,e&&(rt*=e+1);var lt=t.isFunction(i.p.afterInsertRow),ot={},st="";for(i.p.grouping&&i.p.groupingView.groupCollapse===!0&&(st=' style="display:none;"');n<w;){for(e=d[n],o=t.jgrid.getAccessor(e,h),o===undefined&&(o=ft+n,nt.length===0&&r.cell&&(o=t.jgrid.getAccessor(e,r.cell)[h]||o)),l=u===1?0:u,l=(l+n)%2==1?ct:"",c.push("<tr"+st+' id="'+o+'" tabindex="-1" role="row" class= "ui-widget-content jqgrow ui-row-'+i.p.direction+""+l+'">'),i.p.rownumbers===!0&&(c.push(ti(0,n,i.p.page,i.p.rowNum)),p=1),i.p.multiselect&&(c.push(ni(o,p,n)),b=1),i.p.subGrid&&(c.push(t(i).jqGrid("addSubGridCell",b+p,n+u)),k=1),r.repeatitems&&(r.cell&&(e=t.jgrid.getAccessor(e,r.cell)),y||(y=et(b+k+p))),s=0;s<y.length;s++)l=t.jgrid.getAccessor(e,y[s]),c.push(pt(o,l,s+b+k+p,n+u,e)),a[i.p.colModel[s+b+k+p].name]=l;if(c.push("<\/tr>"),i.p.grouping){for(l=i.p.groupingView.groupField.length,s=[],ut=0;ut<l;ut++)s.push(a[i.p.groupingView.groupField[ut]]);ot=t(i).jqGrid("groupingPrepare",c,s,ot,a),c=[]}if((g||i.p.treeGrid===!0)&&(a._id_=o,i.p.data.push(a),i.p._index[o]=i.p.data.length-1),i.p.gridview===!1&&(t("#"+t.jgrid.jqID(i.p.id)+" tbody:first").append(c.join("")),lt&&i.p.afterInsertRow.call(i,o,a,e),c=[]),a={},v++,n++,v==rt)break}if(i.p.gridview===!0&&(it=i.p.treeANode>-1?i.p.treeANode:0,i.p.grouping?t(i).jqGrid("groupingRender",ot,i.p.colModel.length):i.p.treeGrid===!0&&it>0?t(i.rows[it]).after(c.join("")):t("#"+t.jgrid.jqID(i.p.id)+" tbody:first").append(c.join(""))),i.p.subGrid===!0)try{t(i).jqGrid("addSubGrid",b+p)}catch(at){}if(i.p.totaltime=new Date-ht,v>0&&i.p.records===0&&(i.p.records=w),i.p.treeGrid===!0)try{t(i).jqGrid("setTreeNode",it+1,v+it+1)}catch(vt){}if(i.p.treeGrid||i.p.scroll||(i.grid.bDiv.scrollTop=0),i.p.reccount=v,i.p.treeANode=-1,i.p.userDataOnFooter&&t(i).jqGrid("footerData","set",i.p.userData,!0),g&&(i.p.records=w,i.p.lastpage=Math.ceil(w/rt)),f||i.updatepager(!1,!0),g)for(;v<w&&d[v];){if(e=d[v],o=t.jgrid.getAccessor(e,h),o===undefined&&(o=ft+v,nt.length===0&&r.cell&&(o=t.jgrid.getAccessor(e,r.cell)[h]||o)),e){for(r.repeatitems&&(r.cell&&(e=t.jgrid.getAccessor(e,r.cell)),y||(y=et(b+k+p))),s=0;s<y.length;s++)l=t.jgrid.getAccessor(e,y[s]),a[i.p.colModel[s+b+k+p].name]=l;a._id_=o,i.p.data.push(a),i.p._index[o]=i.p.data.length-1,a={}}v++}}},ei=function(){function w(i){var e=0,u,o,f,s;if(i.groups!==undefined)for(u=0;u<i.groups.length;u++){try{w(i.groups[u])}catch(c){alert(c)}e++}if(i.rules!==undefined){e>0&&(s=n.select(),n=t.jgrid.from(s));try{for(u=0;u<i.rules.length;u++)f=i.rules[u],o=i.groupOp.toString().toUpperCase(),h[f.op]&&f.field&&(e>0&&o&&o==="OR"&&(n=n.or()),n=h[f.op](n,o)(f.field,f.data,r[f.field])),e++}catch(l){alert(l)}}}var f,c=!1,r={},l=[],b=[],a,e,v,s,h,n,u;if(t.isArray(i.p.data))if(s=i.p.grouping?i.p.groupingView:!1,t.each(i.p.colModel,function(){if(e=this.sorttype||"text",e=="date"||e=="datetime"?(this.formatter&&typeof this.formatter=="string"&&this.formatter=="date"?(a=this.formatoptions&&this.formatoptions.srcformat?this.formatoptions.srcformat:t.jgrid.formatter.date.srcformat,v=this.formatoptions&&this.formatoptions.newformat?this.formatoptions.newformat:t.jgrid.formatter.date.newformat):a=v=this.datefmt||"Y-m-d",r[this.name]={stype:e,srcfmt:a,newfmt:v}):r[this.name]={stype:e,srcfmt:"",newfmt:""},i.p.grouping&&this.name==s.groupField[0]){var n=this.name;typeof this.index!="undefined"&&(n=this.index),l[0]=r[n],b.push(n)}c||this.index!=i.p.sortname&&this.name!=i.p.sortname||(f=this.name,c=!0)}),i.p.treeGrid)t(i).jqGrid("SortTree",f,i.p.sortorder,r[f].stype,r[f].srcfmt);else{if(h={eq:function(n){return n.equals},ne:function(n){return n.notEquals},lt:function(n){return n.less},le:function(n){return n.lessOrEquals},gt:function(n){return n.greater},ge:function(n){return n.greaterOrEquals},cn:function(n){return n.contains},nc:function(n,t){return t==="OR"?n.orNot().contains:n.andNot().contains},bw:function(n){return n.startsWith},bn:function(n,t){return t==="OR"?n.orNot().startsWith:n.andNot().startsWith},en:function(n,t){return t==="OR"?n.orNot().endsWith:n.andNot().endsWith},ew:function(n){return n.endsWith},ni:function(n,t){return t==="OR"?n.orNot().equals:n.andNot().equals},"in":function(n){return n.equals},nu:function(n){return n.isNull},nn:function(n,t){return t==="OR"?n.orNot().isNull:n.andNot().isNull}},n=t.jgrid.from(i.p.data),i.p.ignoreCase&&(n=n.ignoreCase()),i.p.search===!0)if(u=i.p.postData.filters,u)typeof u=="string"&&(u=t.jgrid.parse(u)),w(u);else try{n=h[i.p.postData.searchOper](n)(i.p.postData.searchField,i.p.postData.searchString,r[i.p.postData.searchField])}catch(g){}i.p.grouping&&(n.orderBy(b,s.groupOrder[0],l[0].stype,l[0].srcfmt),s.groupDataSorted=!0),f&&i.p.sortorder&&c&&(i.p.sortorder.toUpperCase()=="DESC"?n.orderBy(i.p.sortname,"d",r[f].stype,r[f].srcfmt):n.orderBy(i.p.sortname,"a",r[f].stype,r[f].srcfmt)),u=n.select();var y=parseInt(i.p.rowNum,10),k=u.length,p=parseInt(i.p.page,10),d=Math.ceil(k/y),o={};return u=u.slice((p-1)*y,p*y),r=n=null,o[i.p.localReader.total]=d,o[i.p.localReader.page]=p,o[i.p.localReader.records]=k,o[i.p.localReader.root]=u,u=null,o}},st=function(){if(i.grid.hDiv.loading=!0,!i.p.hiddengrid)switch(i.p.loadui){case"enable":t("#load_"+t.jgrid.jqID(i.p.id)).show();break;case"block":t("#lui_"+t.jgrid.jqID(i.p.id)).show(),t("#load_"+t.jgrid.jqID(i.p.id)).show()}},it=function(){i.grid.hDiv.loading=!1;switch(i.p.loadui){case"enable":t("#load_"+t.jgrid.jqID(i.p.id)).hide();break;case"block":t("#lui_"+t.jgrid.jqID(i.p.id)).hide(),t("#load_"+t.jgrid.jqID(i.p.id)).hide()}},a=function(n){var f,e,o,h;if(!i.grid.hDiv.loading){var c=i.p.scroll&&n===!1,r={},s,u=i.p.prmNames;if(i.p.page<=0&&(i.p.page=1),u.search!==null&&(r[u.search]=i.p.search),u.nd!==null&&(r[u.nd]=(new Date).getTime()),u.rows!==null&&(r[u.rows]=i.p.rowNum),u.page!==null&&(r[u.page]=i.p.page),u.sort!==null&&(r[u.sort]=i.p.sortname),u.order!==null&&(r[u.order]=i.p.sortorder),i.p.rowTotal!==null&&u.totalrows!==null&&(r[u.totalrows]=i.p.rowTotal),f=i.p.loadComplete,e=t.isFunction(f),e||(f=null),o=0,n=n||1,n>1?u.npage!==null?(r[u.npage]=n,o=n-1,n=1):f=function(t){i.p.page++,i.grid.hDiv.loading=!1,e&&i.p.loadComplete.call(i,t),a(n-1)}:u.npage!==null&&delete i.p.postData[u.npage],i.p.grouping&&(t(i).jqGrid("groupingSetup"),i.p.groupingView.groupDataSorted===!0&&(r[u.sort]=i.p.groupingView.groupField[0]+" "+i.p.groupingView.groupOrder[0]+", "+r[u.sort])),t.extend(i.p.postData,r),h=i.p.scroll?i.rows.length-1:1,t.isFunction(i.p.datatype))i.p.datatype.call(i,i.p.postData,"load_"+i.p.id);else{t.isFunction(i.p.beforeRequest)&&i.p.beforeRequest.call(i),s=i.p.datatype.toLowerCase();switch(s){case"json":case"jsonp":case"xml":case"script":t.ajax(t.extend({url:i.p.url,type:i.p.mtype,dataType:s,data:t.isFunction(i.p.serializeGridData)?i.p.serializeGridData.call(i,i.p.postData):i.p.postData,success:function(t){s==="xml"?bt(t,i.grid.bDiv,h,n>1,o):ot(t,i.grid.bDiv,h,n>1,o),f&&f.call(i,t),c&&i.grid.populateVisible(),(i.p.loadonce||i.p.treeGrid)&&(i.p.datatype="local"),it()},error:function(n,r,u){t.isFunction(i.p.loadError)&&i.p.loadError.call(i,n,r,u),it()},beforeSend:function(n){st(),t.isFunction(i.p.loadBeforeSend)&&i.p.loadBeforeSend.call(i,n)}},t.jgrid.ajaxOptions,i.p.ajaxGridOptions));break;case"xmlstring":st(),r=t.jgrid.stringToDoc(i.p.datastr),bt(r,i.grid.bDiv),e&&i.p.loadComplete.call(i,r),i.p.datatype="local",i.p.datastr=null,it();break;case"jsonstring":st(),r=typeof i.p.datastr=="string"?t.jgrid.parse(i.p.datastr):i.p.datastr,ot(r,i.grid.bDiv),e&&i.p.loadComplete.call(i,r),i.p.datatype="local",i.p.datastr=null,it();break;case"local":case"clientside":st(),i.p.datatype="local",r=ei(),ot(r,i.grid.bDiv,h,n>1,o),f&&f.call(i,r),c&&i.grid.populateVisible(),it()}}}};for(k=function(n,r){var h="",u="<table cellspacing='0' cellpadding='0' border='0' style='table-layout:auto;' class='ui-pg-table'><tbody><tr>",e="",s,f,l,v,c=function(n){var r;return(t.isFunction(i.p.onPaging)&&(r=i.p.onPaging.call(i,n)),i.p.selrow=null,i.p.multiselect&&(i.p.selarrrow=[],t("#cb_"+t.jgrid.jqID(i.p.id),i.grid.hDiv).attr("checked",!1)),i.p.savedRow=[],r=="stop")?!1:!0};if(n=n.substr(1),s="pg_"+n,f=n+"_left",l=n+"_center",v=n+"_right",t("#"+t.jgrid.jqID(n)).append("<div id='"+s+"' class='ui-pager-control' role='group'><table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table' style='width:100%;table-layout:fixed;height:100%;' role='row'><tbody><tr><td id='"+f+"' align='left'><\/td><td id='"+l+"' align='center' style='white-space:pre;'><\/td><td id='"+v+"' align='right'><\/td><\/tr><\/tbody><\/table><\/div>").attr("dir","ltr"),i.p.rowList.length>0){for(e="<td dir='"+o+"'>",e+="<select class='ui-pg-selbox' role='listbox'>",f=0;f<i.p.rowList.length;f++)e+='<option role="option" value="'+i.p.rowList[f]+'"'+(i.p.rowNum==i.p.rowList[f]?' selected="selected"':"")+">"+i.p.rowList[f]+"<\/option>";e+="<\/select><\/td>"}o=="rtl"&&(u+=e),i.p.pginput===!0&&(h="<td dir='"+o+"'>"+t.jgrid.format(i.p.pgtext||"","<input class='ui-pg-input' type='text' size='2' maxlength='7' value='0' role='textbox'/>","<span id='sp_1'><\/span>")+"<\/td>"),i.p.pgbuttons===!0?(f=["first"+r,"prev"+r,"next"+r,"last"+r],o=="rtl"&&f.reverse(),u+="<td id='"+f[0]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-first'><\/span><\/td>",u+="<td id='"+f[1]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-prev'><\/span><\/td>",u+=h!==""?"<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'><\/span><\/td>"+h+"<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'><\/span><\/td>":"",u+="<td id='"+f[2]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-next'><\/span><\/td>",u+="<td id='"+f[3]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-end'><\/span><\/td>"):h!==""&&(u+=h),o=="ltr"&&(u+=e),u+="<\/tr><\/tbody><\/table>",i.p.viewrecords===!0&&t("td#"+n+"_"+i.p.recordpos,"#"+s).append("<div dir='"+o+"' style='text-align:"+i.p.recordpos+"' class='ui-paging-info'><\/div>"),t("td#"+n+"_"+i.p.pagerpos,"#"+s).append(u),e=t(".ui-jqgrid").css("font-size")||"11px",t(document.body).append("<div id='testpg' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+e+";visibility:hidden;' ><\/div>"),u=t(u).clone().appendTo("#testpg").width(),t("#testpg").remove(),u>0&&(h!==""&&(u+=50),t("td#"+n+"_"+i.p.pagerpos,"#"+s).width(u)),i.p._nvtd=[],i.p._nvtd[0]=u?Math.floor((i.p.width-u)/2):Math.floor(i.p.width/3),i.p._nvtd[1]=0,u=null,t(".ui-pg-selbox","#"+s).bind("change",function(){return(i.p.page=Math.round(i.p.rowNum*(i.p.page-1)/this.value-.5)+1,i.p.rowNum=this.value,r?t(".ui-pg-selbox",i.p.pager).val(this.value):i.p.toppager&&t(".ui-pg-selbox",i.p.toppager).val(this.value),!c("records"))?!1:(a(),!1)}),i.p.pgbuttons===!0&&(t(".ui-pg-button","#"+s).hover(function(){t(this).hasClass("ui-state-disabled")?this.style.cursor="default":(t(this).addClass("ui-state-hover"),this.style.cursor="pointer")},function(){t(this).hasClass("ui-state-disabled")||(t(this).removeClass("ui-state-hover"),this.style.cursor="default")}),t("#first"+r+", #prev"+r+", #next"+r+", #last"+r,"#"+n).click(function(){var n=g(i.p.page,1),t=g(i.p.lastpage,1),u=!1,o=!0,s=!0,f=!0,e=!0;if(t===0||t===1?e=f=s=o=!1:t>1&&n>=1?n===1?s=o=!1:n>1&&n<t||n===t&&(e=f=!1):t>1&&n===0&&(e=f=!1,n=t-1),this.id==="first"+r&&o&&(i.p.page=1,u=!0),this.id==="prev"+r&&s&&(i.p.page=n-1,u=!0),this.id==="next"+r&&f&&(i.p.page=n+1,u=!0),this.id==="last"+r&&e&&(i.p.page=t,u=!0),u){if(!c(this.id))return!1;a()}return!1})),i.p.pginput===!0&&t("input.ui-pg-input","#"+s).keypress(function(n){return(n.charCode?n.charCode:n.keyCode?n.keyCode:0)==13?(i.p.page=t(this).val()>0?t(this).val():i.p.page,!c("user"))?!1:(a(),!1):this})},kt=function(n,r,u,f){if(i.p.colModel[r].sortable&&!(i.p.savedRow.length>0)){if(u||(i.p.lastsort==r?i.p.sortorder=="asc"?i.p.sortorder="desc":i.p.sortorder=="desc"&&(i.p.sortorder="asc"):i.p.sortorder=i.p.colModel[r].firstsortorder||"asc",i.p.page=1),f)if(i.p.lastsort!=r||i.p.sortorder!=f||u)i.p.sortorder=f;else return;if(u=t("thead:first",i.grid.hDiv).get(0),t("tr th:eq("+i.p.lastsort+") span.ui-grid-ico-sort",u).addClass("ui-state-disabled"),t("tr th:eq("+i.p.lastsort+")",u).attr("aria-selected","false"),t("tr th:eq("+r+") span.ui-icon-"+i.p.sortorder,u).removeClass("ui-state-disabled"),t("tr th:eq("+r+")",u).attr("aria-selected","true"),i.p.viewsortcols[0]||i.p.lastsort!=r&&(t("tr th:eq("+i.p.lastsort+") span.s-ico",u).hide(),t("tr th:eq("+r+") span.s-ico",u).show()),n=n.substring(5),i.p.sortname=i.p.colModel[r].index||n,u=i.p.sortorder,t.isFunction(i.p.onSortCol)&&i.p.onSortCol.call(i,n,r,u)=="stop"){i.p.lastsort=r;return}i.p.datatype=="local"?i.p.deselectAfterSort&&t(i).jqGrid("resetSelection"):(i.p.selrow=null,i.p.multiselect&&t("#cb_"+t.jgrid.jqID(i.p.id),i.grid.hDiv).attr("checked",!1),i.p.selarrrow=[],i.p.savedRow=[]),i.p.scroll&&(u=i.grid.bDiv.scrollLeft,tt(i.grid.bDiv,!0,!1),i.grid.hDiv.scrollLeft=u),i.p.subGrid&&i.p.datatype=="local"&&t("td.sgexpanded","#"+t.jgrid.jqID(i.p.id)).each(function(){t(this).trigger("click")}),a(),i.p.lastsort=r,i.p.sortname!=n&&r&&(i.p.lastsort=r)}},ri=function(n){for(var r={},f=yt?0:i.p.cellLayout,u=r[0]=r[1]=r[2]=0;u<=n;u++)i.p.colModel[u].hidden===!1&&(r[0]+=i.p.colModel[u].width+f);return i.p.direction=="rtl"&&(r[0]=i.p.width-r[0]),r[0]-=i.grid.bDiv.scrollLeft,t(i.grid.cDiv).is(":visible")&&(r[1]+=t(i.grid.cDiv).height()+parseInt(t(i.grid.cDiv).css("padding-top"),10)+parseInt(t(i.grid.cDiv).css("padding-bottom"),10)),i.p.toolbar[0]===!0&&(i.p.toolbar[1]=="top"||i.p.toolbar[1]=="both")&&(r[1]+=t(i.grid.uDiv).height()+parseInt(t(i.grid.uDiv).css("border-top-width"),10)+parseInt(t(i.grid.uDiv).css("border-bottom-width"),10)),i.p.toppager&&(r[1]+=t(i.grid.topDiv).height()+parseInt(t(i.grid.topDiv).css("border-bottom-width"),10)),r[2]+=t(i.grid.bDiv).height()+t(i.grid.hDiv).height(),r},this.p.id=this.id,t.inArray(i.p.multikey,["shiftKey","altKey","ctrlKey"])==-1&&(i.p.multikey=!1),i.p.keyIndex=!1,f=0;f<i.p.colModel.length;f++)i.p.colModel[f]=t.extend(!0,{},i.p.cmTemplate,i.p.colModel[f].template||{},i.p.colModel[f]),i.p.keyIndex===!1&&i.p.colModel[f].key===!0&&(i.p.keyIndex=f);if(i.p.sortorder=i.p.sortorder.toLowerCase(),i.p.grouping===!0&&(i.p.scroll=!1,i.p.rownumbers=!1,i.p.subGrid=!1,i.p.treeGrid=!1,i.p.gridview=!0),this.p.treeGrid===!0){try{t(this).jqGrid("setTreeGrid")}catch(oi){}i.p.datatype!="local"&&(i.p.localReader={id:"_id_"})}if(this.p.subGrid)try{t(i).jqGrid("setSubGrid")}catch(si){}if(this.p.multiselect&&(this.p.colNames.unshift("<input role='checkbox' id='cb_"+this.p.id+"' class='cbox' type='checkbox'/>"),this.p.colModel.unshift({name:"cb",width:yt?i.p.multiselectWidth+i.p.cellLayout:i.p.multiselectWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,align:"center",fixed:!0})),this.p.rownumbers&&(this.p.colNames.unshift(""),this.p.colModel.unshift({name:"rn",width:i.p.rownumWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,align:"center",fixed:!0})),i.p.xmlReader=t.extend(!0,{root:"rows",row:"row",page:"rows>page",total:"rows>total",records:"rows>records",repeatitems:!0,cell:"cell",id:"[id]",userdata:"userdata",subgrid:{root:"rows",row:"row",repeatitems:!0,cell:"cell"}},i.p.xmlReader),i.p.jsonReader=t.extend(!0,{root:"rows",page:"page",total:"total",records:"records",repeatitems:!0,cell:"cell",id:"id",userdata:"userdata",subgrid:{root:"rows",repeatitems:!0,cell:"cell"}},i.p.jsonReader),i.p.localReader=t.extend(!0,{root:"rows",page:"page",total:"total",records:"records",repeatitems:!1,cell:"cell",id:"id",userdata:"userdata",subgrid:{root:"rows",repeatitems:!0,cell:"cell"}},i.p.localReader),i.p.scroll&&(i.p.pgbuttons=!1,i.p.pginput=!1,i.p.rowList=[]),i.p.data.length&&wt(),c="<thead><tr class='ui-jqgrid-labels' role='rowheader'>",p=w="",i.p.shrinkToFit===!0&&i.p.forceFit===!0)for(f=i.p.colModel.length-1;f>=0;f--)if(!i.p.colModel[f].hidden){i.p.colModel[f].resizable=!1;break}for(i.p.viewsortcols[1]=="horizontal"&&(w=" ui-i-asc",p=" ui-i-desc"),ui=d?"class='ui-th-div-ie'":"",w="<span class='s-ico' style='display:none'><span sort='asc' class='ui-grid-ico-sort ui-icon-asc"+w+" ui-state-disabled ui-icon ui-icon-triangle-1-n ui-sort-"+o+"'><\/span>",w+="<span sort='desc' class='ui-grid-ico-sort ui-icon-desc"+p+" ui-state-disabled ui-icon ui-icon-triangle-1-s ui-sort-"+o+"'><\/span><\/span>",f=0;f<this.p.colNames.length;f++)p=i.p.headertitles?' title="'+t.jgrid.stripHtml(i.p.colNames[f])+'"':"",c+="<th id='"+i.p.id+"_"+i.p.colModel[f].name+"' role='columnheader' class='ui-state-default ui-th-column ui-th-"+o+"'"+p+">",p=i.p.colModel[f].index||i.p.colModel[f].name,c+="<div id='jqgh_"+i.p.colModel[f].name+"' "+ui+">"+i.p.colNames[f],i.p.colModel[f].width=i.p.colModel[f].width?parseInt(i.p.colModel[f].width,10):150,typeof i.p.colModel[f].title!="boolean"&&(i.p.colModel[f].title=!0),p==i.p.sortname&&(i.p.lastsort=f),c+=w+"<\/div><\/th>";if(c+="<\/tr><\/thead>",w=null,t(this).append(c),t("thead tr:first th",this).hover(function(){t(this).addClass("ui-state-hover")},function(){t(this).removeClass("ui-state-hover")}),this.p.multiselect&&(lt=[],t("#cb_"+t.jgrid.jqID(i.p.id),this).bind("click",function(){i.p.selarrrow=[],this.checked?(t(i.rows).each(function(n){n>0&&(t(this).hasClass("subgrid")||t(this).hasClass("jqgroup")||t(this).hasClass("ui-state-disabled")||(t("#jqg_"+t.jgrid.jqID(i.p.id)+"_"+t.jgrid.jqID(this.id)).attr("checked","checked"),t(this).addClass("ui-state-highlight").attr("aria-selected","true"),i.p.selarrrow.push(this.id),i.p.selrow=this.id))}),at=!0,lt=[]):(t(i.rows).each(function(n){n>0&&(t(this).hasClass("subgrid")||t(this).hasClass("ui-state-disabled")||(t("#jqg_"+t.jgrid.jqID(i.p.id)+"_"+t.jgrid.jqID(this.id)).removeAttr("checked"),t(this).removeClass("ui-state-highlight").attr("aria-selected","false"),lt.push(this.id)))}),i.p.selrow=null,at=!1),t.isFunction(i.p.onSelectAll)&&i.p.onSelectAll.call(i,at?i.p.selarrrow:lt,at)})),i.p.autowidth===!0&&(c=t(b).innerWidth(),i.p.width=c>0?c:"nw"),function(){var n=0,u=yt?0:i.p.cellLayout,f=0,h,c=i.p.scrollOffset,o,l=!1,a,e=0,v=0,s;t.each(i.p.colModel,function(){typeof this.hidden=="undefined"&&(this.hidden=!1),this.widthOrg=o=g(this.width,0),this.hidden===!1&&(n+=o+u,this.fixed?e+=o+u:f++,v++)}),isNaN(i.p.width)?i.p.width=r.width=n:r.width=i.p.width,i.p.tblwidth=n,i.p.shrinkToFit===!1&&i.p.forceFit===!0&&(i.p.forceFit=!1),i.p.shrinkToFit===!0&&f>0&&(a=r.width-u*f-e,isNaN(i.p.height)||(a-=c,l=!0),n=0,t.each(i.p.colModel,function(t){this.hidden!==!1||this.fixed||(this.width=o=Math.round(a*this.width/(i.p.tblwidth-u*f-e)),n+=o,h=t)}),s=0,l?r.width-e-(n+u*f)!==c&&(s=r.width-e-(n+u*f)-c):l||Math.abs(r.width-e-(n+u*f))===1||(s=r.width-e-(n+u*f)),i.p.colModel[h].width+=s,i.p.tblwidth=n+s+u*f+e,i.p.tblwidth>i.p.width&&(i.p.colModel[h].width-=i.p.tblwidth-parseInt(i.p.width,10),i.p.tblwidth=i.p.width))}(),t(b).css("width",r.width+"px").append("<div class='ui-jqgrid-resize-mark' id='rs_m"+i.p.id+"'>&#160;<\/div>"),t(h).css("width",r.width+"px"),c=t("thead:first",i).get(0),ut="",i.p.footerrow&&(ut+="<table role='grid' style='width:"+i.p.tblwidth+"px' class='ui-jqgrid-ftable' cellspacing='0' cellpadding='0' border='0'><tbody><tr role='row' class='ui-widget-content footrow footrow-"+o+"'>"),h=t("tr:first",c),ft="<tr class='jqgfirstrow' role='row' style='height:auto'>",i.p.disableClick=!1,t("th",h).each(function(n){ht=i.p.colModel[n].width,typeof i.p.colModel[n].resizable=="undefined"&&(i.p.colModel[n].resizable=!0),i.p.colModel[n].resizable?(rt=document.createElement("span"),t(rt).html("&#160;").addClass("ui-jqgrid-resize ui-jqgrid-resize-"+o),t.browser.opera||t(rt).css("cursor","col-resize"),t(this).addClass(i.p.resizeclass)):rt="",t(this).css("width",ht+"px").prepend(rt);var u="";i.p.colModel[n].hidden&&(t(this).css("display","none"),u="display:none;"),ft+="<td role='gridcell' style='height:0px;width:"+ht+"px;"+u+"'><\/td>",r.headers[n]={width:ht,el:this},ct=i.p.colModel[n].sortable,typeof ct!="boolean"&&(ct=i.p.colModel[n].sortable=!0),u=i.p.colModel[n].name,u=="cb"||u=="subgrid"||u=="rn"||i.p.viewsortcols[2]&&t("div",this).addClass("ui-jqgrid-sortable"),ct&&(i.p.viewsortcols[0]?(t("div span.s-ico",this).show(),n==i.p.lastsort&&t("div span.ui-icon-"+i.p.sortorder,this).removeClass("ui-state-disabled")):n==i.p.lastsort&&(t("div span.s-ico",this).show(),t("div span.ui-icon-"+i.p.sortorder,this).removeClass("ui-state-disabled"))),i.p.footerrow&&(ut+="<td role='gridcell' "+nt(n,0,"",null,"",!1)+">&#160;<\/td>")}).mousedown(function(n){var u,o,e,f;if(t(n.target).closest("th>span.ui-jqgrid-resize").length==1){if(u=t.jgrid.getCellIndex(this),i.p.forceFit===!0){for(o=i.p,e=u,f=u+1;f<i.p.colModel.length;f++)if(i.p.colModel[f].hidden!==!0){e=f;break}o.nv=e-u}return r.dragStart(u,n,ri(u)),!1}}).click(function(n){if(i.p.disableClick)return i.p.disableClick=!1;var r="th>div.ui-jqgrid-sortable",u,f;return i.p.viewsortcols[2]||(r="th>div>span>span.ui-grid-ico-sort"),n=t(n.target).closest(r),n.length==1?(r=t.jgrid.getCellIndex(this),i.p.viewsortcols[2]||(u=!0,f=n.attr("sort")),kt(t("div",this)[0].id,r,u,f),!1):void 0}),i.p.sortable&&t.fn.sortable)try{t(i).jqGrid("sortableColumns",h)}catch(hi){}i.p.footerrow&&(ut+="<\/tr><\/tbody><\/table>"),ft+="<\/tr>",this.appendChild(document.createElement("tbody")),t(this).addClass("ui-jqgrid-btable").append(ft),ft=null,h=t("<table class='ui-jqgrid-htable' style='width:"+i.p.tblwidth+"px' role='grid' aria-labelledby='gbox_"+this.id+"' cellspacing='0' cellpadding='0' border='0'><\/table>").append(c),l=i.p.caption&&i.p.hiddengrid===!0?!0:!1,f=t("<div class='ui-jqgrid-hbox"+(o=="rtl"?"-rtl":"")+"'><\/div>"),c=null,r.hDiv=document.createElement("div"),t(r.hDiv).css({width:r.width+"px"}).addClass("ui-state-default ui-jqgrid-hdiv").append(f),t(f).append(h),h=null,l&&t(r.hDiv).hide(),i.p.pager&&(typeof i.p.pager=="string"?i.p.pager.substr(0,1)!="#"&&(i.p.pager="#"+i.p.pager):i.p.pager="#"+t(i.p.pager).attr("id"),t(i.p.pager).css({width:r.width+"px"}).appendTo(b).addClass("ui-state-default ui-jqgrid-pager ui-corner-bottom"),l&&t(i.p.pager).hide(),k(i.p.pager,"")),i.p.cellEdit===!1&&i.p.hoverrows===!0&&t(i).bind("mouseover",function(n){return e=t(n.target).closest("tr.jqgrow"),t(e).attr("class")!=="subgrid"&&t(e).addClass("ui-state-hover"),!1}).bind("mouseout",function(n){return e=t(n.target).closest("tr.jqgrow"),t(e).removeClass("ui-state-hover"),!1}),t(i).before(r.hDiv).click(function(n){if(s=n.target,e=t(s,i.rows).closest("tr.jqgrow"),t(e).length===0||e[0].className.indexOf("ui-state-disabled")>-1)return this;var r=t(s).hasClass("cbox"),u=!0;if(t.isFunction(i.p.beforeSelectRow)&&(u=i.p.beforeSelectRow.call(i,e[0].id,n)),s.tagName=="A"||(s.tagName=="INPUT"||s.tagName=="TEXTAREA"||s.tagName=="OPTION"||s.tagName=="SELECT")&&!r)return this;if(u===!0){if(i.p.cellEdit===!0)if(i.p.multiselect&&r)t(i).jqGrid("setSelection",e[0].id,!0);else{v=e[0].rowIndex,y=t.jgrid.getCellIndex(s);try{t(i).jqGrid("editCell",v,y,!0)}catch(f){}}else i.p.multikey?n[i.p.multikey]?t(i).jqGrid("setSelection",e[0].id,!0):i.p.multiselect&&r&&(r=t("[id^=jqg_"+t.jgrid.jqID(i.p.id)+"_]").attr("checked"),t("[id^=jqg_"+t.jgrid.jqID(i.p.id)+"_]").attr("checked",!r)):(i.p.multiselect&&i.p.multiboxonly&&(r||(t(i.p.selarrrow).each(function(n,r){var u=i.rows.namedItem(r);t(u).removeClass("ui-state-highlight"),t("#jqg_"+t.jgrid.jqID(i.p.id)+"_"+t.jgrid.jqID(r)).attr("checked",!1)}),i.p.selarrrow=[],t("#cb_"+t.jgrid.jqID(i.p.id),i.grid.hDiv).attr("checked",!1))),t(i).jqGrid("setSelection",e[0].id,!0));t.isFunction(i.p.onCellSelect)&&(v=e[0].id,y=t.jgrid.getCellIndex(s),i.p.onCellSelect.call(i,v,y,t(s).html(),n)),n.stopPropagation()}else return this}).bind("reloadGrid",function(n,r){if(i.p.treeGrid===!0&&(i.p.datatype=i.p.treedatatype),r&&r.current&&i.grid.selectionPreserver(i),i.p.datatype=="local"?(t(i).jqGrid("resetSelection"),i.p.data.length&&wt()):i.p.treeGrid||(i.p.selrow=null,i.p.multiselect&&(i.p.selarrrow=[],t("#cb_"+t.jgrid.jqID(i.p.id),i.grid.hDiv).attr("checked",!1)),i.p.savedRow=[]),i.p.scroll&&tt(i.grid.bDiv,!0,!1),r&&r.page){var u=r.page;u>i.p.lastpage&&(u=i.p.lastpage),u<1&&(u=1),i.p.page=u,i.grid.bDiv.scrollTop=i.grid.prevRowHeight?(u-1)*i.grid.prevRowHeight*i.p.rowNum:0}return i.grid.prevRowHeight&&i.p.scroll?(delete i.p.lastpage,i.grid.populateVisible()):i.grid.populate(),!1}),t.isFunction(this.p.ondblClickRow)&&t(this).dblclick(function(n){return(s=n.target,e=t(s,i.rows).closest("tr.jqgrow"),t(e).length===0)?!1:(v=e[0].rowIndex,y=t.jgrid.getCellIndex(s),i.p.ondblClickRow.call(i,t(e).attr("id"),v,y,n),!1)}),t.isFunction(this.p.onRightClickRow)&&t(this).bind("contextmenu",function(n){return(s=n.target,e=t(s,i.rows).closest("tr.jqgrow"),t(e).length===0)?!1:(i.p.multiselect||t(i).jqGrid("setSelection",e[0].id,!0),v=e[0].rowIndex,y=t.jgrid.getCellIndex(s),i.p.onRightClickRow.call(i,t(e).attr("id"),v,y,n),!1)}),r.bDiv=document.createElement("div"),d&&String(i.p.height).toLowerCase()==="auto"&&(i.p.height="100%"),t(r.bDiv).append(t('<div style="position:relative;'+(d&&t.browser.version<8?"height:0.01%;":"")+'"><\/div>').append("<div><\/div>").append(this)).addClass("ui-jqgrid-bdiv").css({height:i.p.height+(isNaN(i.p.height)?"":"px"),width:r.width+"px"}).scroll(r.scrollGrid),t("table:first",r.bDiv).css({width:i.p.tblwidth+"px"}),d?(t("tbody",this).size()==2&&t("tbody:gt(0)",this).remove(),i.p.multikey&&t(r.bDiv).bind("selectstart",function(){return!1})):i.p.multikey&&t(r.bDiv).bind("mousedown",function(){return!1}),l&&t(r.bDiv).hide(),r.cDiv=document.createElement("div"),vt=i.p.hidegrid===!0?t("<a role='link' href='javascript:void(0)'/>").addClass("ui-jqgrid-titlebar-close HeaderButton").hover(function(){vt.addClass("ui-state-hover")},function(){vt.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-circle-triangle-n'><\/span>").css(o=="rtl"?"left":"right","0px"):"",t(r.cDiv).append(vt).append("<span class='ui-jqgrid-title"+(o=="rtl"?"-rtl":"")+"'>"+i.p.caption+"<\/span>").addClass("ui-jqgrid-titlebar ui-widget-header ui-corner-top ui-helper-clearfix"),t(r.cDiv).insertBefore(r.hDiv),i.p.toolbar[0]&&(r.uDiv=document.createElement("div"),i.p.toolbar[1]=="top"?t(r.uDiv).insertBefore(r.hDiv):i.p.toolbar[1]=="bottom"&&t(r.uDiv).insertAfter(r.hDiv),i.p.toolbar[1]=="both"?(r.ubDiv=document.createElement("div"),t(r.uDiv).insertBefore(r.hDiv).addClass("ui-userdata ui-state-default").attr("id","t_"+this.id),t(r.ubDiv).insertAfter(r.hDiv).addClass("ui-userdata ui-state-default").attr("id","tb_"+this.id),l&&t(r.ubDiv).hide()):t(r.uDiv).width(r.width).addClass("ui-userdata ui-state-default").attr("id","t_"+this.id),l&&t(r.uDiv).hide()),i.p.toppager&&(i.p.toppager=t.jgrid.jqID(i.p.id)+"_toppager",r.topDiv=t("<div id='"+i.p.toppager+"'><\/div>")[0],i.p.toppager="#"+i.p.toppager,t(r.topDiv).insertBefore(r.hDiv).addClass("ui-state-default ui-jqgrid-toppager").width(r.width),k(i.p.toppager,"_t")),i.p.footerrow&&(r.sDiv=t("<div class='ui-jqgrid-sdiv'><\/div>")[0],f=t("<div class='ui-jqgrid-hbox"+(o=="rtl"?"-rtl":"")+"'><\/div>"),t(r.sDiv).append(f).insertAfter(r.hDiv).width(r.width),t(f).append(ut),r.footers=t(".ui-jqgrid-ftable",r.sDiv)[0].rows[0].cells,i.p.rownumbers&&(r.footers[0].className="ui-state-default jqgrid-rownum"),l&&t(r.sDiv).hide()),f=null,i.p.caption?(fi=i.p.datatype,i.p.hidegrid===!0&&(t(".ui-jqgrid-titlebar-close",r.cDiv).click(function(n){var e=t.isFunction(i.p.onHeaderClick),u=".ui-jqgrid-bdiv, .ui-jqgrid-hdiv, .ui-jqgrid-pager, .ui-jqgrid-sdiv",f,o=this;return i.p.toolbar[0]===!0&&(i.p.toolbar[1]=="both"&&(u+=", #"+t(r.ubDiv).attr("id")),u+=", #"+t(r.uDiv).attr("id")),f=t(u,"#gview_"+t.jgrid.jqID(i.p.id)).length,i.p.gridstate=="visible"?t(u,"#gbox_"+t.jgrid.jqID(i.p.id)).slideUp("fast",function(){f--,f===0&&(t("span",o).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),i.p.gridstate="hidden",t("#gbox_"+t.jgrid.jqID(i.p.id)).hasClass("ui-resizable")&&t(".ui-resizable-handle","#gbox_"+t.jgrid.jqID(i.p.id)).hide(),e&&(l||i.p.onHeaderClick.call(i,i.p.gridstate,n)))}):i.p.gridstate=="hidden"&&t(u,"#gbox_"+t.jgrid.jqID(i.p.id)).slideDown("fast",function(){f--,f===0&&(t("span",o).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n"),l&&(i.p.datatype=fi,a(),l=!1),i.p.gridstate="visible",t("#gbox_"+t.jgrid.jqID(i.p.id)).hasClass("ui-resizable")&&t(".ui-resizable-handle","#gbox_"+t.jgrid.jqID(i.p.id)).show(),e&&(l||i.p.onHeaderClick.call(i,i.p.gridstate,n)))}),!1}),l&&(i.p.datatype="local",t(".ui-jqgrid-titlebar-close",r.cDiv).trigger("click")))):t(r.cDiv).hide(),t(r.hDiv).after(r.bDiv).mousemove(function(n){if(r.resizing)return r.dragMove(n),!1}),t(".ui-jqgrid-labels",r.hDiv).bind("selectstart",function(){return!1}),t(document).mouseup(function(){return r.resizing?(r.dragEnd(),!1):!0}),i.formatCol=nt,i.sortData=kt,i.updatepager=function(n,r){var u,o,f,c,s,l,h,e="";f=parseInt(i.p.page,10)-1,f<0&&(f=0),f*=parseInt(i.p.rowNum,10),s=f+i.p.reccount,i.p.scroll&&(u=t("tbody:first > tr:gt(0)",i.grid.bDiv),f=s-u.length,i.p.reccount=u.length,(o=u.outerHeight()||i.grid.prevRowHeight)&&(u=f*o,o*=parseInt(i.p.records,10),t(">div:first",i.grid.bDiv).css({height:o}).children("div:first").css({height:u,display:u?"":"none"})),i.grid.bDiv.scrollLeft=i.grid.hDiv.scrollLeft),e=i.p.pager?i.p.pager:"",e+=i.p.toppager?e?","+i.p.toppager:i.p.toppager:"",e&&(h=t.jgrid.formatter.integer||{},u=g(i.p.page),o=g(i.p.lastpage),t(".selbox",e).attr("disabled",!1),i.p.pginput===!0&&(t(".ui-pg-input",e).val(i.p.page),t("#sp_1",e).html(t.fmatter?t.fmatter.util.NumberFormat(i.p.lastpage,h):i.p.lastpage)),i.p.viewrecords&&(i.p.reccount===0?t(".ui-paging-info",e).html(i.p.emptyrecords):(c=f+1,l=i.p.records,t.fmatter&&(c=t.fmatter.util.NumberFormat(c,h),s=t.fmatter.util.NumberFormat(s,h),l=t.fmatter.util.NumberFormat(l,h)),t(".ui-paging-info",e).html(t.jgrid.format(i.p.recordtext,c,s,l)))),i.p.pgbuttons===!0&&(u<=0&&(u=o=0),u==1||u===0?(t("#first, #prev",i.p.pager).addClass("ui-state-disabled").removeClass("ui-state-hover"),i.p.toppager&&t("#first_t, #prev_t",i.p.toppager).addClass("ui-state-disabled").removeClass("ui-state-hover")):(t("#first, #prev",i.p.pager).removeClass("ui-state-disabled"),i.p.toppager&&t("#first_t, #prev_t",i.p.toppager).removeClass("ui-state-disabled")),u==o||u===0?(t("#next, #last",i.p.pager).addClass("ui-state-disabled").removeClass("ui-state-hover"),i.p.toppager&&t("#next_t, #last_t",i.p.toppager).addClass("ui-state-disabled").removeClass("ui-state-hover")):(t("#next, #last",i.p.pager).removeClass("ui-state-disabled"),i.p.toppager&&t("#next_t, #last_t",i.p.toppager).removeClass("ui-state-disabled")))),n===!0&&i.p.rownumbers===!0&&t("td.jqgrid-rownum",i.rows).each(function(n){t(this).html(f+1+n)}),r&&i.p.jqgdnd&&t(i).jqGrid("gridDnD","updateDnD"),t.isFunction(i.p.gridComplete)&&i.p.gridComplete.call(i)},i.refreshIndex=wt,i.formatter=function(n,t,i,r,u){return gt(n,t,i,r,u)},t.extend(r,{populate:a,emptyRows:tt}),this.grid=r,i.addXmlData=function(n){bt(n,i.grid.bDiv)},i.addJSONData=function(n){ot(n,i.grid.bDiv)},this.grid.cols=this.rows[0].cells,a(),i.p.hiddengrid=!1,t(window).unload(function(){i=null})}}})},t.jgrid.extend({getGridParam:function(n){var t=this[0];if(t&&t.grid)return n?typeof t.p[n]!="undefined"?t.p[n]:null:t.p},setGridParam:function(n){return this.each(function(){this.grid&&typeof n=="object"&&t.extend(!0,this.p,n)})},getDataIDs:function(){var r=[],n=0,i,u=0;return this.each(function(){if((i=this.rows.length)&&i>0)for(;n<i;)t(this.rows[n]).hasClass("jqgrow")&&(r[u]=this.rows[n].id,u++),n++}),r},setSelection:function(n,i){return this.each(function(){function o(n){var f=t(r.grid.bDiv)[0].clientHeight,i=t(r.grid.bDiv)[0].scrollTop,u=r.rows[n].offsetTop;n=r.rows[n].clientHeight,u+n>=f+i?t(r.grid.bDiv)[0].scrollTop=u-(f+i)+n+i:u<f+i&&u<i&&(t(r.grid.bDiv)[0].scrollTop=u)}var r=this,f,u,e;n!==undefined&&(i=i===!1?!1:!0,u=r.rows.namedItem(n+""),!u||u.className.indexOf("ui-state-disabled")>-1||(r.p.scrollrows===!0&&(f=r.rows.namedItem(n).rowIndex,f>=0&&o(f)),r.p.multiselect?(r.p.selrow=u.id,e=t.inArray(r.p.selrow,r.p.selarrrow),e===-1?(u.className!=="ui-subgrid"&&t(u).addClass("ui-state-highlight").attr("aria-selected","true"),f=!0,t("#jqg_"+t.jgrid.jqID(r.p.id)+"_"+t.jgrid.jqID(r.p.selrow)).attr("checked",f),r.p.selarrrow.push(r.p.selrow)):(u.className!=="ui-subgrid"&&t(u).removeClass("ui-state-highlight").attr("aria-selected","false"),f=!1,t("#jqg_"+t.jgrid.jqID(r.p.id)+"_"+t.jgrid.jqID(r.p.selrow)).attr("checked",f),r.p.selarrrow.splice(e,1),e=r.p.selarrrow[0],r.p.selrow=e===undefined?null:e),r.p.onSelectRow&&i&&r.p.onSelectRow.call(r,u.id,f)):u.className!=="ui-subgrid"&&(r.p.selrow!=u.id?(t(r.rows.namedItem(r.p.selrow)).removeClass("ui-state-highlight").attr({"aria-selected":"false",tabindex:"-1"}),t(u).addClass("ui-state-highlight").attr({"aria-selected":!0,tabindex:"0"}),f=!0):f=!1,r.p.selrow=u.id,r.p.onSelectRow&&i&&r.p.onSelectRow.call(r,u.id,f))))})},resetSelection:function(n){return this.each(function(){var i=this,u,r;typeof n!="undefined"?(r=n===i.p.selrow?i.p.selrow:n,t("#"+t.jgrid.jqID(i.p.id)+" tbody:first tr#"+t.jgrid.jqID(r)).removeClass("ui-state-highlight").attr("aria-selected","false"),i.p.multiselect&&(t("#jqg_"+t.jgrid.jqID(i.p.id)+"_"+t.jgrid.jqID(r)).attr("checked",!1),t("#cb_"+t.jgrid.jqID(i.p.id)).attr("checked",!1)),r=null):i.p.multiselect?(t(i.p.selarrrow).each(function(n,r){u=i.rows.namedItem(r),t(u).removeClass("ui-state-highlight").attr("aria-selected","false"),t("#jqg_"+t.jgrid.jqID(i.p.id)+"_"+t.jgrid.jqID(r)).attr("checked",!1)}),t("#cb_"+t.jgrid.jqID(i.p.id)).attr("checked",!1),i.p.selarrrow=[]):i.p.selrow&&(t("#"+t.jgrid.jqID(i.p.id)+" tbody:first tr#"+t.jgrid.jqID(i.p.selrow)).removeClass("ui-state-highlight").attr("aria-selected","false"),i.p.selrow=null),i.p.savedRow=[]})},getRowData:function(n){var i={},r,u=!1,f,e=0;return this.each(function(){var s=this,o,h;if(typeof n=="undefined")u=!0,r=[],f=s.rows.length;else{if(h=s.rows.namedItem(n),!h)return i;f=2}for(;e<f;)u&&(h=s.rows[e]),t(h).hasClass("jqgrow")&&(t("td",h).each(function(n){if(o=s.p.colModel[n].name,o!=="cb"&&o!=="subgrid"&&o!=="rn")if(s.p.treeGrid===!0&&o==s.p.ExpandColumn)i[o]=t.jgrid.htmlDecode(t("span:first",this).html());else try{i[o]=t.unformat(this,{rowId:h.id,colModel:s.p.colModel[n]},n)}catch(r){i[o]=t.jgrid.htmlDecode(t(this).html())}}),u&&(r.push(i),i={})),e++}),r?r:i},delRowData:function(n){var i=!1,u,r;return this.each(function(){var f,e;if(u=this.rows.namedItem(n))t(u).remove(),this.p.records--,this.p.reccount--,this.updatepager(!0,!1),i=!0,this.p.multiselect&&(r=t.inArray(n,this.p.selarrrow),r!=-1&&this.p.selarrrow.splice(r,1)),n==this.p.selrow&&(this.p.selrow=null);else return!1;this.p.datatype=="local"&&(f=this.p._index[n],typeof f!="undefined"&&(this.p.data.splice(f,1),this.refreshIndex())),this.p.altRows===!0&&i&&(e=this.p.altclass,t(this.rows).each(function(n){n%2==1?t(this).addClass(e):t(this).removeClass(e)}))}),i},setRowData:function(n,i,r){var u,f=!0,e;return this.each(function(){var l,a;if(!this.grid)return!1;var o=this,c,s,v=typeof r,h={};if(s=o.rows.namedItem(n),!s)return!1;if(i)try{if(t(this.p.colModel).each(function(r){u=this.name,i[u]!==undefined&&(h[u]=this.formatter&&typeof this.formatter=="string"&&this.formatter=="date"?t.unformat.date(i[u],this):i[u],c=o.formatter(n,i[u],r,i,"edit"),e=this.title?{title:t.jgrid.stripHtml(c)}:{},o.p.treeGrid===!0&&u==o.p.ExpandColumn?t("td:eq("+r+") > span:first",s).html(c).attr(e):t("td:eq("+r+")",s).html(c).attr(e))}),o.p.datatype=="local"){if(l=o.p._index[n],o.p.treeGrid)for(a in o.p.treeReader)h.hasOwnProperty(o.p.treeReader[a])&&delete h[o.p.treeReader[a]];typeof l!="undefined"&&(o.p.data[l]=t.extend(!0,o.p.data[l],h)),h=null}}catch(y){f=!1}f&&(v==="string"?t(s).addClass(r):v==="object"&&t(s).css(r))}),f},addRowData:function(n,i,r,u){r||(r="last");var d=!1,h,f,c,k,s,o,l,y,a="",p,w,b,e,v;return i&&(t.isArray(i)?(p=!0,r="last",w=n):(i=[i],p=!1),this.each(function(){var it=i.length;s=this.p.rownumbers===!0?1:0,c=this.p.multiselect===!0?1:0,k=this.p.subGrid===!0?1:0,p||(typeof n!="undefined"?n+="":(n=t.jgrid.randId(),this.p.keyIndex!==!1&&(w=this.p.colModel[this.p.keyIndex+c+k+s].name,typeof i[0][w]!="undefined"&&(n=i[0][w])))),b=this.p.altclass;for(var nt=0,tt="",g={},rt=t.isFunction(this.p.afterInsertRow)?!0:!1;nt<it;){if(e=i[nt],f="",p){try{n=e[w]}catch(ut){n=t.jgrid.randId()}tt=this.p.altRows===!0?(this.rows.length-1)%2==0?b:"":""}for(s&&(a=this.formatCol(0,1,"",null,n,!0),f+='<td role="gridcell" aria-describedby="'+this.p.id+'_rn" class="ui-state-default jqgrid-rownum" '+a+">0<\/td>"),c&&(y='<input role="checkbox" type="checkbox" id="jqg_'+this.p.id+"_"+n+'" class="cbox"/>',a=this.formatCol(s,1,"",null,n,!0),f+='<td role="gridcell" aria-describedby="'+this.p.id+'_cb" '+a+">"+y+"<\/td>"),k&&(f+=t(this).jqGrid("addSubGridCell",c+s,1)),l=c+k+s;l<this.p.colModel.length;l++)v=this.p.colModel[l],h=v.name,g[h]=v.formatter&&typeof v.formatter=="string"&&v.formatter=="date"?t.unformat.date(e[h],v):e[h],y=this.formatter(n,t.jgrid.getAccessor(e,h),l,e,"edit"),a=this.formatCol(l,1,y,n,e,!0),f+='<td role="gridcell" aria-describedby="'+this.p.id+"_"+h+'" '+a+">"+y+"<\/td>";if(f='<tr id="'+n+'" role="row" tabindex="-1" class="ui-widget-content jqgrow ui-row-'+this.p.direction+" "+tt+'">'+f+"<\/tr>",this.p.subGrid===!0&&(f=t(f)[0],t(this).jqGrid("addSubGrid",f,c+s)),this.rows.length===0)t("table:first",this.grid.bDiv).append(f);else switch(r){case"last":t(this.rows[this.rows.length-1]).after(f);break;case"first":t(this.rows[0]).after(f);break;case"after":(o=this.rows.namedItem(u))&&(t(this.rows[o.rowIndex+1]).hasClass("ui-subgrid")?t(this.rows[o.rowIndex+1]).after(f):t(o).after(f));break;case"before":(o=this.rows.namedItem(u))&&(t(o).before(f),o=o.rowIndex)}this.p.records++,this.p.reccount++,rt&&this.p.afterInsertRow.call(this,n,e,e),nt++,this.p.datatype=="local"&&(g[this.p.localReader.id]=n,this.p._index[n]=this.p.data.length,this.p.data.push(g),g={})}this.p.altRows!==!0||p||(r=="last"?(this.rows.length-1)%2==1&&t(this.rows[this.rows.length-1]).addClass(b):t(this.rows).each(function(n){n%2==1?t(this).addClass(b):t(this).removeClass(b)})),this.updatepager(!0,!0),d=!0})),d},footerData:function(n,i,r){function s(n){for(var t in n)if(n.hasOwnProperty(t))return!1;return!0}var u,f=!1,e={},o;return typeof n=="undefined"&&(n="get"),typeof r!="boolean"&&(r=!0),n=n.toLowerCase(),this.each(function(){var h=this,c;if(!h.grid||!h.p.footerrow||n=="set"&&s(i))return!1;f=!0,t(this.p.colModel).each(function(s){u=this.name,n=="set"?i[u]!==undefined&&(c=r?h.formatter("",i[u],s,i,"edit"):i[u],o=this.title?{title:t.jgrid.stripHtml(c)}:{},t("tr.footrow td:eq("+s+")",h.grid.sDiv).html(c).attr(o),f=!0):n=="get"&&(e[u]=t("tr.footrow td:eq("+s+")",h.grid.sDiv).html())})}),n=="get"?e:f},showHideCol:function(n,i){return this.each(function(){var r=this,e=!1,o=t.browser.webkit||t.browser.safari?0:r.p.cellLayout,u,f;r.grid&&(typeof n=="string"&&(n=[n]),i=i!="none"?"":"none",f=i===""?!0:!1,t(this.p.colModel).each(function(s){t.inArray(this.name,n)!==-1&&this.hidden===f&&(t("tr",r.grid.hDiv).each(function(){t(this).children("th:eq("+s+")").css("display",i)}),t(r.rows).each(function(){t(this).children("td:eq("+s+")").css("display",i)}),r.p.footerrow&&t(r.grid.sDiv).children("td:eq("+s+")").css("display",i),u=this.widthOrg?this.widthOrg:parseInt(this.width,10),i==="none"?r.p.tblwidth-=u+o:r.p.tblwidth+=u+o,this.hidden=!f,e=!0)}),e===!0&&r.grid.width!==r.p.tblwidth&&t(r).jqGrid("setGridWidth",r.p.shrinkToFit===!0?r.grid.width:r.p.tblwidth,!0))})},hideCol:function(n){return this.each(function(){t(this).jqGrid("showHideCol",n,"none")})},showCol:function(n){return this.each(function(){t(this).jqGrid("showHideCol",n,"")})},remapColumns:function(n,i,r){function f(i){var r;r=i.length?t.makeArray(i):t.extend({},i),t.each(n,function(n){i[n]=r[this]})}function e(i,r){t(">tr"+(r||""),i).each(function(){var i=this,r=t.makeArray(i.cells);t.each(n,function(){var n=r[this];n&&i.appendChild(n)})})}var u=this.get(0);f(u.p.colModel),f(u.p.colNames),f(u.grid.headers),e(t("thead:first",u.grid.hDiv),r&&":not(.ui-jqgrid-labels)"),i&&e(t("#"+t.jgrid.jqID(u.p.id)+" tbody:first"),".jqgfirstrow, tr.jqgrow, tr.jqfoot"),u.p.footerrow&&e(t("tbody:first",u.grid.sDiv)),u.p.remapColumns&&(u.p.remapColumns.length?f(u.p.remapColumns):u.p.remapColumns=t.makeArray(n)),u.p.lastsort=t.inArray(u.p.lastsort,n),u.p.treeGrid&&(u.p.expColInd=t.inArray(u.p.expColInd,n))},setGridWidth:function(n,i){return this.each(function(){var y;if(this.grid){var r=this,u,f=0,e=t.browser.webkit||t.browser.safari?0:r.p.cellLayout,s,o=0,l=!1,a=r.p.scrollOffset,v,h=0,p=0,c;typeof i!="boolean"&&(i=r.p.shrinkToFit),isNaN(n)||(n=parseInt(n,10),r.grid.width=r.p.width=n,t("#gbox_"+t.jgrid.jqID(r.p.id)).css("width",n+"px"),t("#gview_"+t.jgrid.jqID(r.p.id)).css("width",n+"px"),t(r.grid.bDiv).css("width",n+"px"),t(r.grid.hDiv).css("width",n+"px"),r.p.pager&&t(r.p.pager).css("width",n+"px"),r.p.toppager&&t(r.p.toppager).css("width",n+"px"),r.p.toolbar[0]===!0&&(t(r.grid.uDiv).css("width",n+"px"),r.p.toolbar[1]=="both"&&t(r.grid.ubDiv).css("width",n+"px")),r.p.footerrow&&t(r.grid.sDiv).css("width",n+"px"),i===!1&&r.p.forceFit===!0&&(r.p.forceFit=!1),i===!0&&(t.each(r.p.colModel,function(){this.hidden===!1&&(u=this.widthOrg?this.widthOrg:parseInt(this.width,10),f+=u+e,this.fixed?h+=u+e:o++,p++)}),o!==0&&(r.p.tblwidth=f,v=n-e*o-h,isNaN(r.p.height)||(t(r.grid.bDiv)[0].clientHeight<t(r.grid.bDiv)[0].scrollHeight||r.rows.length===1)&&(l=!0,v-=a),f=0,y=r.grid.cols.length>0,t.each(r.p.colModel,function(n){this.hidden!==!1||this.fixed||(u=this.widthOrg?this.widthOrg:parseInt(this.width,10),u=Math.round(v*u/(r.p.tblwidth-e*o-h)),u<0||(this.width=u,f+=u,r.grid.headers[n].width=u,r.grid.headers[n].el.style.width=u+"px",r.p.footerrow&&(r.grid.footers[n].style.width=u+"px"),y&&(r.grid.cols[n].style.width=u+"px"),s=n))}),c=0,l?n-h-(f+e*o)!==a&&(c=n-h-(f+e*o)-a):Math.abs(n-h-(f+e*o))!==1&&(c=n-h-(f+e*o)),r.p.colModel[s].width+=c,r.p.tblwidth=f+c+e*o+h,r.p.tblwidth>n?(l=r.p.tblwidth-parseInt(n,10),r.p.tblwidth=n,u=r.p.colModel[s].width-=l):u=r.p.colModel[s].width,r.grid.headers[s].width=u,r.grid.headers[s].el.style.width=u+"px",y&&(r.grid.cols[s].style.width=u+"px"),t("table:first",r.grid.bDiv).css("width",r.p.tblwidth+"px"),t("table:first",r.grid.hDiv).css("width",r.p.tblwidth+"px"),r.grid.hDiv.scrollLeft=r.grid.bDiv.scrollLeft,r.p.footerrow&&(r.grid.footers[s].style.width=u+"px",t("table:first",r.grid.sDiv).css("width",r.p.tblwidth+"px")))))}})},setGridHeight:function(n){return this.each(function(){this.grid&&(t(this.grid.bDiv).css({height:n+(isNaN(n)?"":"px")}),this.p.height=n,this.p.scroll&&this.grid.populateVisible())})},setCaption:function(n){return this.each(function(){this.p.caption=n,t("span.ui-jqgrid-title",this.grid.cDiv).html(n),t(this.grid.cDiv).show()})},setLabel:function(n,i,r,u){return this.each(function(){var e=-1,f,o;this.grid&&(isNaN(n)?t(this.p.colModel).each(function(t){if(this.name==n)return e=t,!1}):e=parseInt(n,10),e>=0&&(f=t("tr.ui-jqgrid-labels th:eq("+e+")",this.grid.hDiv),i&&(o=t(".s-ico",f),t("[id^=jqgh_]",f).empty().html(i).append(o),this.p.colNames[e]=i),r&&(typeof r=="string"?t(f).addClass(r):t(f).css(r)),typeof u=="object"&&t(f).attr(u)))})},setCell:function(n,i,r,u,f,e){return this.each(function(){var s=-1,o,c,h;this.grid&&(isNaN(i)?t(this.p.colModel).each(function(n){if(this.name==i)return s=n,!1}):s=parseInt(i,10),s>=0&&(o=this.rows.namedItem(n))&&(h=t("td:eq("+s+")",o),(r!==""||e===!0)&&(o=this.formatter(n,r,s,o,"edit"),c=this.p.colModel[s].title?{title:t.jgrid.stripHtml(o)}:{},this.p.treeGrid&&t(".tree-wrap",t(h)).length>0?t("span",t(h)).html(o).attr(c):t(h).html(o).attr(c),this.p.datatype=="local"&&(o=this.p.colModel[s],r=o.formatter&&typeof o.formatter=="string"&&o.formatter=="date"?t.unformat.date(r,o):r,c=this.p._index[n],typeof c!="undefined"&&(this.p.data[c][o.name]=r))),typeof u=="string"?t(h).addClass(u):u&&t(h).css(u),typeof f=="object"&&t(h).attr(f)))})},getCell:function(n,i){var r=!1;return this.each(function(){var u=-1,f;if(this.grid&&(isNaN(i)?t(this.p.colModel).each(function(n){if(this.name===i)return u=n,!1}):u=parseInt(i,10),u>=0&&(f=this.rows.namedItem(n),f)))try{r=t.unformat(t("td:eq("+u+")",f),{rowId:f.id,colModel:this.p.colModel[u]},u)}catch(e){r=t.jgrid.htmlDecode(t("td:eq("+u+")",f).html())}}),r},getCol:function(n,i,r){var u=[],f,s=0,e=0,h=0,o;return i=typeof i!="boolean"?!1:i,typeof r=="undefined"&&(r=!1),this.each(function(){var l=-1,a,c;if(this.grid&&(isNaN(n)?t(this.p.colModel).each(function(t){if(this.name===n)return l=t,!1}):l=parseInt(n,10),l>=0&&(a=this.rows.length,c=0,a&&a>0))){for(;c<a;){if(t(this.rows[c]).hasClass("jqgrow")){try{f=t.unformat(t(this.rows[c].cells[l]),{rowId:this.rows[c].id,colModel:this.p.colModel[l]},l)}catch(v){f=t.jgrid.htmlDecode(this.rows[c].cells[l].innerHTML)}r?(o=parseFloat(f),s+=o,e=Math.min(e,o),h=Math.max(e,o)):i?u.push({id:this.rows[c].id,value:f}):u.push(f)}c++}if(r)switch(r.toLowerCase()){case"sum":u=s;break;case"avg":u=s/a;break;case"count":u=a;break;case"min":u=e;break;case"max":u=h}}}),u},clearGridData:function(n){return this.each(function(){if(this.grid){if(typeof n!="boolean"&&(n=!1),this.p.deepempty)t("#"+t.jgrid.jqID(this.p.id)+" tbody:first tr:gt(0)").remove();else{var i=t("#"+t.jgrid.jqID(this.p.id)+" tbody:first tr:first")[0];t("#"+t.jgrid.jqID(this.p.id)+" tbody:first").empty().append(i)}this.p.footerrow&&n&&t(".ui-jqgrid-ftable td",this.grid.sDiv).html("&#160;"),this.p.selrow=null,this.p.selarrrow=[],this.p.savedRow=[],this.p.records=0,this.p.page=1,this.p.lastpage=0,this.p.reccount=0,this.p.data=[],this.p_index={},this.updatepager(!0,!1)}})},getInd:function(n,t){var r=!1,i;return this.each(function(){(i=this.rows.namedItem(n))&&(r=t===!0?i:i.rowIndex)}),r},bindKeys:function(n){var i=t.extend({onEnter:null,onSpace:null,onLeftKey:null,onRightKey:null,scrollingRows:!0},n||{});return this.each(function(){var n=this;t("body").is("[role]")||t("body").attr("role","application"),n.p.scrollrows=i.scrollingRows,t(n).keydown(function(r){var e=t(n).find("tr[tabindex=0]")[0],f,u,o,s=n.p.treeReader.expanded_field;if(e){if(o=n.p._index[e.id],r.keyCode===37||r.keyCode===38||r.keyCode===39||r.keyCode===40){if(r.keyCode===38){if(u=e.previousSibling,f="",u)if(t(u).is(":hidden")){for(;u;)if(u=u.previousSibling,!t(u).is(":hidden")&&t(u).hasClass("jqgrow")){f=u.id;break}}else f=u.id;t(n).jqGrid("setSelection",f)}if(r.keyCode===40){if(u=e.nextSibling,f="",u)if(t(u).is(":hidden")){for(;u;)if(u=u.nextSibling,!t(u).is(":hidden")&&t(u).hasClass("jqgrow")){f=u.id;break}}else f=u.id;t(n).jqGrid("setSelection",f)}return r.keyCode===37&&(n.p.treeGrid&&n.p.data[o][s]&&t(e).find("div.treeclick").trigger("click"),t.isFunction(i.onLeftKey)&&i.onLeftKey.call(n,n.p.selrow)),r.keyCode===39&&(n.p.treeGrid&&!n.p.data[o][s]&&t(e).find("div.treeclick").trigger("click"),t.isFunction(i.onRightKey)&&i.onRightKey.call(n,n.p.selrow)),!1}if(r.keyCode===13)return t.isFunction(i.onEnter)&&i.onEnter.call(n,n.p.selrow),!1;if(r.keyCode===32)return t.isFunction(i.onSpace)&&i.onSpace.call(n,n.p.selrow),!1}})})},unbindKeys:function(){return this.each(function(){t(this).unbind("keydown")})},getLocalRow:function(n){var i=!1,t;return this.each(function(){typeof n!="undefined"&&(t=this.p._index[n],t>=0&&(i=this.p.data[t]))}),i}})})(t),function(n){n.fmatter={},n.extend(n.fmatter,{isBoolean:function(n){return typeof n=="boolean"},isObject:function(t){return t&&(typeof t=="object"||n.isFunction(t))||!1},isString:function(n){return typeof n=="string"},isNumber:function(n){return typeof n=="number"&&isFinite(n)},isNull:function(n){return n===null},isUndefined:function(n){return typeof n=="undefined"},isValue:function(n){return this.isObject(n)||this.isString(n)||this.isNumber(n)||this.isBoolean(n)},isEmpty:function(t){return!this.isString(t)&&this.isValue(t)?!1:this.isValue(t)?(t=n.trim(t).replace(/\&nbsp\;/ig,"").replace(/\&#160\;/ig,""),t===""):!0}}),n.fn.fmatter=function(t,i,r,u,f){var e=i;return r=n.extend({},n.jgrid.formatter,r),n.fn.fmatter[t]&&(e=n.fn.fmatter[t](i,r,u,f)),e},n.fmatter.util={NumberFormat:function(t,i){var e,s,o;if(n.fmatter.isNumber(t)||(t*=1),n.fmatter.isNumber(t)){var h=t<0,r=t+"",f=i.decimalSeparator?i.decimalSeparator:".",u;if(n.fmatter.isNumber(i.decimalPlaces)&&(e=i.decimalPlaces,r=Math.pow(10,e),r=Math.round(t*r)/r+"",u=r.lastIndexOf("."),e>0))for(u<0?(r+=f,u=r.length-1):f!=="."&&(r=r.replace(".",f));r.length-1-u<e;)r+="0";if(i.thousandsSeparator){for(e=i.thousandsSeparator,u=r.lastIndexOf(f),u=u>-1?u:r.length,f=r.substring(u),s=-1,o=u;o>0;o--)s++,s%3==0&&o!==u&&(!h||o>1)&&(f=e+f),f=r.charAt(o-1)+f;r=f}return r=i.prefix?i.prefix+r:r,i.suffix?r+i.suffix:r}return t},DateFormat:function(t,i,r,u){var s=/^\/Date\((([-+])?[0-9]+)(([-+])([0-9]{2})([0-9]{2}))?\)\/$/,o=typeof i=="string"?i.match(s):null;s=function(n,t){for(n=String(n),t=parseInt(t,10)||2;n.length<t;)n="0"+n;return n};var e={m:1,d:1,y:1970,h:0,i:0,s:0,u:0},f=0,c,h=["i18n"];if(h.i18n={dayNames:u.dayNames,monthNames:u.monthNames},t in u.masks&&(t=u.masks[t]),i.constructor===Number)String(t).toLowerCase()=="u"&&(i*=1e3),f=new Date(i);else if(i.constructor===Date)f=i;else if(o!==null)f=new Date(parseInt(o[1],10)),o[3]&&(t=Number(o[5])*60+Number(o[6]),t*=o[4]=="-"?1:-1,t-=f.getTimezoneOffset(),f.setTime(Number(Number(f)+t*6e4)));else{for(i=String(i).split(/[\\\/:_;.,\t\T\s-]/),t=t.split(/[\\\/:_;.,\t\T\s-]/),o=0,c=t.length;o<c;o++)t[o]=="M"&&(f=n.inArray(i[o],h.i18n.monthNames),f!==-1&&f<12&&(i[o]=f+1)),t[o]=="F"&&(f=n.inArray(i[o],h.i18n.monthNames),f!==-1&&f>11&&(i[o]=f+1-12)),i[o]&&(e[t[o].toLowerCase()]=parseInt(i[o],10));if(e.f&&(e.m=e.f),e.m===0&&e.y===0&&e.d===0)return"&#160;";e.m=parseInt(e.m,10)-1,f=e.y,f>=70&&f<=99?e.y=1900+e.y:f>=0&&f<=69&&(e.y=2e3+e.y),f=new Date(e.y,e.m,e.d,e.h,e.i,e.s,e.u)}r in u.masks?r=u.masks[r]:r||(r="Y-m-d"),t=f.getHours(),i=f.getMinutes(),e=f.getDate(),o=f.getMonth()+1,c=f.getTimezoneOffset();var w=f.getSeconds(),b=f.getMilliseconds(),a=f.getDay(),l=f.getFullYear(),v=(a+6)%7+1,y=(new Date(l,o-1,e)-new Date(l,0,1))/864e5,p={d:s(e),D:h.i18n.dayNames[a],j:e,l:h.i18n.dayNames[a+7],N:v,S:u.S(e),w:a,z:y,W:v<5?Math.floor((y+v-1)/7)+1:Math.floor((y+v-1)/7)||((new Date(l-1,0,1).getDay()+6)%7<4?53:52),F:h.i18n.monthNames[o- -11],m:s(o),M:h.i18n.monthNames[o-1],n:o,t:"?",L:"?",o:"?",Y:l,y:String(l).substring(2),a:t<12?u.AmPm[0]:u.AmPm[1],A:t<12?u.AmPm[2]:u.AmPm[3],B:"?",g:t%12||12,G:t,h:s(t%12||12),H:s(t),i:s(i),s:s(w),u:b,e:"?",I:"?",O:(c>0?"-":"+")+s(Math.floor(Math.abs(c)/60)*100+Math.abs(c)%60,4),P:"?",T:(String(f).match(/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g)||[""]).pop().replace(/[^-+\dA-Z]/g,""),Z:"?",c:"?",r:"?",U:Math.floor(f/1e3)};return r.replace(/\\.|[dDjlNSwzWFmMntLoYyaABgGhHisueIOPTZcrU]/g,function(n){return n in p?p[n]:n.substring(1)})}},n.fn.fmatter.defaultFormat=function(t,i){return n.fmatter.isValue(t)&&t!==""?t:i.defaultValue?i.defaultValue:"&#160;"},n.fn.fmatter.email=function(t,i){return n.fmatter.isEmpty(t)?n.fn.fmatter.defaultFormat(t,i):'<a href="mailto:'+t+'">'+t+"<\/a>"},n.fn.fmatter.checkbox=function(t,i){var r=n.extend({},i.checkbox),u;return n.fmatter.isUndefined(i.colModel.formatoptions)||(r=n.extend({},r,i.colModel.formatoptions)),u=r.disabled===!0?'disabled="disabled"':"",(n.fmatter.isEmpty(t)||n.fmatter.isUndefined(t))&&(t=n.fn.fmatter.defaultFormat(t,r)),t+="",t=t.toLowerCase(),'<input type="checkbox" '+(t.search(/(false|0|no|off)/i)<0?" checked='checked' ":"")+' value="'+t+'" offval="no" '+u+"/>"},n.fn.fmatter.link=function(t,i){var r={target:i.target},u="";return n.fmatter.isUndefined(i.colModel.formatoptions)||(r=n.extend({},r,i.colModel.formatoptions)),r.target&&(u="target="+r.target),n.fmatter.isEmpty(t)?n.fn.fmatter.defaultFormat(t,i):"<a "+u+' href="'+t+'">'+t+"<\/a>"},n.fn.fmatter.showlink=function(t,i){var r={baseLinkUrl:i.baseLinkUrl,showAction:i.showAction,addParam:i.addParam||"",target:i.target,idName:i.idName},u="";return n.fmatter.isUndefined(i.colModel.formatoptions)||(r=n.extend({},r,i.colModel.formatoptions)),r.target&&(u="target="+r.target),r=r.baseLinkUrl+r.showAction+"?"+r.idName+"="+i.rowId+r.addParam,n.fmatter.isString(t)||n.fmatter.isNumber(t)?"<a "+u+' href="'+r+'">'+t+"<\/a>":n.fn.fmatter.defaultFormat(t,i)},n.fn.fmatter.integer=function(t,i){var r=n.extend({},i.integer);return(n.fmatter.isUndefined(i.colModel.formatoptions)||(r=n.extend({},r,i.colModel.formatoptions)),n.fmatter.isEmpty(t))?r.defaultValue:n.fmatter.util.NumberFormat(t,r)},n.fn.fmatter.number=function(t,i){var r=n.extend({},i.number);return(n.fmatter.isUndefined(i.colModel.formatoptions)||(r=n.extend({},r,i.colModel.formatoptions)),n.fmatter.isEmpty(t))?r.defaultValue:n.fmatter.util.NumberFormat(t,r)},n.fn.fmatter.currency=function(t,i){var r=n.extend({},i.currency);return(n.fmatter.isUndefined(i.colModel.formatoptions)||(r=n.extend({},r,i.colModel.formatoptions)),n.fmatter.isEmpty(t))?r.defaultValue:n.fmatter.util.NumberFormat(t,r)},n.fn.fmatter.date=function(t,i,r,u){return r=n.extend({},i.date),n.fmatter.isUndefined(i.colModel.formatoptions)||(r=n.extend({},r,i.colModel.formatoptions)),!r.reformatAfterEdit&&u=="edit"?n.fn.fmatter.defaultFormat(t,i):n.fmatter.isEmpty(t)?n.fn.fmatter.defaultFormat(t,i):n.fmatter.util.DateFormat(r.srcformat,t,r.newformat,r)},n.fn.fmatter.select=function(i,r){var u,e,s,o,f;if(i+="",u=!1,e=[],n.fmatter.isUndefined(r.colModel.formatoptions)?n.fmatter.isUndefined(r.colModel.editoptions)||(u=r.colModel.editoptions.value):u=r.colModel.formatoptions.value,u)if(s=r.colModel.editoptions.multiple===!0?!0:!1,o=[],s&&(o=i.split(","),o=n.map(o,function(t){return n.trim(t)})),n.fmatter.isString(u)){for(var c=u.split(";"),l=0,h=0;h<c.length;h++)if(f=c[h].split(":"),f.length>2&&(f[1]=t.map(f,function(n,t){if(t>0)return n}).join(":")),s)t.inArray(f[0],o)>-1&&(e[l]=f[1],l++);else if(n.trim(f[0])==n.trim(i)){e[0]=f[1];break}}else n.fmatter.isObject(u)&&(s?e=t.map(o,function(n){return u[n]}):e[0]=u[i]||"");return i=e.join(", "),i===""?n.fn.fmatter.defaultFormat(i,r):i},n.fn.fmatter.rowactions=function(t,i,r,u){var f={keys:!1,editbutton:!0,delbutton:!0,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{oper:"edit"},url:null,delOptions:{}},e;u=n("#"+i)[0].p.colModel[u],n.fmatter.isUndefined(u.formatoptions)||(f=n.extend(f,u.formatoptions)),u=function(r){f.afterSave&&f.afterSave(r),n("tr#"+t+" div.ui-inline-edit, tr#"+t+" div.ui-inline-del","#"+i).show(),n("tr#"+t+" div.ui-inline-save, tr#"+t+" div.ui-inline-cancel","#"+i).hide()},e=function(r){f.afterRestore&&f.afterRestore(r),n("tr#"+t+" div.ui-inline-edit, tr#"+t+" div.ui-inline-del","#"+i).show(),n("tr#"+t+" div.ui-inline-save, tr#"+t+" div.ui-inline-cancel","#"+i).hide()};switch(r){case"edit":n("#"+i).jqGrid("editRow",t,f.keys,f.onEdit,f.onSuccess,f.url,f.extraparam,u,f.onError,e),n("tr#"+t+" div.ui-inline-edit, tr#"+t+" div.ui-inline-del","#"+i).hide(),n("tr#"+t+" div.ui-inline-save, tr#"+t+" div.ui-inline-cancel","#"+i).show();break;case"save":n("#"+i).jqGrid("saveRow",t,f.onSuccess,f.url,f.extraparam,u,f.onError,e)&&(n("tr#"+t+" div.ui-inline-edit, tr#"+t+" div.ui-inline-del","#"+i).show(),n("tr#"+t+" div.ui-inline-save, tr#"+t+" div.ui-inline-cancel","#"+i).hide());break;case"cancel":n("#"+i).jqGrid("restoreRow",t,e),n("tr#"+t+" div.ui-inline-edit, tr#"+t+" div.ui-inline-del","#"+i).show(),n("tr#"+t+" div.ui-inline-save, tr#"+t+" div.ui-inline-cancel","#"+i).hide();break;case"del":n("#"+i).jqGrid("delGridRow",t,f.delOptions)}},n.fn.fmatter.actions=function(t,i){var e={keys:!1,editbutton:!0,delbutton:!0},f,r,u;return(n.fmatter.isUndefined(i.colModel.formatoptions)||(e=n.extend(e,i.colModel.formatoptions)),f=i.rowId,r="",typeof f=="undefined"||n.fmatter.isEmpty(f))?"":(e.editbutton&&(u="onclick=$.fn.fmatter.rowactions('"+f+"','"+i.gid+"','edit',"+i.pos+");",r=r+"<div style='margin-left:8px;'><div title='"+n.jgrid.nav.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+u+"><span class='ui-icon ui-icon-pencil'><\/span><\/div>"),e.delbutton&&(u="onclick=$.fn.fmatter.rowactions('"+f+"','"+i.gid+"','del',"+i.pos+");",r=r+"<div title='"+n.jgrid.nav.deltitle+"' style='float:left;margin-left:5px;' class='ui-pg-div ui-inline-del' "+u+"><span class='ui-icon ui-icon-trash'><\/span><\/div>"),u="onclick=$.fn.fmatter.rowactions('"+f+"','"+i.gid+"','save',"+i.pos+");",r=r+"<div title='"+n.jgrid.edit.bSubmit+"' style='float:left;display:none' class='ui-pg-div ui-inline-save'><span class='ui-icon ui-icon-disk' "+u+"><\/span><\/div>",u="onclick=$.fn.fmatter.rowactions('"+f+"','"+i.gid+"','cancel',"+i.pos+");",r+"<div title='"+n.jgrid.edit.bCancel+"' style='float:left;display:none;margin-left:5px;' class='ui-pg-div ui-inline-cancel'><span class='ui-icon ui-icon-cancel' "+u+"><\/span><\/div><\/div>")},n.unformat=function(t,i,r,u){var e,o=i.colModel.formatter,f=i.colModel.formatoptions||{},s=/([\.\*\_\'\(\)\{\}\+\?\\])/g,h=i.colModel.unformat||n.fn.fmatter[o]&&n.fn.fmatter[o].unformat;if(typeof h!="undefined"&&n.isFunction(h))e=h(n(t).text(),i,t);else if(!n.fmatter.isUndefined(o)&&n.fmatter.isString(o)){e=n.jgrid.formatter||{};switch(o){case"integer":f=n.extend({},e.integer,f),i=f.thousandsSeparator.replace(s,"\\$1"),e=n(t).text().replace(RegExp(i,"g"),"");break;case"number":f=n.extend({},e.number,f),i=f.thousandsSeparator.replace(s,"\\$1"),e=n(t).text().replace(RegExp(i,"g"),"").replace(f.decimalSeparator,".");break;case"currency":f=n.extend({},e.currency,f),i=f.thousandsSeparator.replace(s,"\\$1"),e=n(t).text().replace(RegExp(i,"g"),"").replace(f.decimalSeparator,".").replace(f.prefix,"").replace(f.suffix,"");break;case"checkbox":f=i.colModel.editoptions?i.colModel.editoptions.value.split(":"):["Yes","No"],e=n("input",t).attr("checked")?f[0]:f[1];break;case"select":e=n.unformat.select(t,i,r,u);break;case"actions":return"";default:e=n(t).text()}}return e?e:u===!0?n(t).text():n.jgrid.htmlDecode(n(t).html())},n.unformat.select=function(i,r,u,f){var o,e;if(u=[],i=n(i).text(),f===!0)return i;if(r=n.extend({},r.colModel.editoptions),r.value){if(o=r.value,r=r.multiple===!0?!0:!1,f=[],r&&(f=i.split(","),f=n.map(f,function(t){return n.trim(t)})),n.fmatter.isString(o)){for(var h=o.split(";"),c=0,s=0;s<h.length;s++)if(e=h[s].split(":"),e.length>2&&(e[1]=t.map(e,function(n,t){if(t>0)return n}).join(":")),r)t.inArray(e[1],f)>-1&&(u[c]=e[0],c++);else if(n.trim(e[1])==n.trim(i)){u[0]=e[0];break}}else(n.fmatter.isObject(o)||n.isArray(o))&&(r||(f[0]=i),u=t.map(f,function(t){var i;return n.each(o,function(n,r){if(r==t)return i=n,!1}),typeof i!="undefined"?i:void 0}));return u.join(", ")}return i||""},n.unformat.date=function(t,i){var r=n.jgrid.formatter.date||{};return n.fmatter.isUndefined(i.formatoptions)||(r=n.extend({},r,i.formatoptions)),n.fmatter.isEmpty(t)?n.fn.fmatter.defaultFormat(t,i):n.fmatter.util.DateFormat(r.newformat,t,r.srcformat,r)}}(t),function(n){n.jgrid.extend({getColProp:function(n){var r={},t=this[0],i;if(!t.grid)return!1;for(t=t.p.colModel,i=0;i<t.length;i++)if(t[i].name==n){r=t[i];break}return r},setColProp:function(t,i){return this.each(function(){if(this.grid&&i)for(var u=this.p.colModel,r=0;r<u.length;r++)if(u[r].name==t){n.extend(this.p.colModel[r],i);break}})},sortGrid:function(n,t,i){return this.each(function(){var u=-1,r;if(this.grid){for(n||(n=this.p.sortname),r=0;r<this.p.colModel.length;r++)if(this.p.colModel[r].index==n||this.p.colModel[r].name==n){u=r;break}u!=-1&&(r=this.p.colModel[u].sortable,typeof r!="boolean"&&(r=!0),typeof t!="boolean"&&(t=!1),r&&this.sortData("jqgh_"+n,u,t,i))}})},GridDestroy:function(){return this.each(function(){if(this.grid){this.p.pager&&n(this.p.pager).remove();var t=this.id;try{n("#gbox_"+t).remove()}catch(i){}}})},GridUnload:function(){return this.each(function(){var t,i;this.grid&&(t={id:n(this).attr("id"),cl:n(this).attr("class")},this.p.pager&&n(this.p.pager).empty().removeClass("ui-state-default ui-jqgrid-pager corner-bottom"),i=document.createElement("table"),n(i).attr({id:t.id}),i.className=t.cl,t=this.id,n(i).removeClass("ui-jqgrid-btable"),n(this.p.pager).parents("#gbox_"+t).length===1?(n(i).insertBefore("#gbox_"+t).show(),n(this.p.pager).insertBefore("#gbox_"+t)):n(i).insertBefore("#gbox_"+t).show(),n("#gbox_"+t).remove())})},setGridState:function(t){return this.each(function(){this.grid&&(t=="hidden"?(n(".ui-jqgrid-bdiv, .ui-jqgrid-hdiv","#gview_"+this.p.id).slideUp("fast"),this.p.pager&&n(this.p.pager).slideUp("fast"),this.p.toppager&&n(this.p.toppager).slideUp("fast"),this.p.toolbar[0]===!0&&(this.p.toolbar[1]=="both"&&n(this.grid.ubDiv).slideUp("fast"),n(this.grid.uDiv).slideUp("fast")),this.p.footerrow&&n(".ui-jqgrid-sdiv","#gbox_"+this.p.id).slideUp("fast"),n(".ui-jqgrid-titlebar-close span",this.grid.cDiv).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),this.p.gridstate="hidden"):t=="visible"&&(n(".ui-jqgrid-hdiv, .ui-jqgrid-bdiv","#gview_"+this.p.id).slideDown("fast"),this.p.pager&&n(this.p.pager).slideDown("fast"),this.p.toppager&&n(this.p.toppager).slideDown("fast"),this.p.toolbar[0]===!0&&(this.p.toolbar[1]=="both"&&n(this.grid.ubDiv).slideDown("fast"),n(this.grid.uDiv).slideDown("fast")),this.p.footerrow&&n(".ui-jqgrid-sdiv","#gbox_"+this.p.id).slideDown("fast"),n(".ui-jqgrid-titlebar-close span",this.grid.cDiv).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n"),this.p.gridstate="visible"))})},filterToolbar:function(i){return i=n.extend({autosearch:!0,searchOnEnter:!0,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,searchurl:"",stringResult:!1,groupOp:"AND",defaultSearch:"bw"},i||{}),this.each(function(){function f(i,r){var u=n(i);u[0]&&t.each(r,function(){this.data!==undefined?u.bind(this.type,this.data,this.fn):u.bind(this.type,this.fn)})}var r=this,u,e,o;this.ftoolbar||(u=function(){var f={},s=0,e,t,h={},o,v,u,c,l,a;n.each(r.p.colModel,function(){t=this.index||this.name;switch(this.stype){case"select":if(o=this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:"eq",e=n("#gs_"+n.jgrid.jqID(t),r.grid.hDiv).val())f[t]=e,h[t]=o,s++;else try{delete r.p.postData[t]}catch(u){}break;case"text":if(o=this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:i.defaultSearch,e=n("#gs_"+n.jgrid.jqID(t),r.grid.hDiv).val())f[t]=e,h[t]=o,s++;else try{delete r.p.postData[t]}catch(c){}}}),v=s>0?!0:!1,i.stringResult===!0||r.p.datatype=="local"?(u='{"groupOp":"'+i.groupOp+'","rules":[',c=0,n.each(f,function(n,t){c>0&&(u+=","),u+='{"field":"'+n+'",',u+='"op":"'+h[n]+'",',t+="",u+='"data":"'+t.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',c++}),u+="]}",n.extend(r.p.postData,{filters:u}),n.each(["searchField","searchString","searchOper"],function(n,t){r.p.postData.hasOwnProperty(t)&&delete r.p.postData[t]})):n.extend(r.p.postData,f),r.p.searchurl&&(l=r.p.url,n(r).jqGrid("setGridParam",{url:r.p.searchurl})),a=!1,n.isFunction(i.beforeSearch)&&(a=i.beforeSearch.call(r)),a||n(r).jqGrid("setGridParam",{search:v}).trigger("reloadGrid",[{page:1}]),l&&n(r).jqGrid("setGridParam",{url:l}),n.isFunction(i.afterSearch)&&i.afterSearch()},e=n("<tr class='ui-search-toolbar' role='rowheader'><\/tr>"),n.each(r.p.colModel,function(){var h=this,s,y,t,c,l,v,a,p;if(y=n("<th role='columnheader' class='ui-state-default ui-th-column ui-th-"+r.p.direction+"'><\/th>"),s=n("<div style='width:100%;position:relative;height:100%;padding-right:0.3em;'><\/div>"),this.hidden===!0&&n(y).css("display","none"),this.search=this.search===!1?!1:!0,typeof this.stype=="undefined"&&(this.stype="text"),t=n.extend({},this.searchoptions||{}),this.search)switch(this.stype){case"select":if(c=this.surl||t.dataUrl)n.ajax(n.extend({url:c,dataType:"html",complete:function(r){t.buildSelect!==undefined?(r=t.buildSelect(r))&&n(s).append(r):n(s).append(r.responseText),t.defaultValue&&n("select",s).val(t.defaultValue),n("select",s).attr({name:h.index||h.name,id:"gs_"+h.name}),t.attr&&n("select",s).attr(t.attr),n("select",s).css({width:"100%"}),t.dataInit!==undefined&&t.dataInit(n("select",s)[0]),t.dataEvents!==undefined&&f(n("select",s)[0],t.dataEvents),i.autosearch===!0&&n("select",s).change(function(){return u(),!1}),r=null}},n.jgrid.ajaxOptions,r.p.ajaxSelectOptions||{}));else if(h.searchoptions&&h.searchoptions.value?l=h.searchoptions.value:h.editoptions&&h.editoptions.value&&(l=h.editoptions.value),l){if(c=document.createElement("select"),c.style.width="100%",n(c).attr({name:h.index||h.name,id:"gs_"+h.name}),typeof l=="string")for(l=l.split(";"),p=0;p<l.length;p++)v=l[p].split(":"),a=document.createElement("option"),a.value=v[0],a.innerHTML=v[1],c.appendChild(a);else if(typeof l=="object")for(v in l)l.hasOwnProperty(v)&&(a=document.createElement("option"),a.value=v,a.innerHTML=l[v],c.appendChild(a));t.defaultValue&&n(c).val(t.defaultValue),t.attr&&n(c).attr(t.attr),t.dataInit!==undefined&&t.dataInit(c),t.dataEvents!==undefined&&f(c,t.dataEvents),n(s).append(c),i.autosearch===!0&&n(c).change(function(){return u(),!1})}break;case"text":c=t.defaultValue?t.defaultValue:"",n(s).append("<input type='text' style='width:95%;padding:0px;' name='"+(h.index||h.name)+"' id='gs_"+h.name+"' value='"+c+"'/>"),t.attr&&n("input",s).attr(t.attr),t.dataInit!==undefined&&t.dataInit(n("input",s)[0]),t.dataEvents!==undefined&&f(n("input",s)[0],t.dataEvents),i.autosearch===!0&&(i.searchOnEnter?n("input",s).keypress(function(n){return(n.charCode?n.charCode:n.keyCode?n.keyCode:0)==13?(u(),!1):this}):n("input",s).keydown(function(n){switch(n.which){case 13:return!1;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:o&&clearTimeout(o),o=setTimeout(function(){u()},500)}}))}n(y).append(s),n(e).append(y)}),n("table thead",r.grid.hDiv).append(e),this.ftoolbar=!0,this.triggerToolbar=u,this.clearToolbar=function(t){var o={},e,s=0,u,a,f,h,c,l;t=typeof t!="boolean"?!0:t,n.each(r.p.colModel,function(){e=this.searchoptions&&this.searchoptions.defaultValue?this.searchoptions.defaultValue:"",u=this.index||this.name;switch(this.stype){case"select":var t;if(n("#gs_"+n.jgrid.jqID(u)+" option",r.grid.hDiv).each(function(i){return i===0&&(this.selected=!0),n(this).text()==e?(this.selected=!0,t=n(this).val(),!1):void 0}),t)o[u]=t,s++;else try{delete r.p.postData[u]}catch(i){}break;case"text":if(n("#gs_"+n.jgrid.jqID(u),r.grid.hDiv).val(e),e)o[u]=e,s++;else try{delete r.p.postData[u]}catch(f){}}}),a=s>0?!0:!1,i.stringResult===!0||r.p.datatype=="local"?(f='{"groupOp":"'+i.groupOp+'","rules":[',h=0,n.each(o,function(n,t){h>0&&(f+=","),f+='{"field":"'+n+'",',f+='"op":"eq",',t+="",f+='"data":"'+t.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',h++}),f+="]}",n.extend(r.p.postData,{filters:f}),n.each(["searchField","searchString","searchOper"],function(n,t){r.p.postData.hasOwnProperty(t)&&delete r.p.postData[t]})):n.extend(r.p.postData,o),r.p.searchurl&&(c=r.p.url,n(r).jqGrid("setGridParam",{url:r.p.searchurl})),l=!1,n.isFunction(i.beforeClear)&&(l=i.beforeClear.call(r)),l||t&&n(r).jqGrid("setGridParam",{search:a}).trigger("reloadGrid",[{page:1}]),c&&n(r).jqGrid("setGridParam",{url:c}),n.isFunction(i.afterClear)&&i.afterClear()},this.toggleToolbar=function(){var t=n("tr.ui-search-toolbar",r.grid.hDiv);t.css("display")=="none"?t.show():t.hide()})})}})}(t),function(n){n.extend(n.jgrid,{showModal:function(n){n.w.show()},closeModal:function(n){n.w.hide().attr("aria-hidden","true"),n.o&&n.o.remove()},hideModal:function(t,i){if(i=n.extend({jqm:!0,gb:""},i||{}),i.onClose){var r=i.onClose(t);if(typeof r=="boolean"&&!r)return}if(n.fn.jqm&&i.jqm===!0)n(t).attr("aria-hidden","true").jqmHide();else{if(i.gb!=="")try{n(".jqgrid-overlay:first",i.gb).hide()}catch(u){}n(t).hide().attr("aria-hidden","true")}},findPos:function(n){var t=0,i=0;if(n.offsetParent)do t+=n.offsetLeft,i+=n.offsetTop;while(n=n.offsetParent);return[t,i]},createModal:function(t,i,r,u,f,e,o){var s=document.createElement("div"),a,v=this,h,c,l;if(o=n.extend({},o||{}),a=n(r.gbox).attr("dir")=="rtl"?!0:!1,s.className="ui-widget ui-widget-content ui-corner-all ui-jqdialog",s.id=t.themodal,h=document.createElement("div"),h.className="ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix",h.id=t.modalhead,n(h).append("<span class='ui-jqdialog-title'>"+r.caption+"<\/span>"),c=n("<a href='javascript:void(0)' class='ui-jqdialog-titlebar-close ui-corner-all'><\/a>").hover(function(){c.addClass("ui-state-hover")},function(){c.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-closethick'><\/span>"),n(h).append(c),a?(s.dir="rtl",n(".ui-jqdialog-title",h).css("float","right"),n(".ui-jqdialog-titlebar-close",h).css("left","0.3em")):(s.dir="ltr",n(".ui-jqdialog-title",h).css("float","left"),n(".ui-jqdialog-titlebar-close",h).css("right","0.3em")),l=document.createElement("div"),n(l).addClass("ui-jqdialog-content ui-widget-content").attr("id",t.modalcontent),n(l).append(i),s.appendChild(l),n(s).prepend(h),e===!0?n("body").append(s):typeof e=="string"?n(e).append(s):n(s).insertBefore(u),n(s).css(o),typeof r.jqModal=="undefined"&&(r.jqModal=!0),i={},n.fn.jqm&&r.jqModal===!0?(r.left===0&&r.top===0&&r.overlay&&(o=[],o=this.findPos(f),r.left=o[0]+4,r.top=o[1]+4),i.top=r.top+"px",i.left=r.left):(r.left!==0||r.top!==0)&&(i.left=r.left,i.top=r.top+"px"),n("a.ui-jqdialog-titlebar-close",h).click(function(){var i=n("#"+t.themodal).data("onClose")||r.onClose,u=n("#"+t.themodal).data("gbox")||r.gbox;return v.hideModal("#"+t.themodal,{gb:u,jqm:r.jqModal,onClose:i}),!1}),r.width!==0&&r.width||(r.width=300),r.height!==0&&r.height||(r.height=200),r.zIndex||(u=n(u).parents("*[role=dialog]").filter(":first").css("z-index"),r.zIndex=u?parseInt(u,10)+1:950),u=0,a&&i.left&&!e&&(u=n(r.gbox).width()-(isNaN(r.width)?0:parseInt(r.width,10))-8,i.left=parseInt(i.left,10)+parseInt(u,10)),i.left&&(i.left+="px"),n(s).css(n.extend({width:isNaN(r.width)?"auto":r.width+"px",height:isNaN(r.height)?"auto":r.height+"px",zIndex:r.zIndex,overflow:"hidden"},i)).attr({tabIndex:"-1",role:"dialog","aria-labelledby":t.modalhead,"aria-hidden":"true"}),typeof r.drag=="undefined"&&(r.drag=!0),typeof r.resize=="undefined"&&(r.resize=!0),r.drag)if(n(h).css("cursor","move"),n.fn.jqDrag)n(s).jqDrag(h);else try{n(s).draggable({handle:n("#"+h.id)})}catch(y){}if(r.resize)if(n.fn.jqResize)n(s).append("<div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se ui-icon-grip-diagonal-se'><\/div>"),n("#"+t.themodal).jqResize(".jqResize",t.scrollelm?"#"+t.scrollelm:!1);else try{n(s).resizable({handles:"se, sw",alsoResize:t.scrollelm?"#"+t.scrollelm:!1})}catch(p){}r.closeOnEscape===!0&&n(s).keydown(function(i){i.which==27&&(i=n("#"+t.themodal).data("onClose")||r.onClose,v.hideModal(this,{gb:r.gbox,jqm:r.jqModal,onClose:i}))})},viewModal:function(t,i){if(i=n.extend({toTop:!0,overlay:10,modal:!1,onShow:this.showModal,onHide:this.closeModal,gbox:"",jqm:!0,jqM:!0},i||{}),n.fn.jqm&&i.jqm===!0)i.jqM?n(t).attr("aria-hidden","false").jqm(i).jqmShow():n(t).attr("aria-hidden","false").jqmShow();else{i.gbox!==""&&(n(".jqgrid-overlay:first",i.gbox).show(),n(t).data("gbox",i.gbox)),n(t).show().attr("aria-hidden","false");try{n(":input:visible",t)[0].focus()}catch(r){}}},info_dialog:function(t,i,r,u){var f={width:290,height:"auto",dataheight:"auto",drag:!0,resize:!1,caption:"<b>"+t+"<\/b>",left:250,top:170,zIndex:1e3,jqModal:!0,modal:!1,closeOnEscape:!0,align:"center",buttonalign:"center",buttons:[]},e,s,o;if(n.extend(f,u||{}),e=f.jqModal,s=this,n.fn.jqm&&!e&&(e=!1),t="",f.buttons.length>0)for(u=0;u<f.buttons.length;u++)typeof f.buttons[u].id=="undefined"&&(f.buttons[u].id="info_button_"+u),t+="<a href='javascript:void(0)' id='"+f.buttons[u].id+"' class='fm-button ui-state-default ui-corner-all'>"+f.buttons[u].text+"<\/a>";u=isNaN(f.dataheight)?f.dataheight:f.dataheight+"px",o="<div id='info_id'>",o+="<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+u+";"+("text-align:"+f.align+";")+"'>"+i+"<\/div>",o+=r?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+f.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'><a href='javascript:void(0)' id='closedialog' class='fm-button ui-state-default ui-corner-all'>"+r+"<\/a>"+t+"<\/div>":t!==""?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+f.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'>"+t+"<\/div>":"",o+="<\/div>";try{n("#info_dialog").attr("aria-hidden")=="false"&&this.hideModal("#info_dialog",{jqm:e}),n("#info_dialog").remove()}catch(h){}this.createModal({themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content",scrollelm:"infocnt"},o,f,"","",!0),t&&n.each(f.buttons,function(t){n("#"+this.id,"#info_id").bind("click",function(){return f.buttons[t].onClick.call(n("#info_dialog")),!1})}),n("#closedialog","#info_id").click(function(){return s.hideModal("#info_dialog",{jqm:e}),!1}),n(".fm-button","#info_dialog").hover(function(){n(this).addClass("ui-state-hover")},function(){n(this).removeClass("ui-state-hover")}),n.isFunction(f.beforeOpen)&&f.beforeOpen(),this.viewModal("#info_dialog",{onHide:function(n){n.w.hide().remove(),n.o&&n.o.remove()},modal:f.modal,jqm:e}),n.isFunction(f.afterOpen)&&f.afterOpen();try{n("#info_dialog").focus()}catch(c){}},createEl:function(t,i,r,u,f){function c(t,i){return n.isFunction(i.dataInit)&&i.dataInit(t),i.dataEvents&&n.each(i.dataEvents,function(){this.data!==undefined?n(t).bind(this.type,this.data,this.fn):n(t).bind(this.type,this.fn)}),i}function l(t,i){var r=["dataInit","dataEvents","dataUrl","buildSelect","sopt","searchhidden","defaultValue","attr"];n.each(i,function(i,u){n.inArray(i,r)===-1&&n(t).attr(i,u)}),i.hasOwnProperty("id")||n(t).attr("id",n.jgrid.randId())}var e="",o,s,h;switch(t){case"textarea":e=document.createElement("textarea"),u?i.cols||n(e).css({width:"98%"}):i.cols||(i.cols=20),i.rows||(i.rows=2),(r=="&nbsp;"||r=="&#160;"||r.length==1&&r.charCodeAt(0)==160)&&(r=""),e.value=r,l(e,i),i=c(e,i),n(e).attr({role:"textbox",multiline:"true"});break;case"checkbox":e=document.createElement("input"),e.type="checkbox",i.value?(t=i.value.split(":"),r===t[0]&&(e.checked=!0,e.defaultChecked=!0),e.value=t[0],n(e).attr("offval",t[1])):(t=r.toLowerCase(),t.search(/(false|0|no|off|undefined)/i)<0&&t!==""?(e.checked=!0,e.defaultChecked=!0,e.value=r):e.value="on",n(e).attr("offval","off")),l(e,i),i=c(e,i),n(e).attr("role","checkbox");break;case"select":if(e=document.createElement("select"),e.setAttribute("role","select"),u=[],i.multiple===!0?(t=!0,e.multiple="multiple",n(e).attr("aria-multiselectable","true")):t=!1,typeof i.dataUrl!="undefined")n.ajax(n.extend({url:i.dataUrl,type:"GET",dataType:"html",context:{elem:e,options:i,vl:r},success:function(t){var r=[],u=this.elem,f=this.vl,i=n.extend({},this.options),e=i.multiple===!0;typeof i.buildSelect!="undefined"&&(t=i.buildSelect(t)),(t=n(t).html())&&(n(u).append(t),l(u,i),i=c(u,i),typeof i.size=="undefined"&&(i.size=e?3:1),e?(r=f.split(","),r=n.map(r,function(t){return n.trim(t)})):r[0]=n.trim(f),setTimeout(function(){n("option",u).each(function(){n(this).attr("role","option"),(n.inArray(n.trim(n(this).text()),r)>-1||n.inArray(n.trim(n(this).val()),r)>-1)&&(this.selected="selected")})},0))}},f||{}));else if(i.value){if(t?(u=r.split(","),u=n.map(u,function(t){return n.trim(t)}),typeof i.size=="undefined"&&(i.size=3)):i.size=1,typeof i.value=="function"&&(i.value=i.value()),typeof i.value=="string")for(s=i.value.split(";"),o=0;o<s.length;o++)h=s[o].split(":"),h.length>2&&(h[1]=n.map(h,function(n,t){if(t>0)return n}).join(":")),f=document.createElement("option"),f.setAttribute("role","option"),f.value=h[0],f.innerHTML=h[1],t||n.trim(h[0])!=n.trim(r)&&n.trim(h[1])!=n.trim(r)||(f.selected="selected"),t&&(n.inArray(n.trim(h[1]),u)>-1||n.inArray(n.trim(h[0]),u)>-1)&&(f.selected="selected"),e.appendChild(f);else if(typeof i.value=="object"){s=i.value;for(o in s)s.hasOwnProperty(o)&&(f=document.createElement("option"),f.setAttribute("role","option"),f.value=o,f.innerHTML=s[o],t||n.trim(o)!=n.trim(r)&&n.trim(s[o])!=n.trim(r)||(f.selected="selected"),t&&(n.inArray(n.trim(s[o]),u)>-1||n.inArray(n.trim(o),u)>-1)&&(f.selected="selected"),e.appendChild(f))}l(e,i),i=c(e,i)}break;case"text":case"password":case"button":o=t=="button"?"button":"textbox",e=document.createElement("input"),e.type=t,e.value=r,l(e,i),i=c(e,i),t!="button"&&(u?i.size||n(e).css({width:"98%"}):i.size||(i.size=20)),n(e).attr("role",o);break;case"image":case"file":e=document.createElement("input"),e.type=t,l(e,i),i=c(e,i);break;case"custom":e=document.createElement("span");try{if(n.isFunction(i.custom_element))if(s=i.custom_element.call(this,r,i))s=n(s).addClass("customelement").attr({id:i.id,name:i.name}),n(e).empty().append(s);else throw"e2";else throw"e1";}catch(a){a=="e1"&&this.info_dialog(n.jgrid.errors.errcap,"function 'custom_element' "+n.jgrid.edit.msg.nodefined,n.jgrid.edit.bClose),a=="e2"?this.info_dialog(n.jgrid.errors.errcap,"function 'custom_element' "+n.jgrid.edit.msg.novalue,n.jgrid.edit.bClose):this.info_dialog(n.jgrid.errors.errcap,typeof a=="string"?a:a.message,n.jgrid.edit.bClose)}}return e},checkDate:function(n,t){var i={},r,s;if(n=n.toLowerCase(),r=n.indexOf("/")!=-1?"/":n.indexOf("-")!=-1?"-":n.indexOf(".")!=-1?".":"/",n=n.split(r),t=t.split(r),t.length!=3)return!1;r=-1;for(var f,e=-1,o=-1,u=0;u<n.length;u++)f=isNaN(t[u])?0:parseInt(t[u],10),i[n[u]]=f,f=n[u],f.indexOf("y")!=-1&&(r=u),f.indexOf("m")!=-1&&(o=u),f.indexOf("d")!=-1&&(e=u);return(f=n[r]=="y"||n[r]=="yyyy"?4:n[r]=="yy"?2:-1,u=function(n){for(var t=1;t<=n;t++)this[t]=31,(t==4||t==6||t==9||t==11)&&(this[t]=30),t==2&&(this[t]=29);return this}(12),r===-1)?!1:(s=i[n[r]].toString(),f==2&&s.length==1&&(f=1),s.length!=f||i[n[r]]===0&&t[r]!="00")?!1:o===-1?!1:(s=i[n[o]].toString(),s.length<1||i[n[o]]<1||i[n[o]]>12)?!1:e===-1?!1:(s=i[n[e]].toString(),s.length<1||i[n[e]]<1||i[n[e]]>31||i[n[o]]==2&&i[n[e]]>(i[n[r]]%4==0&&(i[n[r]]%100!=0||i[n[r]]%400==0)?29:28)||i[n[e]]>u[i[n[o]]])?!1:!0},isEmpty:function(n){return n.match(/^\s+$/)||n===""?!0:!1},checkTime:function(n){if(!this.isEmpty(n))if(n=n.match(/^(\d{1,2}):(\d{2})([ap]m)?$/)){if(n[3]){if(n[1]<1||n[1]>12)return!1}else if(n[1]>23)return!1;if(n[2]>59)return!1}else return!1;return!0},checkValues:function(t,i,r,u,f){var e,o;if(typeof u=="undefined")if(typeof i=="string"){for(u=0,f=r.p.colModel.length;u<f;u++)if(r.p.colModel[u].name==i){e=r.p.colModel[u].editrules,i=u;try{o=r.p.colModel[u].formoptions.label}catch(s){}break}}else i>=0&&(e=r.p.colModel[i].editrules);else e=u,o=f===undefined?"_":f;if(e){if(o||(o=r.p.colNames[i]),e.required===!0&&this.isEmpty(t))return[!1,o+": "+n.jgrid.edit.msg.required,""];if(u=e.required===!1?!1:!0,e.number===!0&&!(u===!1&&this.isEmpty(t))&&isNaN(t))return[!1,o+": "+n.jgrid.edit.msg.number,""];if(typeof e.minValue!="undefined"&&!isNaN(e.minValue)&&parseFloat(t)<parseFloat(e.minValue))return[!1,o+": "+n.jgrid.edit.msg.minValue+" "+e.minValue,""];if(typeof e.maxValue!="undefined"&&!isNaN(e.maxValue)&&parseFloat(t)>parseFloat(e.maxValue))return[!1,o+": "+n.jgrid.edit.msg.maxValue+" "+e.maxValue,""];if(e.email===!0&&!(u===!1&&this.isEmpty(t))&&(f=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,!f.test(t)))return[!1,o+": "+n.jgrid.edit.msg.email,""];if(e.integer===!0&&!(u===!1&&this.isEmpty(t))){if(isNaN(t))return[!1,o+": "+n.jgrid.edit.msg.integer,""];if(t%1!=0||t.indexOf(".")!=-1)return[!1,o+": "+n.jgrid.edit.msg.integer,""]}if(e.date===!0&&!(u===!1&&this.isEmpty(t))&&(i=r.p.colModel[i].formatoptions&&r.p.colModel[i].formatoptions.newformat?r.p.colModel[i].formatoptions.newformat:r.p.colModel[i].datefmt||"Y-m-d",!this.checkDate(i,t)))return[!1,o+": "+n.jgrid.edit.msg.date+" - "+i,""];if(e.time===!0&&!(u===!1&&this.isEmpty(t))&&!this.checkTime(t))return[!1,o+": "+n.jgrid.edit.msg.date+" - hh:mm (am/pm)",""];if(e.url===!0&&!(u===!1&&this.isEmpty(t))&&(f=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i,!f.test(t)))return[!1,o+": "+n.jgrid.edit.msg.url,""];if(e.custom===!0&&!(u===!1&&this.isEmpty(t)))return n.isFunction(e.custom_func)?(t=e.custom_func.call(r,t,o),n.isArray(t)?t:[!1,n.jgrid.edit.msg.customarray,""]):[!1,n.jgrid.edit.msg.customfcheck,""]}return[!0,"",""]}})}(t),function(u){var f=null;u.jgrid.extend({searchGrid:function(t){return t=u.extend({recreateFilter:!1,drag:!0,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:!0,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,closeAfterSearch:!1,closeAfterReset:!1,closeOnEscape:!1,multipleSearch:!1,multipleGroup:!1,top:0,left:0,jqModal:!0,modal:!1,resize:!1,width:450,height:"auto",dataheight:"auto",showQuery:!1,errorcheck:!0,sopt:null,stringResult:undefined,onClose:null,onSearch:null,onReset:null,toTop:!0,overlay:10,columns:[],tmplNames:null,tmplFilters:null,tmplLabel:" Template: ",showOnLoad:!1,layer:null},u.jgrid.search,t||{}),this.each(function(){function w(){u.isFunction(t.beforeShowSearch)&&(l=t.beforeShowSearch(u("#"+i)),typeof l=="undefined"&&(l=!0)),l&&(u.jgrid.viewModal("#"+s.themodal,{gbox:"#gbox_"+i,jqm:t.jqModal,modal:t.modal,overlay:t.overlay,toTop:t.toTop}),u.isFunction(t.afterShowSearch)&&t.afterShowSearch(u("#"+i)))}var f=this,e;if(f.grid){var i="fbox_"+f.p.id,l=!0,s={themodal:"searchmod"+i,modalhead:"searchhd"+i,modalcontent:"searchcnt"+i,scrollelm:i},o=f.p.postData[t.sFilter];if(typeof o=="string"&&(o=u.jgrid.parse(o)),t.recreateFilter===!0&&u("#"+s.themodal).remove(),u("#"+s.themodal).html()!==null)w();else{if(e=u("<span><div id='"+i+"' class='searchFilter' style='overflow:auto'><\/div><\/span>").insertBefore("#gview_"+f.p.id),u.isFunction(t.onInitializeSearch))t.onInitializeSearch(u("#"+i));var a=u.extend([],f.p.colModel),v="<a href='javascript:void(0)' id='"+i+"_search' class='fm-button ui-state-default ui-corner-all fm-button-icon-right ui-reset'><span class='ui-icon ui-icon-search'><\/span>"+t.Find+"<\/a>",b="<a href='javascript:void(0)' id='"+i+"_reset' class='fm-button ui-state-default ui-corner-all fm-button-icon-left ui-search'><span class='ui-icon ui-icon-arrowreturnthick-1-w'><\/span>"+t.Reset+"<\/a>",y="",h="",p,c=!1;if(t.showQuery&&(y="<a href='javascript:void(0)' id='"+i+"_query' class='fm-button ui-state-default ui-corner-all fm-button-icon-left'><span class='ui-icon ui-icon-comment'><\/span>Query<\/a>"),t.columns.length?a=t.columns:u.each(a,function(n,t){if(t.label||(t.label=f.p.colNames[n]),!c){var i=typeof t.search=="undefined"?!0:t.search,r=t.hidden===!0;(t.searchoptions&&t.searchoptions.searchhidden===!0&&i||i&&!r)&&(c=!0,p=t.index||t.name)}}),(!o&&p||t.multipleSearch===!1)&&(o={groupOp:"AND",rules:[{field:p,op:"eq",data:""}]}),c=!1,t.tmplNames&&t.tmplNames.length&&(c=!0,h=t.tmplLabel,h+="<select class='ui-template'>",h+="<option value='default'>Default<\/option>",u.each(t.tmplNames,function(n,t){h+="<option value='"+n+"'>"+t+"<\/option>"}),h+="<\/select>"),v="<table class='EditTable' style='border:0px none;margin-top:5px' id='"+i+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/><\/td><\/tr><tr><td class='EditButton' style='text-align:left'>"+b+h+"<\/td><td class='EditButton'>"+y+v+"<\/td><\/tr><\/tbody><\/table>",u("#"+i).jqFilter({columns:a,filter:t.loadDefaults?o:null,showQuery:t.showQuery,errorcheck:t.errorcheck,sopt:t.sopt,groupButton:t.multipleGroup,_gridsopt:u.jgrid.search.odata,onChange:function(){this.p.showQuery&&u(".query",this).html(this.toUserFriendlyString())}}),e.append(v),c&&t.tmplFilters&&t.tmplFilters.length&&u(".ui-template",e).bind("change",function(){var n=u(this).val();return n=="default"?u("#"+i).jqFilter("addFilter",o):u("#"+i).jqFilter("addFilter",t.tmplFilters[parseInt(n,10)]),!1}),t.multipleSearch===!1&&(u(".add-rule","#"+i).hide(),u(".delete-rule","#"+i).hide()),u.isFunction(t.onInitializeSearch))t.onInitializeSearch(u("#"+i));t.layer?u.jgrid.createModal(s,e,t,"#gview_"+f.p.id,u("#gbox_"+f.p.id)[0],"#"+t.layer,{position:"relative"}):u.jgrid.createModal(s,e,t,"#gview_"+f.p.id,u("#gbox_"+f.p.id)[0]),y&&u("#"+i+"_query").bind("click",function(){return u(".queryresult",e).toggle(),!1}),t.stringResult===undefined&&(t.stringResult=t.multipleSearch),u("#"+i+"_search").bind("click",function(){var h=u("#"+i),e={},c,o=h.jqFilter("filterData");if(t.errorcheck&&(h[0].hideError(),t.showQuery||h.jqFilter("toSQLString"),h[0].p.error))return h[0].showError(),!1;if(t.stringResult){try{c=r.toJson(o,"","",!1)}catch(l){try{c=n.stringify(o)}catch(a){}}typeof c=="string"&&(e[t.sFilter]=c,u.each([t.sField,t.sValue,t.sOper],function(){e[this]=""}))}else t.multipleSearch?(e[t.sFilter]=o,u.each([t.sField,t.sValue,t.sOper],function(){e[this]=""})):(e[t.sField]=o.rules[0].field,e[t.sValue]=o.rules[0].data,e[t.sOper]=o.rules[0].op,e[t.sFilter]="");return f.p.search=!0,u.extend(f.p.postData,e),u.isFunction(t.onSearch)&&t.onSearch(),u(f).trigger("reloadGrid",[{page:1}]),t.closeAfterSearch&&u.jgrid.hideModal("#"+s.themodal,{gb:"#gbox_"+f.p.id,jqm:t.jqModal,onClose:t.onClose}),!1}),u("#"+i+"_reset").bind("click",function(){var n={},r=u("#"+i);return f.p.search=!1,t.multipleSearch===!1?n[t.sField]=n[t.sValue]=n[t.sOper]="":n[t.sFilter]="",r[0].resetFilter(),c&&u(".ui-template",e).val("default"),u.extend(f.p.postData,n),u.isFunction(t.onReset)&&t.onReset(),u(f).trigger("reloadGrid",[{page:1}]),!1}),w(),u(".fm-button:not(.ui-state-disabled)",e).hover(function(){u(this).addClass("ui-state-hover")},function(){u(this).removeClass("ui-state-hover")})}}})},editGridRow:function(n,r){return f=r=u.extend({top:0,left:0,width:300,height:"auto",dataheight:"auto",modal:!1,overlay:10,drag:!0,resize:!0,url:null,mtype:"POST",clearAfterAdd:!0,closeAfterEdit:!1,reloadAfterSubmit:!0,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:!1,jqModal:!0,closeOnEscape:!1,addedrow:"first",topinfo:"",bottominfo:"",saveicon:[],closeicon:[],savekey:[!1,13],navkeys:[!1,38,40],checkOnSubmit:!1,checkOnUpdate:!1,_savedData:{},processing:!1,onClose:null,ajaxEditOptions:{},serializeEditData:null,viewPagerButtons:!0},u.jgrid.edit,r||{}),this.each(function(){function at(){return u(".FormElement","#"+s).each(function(){var i=u(".customelement",this),n,r;if(i.length)n=u(i[0]).attr("name"),u.each(o.p.colModel,function(){if(this.name===n&&this.editoptions&&u.isFunction(this.editoptions.custom_value)){try{if(e[n]=this.editoptions.custom_value(u("#"+u.jgrid.jqID(n),"#"+s),"get"),e[n]===undefined)throw"e1";}catch(i){i==="e1"?u.jgrid.info_dialog(t.jgrid.errors.errcap,"function 'custom_value' "+u.jgrid.edit.msg.novalue,t.jgrid.edit.bClose):u.jgrid.info_dialog(t.jgrid.errors.errcap,i.message,t.jgrid.edit.bClose)}return!0}});else{switch(u(this).get(0).type){case"checkbox":u(this).attr("checked")?e[this.name]=u(this).val():(i=u(this).attr("offval"),e[this.name]=i);break;case"select-one":e[this.name]=u("option:selected",this).val(),p[this.name]=u("option:selected",this).text();break;case"select-multiple":e[this.name]=u(this).val(),e[this.name]=e[this.name]?e[this.name].join(","):"",r=[],u("option:selected",this).each(function(n,t){r[n]=u(t).text()}),p[this.name]=r.join(",");break;case"password":case"text":case"textarea":case"button":e[this.name]=u(this).val()}o.p.autoencode&&(e[this.name]=u.jgrid.htmlEncode(e[this.name]))}}),!0}function kt(n,t,i,r){for(var s,b,h,a=0,e,y,c,p=[],v=!1,w="",l=1;l<=r;l++)w+="<td class='CaptionTD'>&#160;<\/td><td class='DataTD'>&#160;<\/td>";return n!="_empty"&&(v=u(t).jqGrid("getInd",n)),u(t.p.colModel).each(function(l){if(s=this.name,y=(b=this.editrules&&this.editrules.edithidden===!0?!1:this.hidden===!0?!0:!1)?"style='display:none'":"",s!=="cb"&&s!=="subgrid"&&this.editable===!0&&s!=="rn"){if(v===!1)e="";else if(s==t.p.ExpandColumn&&t.p.treeGrid===!0)e=u("td:eq("+l+")",t.rows[v]).text();else try{e=u.unformat(u("td:eq("+l+")",t.rows[v]),{rowId:n,colModel:this},l)}catch(tt){e=u("td:eq("+l+")",t.rows[v]).text()}var k=u.extend({},this.editoptions||{},{id:s,name:s}),d=u.extend({},{elmprefix:"",elmsuffix:"",rowabove:!1,rowcontent:""},this.formoptions||{}),g=parseInt(d.rowpos,10)||a+1,nt=parseInt((parseInt(d.colpos,10)||1)*2,10);n=="_empty"&&k.defaultValue&&(e=u.isFunction(k.defaultValue)?k.defaultValue():k.defaultValue),this.edittype||(this.edittype="text"),o.p.autoencode&&(e=u.jgrid.htmlDecode(e)),c=u.jgrid.createEl(this.edittype,k,e,!1,u.extend({},u.jgrid.ajaxOptions,t.p.ajaxSelectOptions||{})),e===""&&this.edittype=="checkbox"&&(e=u(c).attr("offval")),e===""&&this.edittype=="select"&&(e=u("option:eq(0)",c).text()),(f.checkOnSubmit||f.checkOnUpdate)&&(f._savedData[s]=e),u(c).addClass("FormElement"),(this.edittype=="text"||this.edittype=="textarea")&&u(c).addClass("ui-widget-content ui-corner-all"),h=u(i).find("tr[rowpos="+g+"]"),d.rowabove&&(k=u("<tr><td class='contentinfo' colspan='"+r*2+"'>"+d.rowcontent+"<\/td><\/tr>"),u(i).append(k),k[0].rp=g),h.length===0&&(h=u("<tr "+y+" rowpos='"+g+"'><\/tr>").addClass("FormData").attr("id","tr_"+s),u(h).append(w),u(i).append(h),h[0].rp=g),u("td:eq("+(nt-2)+")",h[0]).html(typeof d.label=="undefined"?t.p.colNames[l]:d.label),u("td:eq("+(nt-1)+")",h[0]).append(d.elmprefix).append(c).append(d.elmsuffix),p[a]=l,a++}}),a>0&&(l=u("<tr class='FormData' style='display:none'><td class='CaptionTD'><\/td><td colspan='"+(r*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='"+t.p.id+"_id' value='"+n+"'/><\/td><\/tr>"),l[0].rp=a+999,u(i).append(l),(f.checkOnSubmit||f.checkOnUpdate)&&(f._savedData[t.p.id+"_id"]=n)),p}function nt(n,i,r){var e,w=0,h,c,v,a,y,l,p;(f.checkOnSubmit||f.checkOnUpdate)&&(f._savedData={},f._savedData[i.p.id+"_id"]=n),l=i.p.colModel,n=="_empty"?(u(l).each(function(){e=this.name,v=u.extend({},this.editoptions||{}),(c=u("#"+u.jgrid.jqID(e),"#"+r))&&c[0]!==null&&(a="",v.defaultValue?(a=u.isFunction(v.defaultValue)?v.defaultValue():v.defaultValue,c[0].type=="checkbox"?(y=a.toLowerCase(),y.search(/(false|0|no|off|undefined)/i)<0&&y!==""?(c[0].checked=!0,c[0].defaultChecked=!0,c[0].value=a):c.attr({checked:"",defaultChecked:""})):c.val(a)):c[0].type=="checkbox"?(c[0].checked=!1,c[0].defaultChecked=!1,a=u(c).attr("offval")):c[0].type&&c[0].type.substr(0,6)=="select"?c[0].selectedIndex=0:c.val(a),(f.checkOnSubmit===!0||f.checkOnUpdate)&&(f._savedData[e]=a))}),u("#id_g","#"+r).val(n)):(p=u(i).jqGrid("getInd",n,!0),p&&(u("td",p).each(function(s){if(e=l[s].name,e!=="cb"&&e!=="subgrid"&&e!=="rn"&&l[s].editable===!0){if(e==i.p.ExpandColumn&&i.p.treeGrid===!0)h=u(this).text();else try{h=u.unformat(u(this),{rowId:n,colModel:l[s]},s)}catch(v){h=u(this).text()}o.p.autoencode&&(h=u.jgrid.htmlDecode(h)),(f.checkOnSubmit===!0||f.checkOnUpdate)&&(f._savedData[e]=h),e=u.jgrid.jqID(e);switch(l[s].edittype){case"password":case"text":case"button":case"image":u("#"+e,"#"+r).val(h);break;case"textarea":(h=="&nbsp;"||h=="&#160;"||h.length==1&&h.charCodeAt(0)==160)&&(h=""),u("#"+e,"#"+r).val(h);break;case"select":var c=h.split(",");c=u.map(c,function(n){return u.trim(n)}),u("#"+e+" option","#"+r).each(function(){this.selected=!l[s].editoptions.multiple&&(c[0]==u.trim(u(this).text())||c[0]==u.trim(u(this).val()))?!0:l[s].editoptions.multiple?u.inArray(u.trim(u(this).text()),c)>-1||u.inArray(u.trim(u(this).val()),c)>-1?!0:!1:!1});break;case"checkbox":h+="",l[s].editoptions&&l[s].editoptions.value?l[s].editoptions.value.split(":")[0]==h?(u("#"+e,"#"+r).attr("checked",!0),u("#"+e,"#"+r).attr("defaultChecked",!0)):(u("#"+e,"#"+r).attr("checked",!1),u("#"+e,"#"+r).attr("defaultChecked","")):(h=h.toLowerCase(),h.search(/(false|0|no|off|undefined)/i)<0&&h!==""?(u("#"+e,"#"+r).attr("checked",!0),u("#"+e,"#"+r).attr("defaultChecked",!0)):(u("#"+e,"#"+r).attr("checked",!1),u("#"+e,"#"+r).attr("defaultChecked","")));break;case"custom":try{if(l[s].editoptions&&u.isFunction(l[s].editoptions.custom_value))l[s].editoptions.custom_value(u("#"+e,"#"+r),"set",h);else throw"e1";}catch(a){a=="e1"?u.jgrid.info_dialog(t.jgrid.errors.errcap,"function 'custom_value' "+u.jgrid.edit.msg.nodefined,t.jgrid.edit.bClose):u.jgrid.info_dialog(t.jgrid.errors.errcap,a.message,t.jgrid.edit.bClose)}}w++}}),w>0&&u("#id_g","#"+s).val(n)))}function tt(){var d,n=[!0,"",""],l={},t=o.p.prmNames,v,y,b,w,k;u.isFunction(f.beforeCheckValues)&&(k=f.beforeCheckValues(e,u("#"+h),e[o.p.id+"_id"]=="_empty"?t.addoper:t.editoper),k&&typeof k=="object"&&(e=k));for(b in e)if(e.hasOwnProperty(b)&&(n=u.jgrid.checkValues(e[b],b,o),n[0]===!1))break;if(n[0]&&(u.isFunction(f.onclickSubmit)&&(l=f.onclickSubmit(f,e)||{}),u.isFunction(f.beforeSubmit)&&(n=f.beforeSubmit(e,u("#"+h)))),n[0]&&!f.processing){if(f.processing=!0,u("#sData","#"+s+"_2").addClass("ui-state-active"),y=t.oper,v=t.id,e[y]=u.trim(e[o.p.id+"_id"])=="_empty"?t.addoper:t.editoper,e[y]!=t.addoper?e[v]=e[o.p.id+"_id"]:e[v]===undefined&&(e[v]=e[o.p.id+"_id"]),delete e[o.p.id+"_id"],e=u.extend(e,f.editData,l),o.p.treeGrid===!0){e[y]==t.addoper&&(w=u(o).jqGrid("getGridParam","selrow"),e[o.p.treeGridModel=="adjacency"?o.p.treeReader.parent_id_field:"parent_id"]=w);for(i in o.p.treeReader)l=o.p.treeReader[i],e.hasOwnProperty(l)&&(e[y]==t.addoper&&i==="parent_id_field"||delete e[l])}l=u.extend({url:f.url?f.url:u(o).jqGrid("getGridParam","editurl"),type:f.mtype,data:u.isFunction(f.serializeEditData)?f.serializeEditData(e):e,complete:function(i,l){if(l!="success"?(n[0]=!1,n[1]=u.isFunction(f.errorTextFormat)?f.errorTextFormat(i):l+" Status: '"+i.statusText+"'. Error code: "+i.status):u.isFunction(f.afterSubmit)&&(n=f.afterSubmit(i,e)),n[0]===!1)u("#FormError>td","#"+s).html(n[1]),u("#FormError","#"+s).show();else if(u.each(o.p.colModel,function(){if(p[this.name]&&this.formatter&&this.formatter=="select")try{delete p[this.name]}catch(n){}}),e=u.extend(e,p),o.p.autoencode&&u.each(e,function(n,t){e[n]=u.jgrid.htmlDecode(t)}),f.reloadAfterSubmit=f.reloadAfterSubmit&&o.p.datatype!="local",e[y]==t.addoper?(n[2]||(n[2]=u.jgrid.randId()),e[v]=n[2],f.closeAfterAdd?(f.reloadAfterSubmit?u(o).trigger("reloadGrid"):o.p.treeGrid===!0?u(o).jqGrid("addChildNode",n[2],w,e):(u(o).jqGrid("addRowData",n[2],e,r.addedrow),u(o).jqGrid("setSelection",n[2])),u.jgrid.hideModal("#"+c.themodal,{gb:"#gbox_"+a,jqm:r.jqModal,onClose:f.onClose})):f.clearAfterAdd?(f.reloadAfterSubmit?u(o).trigger("reloadGrid"):o.p.treeGrid===!0?u(o).jqGrid("addChildNode",n[2],w,e):u(o).jqGrid("addRowData",n[2],e,r.addedrow),nt("_empty",o,h)):f.reloadAfterSubmit?u(o).trigger("reloadGrid"):o.p.treeGrid===!0?u(o).jqGrid("addChildNode",n[2],w,e):u(o).jqGrid("addRowData",n[2],e,r.addedrow)):(f.reloadAfterSubmit?(u(o).trigger("reloadGrid"),f.closeAfterEdit||setTimeout(function(){u(o).jqGrid("setSelection",e[v])},1e3)):o.p.treeGrid===!0?u(o).jqGrid("setTreeRow",e[v],e):u(o).jqGrid("setRowData",e[v],e),f.closeAfterEdit&&u.jgrid.hideModal("#"+c.themodal,{gb:"#gbox_"+a,jqm:r.jqModal,onClose:f.onClose})),u.isFunction(f.afterComplete)&&(d=i,setTimeout(function(){f.afterComplete(d,e,u("#"+h)),d=null},500)),(f.checkOnSubmit||f.checkOnUpdate)&&(u("#"+h).data("disabled",!1),f._savedData[o.p.id+"_id"]!="_empty"))for(var b in f._savedData)e[b]&&(f._savedData[b]=e[b]);f.processing=!1,u("#sData","#"+s+"_2").removeClass("ui-state-active");try{u(":input:visible","#"+h)[0].focus()}catch(k){}}},u.jgrid.ajaxOptions,f.ajaxEditOptions),l.url||f.useDataProxy||(u.isFunction(o.p.dataProxy)?f.useDataProxy=!0:(n[0]=!1,n[1]+=" "+u.jgrid.errors.nourl)),n[0]&&(f.useDataProxy?o.p.dataProxy.call(o,l,"set_"+o.p.id):u.ajax(l))}n[0]===!1&&(u("#FormError>td","#"+s).html(n[1]),u("#FormError","#"+s).show())}function vt(n,t){var r=!1,i;for(i in n)if(n[i]!=t[i]){r=!0;break}return r}function yt(){u.each(o.p.colModel,function(n,t){t.editoptions&&t.editoptions.NullIfEmpty===!0&&e.hasOwnProperty(t.name)&&e[t.name]==""&&(e[t.name]="null")})}function w(){var n=!0;return u("#FormError","#"+s).hide(),f.checkOnUpdate&&(e={},p={},at(),rt=u.extend({},e,p),(bt=vt(rt,f._savedData))?(u("#"+h).data("disabled",!0),u(".confirm","#"+c.themodal).show(),n=!1):yt()),n}function pt(){if(n!=="_empty"&&typeof o.p.savedRow!="undefined"&&o.p.savedRow.length>0&&u.isFunction(u.fn.jqGrid.restoreRow))for(var t=0;t<o.p.savedRow.length;t++)if(o.p.savedRow[t].id==n){u(o).jqGrid("restoreRow",n);break}}function st(n,t){n===0?u("#pData","#"+s+"_2").addClass("ui-state-disabled"):u("#pData","#"+s+"_2").removeClass("ui-state-disabled"),n==t?u("#nData","#"+s+"_2").addClass("ui-state-disabled"):u("#nData","#"+s+"_2").removeClass("ui-state-disabled")}function ht(){var n=u(o).jqGrid("getDataIDs"),t=u("#id_g","#"+s).val();return[u.inArray(t,n),n]}var o=this,ut,y,k,d,ft,et,ot,lt;if(o.grid&&n){var a=o.p.id,h="FrmGrid_"+a,s="TblGrid_"+a,c={themodal:"editmod"+a,modalhead:"edithd"+a,modalcontent:"editcnt"+a,scrollelm:h},b=u.isFunction(f.beforeShowForm)?f.beforeShowForm:!1,it=u.isFunction(f.afterShowForm)?f.afterShowForm:!1,v=u.isFunction(f.beforeInitData)?f.beforeInitData:!1,wt=u.isFunction(f.onInitializeForm)?f.onInitializeForm:!1,l=!0,g=1,ct=0,e,p,rt,bt;if(n==="new"?(n="_empty",r.caption=f.addCaption):r.caption=f.editCaption,r.recreateForm===!0&&u("#"+c.themodal).html()!==null&&u("#"+c.themodal).remove(),ut=!0,r.checkOnUpdate&&r.jqModal&&!r.modal&&(ut=!1),u("#"+c.themodal).html()!==null){if(v&&(l=v(u("#"+h)),typeof l=="undefined"&&(l=!0)),l===!1)return;pt(),u(".ui-jqdialog-title","#"+c.modalhead).html(r.caption),u("#FormError","#"+s).hide(),f.topinfo?(u(".topinfo","#"+s+"_2").html(f.topinfo),u(".tinfo","#"+s+"_2").show()):u(".tinfo","#"+s+"_2").hide(),f.bottominfo?(u(".bottominfo","#"+s+"_2").html(f.bottominfo),u(".binfo","#"+s+"_2").show()):u(".binfo","#"+s+"_2").hide(),nt(n,o,h),n=="_empty"||!f.viewPagerButtons?u("#pData, #nData","#"+s+"_2").hide():u("#pData, #nData","#"+s+"_2").show(),f.processing===!0&&(f.processing=!1,u("#sData","#"+s+"_2").removeClass("ui-state-active")),u("#"+h).data("disabled")===!0&&(u(".confirm","#"+c.themodal).hide(),u("#"+h).data("disabled",!1)),b&&b(u("#"+h)),u("#"+c.themodal).data("onClose",f.onClose),u.jgrid.viewModal("#"+c.themodal,{gbox:"#gbox_"+a,jqm:r.jqModal,jqM:!1,overlay:r.overlay,modal:r.modal}),ut||u(".jqmOverlay").click(function(){return w()?(u.jgrid.hideModal("#"+c.themodal,{gb:"#gbox_"+a,jqm:r.jqModal,onClose:f.onClose}),!1):!1}),it&&it(u("#"+h))}else{if(y=isNaN(r.dataheight)?r.dataheight:r.dataheight+"px",y=u("<form name='FormPost' id='"+h+"' class='FormGrid' onSubmit='return false;' style='width:100%;overflow:auto;position:relative;height:"+y+";'><\/form>").data("disabled",!1),k=u("<table id='"+s+"' class='EditTable' cellspacing='0' cellpadding='0' border='0'><tbody><\/tbody><\/table>"),v&&(l=v(u("#"+h)),typeof l=="undefined"&&(l=!0)),l===!1)return;pt(),u(o.p.colModel).each(function(){var n=this.formoptions;g=Math.max(g,n?n.colpos||0:0),ct=Math.max(ct,n?n.rowpos||0:0)}),u(y).append(k),v=u("<tr id='FormError' style='display:none'><td class='ui-state-error' colspan='"+g*2+"'><\/td><\/tr>"),v[0].rp=0,u(k).append(v),v=u("<tr style='display:none' class='tinfo'><td class='topinfo' colspan='"+g*2+"'>"+f.topinfo+"<\/td><\/tr>"),v[0].rp=0,u(k).append(v),l=(v=o.p.direction=="rtl"?!0:!1)?"nData":"pData",d=v?"pData":"nData",kt(n,o,k,g),l="<a href='javascript:void(0)' id='"+l+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'><\/span><\/div>",d="<a href='javascript:void(0)' id='"+d+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'><\/span><\/div>",ft="<a href='javascript:void(0)' id='sData' class='fm-button ui-state-default ui-corner-all'>"+r.bSubmit+"<\/a>",et="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+r.bCancel+"<\/a>",l="<table border='0' cellspacing='0' cellpadding='0' class='EditTable' id='"+s+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/><\/td><\/tr><tr id='Act_Buttons'><td class='navButton'>"+(v?d+l:l+d)+"<\/td><td class='EditButton'>"+ft+et+"<\/td><\/tr>",l+="<tr style='display:none' class='binfo'><td class='bottominfo' colspan='2'>"+f.bottominfo+"<\/td><\/tr>",l+="<\/tbody><\/table>",ct>0&&(ot=[],u.each(u(k)[0].rows,function(n,t){ot[n]=t}),ot.sort(function(n,t){return n.rp>t.rp?1:n.rp<t.rp?-1:0}),u.each(ot,function(n,t){u("tbody",k).append(t)})),r.gbox="#gbox_"+a,lt=!1,r.closeOnEscape===!0&&(r.closeOnEscape=!1,lt=!0),y=u("<span><\/span>").append(y).append(l),u.jgrid.createModal(c,y,r,"#gview_"+o.p.id,u("#gbox_"+o.p.id)[0]),v&&(u("#pData, #nData","#"+s+"_2").css("float","right"),u(".EditButton","#"+s+"_2").css("text-align","left")),f.topinfo&&u(".tinfo","#"+s+"_2").show(),f.bottominfo&&u(".binfo","#"+s+"_2").show(),l=y=null,u("#"+c.themodal).keydown(function(n){var t=n.target;if(u("#"+h).data("disabled")===!0)return!1;if(f.savekey[0]===!0&&n.which==f.savekey[1]&&t.tagName!="TEXTAREA")return u("#sData","#"+s+"_2").trigger("click"),!1;if(n.which===27)return w()?(lt&&u.jgrid.hideModal(this,{gb:r.gbox,jqm:r.jqModal,onClose:f.onClose}),!1):!1;if(f.navkeys[0]===!0){if(u("#id_g","#"+s).val()=="_empty")return!0;if(n.which==f.navkeys[1])return u("#pData","#"+s+"_2").trigger("click"),!1;if(n.which==f.navkeys[2])return u("#nData","#"+s+"_2").trigger("click"),!1}}),r.checkOnUpdate&&(u("a.ui-jqdialog-titlebar-close span","#"+c.themodal).removeClass("jqmClose"),u("a.ui-jqdialog-titlebar-close","#"+c.themodal).unbind("click").click(function(){return w()?(u.jgrid.hideModal("#"+c.themodal,{gb:"#gbox_"+a,jqm:r.jqModal,onClose:f.onClose}),!1):!1})),r.saveicon=u.extend([!0,"left","ui-icon-disk"],r.saveicon),r.closeicon=u.extend([!0,"left","ui-icon-close"],r.closeicon),r.saveicon[0]===!0&&u("#sData","#"+s+"_2").addClass(r.saveicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+r.saveicon[2]+"'><\/span>"),r.closeicon[0]===!0&&u("#cData","#"+s+"_2").addClass(r.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+r.closeicon[2]+"'><\/span>"),(f.checkOnSubmit||f.checkOnUpdate)&&(ft="<a href='javascript:void(0)' id='sNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+r.bYes+"<\/a>",d="<a href='javascript:void(0)' id='nNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+r.bNo+"<\/a>",et="<a href='javascript:void(0)' id='cNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+r.bExit+"<\/a>",y=r.zIndex||999,y++,u("<div class='ui-widget-overlay jqgrid-overlay confirm' style='z-index:"+y+";display:none;'>&#160;"+(u.browser.msie&&u.browser.version==6?'<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"><\/iframe>':"")+"<\/div><div class='confirm ui-widget-content ui-jqconfirm' style='z-index:"+(y+1)+"'>"+r.saveData+"<br/><br/>"+ft+d+et+"<\/div>").insertAfter("#"+h),u("#sNew","#"+c.themodal).click(function(){return tt(),u("#"+h).data("disabled",!1),u(".confirm","#"+c.themodal).hide(),!1}),u("#nNew","#"+c.themodal).click(function(){return u(".confirm","#"+c.themodal).hide(),u("#"+h).data("disabled",!1),setTimeout(function(){u(":input","#"+h)[0].focus()},0),!1}),u("#cNew","#"+c.themodal).click(function(){return u(".confirm","#"+c.themodal).hide(),u("#"+h).data("disabled",!1),u.jgrid.hideModal("#"+c.themodal,{gb:"#gbox_"+a,jqm:r.jqModal,onClose:f.onClose}),!1})),wt&&wt(u("#"+h)),n=="_empty"||!f.viewPagerButtons?u("#pData,#nData","#"+s+"_2").hide():u("#pData,#nData","#"+s+"_2").show(),b&&b(u("#"+h)),u("#"+c.themodal).data("onClose",f.onClose),u.jgrid.viewModal("#"+c.themodal,{gbox:"#gbox_"+a,jqm:r.jqModal,overlay:r.overlay,modal:r.modal}),ut||u(".jqmOverlay").click(function(){return w()?(u.jgrid.hideModal("#"+c.themodal,{gb:"#gbox_"+a,jqm:r.jqModal,onClose:f.onClose}),!1):!1}),it&&it(u("#"+h)),u(".fm-button","#"+c.themodal).hover(function(){u(this).addClass("ui-state-hover")},function(){u(this).removeClass("ui-state-hover")}),u("#sData","#"+s+"_2").click(function(){return e={},p={},u("#FormError","#"+s).hide(),at(),yt(),e[o.p.id+"_id"]=="_empty"?tt():r.checkOnSubmit===!0?(rt=u.extend({},e,p),(bt=vt(rt,f._savedData))?(u("#"+h).data("disabled",!0),u(".confirm","#"+c.themodal).show()):tt()):tt(),!1}),u("#cData","#"+s+"_2").click(function(){return w()?(u.jgrid.hideModal("#"+c.themodal,{gb:"#gbox_"+a,jqm:r.jqModal,onClose:f.onClose}),!1):!1}),u("#nData","#"+s+"_2").click(function(){if(!w())return!1;u("#FormError","#"+s).hide();var n=ht();if(n[0]=parseInt(n[0],10),n[0]!=-1&&n[1][n[0]+1]){if(u.isFunction(r.onclickPgButtons))r.onclickPgButtons("next",u("#"+h),n[1][n[0]]);nt(n[1][n[0]+1],o,h),u(o).jqGrid("setSelection",n[1][n[0]+1]),u.isFunction(r.afterclickPgButtons)&&r.afterclickPgButtons("next",u("#"+h),n[1][n[0]+1]),st(n[0]+1,n[1].length-1)}return!1}),u("#pData","#"+s+"_2").click(function(){if(!w())return!1;u("#FormError","#"+s).hide();var n=ht();if(n[0]!=-1&&n[1][n[0]-1]){if(u.isFunction(r.onclickPgButtons))r.onclickPgButtons("prev",u("#"+h),n[1][n[0]]);nt(n[1][n[0]-1],o,h),u(o).jqGrid("setSelection",n[1][n[0]-1]),u.isFunction(r.afterclickPgButtons)&&r.afterclickPgButtons("prev",u("#"+h),n[1][n[0]-1]),st(n[0]-1,n[1].length-1)}return!1})}b=ht(),st(b[0],b[1].length-1)}})},viewGridRow:function(n,t){return t=u.extend({top:0,left:0,width:0,height:"auto",dataheight:"auto",modal:!1,overlay:10,drag:!0,resize:!0,jqModal:!0,closeOnEscape:!1,labelswidth:"30%",closeicon:[],navkeys:[!1,38,40],onClose:null,beforeShowForm:null,beforeInitData:null,viewPagerButtons:!0},u.jgrid.view,t||{}),this.each(function(){function a(){(t.closeOnEscape===!0||t.navkeys[0]===!0)&&setTimeout(function(){u(".ui-jqdialog-titlebar-close","#"+c.modalhead).focus()},0)}function tt(n,i,r,f){for(var e,a,o,s=0,w,b,k=[],h=!1,nt="<td class='CaptionTD form-view-label ui-widget-content' width='"+t.labelswidth+"'>&#160;<\/td><td class='DataTD form-view-data ui-helper-reset ui-widget-content'>&#160;<\/td>",d="",tt=["integer","number","currency"],c=0,l=0,v,y,g,p=1;p<=f;p++)d+=p==1?nt:"<td class='CaptionTD form-view-label ui-widget-content'>&#160;<\/td><td class='DataTD form-view-data ui-widget-content'>&#160;<\/td>";return u(i.p.colModel).each(function(){a=this.editrules&&this.editrules.edithidden===!0?!1:this.hidden===!0?!0:!1,a||this.align!=="right"||(this.formatter&&u.inArray(this.formatter,tt)!==-1?c=Math.max(c,parseInt(this.width,10)):l=Math.max(l,parseInt(this.width,10)))}),v=c!==0?c:l!==0?l:0,h=u(i).jqGrid("getInd",n),u(i.p.colModel).each(function(n){var p;if(e=this.name,y=!1,b=(a=this.editrules&&this.editrules.edithidden===!0?!1:this.hidden===!0?!0:!1)?"style='display:none'":"",g=typeof this.viewable!="boolean"?!0:this.viewable,e!=="cb"&&e!=="subgrid"&&e!=="rn"&&g){w=h===!1?"":e==i.p.ExpandColumn&&i.p.treeGrid===!0?u("td:eq("+n+")",i.rows[h]).text():u("td:eq("+n+")",i.rows[h]).html(),y=this.align==="right"&&v!==0?!0:!1,u.extend({},this.editoptions||{},{id:e,name:e});var t=u.extend({},{rowabove:!1,rowcontent:""},this.formoptions||{}),c=parseInt(t.rowpos,10)||s+1,l=parseInt((parseInt(t.colpos,10)||1)*2,10);t.rowabove&&(p=u("<tr><td class='contentinfo' colspan='"+f*2+"'>"+t.rowcontent+"<\/td><\/tr>"),u(r).append(p),p[0].rp=c),o=u(r).find("tr[rowpos="+c+"]"),o.length===0&&(o=u("<tr "+b+" rowpos='"+c+"'><\/tr>").addClass("FormData").attr("id","trv_"+e),u(o).append(d),u(r).append(o),o[0].rp=c),u("td:eq("+(l-2)+")",o[0]).html("<b>"+(typeof t.label=="undefined"?i.p.colNames[n]:t.label)+"<\/b>"),u("td:eq("+(l-1)+")",o[0]).append("<span>"+w+"<\/span>").attr("id","v_"+e),y&&u("td:eq("+(l-1)+") span",o[0]).css({"text-align":"right",width:v+"px"}),k[s]=n,s++}}),s>0&&(n=u("<tr class='FormData' style='display:none'><td class='CaptionTD'><\/td><td colspan='"+(f*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+n+"'/><\/td><\/tr>"),n[0].rp=s+99,u(r).append(n)),k}function y(n,t){var r,f,e=0,o,s;(s=u(t).jqGrid("getInd",n,!0))&&(u("td",s).each(function(n){r=t.p.colModel[n].name,f=t.p.colModel[n].editrules&&t.p.colModel[n].editrules.edithidden===!0?!1:t.p.colModel[n].hidden===!0?!0:!1,r!=="cb"&&r!=="subgrid"&&r!=="rn"&&(o=r==t.p.ExpandColumn&&t.p.treeGrid===!0?u(this).text():u(this).html(),u.extend({},t.p.colModel[n].editoptions||{}),r=u.jgrid.jqID("v_"+r),u("#"+r+" span","#"+i).html(o),f&&u("#"+r,"#"+i).parents("tr:first").hide(),e++)}),e>0&&u("#id_g","#"+i).val(n))}function p(n,t){n===0?u("#pData","#"+i+"_2").addClass("ui-state-disabled"):u("#pData","#"+i+"_2").removeClass("ui-state-disabled"),n==t?u("#nData","#"+i+"_2").addClass("ui-state-disabled"):u("#nData","#"+i+"_2").removeClass("ui-state-disabled")}function w(){var n=u(r).jqGrid("getDataIDs"),t=u("#id_g","#"+i).val();return[u.inArray(t,n),n]}var r=this,e,l,d,nt,v,g;if(r.grid&&n){t.imgpath||(t.imgpath=r.p.imgpath);var s=r.p.id,o="ViewGrid_"+s,i="ViewTbl_"+s,c={themodal:"viewmod"+s,modalhead:"viewhd"+s,modalcontent:"viewcnt"+s,scrollelm:o},h=u.isFunction(t.beforeInitData)?t.beforeInitData:!1,f=!0,b=1,k=0;if(u("#"+c.themodal).html()!==null){if(h&&(f=h(u("#"+o)),typeof f=="undefined"&&(f=!0)),f===!1)return;u(".ui-jqdialog-title","#"+c.modalhead).html(t.caption),u("#FormError","#"+i).hide(),y(n,r),u.isFunction(t.beforeShowForm)&&t.beforeShowForm(u("#"+o)),u.jgrid.viewModal("#"+c.themodal,{gbox:"#gbox_"+s,jqm:t.jqModal,jqM:!1,overlay:t.overlay,modal:t.modal}),a()}else{if(e=isNaN(t.dataheight)?t.dataheight:t.dataheight+"px",e=u("<form name='FormPost' id='"+o+"' class='FormGrid' style='width:100%;overflow:auto;position:relative;height:"+e+";'><\/form>"),l=u("<table id='"+i+"' class='EditTable' cellspacing='1' cellpadding='2' border='0' style='table-layout:fixed'><tbody><\/tbody><\/table>"),h&&(f=h(u("#"+o)),typeof f=="undefined"&&(f=!0)),f===!1)return;u(r.p.colModel).each(function(){var n=this.formoptions;b=Math.max(b,n?n.colpos||0:0),k=Math.max(k,n?n.rowpos||0:0)}),u(e).append(l),tt(n,r,l,b),h=r.p.direction=="rtl"?!0:!1,f="<a href='javascript:void(0)' id='"+(h?"nData":"pData")+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'><\/span><\/a>",d="<a href='javascript:void(0)' id='"+(h?"pData":"nData")+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'><\/span><\/a>",nt="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+t.bClose+"<\/a>",k>0&&(v=[],u.each(u(l)[0].rows,function(n,t){v[n]=t}),v.sort(function(n,t){return n.rp>t.rp?1:n.rp<t.rp?-1:0}),u.each(v,function(n,t){u("tbody",l).append(t)})),t.gbox="#gbox_"+s,g=!1,t.closeOnEscape===!0&&(t.closeOnEscape=!1,g=!0),e=u("<span><\/span>").append(e).append("<table border='0' class='EditTable' id='"+i+"_2'><tbody><tr id='Act_Buttons'><td class='navButton' width='"+t.labelswidth+"'>"+(h?d+f:f+d)+"<\/td><td class='EditButton'>"+nt+"<\/td><\/tr><\/tbody><\/table>"),u.jgrid.createModal(c,e,t,"#gview_"+r.p.id,u("#gview_"+r.p.id)[0]),h&&(u("#pData, #nData","#"+i+"_2").css("float","right"),u(".EditButton","#"+i+"_2").css("text-align","left")),t.viewPagerButtons||u("#pData, #nData","#"+i+"_2").hide(),e=null,u("#"+c.themodal).keydown(function(n){if(n.which===27)return g&&u.jgrid.hideModal(this,{gb:t.gbox,jqm:t.jqModal,onClose:t.onClose}),!1;if(t.navkeys[0]===!0){if(n.which===t.navkeys[1])return u("#pData","#"+i+"_2").trigger("click"),!1;if(n.which===t.navkeys[2])return u("#nData","#"+i+"_2").trigger("click"),!1}}),t.closeicon=u.extend([!0,"left","ui-icon-close"],t.closeicon),t.closeicon[0]===!0&&u("#cData","#"+i+"_2").addClass(t.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+t.closeicon[2]+"'><\/span>"),u.isFunction(t.beforeShowForm)&&t.beforeShowForm(u("#"+o)),u.jgrid.viewModal("#"+c.themodal,{gbox:"#gbox_"+s,jqm:t.jqModal,modal:t.modal}),u(".fm-button:not(.ui-state-disabled)","#"+i+"_2").hover(function(){u(this).addClass("ui-state-hover")},function(){u(this).removeClass("ui-state-hover")}),a(),u("#cData","#"+i+"_2").click(function(){return u.jgrid.hideModal("#"+c.themodal,{gb:"#gbox_"+s,jqm:t.jqModal,onClose:t.onClose}),!1}),u("#nData","#"+i+"_2").click(function(){u("#FormError","#"+i).hide();var n=w();if(n[0]=parseInt(n[0],10),n[0]!=-1&&n[1][n[0]+1]){if(u.isFunction(t.onclickPgButtons))t.onclickPgButtons("next",u("#"+o),n[1][n[0]]);y(n[1][n[0]+1],r),u(r).jqGrid("setSelection",n[1][n[0]+1]),u.isFunction(t.afterclickPgButtons)&&t.afterclickPgButtons("next",u("#"+o),n[1][n[0]+1]),p(n[0]+1,n[1].length-1)}return a(),!1}),u("#pData","#"+i+"_2").click(function(){u("#FormError","#"+i).hide();var n=w();if(n[0]!=-1&&n[1][n[0]-1]){if(u.isFunction(t.onclickPgButtons))t.onclickPgButtons("prev",u("#"+o),n[1][n[0]]);y(n[1][n[0]-1],r),u(r).jqGrid("setSelection",n[1][n[0]-1]),u.isFunction(t.afterclickPgButtons)&&t.afterclickPgButtons("prev",u("#"+o),n[1][n[0]-1]),p(n[0]-1,n[1].length-1)}return a(),!1})}e=w(),p(e[0],e[1].length-1)}})},delGridRow:function(n,i){return f=i=u.extend({top:0,left:0,width:240,height:"auto",dataheight:"auto",modal:!1,overlay:10,drag:!0,resize:!0,url:"",mtype:"POST",reloadAfterSubmit:!0,beforeShowForm:null,beforeInitData:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,jqModal:!0,closeOnEscape:!1,delData:{},delicon:[],cancelicon:[],onClose:null,ajaxDelOptions:{},processing:!1,serializeDelData:null,useDataProxy:!1},u.jgrid.del,i||{}),this.each(function(){var e=this,o;if(e.grid&&n){var p=typeof i.beforeShowForm=="function"?!0:!1,k=typeof i.afterShowForm=="function"?!0:!1,a=u.isFunction(i.beforeInitData)?i.beforeInitData:!1,s=e.p.id,y={},h=!0,r="DelTbl_"+s,l,w,v,b,c={themodal:"delmod"+s,modalhead:"delhd"+s,modalcontent:"delcnt"+s,scrollelm:r};if(t.isArray(n)&&(n=n.join()),u("#"+c.themodal).html()!==null){if(a&&(h=a(u("#"+r)),typeof h=="undefined"&&(h=!0)),h===!1)return;u("#DelData>td","#"+r).text(n),u("#DelError","#"+r).hide(),f.processing===!0&&(f.processing=!1,u("#dData","#"+r).removeClass("ui-state-active")),p&&i.beforeShowForm(u("#"+r)),u.jgrid.viewModal("#"+c.themodal,{gbox:"#gbox_"+s,jqm:i.jqModal,jqM:!1,overlay:i.overlay,modal:i.modal})}else{if(o=isNaN(i.dataheight)?i.dataheight:i.dataheight+"px",o="<div id='"+r+"' class='formdata' style='width:100%;overflow:auto;position:relative;height:"+o+";'>",o+="<table class='DelTable'><tbody>",o+="<tr id='DelError' style='display:none'><td class='ui-state-error'><\/td><\/tr>",o+="<tr id='DelData' style='display:none'><td >"+n+"<\/td><\/tr>",o+='<tr><td class="delmsg" style="white-space:pre;">'+i.msg+"<\/td><\/tr><tr><td >&#160;<\/td><\/tr>",o+="<\/tbody><\/table><\/div>",o+="<table cellspacing='0' cellpadding='0' border='0' class='EditTable' id='"+r+"_2'><tbody><tr><td><hr class='ui-widget-content' style='margin:1px'/><\/td><\/tr><\/tr><tr><td class='DelButton EditButton'>"+("<a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'>"+i.bSubmit+"<\/a>")+"&#160;"+("<a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'>"+i.bCancel+"<\/a>")+"<\/td><\/tr><\/tbody><\/table>",i.gbox="#gbox_"+s,u.jgrid.createModal(c,o,i,"#gview_"+e.p.id,u("#gview_"+e.p.id)[0]),a&&(h=a(u("#"+r)),typeof h=="undefined"&&(h=!0)),h===!1)return;u(".fm-button","#"+r+"_2").hover(function(){u(this).addClass("ui-state-hover")},function(){u(this).removeClass("ui-state-hover")}),i.delicon=u.extend([!0,"left","ui-icon-scissors"],i.delicon),i.cancelicon=u.extend([!0,"left","ui-icon-cancel"],i.cancelicon),i.delicon[0]===!0&&u("#dData","#"+r+"_2").addClass(i.delicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+i.delicon[2]+"'><\/span>"),i.cancelicon[0]===!0&&u("#eData","#"+r+"_2").addClass(i.cancelicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+i.cancelicon[2]+"'><\/span>"),u("#dData","#"+r+"_2").click(function(){var n=[!0,""],t,o;return y={},t=u("#DelData>td","#"+r).text(),typeof i.onclickSubmit=="function"&&(y=i.onclickSubmit(f,t)||{}),typeof i.beforeSubmit=="function"&&(n=i.beforeSubmit(t)),n[0]&&!f.processing&&(f.processing=!0,u(this).addClass("ui-state-active"),v=e.p.prmNames,l=u.extend({},f.delData,y),b=v.oper,l[b]=v.deloper,w=v.id,l[w]=t,o=u.extend({url:f.url?f.url:u(e).jqGrid("getGridParam","editurl"),type:i.mtype,data:u.isFunction(i.serializeDelData)?i.serializeDelData(l):l,complete:function(o,h){var a,v;if(h!="success"?(n[0]=!1,n[1]=u.isFunction(f.errorTextFormat)?f.errorTextFormat(o):h+" Status: '"+o.statusText+"'. Error code: "+o.status):typeof f.afterSubmit=="function"&&(n=f.afterSubmit(o,l)),n[0]===!1)u("#DelError>td","#"+r).html(n[1]),u("#DelError","#"+r).show();else{if(f.reloadAfterSubmit&&e.p.datatype!="local")u(e).trigger("reloadGrid");else{if(a=[],a=t.split(","),e.p.treeGrid===!0)try{u(e).jqGrid("delTreeNode",a[0])}catch(y){}else for(v=0;v<a.length;v++)u(e).jqGrid("delRowData",a[v]);e.p.selrow=null,e.p.selarrrow=[]}u.isFunction(f.afterComplete)&&setTimeout(function(){f.afterComplete(o,t)},500)}f.processing=!1,u("#dData","#"+r+"_2").removeClass("ui-state-active"),n[0]&&u.jgrid.hideModal("#"+c.themodal,{gb:"#gbox_"+s,jqm:i.jqModal,onClose:f.onClose})}},u.jgrid.ajaxOptions,i.ajaxDelOptions),o.url||f.useDataProxy||(u.isFunction(e.p.dataProxy)?f.useDataProxy=!0:(n[0]=!1,n[1]+=" "+u.jgrid.errors.nourl)),n[0]&&(f.useDataProxy?e.p.dataProxy.call(e,o,"del_"+e.p.id):u.ajax(o))),n[0]===!1&&(u("#DelError>td","#"+r).html(n[1]),u("#DelError","#"+r).show()),!1}),u("#eData","#"+r+"_2").click(function(){return u.jgrid.hideModal("#"+c.themodal,{gb:"#gbox_"+s,jqm:i.jqModal,onClose:f.onClose}),!1}),p&&i.beforeShowForm(u("#"+r)),u.jgrid.viewModal("#"+c.themodal,{gbox:"#gbox_"+s,jqm:i.jqModal,overlay:i.overlay,modal:i.modal})}k&&i.afterShowForm(u("#"+r)),i.closeOnEscape===!0&&setTimeout(function(){u(".ui-jqdialog-titlebar-close","#"+c.modalhead).focus()},0)}})},navGrid:function(n,t,i,r,f,e,o){return t=u.extend({edit:!0,editicon:"ui-icon-pencil",add:!0,addicon:"ui-icon-plus",del:!0,delicon:"ui-icon-trash",search:!0,searchicon:"ui-icon-search",refresh:!0,refreshicon:"ui-icon-refresh",refreshstate:"firstpage",view:!1,viewicon:"ui-icon-document",position:"left",closeOnEscape:!0,beforeRefresh:null,afterRefresh:null,cloneToTop:!1},u.jgrid.nav,t||{}),this.each(function(){var p,h,a,v,s,c,y,l;if(!this.nav&&(p={themodal:"alertmod",modalhead:"alerthd",modalcontent:"alertcnt"},h=this,!(!h.grid||typeof n!="string")))for(u("#"+p.themodal).html()===null&&(typeof window.innerWidth!="undefined"?(a=window.innerWidth,v=window.innerHeight):typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!==0?(a=document.documentElement.clientWidth,v=document.documentElement.clientHeight):(a=1024,v=768),u.jgrid.createModal(p,"<div>"+t.alerttext+"<\/div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'><\/span><\/span>",{gbox:"#gbox_"+h.p.id,jqModal:!0,drag:!0,resize:!0,caption:t.alertcap,top:v/2-25,left:a/2-100,width:200,height:"auto",closeOnEscape:t.closeOnEscape},"","",!0)),a=1,t.cloneToTop&&h.p.toppager&&(a=2),v=0;v<a;v++)c=u("<table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr><\/tr><\/tbody><\/table>"),v===0?(y=n,l=h.p.id,y==h.p.toppager&&(l+="_top",a=1)):(y=h.p.toppager,l=h.p.id+"_top"),h.p.direction=="rtl"&&u(c).attr("dir","rtl").css("float","right"),t.add&&(r=r||{},s=u("<td class='ui-pg-button ui-corner-all'><\/td>"),u(s).append("<div class='ui-pg-div'><span class='ui-icon "+t.addicon+"'><\/span>"+t.addtext+"<\/div>"),u("tr",c).append(s),u(s,c).attr({title:t.addtitle||"",id:r.id||"add_"+l}).click(function(){return u(this).hasClass("ui-state-disabled")||(typeof t.addfunc=="function"?t.addfunc():u(h).jqGrid("editGridRow","new",r)),!1}).hover(function(){u(this).hasClass("ui-state-disabled")||u(this).addClass("ui-state-hover")},function(){u(this).removeClass("ui-state-hover")}),s=null),t.edit&&(s=u("<td class='ui-pg-button ui-corner-all'><\/td>"),i=i||{},u(s).append("<div class='ui-pg-div'><span class='ui-icon "+t.editicon+"'><\/span>"+t.edittext+"<\/div>"),u("tr",c).append(s),u(s,c).attr({title:t.edittitle||"",id:i.id||"edit_"+l}).click(function(){if(!u(this).hasClass("ui-state-disabled")){var n=h.p.selrow;n?typeof t.editfunc=="function"?t.editfunc(n):u(h).jqGrid("editGridRow",n,i):(u.jgrid.viewModal("#"+p.themodal,{gbox:"#gbox_"+h.p.id,jqm:!0}),u("#jqg_alrt").focus())}return!1}).hover(function(){u(this).hasClass("ui-state-disabled")||u(this).addClass("ui-state-hover")},function(){u(this).removeClass("ui-state-hover")}),s=null),t.view&&(s=u("<td class='ui-pg-button ui-corner-all'><\/td>"),o=o||{},u(s).append("<div class='ui-pg-div'><span class='ui-icon "+t.viewicon+"'><\/span>"+t.viewtext+"<\/div>"),u("tr",c).append(s),u(s,c).attr({title:t.viewtitle||"",id:o.id||"view_"+l}).click(function(){if(!u(this).hasClass("ui-state-disabled")){var n=h.p.selrow;n?u(h).jqGrid("viewGridRow",n,o):(u.jgrid.viewModal("#"+p.themodal,{gbox:"#gbox_"+h.p.id,jqm:!0}),u("#jqg_alrt").focus())}return!1}).hover(function(){u(this).hasClass("ui-state-disabled")||u(this).addClass("ui-state-hover")},function(){u(this).removeClass("ui-state-hover")}),s=null),t.del&&(s=u("<td class='ui-pg-button ui-corner-all'><\/td>"),f=f||{},u(s).append("<div class='ui-pg-div'><span class='ui-icon "+t.delicon+"'><\/span>"+t.deltext+"<\/div>"),u("tr",c).append(s),u(s,c).attr({title:t.deltitle||"",id:f.id||"del_"+l}).click(function(){if(!u(this).hasClass("ui-state-disabled")){var n;h.p.multiselect?(n=h.p.selarrrow,n.length===0&&(n=null)):n=h.p.selrow,n?"function"==typeof t.delfunc?t.delfunc(n):u(h).jqGrid("delGridRow",n,f):(u.jgrid.viewModal("#"+p.themodal,{gbox:"#gbox_"+h.p.id,jqm:!0}),u("#jqg_alrt").focus())}return!1}).hover(function(){u(this).hasClass("ui-state-disabled")||u(this).addClass("ui-state-hover")},function(){u(this).removeClass("ui-state-hover")}),s=null),(t.add||t.edit||t.del||t.view)&&u("tr",c).append("<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'><\/span><\/td>"),t.search&&(s=u("<td class='ui-pg-button ui-corner-all'><\/td>"),e=e||{},u(s).append("<div class='ui-pg-div'><span class='ui-icon "+t.searchicon+"'><\/span>"+t.searchtext+"<\/div>"),u("tr",c).append(s),u(s,c).attr({title:t.searchtitle||"",id:e.id||"search_"+l}).click(function(){return u(this).hasClass("ui-state-disabled")||u(h).jqGrid("searchGrid",e),!1}).hover(function(){u(this).hasClass("ui-state-disabled")||u(this).addClass("ui-state-hover")},function(){u(this).removeClass("ui-state-hover")}),e.showOnLoad&&e.showOnLoad===!0&&u(s,c).click(),s=null),t.refresh&&(s=u("<td class='ui-pg-button ui-corner-all'><\/td>"),u(s).append("<div class='ui-pg-div'><span class='ui-icon "+t.refreshicon+"'><\/span>"+t.refreshtext+"<\/div>"),u("tr",c).append(s),u(s,c).attr({title:t.refreshtitle||"",id:"refresh_"+l}).click(function(){if(!u(this).hasClass("ui-state-disabled")){u.isFunction(t.beforeRefresh)&&t.beforeRefresh(),h.p.search=!1;try{var n=h.p.id;h.p.postData.filters="",u("#fbox_"+n).jqFilter("resetFilter"),u.isFunction(h.clearToolbar)&&h.clearToolbar(!1)}catch(i){}switch(t.refreshstate){case"firstpage":u(h).trigger("reloadGrid",[{page:1}]);break;case"current":u(h).trigger("reloadGrid",[{current:!0}])}u.isFunction(t.afterRefresh)&&t.afterRefresh()}return!1}).hover(function(){u(this).hasClass("ui-state-disabled")||u(this).addClass("ui-state-hover")},function(){u(this).removeClass("ui-state-hover")}),s=null),s=u(".ui-jqgrid").css("font-size")||"11px",u("body").append("<div id='testpg2' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+s+";visibility:hidden;' ><\/div>"),s=u(c).clone().appendTo("#testpg2").width(),u("#testpg2").remove(),u(y+"_"+t.position,y).append(c),h.p._nvtd&&(s>h.p._nvtd[0]&&(u(y+"_"+t.position,y).width(s),h.p._nvtd[0]=s),h.p._nvtd[1]=s),c=s=s=null,this.nav=!0})},navButtonAdd:function(n,t){return t=u.extend({caption:"newButton",title:"",buttonicon:"ui-icon-newwin",onClickButton:null,position:"last",cursor:"pointer"},t||{}),this.each(function(){var i,f,r;this.grid&&(n.indexOf("#")!==0&&(n="#"+n),i=u(".navtable",n)[0],f=this,i&&(t.id&&u("#"+t.id,i).html()!==null||(r=u("<td><\/td>"),t.buttonicon.toString().toUpperCase()=="NONE"?u(r).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'>"+t.caption+"<\/div>"):u(r).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'><span class='ui-icon "+t.buttonicon+"'><\/span>"+t.caption+"<\/div>"),t.id&&u(r).attr("id",t.id),t.position=="first"?i.rows[0].cells.length===0?u("tr",i).append(r):u("tr td:eq(0)",i).before(r):u("tr",i).append(r),u(r,i).attr("title",t.title||"").click(function(n){return u(this).hasClass("ui-state-disabled")||u.isFunction(t.onClickButton)&&t.onClickButton.call(f,n),!1}).hover(function(){u(this).hasClass("ui-state-disabled")||u(this).addClass("ui-state-hover")},function(){u(this).removeClass("ui-state-hover")}))))})},navSeparatorAdd:function(n,t){return t=u.extend({sepclass:"ui-separator",sepcontent:""},t||{}),this.each(function(){var i,r;this.grid&&(n.indexOf("#")!==0&&(n="#"+n),i=u(".navtable",n)[0],i&&(r="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='"+t.sepclass+"'><\/span>"+t.sepcontent+"<\/td>",u("tr",i).append(r)))})},GridToForm:function(n,t){return this.each(function(){var r,i;if(this.grid&&(r=u(this).jqGrid("getRowData",n),r))for(i in r)u("[name="+u.jgrid.jqID(i)+"]",t).is("input:radio")||u("[name="+u.jgrid.jqID(i)+"]",t).is("input:checkbox")?u("[name="+u.jgrid.jqID(i)+"]",t).each(function(){u(this).val()==r[i]?u(this).attr("checked","checked"):u(this).attr("checked","")}):u("[name="+u.jgrid.jqID(i)+"]",t).val(r[i])})},FormToGrid:function(n,t,i,r){return this.each(function(){if(this.grid){i||(i="set"),r||(r="first");var e=u(t).serializeArray(),f={};u.each(e,function(n,t){f[t.name]=t.value}),i=="add"?u(this).jqGrid("addRowData",n,f,r):i=="set"&&u(this).jqGrid("setRowData",n,f)}})}})}(t),function(n){n.fn.jqFilter=function(t){var r,u,i;if(typeof t=="string"){if(r=n.fn.jqFilter[t],!r)throw"jqFilter - No such method: "+t;return u=n.makeArray(arguments).slice(1),r.apply(this,u)}return i=n.extend(!0,{filter:null,columns:[],onChange:null,checkValues:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,sopt:null,ops:[{name:"eq",description:"equal",operator:"="},{name:"ne",description:"not equal",operator:"<>"},{name:"lt",description:"less",operator:"<"},{name:"le",description:"less or equal",operator:"<="},{name:"gt",description:"greater",operator:">"},{name:"ge",description:"greater or equal",operator:">="},{name:"bw",description:"begins with",operator:"LIKE"},{name:"bn",description:"does not begin with",operator:"NOT LIKE"},{name:"in",description:"in",operator:"IN"},{name:"ni",description:"not in",operator:"NOT IN"},{name:"ew",description:"ends with",operator:"LIKE"},{name:"en",description:"does not end with",operator:"NOT LIKE"},{name:"cn",description:"contains",operator:"LIKE"},{name:"nc",description:"does not contain",operator:"NOT LIKE"},{name:"nu",description:"is null",operator:"IS NULL"},{name:"nn",description:"is not null",operator:"IS NOT NULL"}],numopts:["eq","ne","lt","le","gt","ge","nu","nn","in","ni"],stropts:["eq","ne","bw","bn","ew","en","cn","nc","nu","nn","in","ni"],_gridsopt:[],groupOps:["AND","OR"],groupButton:!0},t||{}),this.each(function(){var r,u,t,f,e;if(!this.filter){if(this.p=i,(this.p.filter===null||this.p.filter===undefined)&&(this.p.filter={groupOp:this.p.groupOps[0],rules:[],groups:[]}),u=this.p.columns.length,f=/msie/i.test(navigator.userAgent)&&!window.opera,this.p._gridsopt.length)for(r=0;r<this.p._gridsopt.length;r++)this.p.ops[r].description=this.p._gridsopt[r];if(this.p.initFilter=n.extend(!0,{},this.p.filter),u){for(r=0;r<u;r++)t=this.p.columns[r],t.stype?t.inputtype=t.stype:t.inputtype||(t.inputtype="text"),t.sorttype?t.searchtype=t.sorttype:t.searchtype||(t.searchtype="string"),t.hidden===undefined&&(t.hidden=!1),t.label||(t.label=t.name),t.index&&(t.name=t.index),t.hasOwnProperty("searchoptions")||(t.searchoptions={}),t.hasOwnProperty("searchrules")||(t.searchrules={});this.p.showQuery&&n(this).append("<table class='queryresult ui-widget ui-widget-content' style='display:block;max-width:440px;border:0px none;'><tbody><tr><td class='query'><\/td><\/tr><\/tbody><\/table>"),e=function(t,r){var u=[!0,""];if(n.isFunction(r.searchrules))u=r.searchrules(t,r);else if(n.jgrid&&n.jgrid.checkValues)try{u=n.jgrid.checkValues(t,-1,null,r.searchrules,r.label)}catch(f){}u&&u.length&&u[0]===!1&&(i.error=!u[0],i.errmsg=u[1])},this.onchange=function(){return this.p.error=!1,this.p.errmsg="",n.isFunction(this.p.onChange)?this.p.onChange.call(this,this.p):!1},this.reDraw=function(){n("table.group:first",this).remove();var t=this.createTableForGroup(i.filter,null);n(this).append(t)},this.createTableForGroup=function(t,r){var e=this,u,s=n("<table class='group ui-widget ui-widget-content' style='border:0px none;'><tbody><\/tbody><\/table>"),f,o,c,l,h;for(r===null&&n(s).append("<tr class='error' style='display:none;'><th colspan='5' class='ui-state-error' align='left'><\/th><\/tr>"),f=n("<tr><\/tr>"),n(s).append(f),o=n("<th colspan='5' align='left'><\/th>"),f.append(o),c=n("<select class='opsel'><\/select>"),o.append(c),f="",u=0;u<i.groupOps.length;u++)l=t.groupOp===e.p.groupOps[u]?" selected='selected'":"",f+="<option value='"+e.p.groupOps[u]+"'"+l+">"+e.p.groupOps[u]+"<\/option>";if(c.append(f).bind("change",function(){t.groupOp=n(c).val(),e.onchange()}),f="<span><\/span>",this.p.groupButton&&(f=n("<input type='button' value='+ {}' title='Add subgroup' class='add-group'/>"),f.bind("click",function(){return t.groups===undefined&&(t.groups=[]),t.groups.push({groupOp:i.groupOps[0],rules:[],groups:[]}),e.reDraw(),e.onchange(),!1})),o.append(f),f=n("<input type='button' value='+' title='Add rule' class='add-rule ui-add'/>"),f.bind("click",function(){for(t.rules===undefined&&(t.rules=[]),u=0;u<e.p.columns.length;u++){var n=typeof e.p.columns[u].search=="undefined"?!0:e.p.columns[u].search,i=e.p.columns[u].hidden===!0;if(e.p.columns[u].searchoptions.searchhidden===!0&&n||n&&!i){h=e.p.columns[u];break}}return t.rules.push({field:h.name,op:(h.searchoptions.sopt?h.searchoptions.sopt:e.p.sopt?e.p.sopt:h.searchtype==="string"?e.p.stropts:e.p.numopts)[0],data:""}),e.reDraw(),!1}),o.append(f),r!==null&&(f=n("<input type='button' value='-' title='Delete group' class='delete-group'/>"),o.append(f),f.bind("click",function(){for(u=0;u<r.groups.length;u++)if(r.groups[u]===t){r.groups.splice(u,1);break}return e.reDraw(),e.onchange(),!1})),t.groups!==undefined)for(u=0;u<t.groups.length;u++)o=n("<tr><\/tr>"),s.append(o),f=n("<td class='first'><\/td>"),o.append(f),f=n("<td colspan='4'><\/td>"),f.append(this.createTableForGroup(t.groups[u],t)),o.append(f);if(t.groupOp===undefined&&(t.groupOp=e.p.groupOps[0]),t.rules!==undefined)for(u=0;u<t.rules.length;u++)s.append(this.createTableRowForRule(t.rules[u],t));return s},this.createTableRowForRule=function(t,r){var u=this,l=n("<tr><\/tr>"),e,p,a,o,s="",c,h,v,w,y;for(l.append("<td class='first'><\/td>"),h=n("<td class='columns'><\/td>"),l.append(h),v=n("<select><\/select>"),h.append(v),v.bind("change",function(){var i,r,s;for(t.field=n(v).val(),a=n(this).parents("tr:first"),e=0;e<u.p.columns.length;e++)if(u.p.columns[e].name===t.field){o=u.p.columns[e];break}if(o){for(o.searchoptions.id=n.jgrid.randId(),f&&o.inputtype==="text"&&(o.searchoptions.size||(o.searchoptions.size=10)),i=n.jgrid.createEl(o.inputtype,o.searchoptions,"",!0,u.p.ajaxSelectOptions,!0),n(i).addClass("input-elm"),p=o.searchoptions.sopt?o.searchoptions.sopt:u.p.sopt?u.p.sopt:o.searchtype==="string"?u.p.stropts:u.p.numopts,r="",s="",e=0;e<u.p.ops.length;e++)n.inArray(u.p.ops[e].name,p)!==-1&&(s=t.op===u.p.ops[e].name?" selected=selected":"",r+="<option value='"+u.p.ops[e].name+"'"+s+">"+u.p.ops[e].description+"<\/option>");n(".selectopts",a).empty().append(r),n(".data",a).empty().append(i),n(".input-elm",a).bind("change",function(){t.data=n(this).val(),n.isArray(t.data)&&(t.data=t.data.join(",")),u.onchange()}),setTimeout(function(){t.data=n(i).val(),u.onchange()},0)}}),e=h=0;e<u.p.columns.length;e++)c=typeof u.p.columns[e].search=="undefined"?!0:u.p.columns[e].search,w=u.p.columns[e].hidden===!0,(u.p.columns[e].searchoptions.searchhidden===!0&&c||c&&!w)&&(c="",t.field===u.p.columns[e].name&&(c=" selected='selected'",h=e),s+="<option value='"+u.p.columns[e].name+"'"+c+">"+u.p.columns[e].label+"<\/option>");for(v.append(s),s=n("<td class='operators'><\/td>"),l.append(s),o=i.columns[h],o.searchoptions.id=n.jgrid.randId(),f&&o.inputtype==="text"&&(o.searchoptions.size||(o.searchoptions.size=10)),h=n.jgrid.createEl(o.inputtype,o.searchoptions,t.data,!0,u.p.ajaxSelectOptions,!0),y=n("<select class='selectopts'><\/select>"),s.append(y),y.bind("change",function(){t.op=n(y).val(),a=n(this).parents("tr:first");var i=n(".input-elm",a)[0];t.op==="nu"||t.op==="nn"?(t.data="",i.value="",i.setAttribute("readonly","true"),i.setAttribute("disabled","true")):(i.removeAttribute("readonly"),i.removeAttribute("disabled")),u.onchange()}),p=o.searchoptions.sopt?o.searchoptions.sopt:u.p.sopt?u.p.sopt:o.searchtype==="string"?i.stropts:u.p.numopts,s="",e=0;e<u.p.ops.length;e++)n.inArray(u.p.ops[e].name,p)!==-1&&(c=t.op===u.p.ops[e].name?" selected='selected'":"",s+="<option value='"+u.p.ops[e].name+"'"+c+">"+u.p.ops[e].description+"<\/option>");return y.append(s),s=n("<td class='data'><\/td>"),l.append(s),s.append(h),n(h).addClass("input-elm").bind("change",function(){t.data=n(this).val(),n.isArray(t.data)&&(t.data=t.data.join(",")),u.onchange()}),s=n("<td><\/td>"),l.append(s),h=n("<input type='button' value='-' title='Delete rule' class='delete-rule ui-del'/>"),s.append(h),h.bind("click",function(){for(e=0;e<r.rules.length;e++)if(r.rules[e]===t){r.rules.splice(e,1);break}return u.reDraw(),u.onchange(),!1}),l},this.getStringForGroup=function(n){var t="(",i;if(n.groups!==undefined)for(i=0;i<n.groups.length;i++){t.length>1&&(t+=" "+n.groupOp+" ");try{t+=this.getStringForGroup(n.groups[i])}catch(r){alert(r)}}if(n.rules!==undefined)try{for(i=0;i<n.rules.length;i++)t.length>1&&(t+=" "+n.groupOp+" "),t+=this.getStringForRule(n.rules[i])}catch(u){alert(u)}return t+=")",t==="()"?"":t},this.getStringForRule=function(t){for(var f="",u="",o,r=0;r<this.p.ops.length;r++)if(this.p.ops[r].name===t.op){f=this.p.ops[r].operator,u=this.p.ops[r].name;break}for(r=0;r<this.p.columns.length;r++)if(this.p.columns[r].name===t.field){o=this.p.columns[r];break}return r=t.data,(u==="bw"||u==="bn")&&(r+="%"),(u==="ew"||u==="en")&&(r="%"+r),(u==="cn"||u==="nc")&&(r="%"+r+"%"),(u==="in"||u==="ni")&&(r=" ("+r+")"),i.errorcheck&&e(t.data,o),n.inArray(o.searchtype,["int","integer","float","number","currency"])!==-1||u==="nn"||u==="nu"?t.field+" "+f+" "+r:t.field+" "+f+' "'+r+'"'},this.resetFilter=function(){this.p.filter=n.extend(!0,{},this.p.initFilter),this.reDraw(),this.onchange()},this.hideError=function(){n("th.ui-state-error",this).html(""),n("tr.error",this).hide()},this.showError=function(){n("th.ui-state-error",this).html(this.p.errmsg),n("tr.error",this).show()},this.toUserFriendlyString=function(){return this.getStringForGroup(i.filter)},this.toString=function(){function t(i){var r="(",u,f,o,s;if(i.groups!==undefined)for(u=0;u<i.groups.length;u++)r.length>1&&(r+=i.groupOp==="OR"?" || ":" && "),r+=t(i.groups[u]);if(i.rules!==undefined)for(u=0;u<i.rules.length;u++){if(r.length>1&&(r+=i.groupOp==="OR"?" || ":" && "),f=i.rules[u],n.p.errorcheck){for(o=void 0,s=void 0,o=0;o<n.p.columns.length;o++)if(n.p.columns[o].name===f.field){s=n.p.columns[o];break}s&&e(f.data,s)}r+=f.op+"(item."+f.field+",'"+f.data+"')"}return r+=")",r==="()"?"":r}var n=this;return t(this.p.filter)},this.reDraw(),this.p.showQuery&&this.onchange(),this.filter=!0}}})},n.extend(n.fn.jqFilter,{toSQLString:function(){var n="";return this.each(function(){n=this.toUserFriendlyString()}),n},filterData:function(){var n;return this.each(function(){n=this.p.filter}),n},getParameter:function(n){return n!==undefined&&this.p.hasOwnProperty(n)?this.p[n]:this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(n){typeof n=="string"&&(n=t.jgrid.parse(n)),this.each(function(){this.p.filter=n,this.reDraw(),this.onchange()})}})}(t),function(n){n.jgrid.extend({editRow:function(t,i,r,u,f,e,o,s,h){var a={keys:i||!1,oneditfunc:r||null,successfunc:u||null,url:f||null,extraparam:e||{},aftersavefunc:o||null,errorfunc:s||null,afterrestorefunc:h||null,restoreAfterErorr:!0},l=n.makeArray(arguments).slice(1),c;return c=l[0]&&typeof l[0]=="object"&&!n.isFunction(l[0])?n.extend(a,l[0]):a,this.each(function(){var i=this,u,e,l=0,o=null,s={},f,r;i.grid&&(f=n(i).jqGrid("getInd",t,!0),f!==!1&&((n(f).attr("editable")||"0")!="0"||n(f).hasClass("not-editable-row")||(r=i.p.colModel,n("td",f).each(function(f){var c,h;if(u=r[f].name,c=i.p.treeGrid===!0&&u==i.p.ExpandColumn,c)e=n("span:first",this).html();else try{e=n.unformat(this,{rowId:t,colModel:r[f]},f)}catch(a){e=n(this).html()}u!="cb"&&u!="subgrid"&&u!="rn"&&(i.p.autoencode&&(e=n.jgrid.htmlDecode(e)),s[u]=e,r[f].editable===!0&&(o===null&&(o=f),c?n("span:first",this).html(""):n(this).html(""),h=n.extend({},r[f].editoptions||{},{id:t+"_"+u,name:u}),r[f].edittype||(r[f].edittype="text"),h=n.jgrid.createEl(r[f].edittype,h,e,!0,n.extend({},n.jgrid.ajaxOptions,i.p.ajaxSelectOptions||{})),n(h).addClass("editable"),c?n("span:first",this).append(h):n(this).append(h),r[f].edittype=="select"&&r[f].editoptions.multiple===!0&&n.browser.msie&&n(h).width(n(h).width()),l++))}),l>0&&(s.id=t,i.p.savedRow.push(s),n(f).attr("editable","1"),n("td:eq("+o+") input",f).focus(),c.keys===!0&&n(f).bind("keydown",function(r){if(r.keyCode===27&&n(i).jqGrid("restoreRow",t,h),r.keyCode===13)return r.target.tagName=="TEXTAREA"?!0:(n(i).jqGrid("saveRow",t,c),!1);r.stopPropagation()}),n.isFunction(c.oneditfunc)&&c.oneditfunc.call(i,t)))))})},saveRow:function(i,r,u,f,e,o,s){var y={successfunc:r||null,url:u||null,extraparam:f||{},aftersavefunc:e||null,errorfunc:o||null,afterrestorefunc:s||null,restoreAfterErorr:!0},k=n.makeArray(arguments).slice(1),l,v,b;l=k[0]&&typeof k[0]=="object"&&!n.isFunction(k[0])?n.extend(y,k[0]):y;var g=!1,h=this[0],a,c={},nt={},tt={},d,p,w;if(!h.grid||(w=n(h).jqGrid("getInd",i,!0),w===!1))return g;if(y=n(w).attr("editable"),l.url=l.url?l.url:h.p.editurl,y==="1"){if(n("td",w).each(function(i){var r,u;if(v=h.p.colModel[i],a=v.name,a!="cb"&&a!="subgrid"&&v.editable===!0&&a!="rn"&&!n(this).hasClass("not-editable-cell")){switch(v.edittype){case"checkbox":r=["Yes","No"],v.editoptions&&(r=v.editoptions.value.split(":")),c[a]=n("input",this).attr("checked")?r[0]:r[1];break;case"text":case"password":case"textarea":case"button":c[a]=n("input, textarea",this).val();break;case"select":v.editoptions.multiple?(r=n("select",this),u=[],c[a]=n(r).val(),c[a]=c[a]?c[a].join(","):"",n("select > option:selected",this).each(function(t,i){u[t]=n(i).text()}),nt[a]=u.join(",")):(c[a]=n("select>option:selected",this).val(),nt[a]=n("select>option:selected",this).text()),v.formatter&&v.formatter=="select"&&(nt={});break;case"custom":try{if(v.editoptions&&n.isFunction(v.editoptions.custom_value)){if(c[a]=v.editoptions.custom_value.call(h,n(".customelement",this),"get"),c[a]===undefined)throw"e2";}else throw"e1";}catch(f){f=="e1"&&n.jgrid.info_dialog(t.jgrid.errors.errcap,"function 'custom_value' "+n.jgrid.edit.msg.nodefined,t.jgrid.edit.bClose),f=="e2"?n.jgrid.info_dialog(t.jgrid.errors.errcap,"function 'custom_value' "+n.jgrid.edit.msg.novalue,t.jgrid.edit.bClose):n.jgrid.info_dialog(t.jgrid.errors.errcap,f.message,t.jgrid.edit.bClose)}}if(p=n.jgrid.checkValues(c[a],i,h),p[0]===!1)return p[1]=c[a]+" "+p[1],!1;h.p.autoencode&&(c[a]=n.jgrid.htmlEncode(c[a])),l.url!=="clientArray"&&v.editoptions&&v.editoptions.NullIfEmpty===!0&&c[a]==""&&(tt[a]="null")}}),p[0]===!1){try{b=n.jgrid.findPos(n("#"+n.jgrid.jqID(i),h.grid.bDiv)[0]),n.jgrid.info_dialog(n.jgrid.errors.errcap,p[1],n.jgrid.edit.bClose,{left:b[0],top:b[1]})}catch(it){alert(p[1])}return g}if(c&&(y=h.p.prmNames,k=y.oper,b=y.id,c[k]=y.editoper,c[b]=i,typeof h.p.inlineData=="undefined"&&(h.p.inlineData={}),c=n.extend({},c,h.p.inlineData,l.extraparam)),l.url=="clientArray"){for(c=n.extend({},c,nt),h.p.autoencode&&n.each(c,function(t,i){c[t]=n.jgrid.htmlDecode(i)}),b=n(h).jqGrid("setRowData",i,c),n(w).attr("editable","0"),y=0;y<h.p.savedRow.length;y++)if(h.p.savedRow[y].id==i){d=y;break}d>=0&&h.p.savedRow.splice(d,1),n.isFunction(l.aftersavefunc)&&l.aftersavefunc.call(h,i,b),g=!0}else n("#lui_"+h.p.id).show(),tt=n.extend({},c,tt),n.ajax(n.extend({url:l.url,data:n.isFunction(h.p.serializeRowData)?h.p.serializeRowData.call(h,tt):tt,type:"POST",async:!1,complete:function(t,r){if(n("#lui_"+h.p.id).hide(),r==="success")if((n.isFunction(l.succesfunc)?l.succesfunc.call(h,t):!0)===!0){h.p.autoencode&&n.each(c,function(t,i){c[t]=n.jgrid.htmlDecode(i)}),c=n.extend({},c,nt),n(h).jqGrid("setRowData",i,c),n(w).attr("editable","0");for(var u=0;u<h.p.savedRow.length;u++)if(h.p.savedRow[u].id==i){d=u;break}d>=0&&h.p.savedRow.splice(d,1),n.isFunction(l.aftersavefunc)&&l.aftersavefunc.call(h,i,t),g=!0}else n.isFunction(l.errorfunc)&&l.errorfunc.call(h,i,t,r),l.restoreAfterError===!0&&n(h).jqGrid("restoreRow",i,l.afterrestorefunc)},error:function(r,u){if(n("#lui_"+h.p.id).hide(),n.isFunction(l.errorfunc))l.errorfunc.call(h,i,r,u);else try{t.jgrid.info_dialog(t.jgrid.errors.errcap,'<div class="ui-state-error">'+r.responseText+"<\/div>",t.jgrid.edit.bClose,{buttonalign:"right"})}catch(f){alert(r.responseText)}l.restoreAfterError===!0&&n(h).jqGrid("restoreRow",i,l.afterrestorefunc)}},n.jgrid.ajaxOptions,h.p.ajaxRowOptions||{}));n(w).unbind("keydown")}return g},restoreRow:function(t,i){return this.each(function(){var r=this,u,e,o={},f;if(r.grid&&(e=n(r).jqGrid("getInd",t,!0),e!==!1)){for(f=0;f<r.p.savedRow.length;f++)if(r.p.savedRow[f].id==t){u=f;break}if(u>=0){if(n.isFunction(n.fn.datepicker))try{n("input.hasDatepicker","#"+n.jgrid.jqID(e.id)).datepicker("hide")}catch(s){}n.each(r.p.colModel,function(){this.editable===!0&&this.name in r.p.savedRow[u]&&!n(this).hasClass("not-editable-cell")&&(o[this.name]=r.p.savedRow[u][this.name])}),n(r).jqGrid("setRowData",t,o),n(e).attr("editable","0").unbind("keydown"),r.p.savedRow.splice(u,1)}n.isFunction(i)&&i.call(r,t)}})}})}(t),function(n){n.jgrid.extend({editCell:function(t,i,r){return this.each(function(){var u=this,e,f,o,s,h;if(!(!u.grid||u.p.cellEdit!==!0)){if(i=parseInt(i,10),u.p.selrow=u.rows[t].id,u.p.knv||n(u).jqGrid("GridNav"),u.p.savedRow.length>0){if(r===!0&&t==u.p.iRow&&i==u.p.iCol)return;n(u).jqGrid("saveCell",u.p.savedRow[0].id,u.p.savedRow[0].ic)}else window.setTimeout(function(){n("#"+u.p.knv).attr("tabindex","-1").focus()},0);if(e=u.p.colModel[i].name,!(e=="subgrid"||e=="cb"||e=="rn")){if(o=n("td:eq("+i+")",u.rows[t]),u.p.colModel[i].editable!==!0||r!==!0||o.hasClass("not-editable-cell"))parseInt(u.p.iCol,10)>=0&&parseInt(u.p.iRow,10)>=0&&(n("td:eq("+u.p.iCol+")",u.rows[u.p.iRow]).removeClass("edit-cell ui-state-highlight"),n(u.rows[u.p.iRow]).removeClass("selected-row ui-state-hover")),o.addClass("edit-cell ui-state-highlight"),n(u.rows[t]).addClass("selected-row ui-state-hover"),n.isFunction(u.p.onSelectCell)&&(f=o.html().replace(/\&#160\;/ig,""),u.p.onSelectCell.call(u,u.rows[t].id,e,f,t,i));else{parseInt(u.p.iCol,10)>=0&&parseInt(u.p.iRow,10)>=0&&(n("td:eq("+u.p.iCol+")",u.rows[u.p.iRow]).removeClass("edit-cell ui-state-highlight"),n(u.rows[u.p.iRow]).removeClass("selected-row ui-state-hover")),n(o).addClass("edit-cell ui-state-highlight"),n(u.rows[t]).addClass("selected-row ui-state-hover");try{f=n.unformat(o,{rowId:u.rows[t].id,colModel:u.p.colModel[i]},i)}catch(c){f=n(o).html()}u.p.autoencode&&(f=n.jgrid.htmlDecode(f)),u.p.colModel[i].edittype||(u.p.colModel[i].edittype="text"),u.p.savedRow.push({id:t,ic:i,name:e,v:f}),n.isFunction(u.p.formatCell)&&(s=u.p.formatCell.call(u,u.rows[t].id,e,f,t,i),s!==undefined&&(f=s)),s=n.extend({},u.p.colModel[i].editoptions||{},{id:t+"_"+e,name:e}),h=n.jgrid.createEl(u.p.colModel[i].edittype,s,f,!0,n.extend({},n.jgrid.ajaxOptions,u.p.ajaxSelectOptions||{})),n.isFunction(u.p.beforeEditCell)&&u.p.beforeEditCell.call(u,u.rows[t].id,e,f,t,i),n(o).html("").append(h).attr("tabindex","0"),window.setTimeout(function(){n(h).focus()},0),n("input, select, textarea",o).bind("keydown",function(r){if(r.keyCode===27&&(n("input.hasDatepicker",o).length>0?n(".ui-datepicker").is(":hidden")?n(u).jqGrid("restoreCell",t,i):n("input.hasDatepicker",o).datepicker("hide"):n(u).jqGrid("restoreCell",t,i)),r.keyCode===13&&n(u).jqGrid("saveCell",t,i),r.keyCode==9){if(u.grid.hDiv.loading)return!1;r.shiftKey?n(u).jqGrid("prevCell",t,i):n(u).jqGrid("nextCell",t,i)}r.stopPropagation()}),n.isFunction(u.p.afterEditCell)&&u.p.afterEditCell.call(u,u.rows[t].id,e,f,t,i)}u.p.iCol=i,u.p.iRow=t}}})},saveCell:function(i,r){return this.each(function(){var u=this,h,y,v,w,l;if(!(!u.grid||u.p.cellEdit!==!0)){if(h=u.p.savedRow.length>=1?0:null,h!==null){var c=n("td:eq("+r+")",u.rows[i]),f,e,o=u.p.colModel[r],a=o.name,s=n.jgrid.jqID(a);switch(o.edittype){case"select":o.editoptions.multiple?(s=n("#"+i+"_"+s,u.rows[i]),y=[],(f=n(s).val())?f.join(","):f="",n("option:selected",s).each(function(t,i){y[t]=n(i).text()}),e=y.join(",")):(f=n("#"+i+"_"+s+">option:selected",u.rows[i]).val(),e=n("#"+i+"_"+s+">option:selected",u.rows[i]).text()),o.formatter&&(e=f);break;case"checkbox":v=["Yes","No"],o.editoptions&&(v=o.editoptions.value.split(":")),e=f=n("#"+i+"_"+s,u.rows[i]).attr("checked")?v[0]:v[1];break;case"password":case"text":case"textarea":case"button":e=f=n("#"+i+"_"+s,u.rows[i]).val();break;case"custom":try{if(o.editoptions&&n.isFunction(o.editoptions.custom_value))if(f=o.editoptions.custom_value.call(u,n(".customelement",c),"get"),f===undefined)throw"e2";else e=f;else throw"e1";}catch(p){p=="e1"&&n.jgrid.info_dialog(t.jgrid.errors.errcap,"function 'custom_value' "+n.jgrid.edit.msg.nodefined,t.jgrid.edit.bClose),p=="e2"?n.jgrid.info_dialog(t.jgrid.errors.errcap,"function 'custom_value' "+n.jgrid.edit.msg.novalue,t.jgrid.edit.bClose):n.jgrid.info_dialog(t.jgrid.errors.errcap,p.message,t.jgrid.edit.bClose)}}if(e!=u.p.savedRow[h].v)if(n.isFunction(u.p.beforeSaveCell)&&(h=u.p.beforeSaveCell.call(u,u.rows[i].id,a,f,i,r))&&(e=f=h),w=n.jgrid.checkValues(f,r,u),w[0]===!0){if(h={},n.isFunction(u.p.beforeSubmitCell)&&((h=u.p.beforeSubmitCell.call(u,u.rows[i].id,a,f,i,r))||(h={})),n("input.hasDatepicker",c).length>0&&n("input.hasDatepicker",c).datepicker("hide"),u.p.cellsubmit=="remote")if(u.p.cellurl)l={},u.p.autoencode&&(f=n.jgrid.htmlEncode(f)),l[a]=f,v=u.p.prmNames,o=v.id,s=v.oper,l[o]=u.rows[i].id,l[s]=v.editoper,l=n.extend(h,l),n("#lui_"+u.p.id).show(),u.grid.hDiv.loading=!0,n.ajax(n.extend({url:u.p.cellurl,data:n.isFunction(u.p.serializeCellData)?u.p.serializeCellData.call(u,l):l,type:"POST",complete:function(t,o){if(n("#lui_"+u.p.id).hide(),u.grid.hDiv.loading=!1,o=="success")if(n.isFunction(u.p.afterSubmitCell)){var s=u.p.afterSubmitCell.call(u,t,l.id,a,f,i,r);s[0]===!0?(n(c).empty(),n(u).jqGrid("setCell",u.rows[i].id,r,e,!1,!1,!0),n(c).addClass("dirty-cell"),n(u.rows[i]).addClass("edited"),n.isFunction(u.p.afterSaveCell)&&u.p.afterSaveCell.call(u,u.rows[i].id,a,f,i,r),u.p.savedRow.splice(0,1)):(n.jgrid.info_dialog(n.jgrid.errors.errcap,s[1],n.jgrid.edit.bClose),n(u).jqGrid("restoreCell",i,r))}else n(c).empty(),n(u).jqGrid("setCell",u.rows[i].id,r,e,!1,!1,!0),n(c).addClass("dirty-cell"),n(u.rows[i]).addClass("edited"),n.isFunction(u.p.afterSaveCell)&&u.p.afterSaveCell.call(u,u.rows[i].id,a,f,i,r),u.p.savedRow.splice(0,1)},error:function(t,f){n("#lui_"+u.p.id).hide(),u.grid.hDiv.loading=!1,n.isFunction(u.p.errorCell)?u.p.errorCell.call(u,t,f):n.jgrid.info_dialog(n.jgrid.errors.errcap,t.status+" : "+t.statusText+"<br/>"+f,n.jgrid.edit.bClose),n(u).jqGrid("restoreCell",i,r)}},n.jgrid.ajaxOptions,u.p.ajaxCellOptions||{}));else try{n.jgrid.info_dialog(n.jgrid.errors.errcap,n.jgrid.errors.nourl,n.jgrid.edit.bClose),n(u).jqGrid("restoreCell",i,r)}catch(b){}u.p.cellsubmit=="clientArray"&&(n(c).empty(),n(u).jqGrid("setCell",u.rows[i].id,r,e,!1,!1,!0),n(c).addClass("dirty-cell"),n(u.rows[i]).addClass("edited"),n.isFunction(u.p.afterSaveCell)&&u.p.afterSaveCell.call(u,u.rows[i].id,a,f,i,r),u.p.savedRow.splice(0,1))}else try{window.setTimeout(function(){n.jgrid.info_dialog(n.jgrid.errors.errcap,f+" "+w[1],n.jgrid.edit.bClose)},100),n(u).jqGrid("restoreCell",i,r)}catch(k){}else n(u).jqGrid("restoreCell",i,r)}n.browser.opera?n("#"+u.p.knv).attr("tabindex","-1").focus():window.setTimeout(function(){n("#"+u.p.knv).attr("tabindex","-1").focus()},0)}})},restoreCell:function(t,i){return this.each(function(){var r=this,u,f;if(!(!r.grid||r.p.cellEdit!==!0)){if(u=r.p.savedRow.length>=1?0:null,u!==null){if(f=n("td:eq("+i+")",r.rows[t]),n.isFunction(n.fn.datepicker))try{n("input.hasDatepicker",f).datepicker("hide")}catch(e){}n(f).empty().attr("tabindex","-1"),n(r).jqGrid("setCell",r.rows[t].id,i,r.p.savedRow[u].v,!1,!1,!0),n.isFunction(r.p.afterRestoreCell)&&r.p.afterRestoreCell.call(r,r.rows[t].id,r.p.savedRow[u].v,t,i),r.p.savedRow.splice(0,1)}window.setTimeout(function(){n("#"+r.p.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(t,i){return this.each(function(){var u=!1,r;if(!(!this.grid||this.p.cellEdit!==!0)){for(r=i+1;r<this.p.colModel.length;r++)if(this.p.colModel[r].editable===!0){u=r;break}u!==!1?n(this).jqGrid("editCell",t,u,!0):this.p.savedRow.length>0&&n(this).jqGrid("saveCell",t,i)}})},prevCell:function(t,i){return this.each(function(){var u=!1,r;if(!(!this.grid||this.p.cellEdit!==!0)){for(r=i-1;r>=0;r--)if(this.p.colModel[r].editable===!0){u=r;break}u!==!1?n(this).jqGrid("editCell",t,u,!0):this.p.savedRow.length>0&&n(this).jqGrid("saveCell",t,i)}})},GridNav:function(){return this.each(function(){function u(i,r,u){if(u.substr(0,1)=="v"){var f=n(t.grid.bDiv)[0].clientHeight,e=n(t.grid.bDiv)[0].scrollTop,o=t.rows[i].offsetTop+t.rows[i].clientHeight,s=t.rows[i].offsetTop;u=="vd"&&o>=f&&(n(t.grid.bDiv)[0].scrollTop=n(t.grid.bDiv)[0].scrollTop+t.rows[i].clientHeight),u=="vu"&&s<e&&(n(t.grid.bDiv)[0].scrollTop=n(t.grid.bDiv)[0].scrollTop-t.rows[i].clientHeight)}u=="h"&&(u=n(t.grid.bDiv)[0].clientWidth,f=n(t.grid.bDiv)[0].scrollLeft,e=t.rows[i].cells[r].offsetLeft,t.rows[i].cells[r].offsetLeft+t.rows[i].cells[r].clientWidth>=u+parseInt(f,10)?n(t.grid.bDiv)[0].scrollLeft=n(t.grid.bDiv)[0].scrollLeft+t.rows[i].cells[r].clientWidth:e<f&&(n(t.grid.bDiv)[0].scrollLeft=n(t.grid.bDiv)[0].scrollLeft-t.rows[i].cells[r].clientWidth))}function f(n,i){var u,r;if(i=="lft")for(u=n+1,r=n;r>=0;r--)if(t.p.colModel[r].hidden!==!0){u=r;break}if(i=="rgt")for(u=n-1,r=n;r<t.p.colModel.length;r++)if(t.p.colModel[r].hidden!==!0){u=r;break}return u}var t=this,e,i,r;!t.grid||t.p.cellEdit!==!0||(t.p.knv=t.p.id+"_kn",e=n("<span style='width:0px;height:0px;background-color:black;' tabindex='0'><span tabindex='-1' style='width:0px;height:0px;background-color:grey' id='"+t.p.knv+"'><\/span><\/span>"),n(e).insertBefore(t.grid.cDiv),n("#"+t.p.knv).focus().keydown(function(e){r=e.keyCode,t.p.direction=="rtl"&&(r==37?r=39:r==39&&(r=37));switch(r){case 38:t.p.iRow-1>0&&(u(t.p.iRow-1,t.p.iCol,"vu"),n(t).jqGrid("editCell",t.p.iRow-1,t.p.iCol,!1));break;case 40:t.p.iRow+1<=t.rows.length-1&&(u(t.p.iRow+1,t.p.iCol,"vd"),n(t).jqGrid("editCell",t.p.iRow+1,t.p.iCol,!1));break;case 37:t.p.iCol-1>=0&&(i=f(t.p.iCol-1,"lft"),u(t.p.iRow,i,"h"),n(t).jqGrid("editCell",t.p.iRow,i,!1));break;case 39:t.p.iCol+1<=t.p.colModel.length-1&&(i=f(t.p.iCol+1,"rgt"),u(t.p.iRow,i,"h"),n(t).jqGrid("editCell",t.p.iRow,i,!1));break;case 13:parseInt(t.p.iCol,10)>=0&&parseInt(t.p.iRow,10)>=0&&n(t).jqGrid("editCell",t.p.iRow,t.p.iCol,!0)}return!1}))})},getChangedCells:function(t){var i=[];return t||(t="all"),this.each(function(){var r=this,u;r.grid&&r.p.cellEdit===!0&&n(r.rows).each(function(f){var e={};n(this).hasClass("edited")&&(n("td",this).each(function(i){if(u=r.p.colModel[i].name,u!=="cb"&&u!=="subgrid")if(t=="dirty"){if(n(this).hasClass("dirty-cell"))try{e[u]=n.unformat(this,{rowId:r.rows[f].id,colModel:r.p.colModel[i]},i)}catch(o){e[u]=n.jgrid.htmlDecode(n(this).html())}}else try{e[u]=n.unformat(this,{rowId:r.rows[f].id,colModel:r.p.colModel[i]},i)}catch(s){e[u]=n.jgrid.htmlDecode(n(this).html())}}),e.id=this.id,i.push(e))})}),i}})}(t),function(n){n.fn.jqm=function(r){var f={overlay:50,closeoverlay:!0,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:t,ajaxText:"",target:t,modal:t,toTop:t,onShow:t,onHide:t,onLoad:t};return this.each(function(){if(this._jqm)return i[this._jqm].c=n.extend({},i[this._jqm].c,r);u++,this._jqm=u,i[u]={c:n.extend(f,n.jqm.params,r),a:t,w:n(this).addClass("jqmID"+u),s:u},f.trigger&&n(this).jqmAddTrigger(f.trigger)})},n.fn.jqmAddClose=function(n){return c(this,n,"jqmHide")},n.fn.jqmAddTrigger=function(n){return c(this,n,"jqmShow")},n.fn.jqmShow=function(t){return this.each(function(){n.jqm.open(this._jqm,t)})},n.fn.jqmHide=function(t){return this.each(function(){n.jqm.close(this._jqm,t)})},n.jqm={hash:{},open:function(u,f){var s=i[u],c=s.c,v="."+c.closeClass,a=parseInt(s.w.css("z-index")),l,y;if(a=a>0?a:3e3,l=n("<div><\/div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":a-1,opacity:c.overlay/100}),s.a)return t;if(s.t=f,s.a=!0,s.w.css("z-index",a),c.modal?(r[0]||setTimeout(function(){h("bind")},1),r.push(u)):c.overlay>0?c.closeoverlay&&s.w.jqmAddClose(l):l=t,s.o=l?l.addClass(c.overlayClass).prependTo("body"):t,e&&(n("html,body").css({height:"100%",width:"100%"}),l)){l=l.css({position:"absolute"})[0];for(y in{Top:1,Left:1})l.style.setExpression(y.toLowerCase(),"(_=(document.documentElement.scroll"+y+" || document.body.scroll"+y+"))+'px'")}return c.ajax?(a=c.target||s.w,l=c.ajax,a=typeof a=="string"?n(a,s.w):n(a),l=l.substr(0,1)=="@"?n(f).attr(l.substring(1)):l,a.html(c.ajaxText).load(l,function(){c.onLoad&&c.onLoad.call(this,s),v&&s.w.jqmAddClose(n(v,s.w)),o(s)})):v&&s.w.jqmAddClose(n(v,s.w)),c.toTop&&s.o&&s.w.before('<span id="jqmP'+s.w[0]._jqm+'"><\/span>').insertAfter(s.o),c.onShow?c.onShow(s):s.w.show(),o(s),t},close:function(u){if(u=i[u],!u.a)return t;if(u.a=t,r[0]&&(r.pop(),r[0]||h("unbind")),u.c.toTop&&u.o&&n("#jqmP"+u.w[0]._jqm).after(u.w).remove(),u.c.onHide)u.c.onHide(u);else u.w.hide(),u.o&&u.o.remove();return t},params:{}};var u=0,i=n.jqm.hash,r=[],e=n.browser.msie&&n.browser.version=="6.0",t=!1,o=function(t){var i=n('<iframe src="javascript:false;document.write(\'\');" class="jqm"><\/iframe>').css({opacity:0});e&&(t.o?t.o.html('<p style="width:100%;height:100%"/>').prepend(i):n("iframe.jqm",t.w)[0]||t.w.prepend(i)),s(t)},s=function(t){try{n(":input:visible",t.w)[0].focus()}catch(i){}},h=function(t){n(document)[t]("keypress",f)[t]("keydown",f)[t]("mousedown",f)},f=function(t){var u=i[r[r.length-1]];return(t=!n(t.target).parents(".jqmID"+u.s)[0])&&s(u),!t},c=function(r,u,f){return r.each(function(){var r=this._jqm;n(u).each(function(){this[f]||(this[f]=[],n(this).click(function(){var n,r;for(n in{jqmShow:1,jqmHide:1})for(r in this[n])i[this[n][r]]&&i[this[n][r]].w[n](this);return t})),this[f].push(r)})})}}(t),function(n){n.fn.jqDrag=function(n){return e(this,n,"d")},n.fn.jqResize=function(n,t){return e(this,n,"r",t)},n.jqDnR={dnr:{},e:0,drag:function(n){return t.k=="d"?i.css({left:t.X+n.pageX-t.pX,top:t.Y+n.pageY-t.pY}):(i.css({width:Math.max(n.pageX-t.pX+t.W,0),height:Math.max(n.pageY-t.pY+t.H,0)}),M1&&r.css({width:Math.max(n.pageX-M1.pX+M1.W,0),height:Math.max(n.pageY-M1.pY+M1.H,0)})),!1},stop:function(){n(document).unbind("mousemove",u.drag).unbind("mouseup",u.stop)}};var u=n.jqDnR,t=u.dnr,i=u.e,r,e=function(u,e,o,s){return u.each(function(){e=e?n(e,u):u,e.bind("mousedown",{e:u,k:o},function(u){var o=u.data,e={};if(i=o.e,r=s?n(s):!1,i.css("position")!="relative")try{i.position(e)}catch(h){}if(t={X:e.left||f("left")||0,Y:e.top||f("top")||0,W:f("width")||i[0].scrollWidth||0,H:f("height")||i[0].scrollHeight||0,pX:u.pageX,pY:u.pageY,k:o.k},M1=r&&o.k!="d"?{X:e.left||f1("left")||0,Y:e.top||f1("top")||0,W:r[0].offsetWidth||f1("width")||0,H:r[0].offsetHeight||f1("height")||0,pX:u.pageX,pY:u.pageY,k:o.k}:!1,n("input.hasDatepicker",i[0])[0])try{n("input.hasDatepicker",i[0]).datepicker("hide")}catch(c){}return n(document).mousemove(n.jqDnR.drag).mouseup(n.jqDnR.stop),!1})})},f=function(n){return parseInt(i.css(n))||!1};f1=function(n){return parseInt(r.css(n))||!1}}(t),function(n){n.jgrid.extend({setSubGrid:function(){return this.each(function(){var t,i;if(this.p.subGridOptions=n.extend({plusicon:"ui-icon-plus",minusicon:"ui-icon-minus",openicon:"ui-icon-carat-1-sw",expandOnLoad:!1,delayOnLoad:50,selectOnExpand:!1,reloadOnExpand:!0},this.p.subGridOptions||{}),this.p.colNames.unshift(""),this.p.colModel.unshift({name:"subgrid",width:n.browser.safari?this.p.subGridWidth+this.p.cellLayout:this.p.subGridWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,fixed:!0}),t=this.p.subGridModel,t[0])for(t[0].align=n.extend([],t[0].align||[]),i=0;i<t[0].name.length;i++)t[0].align[i]=t[0].align[i]||"left"})},addSubGridCell:function(n,t){var i="",r,u;return this.each(function(){i=this.formatCol(n,t),u=this.p.id,r=this.p.subGridOptions.plusicon}),'<td role="grid" aria-describedby="'+u+'_subgrid" class="ui-sgcollapsed sgcollapsed" '+i+"><a href='javascript:void(0);'><span class='ui-icon "+r+"'><\/span><\/a><\/td>"},addSubGrid:function(t){return this.each(function(){var i=this;if(i.grid){var o=function(t,r,u){r=n("<td align='"+i.p.subGridModel[0].align[u]+"'><\/td>").html(r),n(t).append(r)},s=function(t,r){for(var f,s,h=n("<table cellspacing='0' cellpadding='0' border='0'><tbody><\/tbody><\/table>"),e=n("<tr><\/tr>"),u=0;u<i.p.subGridModel[0].name.length;u++)f=n("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+i.p.direction+"'><\/th>"),n(f).html(i.p.subGridModel[0].name[u]),n(f).width(i.p.subGridModel[0].width[u]),n(e).append(f);return n(h).append(e),t&&(s=i.p.xmlReader.subgrid,n(s.root+" "+s.row,t).each(function(){if(e=n("<tr class='ui-widget-content ui-subtblcell'><\/tr>"),s.repeatitems===!0)n(s.cell,this).each(function(t){o(e,n(this).text()||"&#160;",t)});else{var t=i.p.subGridModel[0].mapping||i.p.subGridModel[0].name;if(t)for(u=0;u<t.length;u++)o(e,n(t[u],this).text()||"&#160;",u)}n(h).append(e)})),f=n("table:first",i.grid.bDiv).attr("id")+"_",n("#"+f+r).append(h),i.grid.hDiv.loading=!1,n("#load_"+i.p.id).hide(),!1},h=function(t,r){for(var e,s,c,f,a=n("<table cellspacing='0' cellpadding='0' border='0'><tbody><\/tbody><\/table>"),h=n("<tr><\/tr>"),l,u=0;u<i.p.subGridModel[0].name.length;u++)e=n("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+i.p.direction+"'><\/th>"),n(e).html(i.p.subGridModel[0].name[u]),n(e).width(i.p.subGridModel[0].width[u]),n(h).append(e);if(n(a).append(h),t&&(c=i.p.jsonReader.subgrid,e=t[c.root],typeof e!="undefined"))for(u=0;u<e.length;u++){if(s=e[u],h=n("<tr class='ui-widget-content ui-subtblcell'><\/tr>"),c.repeatitems===!0)for(c.cell&&(s=s[c.cell]),f=0;f<s.length;f++)o(h,s[f]||"&#160;",f);else if(l=i.p.subGridModel[0].mapping||i.p.subGridModel[0].name,l.length)for(f=0;f<l.length;f++)o(h,s[l[f]]||"&#160;",f);n(a).append(h)}return u=n("table:first",i.grid.bDiv).attr("id")+"_",n("#"+u+r).append(a),i.grid.hDiv.loading=!1,n("#load_"+i.p.id).hide(),!1},a=function(t){var f,r,u,e;if(f=n(t).attr("id"),r={nd_:(new Date).getTime()},r[i.p.prmNames.subgridid]=f,!i.p.subGridModel[0])return!1;if(i.p.subGridModel[0].params)for(e=0;e<i.p.subGridModel[0].params.length;e++)for(u=0;u<i.p.colModel.length;u++)i.p.colModel[u].name==i.p.subGridModel[0].params[e]&&(r[i.p.colModel[u].name]=n("td:eq("+u+")",t).text().replace(/\&#160\;/ig,""));if(!i.grid.hDiv.loading){i.grid.hDiv.loading=!0,n("#load_"+i.p.id).show(),i.p.subgridtype||(i.p.subgridtype=i.p.datatype),n.isFunction(i.p.subgridtype)?i.p.subgridtype.call(i,r):i.p.subgridtype=i.p.subgridtype.toLowerCase();switch(i.p.subgridtype){case"xml":case"json":n.ajax(n.extend({type:i.p.mtype,url:i.p.subGridUrl,dataType:i.p.subgridtype,data:n.isFunction(i.p.serializeSubGridData)?i.p.serializeSubGridData.call(i,r):r,complete:function(t){i.p.subgridtype=="xml"?s(t.responseXML,f):h(n.jgrid.parse(t.responseText),f)}},n.jgrid.ajaxOptions,i.p.ajaxSubgridOptions||{}))}}return!1},r,e,c,l=0,u,f;n.each(i.p.colModel,function(){(this.hidden===!0||this.name=="rn"||this.name=="cb")&&l++}),n(i.rows).each(function(o){var s=this;n(s).hasClass("jqgrow")&&(n(this.cells[t]).bind("click",function(){if(f=s.nextSibling,n(this).hasClass("sgcollapsed")){if(e=i.p.id,r=s.id,i.p.subGridOptions.reloadOnExpand!==!0&&(i.p.subGridOptions.reloadOnExpand!==!1||n(f).hasClass("ui-subgrid")))n(f).show();else{if(c=t>=1?"<td colspan='"+t+"'>&#160;<\/td>":"",u=!0,n.isFunction(i.p.subGridBeforeExpand)&&(u=i.p.subGridBeforeExpand.call(i,e+"_"+r,r)),u===!1)return!1;n(s).after("<tr role='row' class='ui-subgrid'>"+c+"<td class='ui-widget-content subgrid-cell'><span class='ui-icon "+i.p.subGridOptions.openicon+"'><\/span><\/td><td colspan='"+parseInt(i.p.colNames.length-1-l,10)+"' class='ui-widget-content subgrid-data'><div id="+e+"_"+r+" class='tablediv'><\/div><\/td><\/tr>"),n.isFunction(i.p.subGridRowExpanded)?i.p.subGridRowExpanded.call(i,e+"_"+r,r):a(s)}n(this).html("<a href='javascript:void(0);'><span class='ui-icon "+i.p.subGridOptions.minusicon+"'><\/span><\/a>").removeClass("sgcollapsed").addClass("sgexpanded"),i.p.subGridOptions.selectOnExpand&&n(i).jqGrid("setSelection",r)}else if(n(this).hasClass("sgexpanded")){if(u=!0,n.isFunction(i.p.subGridRowColapsed)&&(r=s.id,u=i.p.subGridRowColapsed.call(i,e+"_"+r,r)),u===!1)return!1;i.p.subGridOptions.reloadOnExpand===!0?n(f).remove(".ui-subgrid"):n(f).hasClass("ui-subgrid")&&n(f).hide(),n(this).html("<a href='javascript:void(0);'><span class='ui-icon "+i.p.subGridOptions.plusicon+"'><\/span><\/a>").removeClass("sgexpanded").addClass("sgcollapsed")}return!1}),i.p.subGridOptions.expandOnLoad===!0&&setTimeout(function(){n(s.cells[t]).trigger("click")},o*i.p.subGridOptions.delayOnLoad))}),i.subGridXml=function(n,t){s(n,t)},i.subGridJson=function(n,t){h(n,t)}}})},expandSubGridRow:function(t){return this.each(function(){if((this.grid||t)&&this.p.subGrid===!0){var i=n(this).jqGrid("getInd",t,!0);i&&(i=n("td.sgcollapsed",i)[0])&&n(i).trigger("click")}})},collapseSubGridRow:function(t){return this.each(function(){if((this.grid||t)&&this.p.subGrid===!0){var i=n(this).jqGrid("getInd",t,!0);i&&(i=n("td.sgexpanded",i)[0])&&n(i).trigger("click")}})},toggleSubGridRow:function(t){return this.each(function(){var r,i;(this.grid||t)&&this.p.subGrid===!0&&(r=n(this).jqGrid("getInd",t,!0),r&&(i=n("td.sgcollapsed",r)[0],i?n(i).trigger("click"):(i=n("td.sgexpanded",r)[0])&&n(i).trigger("click")))})}})}(t),function(n){n.jgrid.extend({groupingSetup:function(){return this.each(function(){var t=this.p.groupingView,i;if(t!==null&&(typeof t=="object"||n.isFunction(t)))if(t.groupField.length){for(typeof t.visibiltyOnNextGrouping=="undefined"&&(t.visibiltyOnNextGrouping=[]),i=0;i<t.groupField.length;i++)if(t.groupOrder[i]||(t.groupOrder[i]="asc"),t.groupText[i]||(t.groupText[i]="{0}"),typeof t.groupColumnShow[i]!="boolean"&&(t.groupColumnShow[i]=!0),typeof t.groupSummary[i]!="boolean"&&(t.groupSummary[i]=!1),t.groupColumnShow[i]===!0?(t.visibiltyOnNextGrouping[i]=!0,n(this).jqGrid("showCol",t.groupField[i])):(t.visibiltyOnNextGrouping[i]=n("#"+this.p.id+"_"+t.groupField[i]).is(":visible"),n(this).jqGrid("hideCol",t.groupField[i])),t.sortitems[i]=[],t.sortnames[i]=[],t.summaryval[i]=[],t.groupSummary[i]){t.summary[i]=[];for(var u=this.p.colModel,r=0,f=u.length;r<f;r++)u[r].summaryType&&t.summary[i].push({nm:u[r].name,st:u[r].summaryType,v:""})}this.p.scroll=!1,this.p.rownumbers=!1,this.p.subGrid=!1,this.p.treeGrid=!1,this.p.gridview=!0}else this.p.grouping=!1;else this.p.grouping=!1})},groupingPrepare:function(t,i,r,u){return this.each(function(){i[0]+="";var f=i[0].toString().split(" ").join(""),e=this.p.groupingView,o=this;r.hasOwnProperty(f)?r[f].push(t):(r[f]=[],r[f].push(t),e.sortitems[0].push(f),e.sortnames[0].push(n.trim(i[0].toString())),e.summaryval[0][f]=n.extend(!0,[],e.summary[0])),e.groupSummary[0]&&n.each(e.summaryval[0][f],function(){this.v=n.isFunction(this.st)?this.st.call(o,this.v,this.nm,u):n(o).jqGrid("groupingCalculations."+this.st,this.v,this.nm,u)})}),r},groupingToggle:function(t){return this.each(function(){var u=this.p.groupingView,r=t.lastIndexOf("_"),s=t.substring(0,r+1);r=parseInt(t.substring(r+1),10)+1;var f=u.minusicon,h=u.plusicon,i=n("#"+t)[0].nextSibling,e=n("#"+t+" span.tree-wrap-"+this.p.direction),o=!1;if(e.hasClass(f)){if(u.showSummaryOnHide&&u.groupSummary[0]){if(i)for(;i;){if(n(i).hasClass("jqfoot"))break;n(i).hide(),i=i.nextSibling}}else if(i)for(;i;){if(n(i).attr("id")==s+String(r))break;n(i).hide(),i=i.nextSibling}e.removeClass(f).addClass(h),o=!0}else{if(i)for(;i;){if(n(i).attr("id")==s+String(r))break;n(i).show(),i=i.nextSibling}e.removeClass(h).addClass(f),o=!1}n.isFunction(this.p.onClickGroup)&&this.p.onClickGroup.call(this,t,o)}),!1},groupingRender:function(t,i){return this.each(function(){var u=this,r=u.p.groupingView,f="",c="",o,s="",h,l,e;for(r.groupDataSorted||(r.sortitems[0].sort(),r.sortnames[0].sort(),r.groupOrder[0].toLowerCase()=="desc"&&(r.sortitems[0].reverse(),r.sortnames[0].reverse())),s=r.groupCollapse?r.plusicon:r.minusicon,s+=" tree-wrap-"+u.p.direction,e=0;e<i;){if(u.p.colModel[e].name==r.groupField[0]){l=e;break}e++}n.each(r.sortitems[0],function(e,a){var v,b,k;o=u.p.id+"ghead_"+e,c="<span style='cursor:pointer;' class='ui-icon "+s+"' onclick=\"jQuery('#"+u.p.id+"').jqGrid('groupingToggle','"+o+"');return false;\"><\/span>";try{h=u.formatter(o,r.sortnames[0][e],l,r.sortitems[0])}catch(g){h=r.sortnames[0][e]}for(f+='<tr id="'+o+'" role="row" class= "ui-widget-content jqgroup ui-row-'+u.p.direction+'"><td colspan="'+i+'">'+c+n.jgrid.format(r.groupText[0],h,t[a].length)+"<\/td><\/tr>",v=0;v<t[a].length;v++)f+=t[a][v].join("");if(r.groupSummary[0]){v="",r.groupCollapse&&!r.showSummaryOnHide&&(v=' style="display:none;"'),f+="<tr"+v+' role="row" class="ui-widget-content jqfoot ui-row-'+u.p.direction+'">',v=r.summaryval[0][a];for(var p=u.p.colModel,w,d=t[a].length,y=0;y<i;y++)b="<td "+u.formatCol(y,1,"")+">&#160;<\/td>",k="{0}",n.each(v,function(){if(this.nm==p[y].name){p[y].summaryTpl&&(k=p[y].summaryTpl),this.st=="avg"&&this.v&&d>0&&(this.v/=d);try{w=u.formatter("",this.v,y,this)}catch(t){w=this.v}return b="<td "+u.formatCol(y,1,"")+">"+n.jgrid.format(k,w)+"<\/td>",!1}}),f+=b;f+="<\/tr>"}}),n("#"+u.p.id+" tbody:first").append(f),f=null})},groupingGroupBy:function(t,i){return this.each(function(){var u,r;for(typeof t=="string"&&(t=[t]),u=this.p.groupingView,this.p.grouping=!0,r=0;r<u.groupField.length;r++)!u.groupColumnShow[r]&&u.visibiltyOnNextGrouping[r]&&n(this).jqGrid("showCol",u.groupField[r]);for(r=0;r<t.length;r++)u.visibiltyOnNextGrouping[r]=n("#"+this.p.id+"_"+t[r]).is(":visible");this.p.groupingView=n.extend(this.p.groupingView,i||{}),u.groupField=t,n(this).trigger("reloadGrid")})},groupingRemove:function(t){return this.each(function(){if(typeof t=="undefined"&&(t=!0),this.p.grouping=!1,t===!0){for(var i=this.p.groupingView,r=0;r<i.groupField.length;r++)!i.groupColumnShow[r]&&i.visibiltyOnNextGrouping[r]&&n(this).jqGrid("showCol",i.groupField);n("tr.jqgroup, tr.jqfoot","#"+this.p.id+" tbody:first").remove(),n("tr.jqgrow:hidden","#"+this.p.id+" tbody:first").show()}else n(this).trigger("reloadGrid")})},groupingCalculations:{sum:function(n,t,i){return parseFloat(n||0)+parseFloat(i[t]||0)},min:function(n,t,i){return n===""?parseFloat(i[t]||0):Math.min(parseFloat(n),parseFloat(i[t]||0))},max:function(n,t,i){return n===""?parseFloat(i[t]||0):Math.max(parseFloat(n),parseFloat(i[t]||0))},count:function(n,t,i){return n===""&&(n=0),i.hasOwnProperty(t)?n+1:0},avg:function(n,t,i){return parseFloat(n||0)+parseFloat(i[t]||0)}}})}(t),function(n){n.jgrid.extend({setTreeNode:function(t,i){return this.each(function(){var r=this;if(r.grid&&r.p.treeGrid)for(var l=r.p.expColInd,o=r.p.treeReader.expanded_field,f=r.p.treeReader.leaf_field,v=r.p.treeReader.level_field,a=r.p.treeReader.icon_field,c=r.p.treeReader.loaded,s,h,e,u;t<i;)u=r.p.data[r.p._index[r.rows[t].id]],r.p.treeGridModel=="nested"&&(u[f]||(s=parseInt(u[r.p.treeReader.left_field],10),h=parseInt(u[r.p.treeReader.right_field],10),u[f]=h===s+1?"true":"false",r.rows[t].cells[r.p._treeleafpos].innerHTML=u[f])),s=parseInt(u[v],10),r.p.tree_root_level===0?(e=s+1,h=s):(e=s,h=s-1),e="<div class='tree-wrap tree-wrap-"+r.p.direction+"' style='width:"+e*18+"px;'>",e+="<div style='"+(r.p.direction=="rtl"?"right:":"left:")+h*18+"px;' class='ui-icon ",u[c]!==undefined&&(u[c]=u[c]=="true"||u[c]===!0?!0:!1),u[f]=="true"||u[f]===!0?(e+=(u[a]!==undefined&&u[a]!==""?u[a]:r.p.treeIcons.leaf)+" tree-leaf treeclick'",u[f]=!0,h="leaf"):(u[f]=!1,h=""),u[o]=(u[o]=="true"||u[o]===!0?!0:!1)&&u[c],e+=u[o]===!0?r.p.treeIcons.minus+" tree-minus treeclick'":r.p.treeIcons.plus+" tree-plus treeclick'",e+="<\/div><\/div>",n(r.rows[t].cells[l]).wrapInner("<span class='cell-wrapper"+h+"'><\/span>").prepend(e),s!==parseInt(r.p.tree_root_level,10)&&((u=(u=n(r).jqGrid("getNodeParent",u))&&u.hasOwnProperty(o)?u[o]:!0)||n(r.rows[t]).css("display","none")),n(r.rows[t].cells[l]).find("div.treeclick").bind("click",function(t){return t=n(t.target||t.srcElement,r.rows).closest("tr.jqgrow")[0].id,t=r.p._index[t],r.p.data[t][f]||(r.p.data[t][o]?(n(r).jqGrid("collapseRow",r.p.data[t]),n(r).jqGrid("collapseNode",r.p.data[t])):(n(r).jqGrid("expandRow",r.p.data[t]),n(r).jqGrid("expandNode",r.p.data[t]))),!1}),r.p.ExpandColClick===!0&&n(r.rows[t].cells[l]).find("span.cell-wrapper").css("cursor","pointer").bind("click",function(t){t=n(t.target||t.srcElement,r.rows).closest("tr.jqgrow")[0].id;var i=r.p._index[t];return r.p.data[i][f]||(r.p.data[i][o]?(n(r).jqGrid("collapseRow",r.p.data[i]),n(r).jqGrid("collapseNode",r.p.data[i])):(n(r).jqGrid("expandRow",r.p.data[i]),n(r).jqGrid("expandNode",r.p.data[i]))),n(r).jqGrid("setSelection",t),!1}),t++})},setTreeGrid:function(){return this.each(function(){var t=this,i=0,f=!1,r,u,e=[],o;if(t.p.treeGrid){t.p.treedatatype||n.extend(t.p,{treedatatype:t.p.datatype}),t.p.subGrid=!1,t.p.altRows=!1,t.p.pgbuttons=!1,t.p.pginput=!1,t.p.gridview=!0,t.p.multiselect=!1,t.p.rowList=[],t.p.expColInd=0,t.p.treeIcons=n.extend({plus:"ui-icon-triangle-1-"+(t.p.direction=="rtl"?"w":"e"),minus:"ui-icon-triangle-1-s",leaf:"ui-icon-radio-off"},t.p.treeIcons||{}),t.p.treeGridModel=="nested"?t.p.treeReader=n.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},t.p.treeReader):t.p.treeGridModel=="adjacency"&&(t.p.treeReader=n.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},t.p.treeReader));for(u in t.p.colModel)if(t.p.colModel.hasOwnProperty(u)){r=t.p.colModel[u].name,r!=t.p.ExpandColumn||f||(f=!0,t.p.expColInd=i),i++;for(o in t.p.treeReader)t.p.treeReader[o]==r&&e.push(r)}n.each(t.p.treeReader,function(r,u){u&&n.inArray(u,e)===-1&&(r==="leaf_field"&&(t.p._treeleafpos=i),i++,t.p.colNames.push(u),t.p.colModel.push({name:u,width:1,hidden:!0,sortable:!1,resizable:!1,hidedlg:!0,editable:!0,search:!1}))})}})},expandRow:function(t){this.each(function(){var i=this,r,u;i.grid&&i.p.treeGrid&&(r=n(i).jqGrid("getNodeChildren",t),u=i.p.treeReader.expanded_field,n(r).each(function(){var t=n.jgrid.getAccessor(this,i.p.localReader.id);n("#"+t,i.grid.bDiv).css("display",""),this[u]&&n(i).jqGrid("expandRow",this)}))})},collapseRow:function(t){this.each(function(){var i=this,r,u;i.grid&&i.p.treeGrid&&(r=n(i).jqGrid("getNodeChildren",t),u=i.p.treeReader.expanded_field,n(r).each(function(){var t=n.jgrid.getAccessor(this,i.p.localReader.id);n("#"+t,i.grid.bDiv).css("display","none"),this[u]&&n(i).jqGrid("collapseRow",this)}))})},getRootNodes:function(){var t=[];return this.each(function(){var i=this,u,r;if(i.grid&&i.p.treeGrid)switch(i.p.treeGridModel){case"nested":u=i.p.treeReader.level_field,n(i.p.data).each(function(){parseInt(this[u],10)===parseInt(i.p.tree_root_level,10)&&t.push(this)});break;case"adjacency":r=i.p.treeReader.parent_id_field,n(i.p.data).each(function(){(this[r]===null||String(this[r]).toLowerCase()=="null")&&t.push(this)})}}),t},getNodeDepth:function(t){var i=null;return this.each(function(){if(this.grid&&this.p.treeGrid)switch(this.p.treeGridModel){case"nested":i=parseInt(t[this.p.treeReader.level_field],10)-parseInt(this.p.tree_root_level,10);break;case"adjacency":i=n(this).jqGrid("getNodeAncestors",t).length}}),i},getNodeParent:function(t){var i=null;return this.each(function(){var e,o;if(this.grid&&this.p.treeGrid)switch(this.p.treeGridModel){case"nested":var r=this.p.treeReader.left_field,u=this.p.treeReader.right_field,f=this.p.treeReader.level_field,s=parseInt(t[r],10),h=parseInt(t[u],10),c=parseInt(t[f],10);n(this.p.data).each(function(){if(parseInt(this[f],10)===c-1&&parseInt(this[r],10)<s&&parseInt(this[u],10)>h)return i=this,!1});break;case"adjacency":e=this.p.treeReader.parent_id_field,o=this.p.localReader.id,n(this.p.data).each(function(){if(this[o]==t[e])return i=this,!1})}}),i},getNodeChildren:function(t){var i=[];return this.each(function(){var e,o;if(this.grid&&this.p.treeGrid)switch(this.p.treeGridModel){case"nested":var r=this.p.treeReader.left_field,u=this.p.treeReader.right_field,f=this.p.treeReader.level_field,s=parseInt(t[r],10),h=parseInt(t[u],10),c=parseInt(t[f],10);n(this.p.data).each(function(){parseInt(this[f],10)===c+1&&parseInt(this[r],10)>s&&parseInt(this[u],10)<h&&i.push(this)});break;case"adjacency":e=this.p.treeReader.parent_id_field,o=this.p.localReader.id,n(this.p.data).each(function(){this[e]==t[o]&&i.push(this)})}}),i},getFullTreeNode:function(t){var i=[];return this.each(function(){var u,e,o;if(this.grid&&this.p.treeGrid)switch(this.p.treeGridModel){case"nested":var r=this.p.treeReader.left_field,s=this.p.treeReader.right_field,f=this.p.treeReader.level_field,h=parseInt(t[r],10),c=parseInt(t[s],10),l=parseInt(t[f],10);n(this.p.data).each(function(){parseInt(this[f],10)>=l&&parseInt(this[r],10)>=h&&parseInt(this[r],10)<=c&&i.push(this)});break;case"adjacency":t&&(i.push(t),e=this.p.treeReader.parent_id_field,o=this.p.localReader.id,n(this.p.data).each(function(n){for(u=i.length,n=0;n<u;n++)if(i[n][o]==this[e]){i.push(this);break}}))}}),i},getNodeAncestors:function(t){var i=[];return this.each(function(){if(this.grid&&this.p.treeGrid)for(var r=n(this).jqGrid("getNodeParent",t);r;)i.push(r),r=n(this).jqGrid("getNodeParent",r)}),i},isVisibleNode:function(t){var i=!0;return this.each(function(){if(this.grid&&this.p.treeGrid){var r=n(this).jqGrid("getNodeAncestors",t),u=this.p.treeReader.expanded_field;n(r).each(function(){return i=i&&this[u],i?void 0:!1})}}),i},isNodeLoaded:function(t){var i;return this.each(function(){if(this.grid&&this.p.treeGrid){var r=this.p.treeReader.leaf_field;i=t!==undefined?t.loaded!==undefined?t.loaded:t[r]||n(this).jqGrid("getNodeChildren",t).length>0?!0:!1:!1}}),i},expandNode:function(t){return this.each(function(){if(this.grid&&this.p.treeGrid){var r=this.p.treeReader.expanded_field,e=this.p.treeReader.parent_id_field,o=this.p.treeReader.loaded,f=this.p.treeReader.level_field,s=this.p.treeReader.left_field,h=this.p.treeReader.right_field;if(!t[r]){var i=n.jgrid.getAccessor(t,this.p.localReader.id),u=n("#"+i,this.grid.bDiv)[0],c=this.p._index[i];n(this).jqGrid("isNodeLoaded",this.p.data[c])?(t[r]=!0,n("div.treeclick",u).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus")):(t[r]=!0,n("div.treeclick",u).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus"),this.p.treeANode=u.rowIndex,this.p.datatype=this.p.treedatatype,this.p.treeGridModel=="nested"?n(this).jqGrid("setGridParam",{postData:{nodeid:i,n_left:t[s],n_right:t[h],n_level:t[f]}}):n(this).jqGrid("setGridParam",{postData:{nodeid:i,parentid:t[e],n_level:t[f]}}),n(this).trigger("reloadGrid"),t[o]=!0,this.p.treeGridModel=="nested"?n(this).jqGrid("setGridParam",{postData:{nodeid:"",n_left:"",n_right:"",n_level:""}}):n(this).jqGrid("setGridParam",{postData:{nodeid:"",parentid:"",n_level:""}}))}}})},collapseNode:function(t){return this.each(function(){if(this.grid&&this.p.treeGrid&&t.expanded){t.expanded=!1;var i=n.jgrid.getAccessor(t,this.p.localReader.id);i=n("#"+i,this.grid.bDiv)[0],n("div.treeclick",i).removeClass(this.p.treeIcons.minus+" tree-minus").addClass(this.p.treeIcons.plus+" tree-plus")}})},SortTree:function(t,i,r,u){return this.each(function(){if(this.grid&&this.p.treeGrid){var f,c,s,e=[],h=this,o;for(f=n(this).jqGrid("getRootNodes"),f=n.jgrid.from(f),f.orderBy(t,i,r,u),o=f.select(),f=0,c=o.length;f<c;f++)s=o[f],e.push(s),n(this).jqGrid("collectChildrenSortTree",e,s,t,i,r,u);n.each(e,function(t){var i=n.jgrid.getAccessor(this,h.p.localReader.id);n("#"+h.p.id+" tbody tr:eq("+t+")").after(n("tr#"+i,h.grid.bDiv))}),e=o=f=null}})},collectChildrenSortTree:function(t,i,r,u,f,e){return this.each(function(){if(this.grid&&this.p.treeGrid){var o,c,s,h;for(o=n(this).jqGrid("getNodeChildren",i),o=n.jgrid.from(o),o.orderBy(r,u,f,e),h=o.select(),o=0,c=h.length;o<c;o++)s=h[o],t.push(s),n(this).jqGrid("collectChildrenSortTree",t,s,r,u,f,e)}})},setTreeRow:function(t,i){var r=!1;return this.each(function(){this.grid&&this.p.treeGrid&&(r=n(this).jqGrid("setRowData",t,i))}),r},delTreeNode:function(t){return this.each(function(){var i=this.p.localReader.id,f=this.p.treeReader.left_field,e=this.p.treeReader.right_field,o,h,u,r,s;if(this.grid&&this.p.treeGrid&&(r=this.p._index[t],r!==undefined)){if(o=parseInt(this.p.data[r][e],10),h=o-parseInt(this.p.data[r][f],10)+1,r=n(this).jqGrid("getFullTreeNode",this.p.data[r]),r.length>0)for(s=0;s<r.length;s++)n(this).jqGrid("delRowData",r[s][i]);if(this.p.treeGridModel==="nested"){if(i=n.jgrid.from(this.p.data).greater(f,o,{stype:"integer"}).select(),i.length)for(u in i)i[u][f]=parseInt(i[u][f],10)-h;if(i=n.jgrid.from(this.p.data).greater(e,o,{stype:"integer"}).select(),i.length)for(u in i)i[u][e]=parseInt(i[u][e],10)-h}}})},addChildNode:function(t,i,r){var u=this[0],y,b,k,o;if(r){var p=u.p.treeReader.expanded_field,s=u.p.treeReader.leaf_field,f=u.p.treeReader.level_field,g=u.p.treeReader.parent_id_field,l=u.p.treeReader.left_field,h=u.p.treeReader.right_field,d=u.p.treeReader.loaded,a,v,c,w,e;if(a=0,y=i,!t){if(e=u.p.data.length-1,e>=0)for(;e>=0;)a=Math.max(a,parseInt(u.p.data[e][u.p.localReader.id],10)),e--;t=a+1}if(k=n(u).jqGrid("getInd",i),b=!1,i===undefined||i===null||i===""?(y=i=null,a="last",w=u.p.tree_root_level,e=u.p.data.length+1):(a="after",v=u.p._index[i],c=u.p.data[v],i=c[u.p.localReader.id],w=parseInt(c[f],10)+1,e=n(u).jqGrid("getFullTreeNode",c),e.length?(y=e=e[e.length-1][u.p.localReader.id],e=n(u).jqGrid("getInd",y)+1):e=n(u).jqGrid("getInd",i)+1,c[s]&&(b=!0,c[p]=!0,n(u.rows[k]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(u.p.treeIcons.leaf+" tree-leaf").addClass(u.p.treeIcons.minus+" tree-minus"),u.p.data[v][s]=!1,c[d]=!0)),v=e+1,r[p]=!1,r[d]=!0,r[f]=w,r[s]=!0,u.p.treeGridModel==="adjacency"&&(r[g]=i),u.p.treeGridModel==="nested")if(i!==null){if(s=parseInt(c[h],10),f=n.jgrid.from(u.p.data),f=f.greaterOrEquals(h,s,{stype:"integer"}),f=f.select(),f.length)for(o in f)f[o][l]=f[o][l]>s?parseInt(f[o][l],10)+2:f[o][l],f[o][h]=f[o][h]>=s?parseInt(f[o][h],10)+2:f[o][h];r[l]=s,r[h]=s+1}else{if(s=parseInt(n(u).jqGrid("getCol",h,!1,"max"),10),f=n.jgrid.from(u.p.data).greater(l,s,{stype:"integer"}).select(),f.length)for(o in f)f[o][l]=parseInt(f[o][l],10)+2;if(f=n.jgrid.from(u.p.data).greater(h,s,{stype:"integer"}).select(),f.length)for(o in f)f[o][h]=parseInt(f[o][h],10)+2;r[l]=s+1,r[h]=s+2}(i===null||n(u).jqGrid("isNodeLoaded",c)||b)&&(n(u).jqGrid("addRowData",t,r,a,y),n(u).jqGrid("setTreeNode",e,v)),c&&!c[p]&&n(u.rows[k]).find("div.treeclick").click()}}})}(t),function(n){n.jgrid.extend({jqGridImport:function(t){return t=n.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"roots>grid",data:"roots>rows"},jsonGrid:{config:"grid",data:"data"},ajaxOptions:{}},t||{}),this.each(function(){var u=this,f=function(t,i){var f=n(i.xmlGrid.config,t)[0],e=n(i.xmlGrid.data,t)[0],o,s;if(r.xml2json&&n.jgrid.parse){f=r.xml2json(f," "),f=n.jgrid.parse(f);for(s in f)f.hasOwnProperty(s)&&(o=f[s]);e?(e=f.grid.datatype,f.grid.datatype="xmlstring",f.grid.datastr=t,n(u).jqGrid(o).jqGrid("setGridParam",{datatype:e})):n(u).jqGrid(o)}else alert("xml2json or parse are not present")},e=function(t,i){var f,r,e;t&&typeof t=="string"&&(f=n.jgrid.parse(t),r=f[i.jsonGrid.config],(f=f[i.jsonGrid.data])?(e=r.datatype,r.datatype="jsonstring",r.datastr=f,n(u).jqGrid(r).jqGrid("setGridParam",{datatype:e})):n(u).jqGrid(r))},i;switch(t.imptype){case"xml":n.ajax(n.extend({url:t.impurl,type:t.mtype,data:t.impData,dataType:"xml",complete:function(i,r){r=="success"&&(f(i.responseXML,t),n.isFunction(t.importComplete)&&t.importComplete(i))}},t.ajaxOptions));break;case"xmlstring":t.impstring&&typeof t.impstring=="string"&&(i=n.jgrid.stringToDoc(t.impstring),i&&(f(i,t),n.isFunction(t.importComplete)&&t.importComplete(i),t.impstring=null),i=null);break;case"json":n.ajax(n.extend({url:t.impurl,type:t.mtype,data:t.impData,dataType:"json",complete:function(i,r){r=="success"&&(e(i.responseText,t),n.isFunction(t.importComplete)&&t.importComplete(i))}},t.ajaxOptions));break;case"jsonstring":t.impstring&&typeof t.impstring=="string"&&(e(t.impstring,t),n.isFunction(t.importComplete)&&t.importComplete(t.impstring),t.impstring=null)}})},jqGridExport:function(t){t=n.extend({exptype:"xmlstring",root:"grid",ident:"\t"},t||{});var i=null;return this.each(function(){var u,f;if(this.grid){if(u=n.extend({},n(this).jqGrid("getGridParam")),u.rownumbers&&(u.colNames.splice(0,1),u.colModel.splice(0,1)),u.multiselect&&(u.colNames.splice(0,1),u.colModel.splice(0,1)),u.subGrid&&(u.colNames.splice(0,1),u.colModel.splice(0,1)),u.knv=null,u.treeGrid)for(f in u.treeReader)u.treeReader.hasOwnProperty(f)&&(u.colNames.splice(u.colNames.length-1),u.colModel.splice(u.colModel.length-1));switch(t.exptype){case"xmlstring":i="<"+t.root+">"+r.json2xml(u,t.ident)+"<\/"+t.root+">";break;case"jsonstring":i="{"+r.toJson(u,t.root,t.ident)+"}",u.postData.filters!==undefined&&(i=i.replace(/filters":"/,'filters":'),i=i.replace(/}]}"/,"}]}"))}}}),i},excelExport:function(i){return i=n.extend({exptype:"remote",url:null,oper:"oper",tag:"excel",exportOptions:{}},i||{}),this.each(function(){if(this.grid){var r;i.exptype=="remote"&&(r=n.extend({},this.p.postData),r[i.oper]=i.tag,r=t.param(r),r=i.url.indexOf("?")!=-1?i.url+"&"+r:i.url+"?"+r,window.location=r)}})}})}(t),r={xml2json:function(n,t){n.nodeType===9&&(n=n.documentElement);var i=this.toJson(this.toObj(this.removeWhite(n)),n.nodeName,"\t");return"{\n"+t+(t?i.replace(/\t/g,t):i.replace(/\t|\n/g,""))+"\n}"},json2xml:function(n,t){var r=function(n,t,i){var f="",e,u,o;if(n instanceof Array)if(n.length===0)f+=i+"<"+t+">__EMPTY_ARRAY_<\/"+t+">\n";else for(e=0,u=n.length;e<u;e+=1)o=i+r(n[e],t,i+"\t")+"\n",f+=o;else if(typeof n=="object"){e=!1,f+=i+"<"+t;for(u in n)n.hasOwnProperty(u)&&(u.charAt(0)==="@"?f+=" "+u.substr(1)+'="'+n[u].toString()+'"':e=!0);if(f+=e?">":"/>",e){for(u in n)n.hasOwnProperty(u)&&(u==="#text"?f+=n[u]:u==="#cdata"?f+="<![CDATA["+n[u]+"]\]>":u.charAt(0)!=="@"&&(f+=r(n[u],u,i+"\t")));f+=(f.charAt(f.length-1)==="\n"?i:"")+"<\/"+t+">"}}else f+=typeof n=="function"?i+"<"+t+"><![CDATA["+n+"]\]><\/"+t+">":n.toString()==='""'||n.toString().length===0?i+"<"+t+">__EMPTY_STRING_<\/"+t+">":i+"<"+t+">"+n.toString()+"<\/"+t+">";return f},u="",i;for(i in n)n.hasOwnProperty(i)&&(u+=r(n[i],i,""));return t?u.replace(/\t/g,t):u.replace(/\t|\n/g,"")},toObj:function(n){var i={},e=/function/i,r,u,f,t;if(n.nodeType===1){if(n.attributes.length)for(r=0;r<n.attributes.length;r+=1)i["@"+n.attributes[r].nodeName]=(n.attributes[r].nodeValue||"").toString();if(n.firstChild){for(u=r=0,f=!1,t=n.firstChild;t;t=t.nextSibling)t.nodeType===1?f=!0:t.nodeType===3&&t.nodeValue.match(/[^ \f\n\r\t\v]/)?r+=1:t.nodeType===4&&(u+=1);if(f)if(r<2&&u<2)for(this.removeWhite(n),t=n.firstChild;t;t=t.nextSibling)t.nodeType===3?i["#text"]=this.escape(t.nodeValue):t.nodeType===4?e.test(t.nodeValue)?i[t.nodeName]=[i[t.nodeName],t.nodeValue]:i["#cdata"]=this.escape(t.nodeValue):i[t.nodeName]?i[t.nodeName]instanceof Array?i[t.nodeName][i[t.nodeName].length]=this.toObj(t):i[t.nodeName]=[i[t.nodeName],this.toObj(t)]:i[t.nodeName]=this.toObj(t);else n.attributes.length?i["#text"]=this.escape(this.innerXml(n)):i=this.escape(this.innerXml(n));else if(r)n.attributes.length?i["#text"]=this.escape(this.innerXml(n)):(i=this.escape(this.innerXml(n)),i==="__EMPTY_ARRAY_"?i="[]":i==="__EMPTY_STRING_"&&(i=""));else if(u)if(u>1)i=this.escape(this.innerXml(n));else for(t=n.firstChild;t;t=t.nextSibling)if(e.test(n.firstChild.nodeValue)){i=n.firstChild.nodeValue;break}else i["#cdata"]=this.escape(t.nodeValue)}n.attributes.length||n.firstChild||(i=null)}else n.nodeType===9?i=this.toObj(n.documentElement):alert("unhandled node type: "+n.nodeType);return i},toJson:function(n,t,i,r){var f,u,h;r===undefined&&(r=!0);var s=t?'"'+t+'"':"",e="\t",o="\n";if(r||(o=e=""),n==="[]")s+=t?":[]":"[]";else if(n instanceof Array){for(h=[],u=0,f=n.length;u<f;u+=1)h[u]=this.toJson(n[u],"",i+e,r);s+=(t?":[":"[")+(h.length>1?o+i+e+h.join(","+o+i+e)+o+i:h.join(""))+"]"}else if(n===null)s+=(t&&":")+"null";else if(typeof n=="object"){f=[];for(u in n)n.hasOwnProperty(u)&&(f[f.length]=this.toJson(n[u],u,i+e,r));s+=(t?":{":"{")+(f.length>1?o+i+e+f.join(","+o+i+e)+o+i:f.join(""))+"}"}else s+=typeof n=="string"?(t&&":")+'"'+n.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"':(t&&":")+'"'+n.toString()+'"';return s},innerXml:function(n){var t="",i;if("innerHTML"in n)t=n.innerHTML;else for(i=function(n){var r="",t;if(n.nodeType===1){for(r+="<"+n.nodeName,t=0;t<n.attributes.length;t+=1)r+=" "+n.attributes[t].nodeName+'="'+(n.attributes[t].nodeValue||"").toString()+'"';if(n.firstChild){for(r+=">",t=n.firstChild;t;t=t.nextSibling)r+=i(t);r+="<\/"+n.nodeName+">"}else r+="/>"}else n.nodeType===3?r+=n.nodeValue:n.nodeType===4&&(r+="<![CDATA["+n.nodeValue+"]\]>");return r},n=n.firstChild;n;n=n.nextSibling)t+=i(n);return t},escape:function(n){return n.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(n){var t,i;for(n.normalize(),t=n.firstChild;t;)t.nodeType===3?t.nodeValue.match(/[^ \f\n\r\t\v]/)?t=t.nextSibling:(i=t.nextSibling,n.removeChild(t),t=i):(t.nodeType===1&&this.removeWhite(t),t=t.nextSibling);return n}},function(n){if(n.browser.msie&&n.browser.version==8&&(n.expr[":"].hidden=function(n){return n.offsetWidth===0||n.offsetHeight===0||n.style.display=="none"}),n.jgrid._multiselect=!1,n.ui&&n.ui.multiselect){if(n.ui.multiselect.prototype._setSelected){var t=n.ui.multiselect.prototype._setSelected;n.ui.multiselect.prototype._setSelected=function(i,r){var f=t.call(this,i,r),u;return r&&this.selectedList&&(u=this.element,this.selectedList.find("li").each(function(){n(this).data("optionLink")&&n(this).data("optionLink").remove().appendTo(u)})),f}}n.ui.multiselect.prototype.destroy&&(n.ui.multiselect.prototype.destroy=function(){this.element.show(),this.container.remove(),n.Widget===undefined?n.widget.prototype.destroy.apply(this,arguments):n.Widget.prototype.destroy.apply(this,arguments)}),n.jgrid._multiselect=!0}n.jgrid.extend({sortableColumns:function(t){return this.each(function(){function u(){i.p.disableClick=!0}var i=this,r={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_cb,#jqgh_rn,#jqgh_subgrid),:hidden)",placeholder:{element:function(t){return n(document.createElement(t[0].nodeName)).addClass(t[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0]},update:function(n,t){t.height(n.currentItem.innerHeight()-parseInt(n.currentItem.css("paddingTop")||0,10)-parseInt(n.currentItem.css("paddingBottom")||0,10)),t.width(n.currentItem.innerWidth()-parseInt(n.currentItem.css("paddingLeft")||0,10)-parseInt(n.currentItem.css("paddingRight")||0,10))}},update:function(t,r){var e=n(r.item).parent(),u,f;e=n(">th",e),u={},n.each(i.p.colModel,function(n){u[this.name]=n}),f=[],e.each(function(){var t=n(">div",this).get(0).id.replace(/^jqgh_/,"");t in u&&f.push(u[t])}),n(i).jqGrid("remapColumns",f,!0,!0),n.isFunction(i.p.sortable.update)&&i.p.sortable.update(f),setTimeout(function(){i.p.disableClick=!1},50)}},f;i.p.sortable.options?n.extend(r,i.p.sortable.options):n.isFunction(i.p.sortable)&&(i.p.sortable={update:i.p.sortable}),r.start?(f=r.start,r.start=function(n,t){u(),f.call(this,n,t)}):r.start=u,i.p.sortable.exclude&&(r.items+=":not("+i.p.sortable.exclude+")"),t.sortable(r).data("sortable").floating=!0})},columnChooser:function(t){function f(t,i){t&&(typeof t=="string"?n.fn[t]&&n.fn[t].apply(i,n.makeArray(arguments).slice(2)):n.isFunction(t)&&t.apply(i,n.makeArray(arguments).slice(2)))}var i=this,u,r,o;if(!n("#colchooser_"+i[0].p.id).length){if(u=n('<div id="colchooser_'+i[0].p.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"><\/select><\/div><\/div>'),r=n("select",u),t=n.extend({width:420,height:240,classname:null,done:function(n){n&&i.jqGrid("remapColumns",n,!0)},msel:"multiselect",dlog:"dialog",dlog_opts:function(n){var t={};return t[n.bSubmit]=function(){n.apply_perm(),n.cleanup(!1)},t[n.bCancel]=function(){n.cleanup(!0)},{buttons:t,close:function(){n.cleanup(!0)},modal:n.modal?n.modal:!1,resizable:n.resizable?n.resizable:!0,width:n.width+20}},apply_perm:function(){n("option",r).each(function(){this.selected?i.jqGrid("showCol",e[this.value].name):i.jqGrid("hideCol",e[this.value].name)});var u=[];n("option[selected]",r).each(function(){u.push(parseInt(this.value,10))}),n.each(u,function(){delete s[e[parseInt(this,10)].name]}),n.each(s,function(){var r=parseInt(this,10),t=u,n=r,i,f;n>=0?(i=t.slice(),f=i.splice(n,Math.max(t.length-n,n)),n>t.length&&(n=t.length),i[n]=r,u=i.concat(f)):u=void 0}),t.done&&t.done.call(i,u)},cleanup:function(n){f(t.dlog,u,"destroy"),f(t.msel,r,"destroy"),u.remove(),n&&t.done&&t.done.call(i)},msel_opts:{}},n.jgrid.col,t||{}),n.ui&&n.ui.multiselect&&t.msel=="multiselect"){if(!n.jgrid._multiselect){alert("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");return}t.msel_opts=n.extend(n.ui.multiselect.defaults,t.msel_opts)}t.caption&&u.attr("title",t.caption),t.classname&&(u.addClass(t.classname),r.addClass(t.classname)),t.width&&(n(">div",u).css({width:t.width,margin:"0 auto"}),r.css("width",t.width)),t.height&&(n(">div",u).css("height",t.height),r.css("height",t.height-10));var e=i.jqGrid("getGridParam","colModel"),h=i.jqGrid("getGridParam","colNames"),s={},c=[];r.empty(),n.each(e,function(n){s[this.name]=n,this.hidedlg?this.hidden||c.push(n):r.append("<option value='"+n+"' "+(this.hidden?"":"selected='selected'")+">"+h[n]+"<\/option>")}),o=n.isFunction(t.dlog_opts)?t.dlog_opts.call(i,t):t.dlog_opts,f(t.dlog,u,o),o=n.isFunction(t.msel_opts)?t.msel_opts.call(i,t):t.msel_opts,f(t.msel,r,o)}},sortableRows:function(t){return this.each(function(){var i=this;i.grid&&(i.p.treeGrid||n.fn.sortable&&(t=n.extend({cursor:"move",axis:"y",items:".jqgrow"},t||{}),t.start&&n.isFunction(t.start)?(t._start_=t.start,delete t.start):t._start_=!1,t.update&&n.isFunction(t.update)?(t._update_=t.update,delete t.update):t._update_=!1,t.start=function(r,u){if(n(u.item).css("border-width","0px"),n("td",u.item).each(function(n){this.style.width=i.grid.cols[n].style.width}),i.p.subGrid){var f=n(u.item).attr("id");try{n(i).jqGrid("collapseSubGridRow",f)}catch(e){}}t._start_&&t._start_.apply(this,[r,u])},t.update=function(r,u){n(u.item).css("border-width",""),i.p.rownumbers===!0&&n("td.jqgrid-rownum",i.rows).each(function(t){n(this).html(t+1)}),t._update_&&t._update_.apply(this,[r,u])},n("tbody:first",i).sortable(t),n("tbody:first",i).disableSelection()))})},gridDnD:function(t){return this.each(function(){function u(){var t=n.data(i,"dnd");n("tr.jqgrow:not(.ui-draggable)",i).draggable(n.isFunction(t.drag)?t.drag.call(n(i),t):t.drag)}var i=this,r;if(i.grid&&!i.p.treeGrid&&n.fn.draggable&&n.fn.droppable)if(n("#jqgrid_dnd").html()===null&&n("body").append("<table id='jqgrid_dnd' class='ui-jqgrid-dnd'><\/table>"),typeof t=="string"&&t=="updateDnD"&&i.p.jqgdnd===!0)u();else if(t=n.extend({drag:function(t){return n.extend({start:function(r,u){if(i.p.subGrid){var f=n(u.helper).attr("id");try{n(i).jqGrid("collapseSubGridRow",f)}catch(e){}}for(f=0;f<n.data(i,"dnd").connectWith.length;f++)n(n.data(i,"dnd").connectWith[f]).jqGrid("getGridParam","reccount")=="0"&&n(n.data(i,"dnd").connectWith[f]).jqGrid("addRowData","jqg_empty_row",{});u.helper.addClass("ui-state-highlight"),n("td",u.helper).each(function(n){this.style.width=i.grid.headers[n].width+"px"}),t.onstart&&n.isFunction(t.onstart)&&t.onstart.call(n(i),r,u)},stop:function(r,u){if(u.helper.dropped){var f=n(u.helper).attr("id");n(i).jqGrid("delRowData",f)}for(f=0;f<n.data(i,"dnd").connectWith.length;f++)n(n.data(i,"dnd").connectWith[f]).jqGrid("delRowData","jqg_empty_row");t.onstop&&n.isFunction(t.onstop)&&t.onstop.call(n(i),r,u)}},t.drag_opts||{})},drop:function(t){return n.extend({accept:function(t){if(!n(t).hasClass("jqgrow"))return t;var i=n(t).closest("table.ui-jqgrid-btable");return i.length>0&&n.data(i[0],"dnd")!==undefined?(t=n.data(i[0],"dnd").connectWith,n.inArray("#"+this.id,t)!=-1?!0:!1):t},drop:function(r,u){var f,h,o;if(n(u.draggable).hasClass("jqgrow")){if(f=n(u.draggable).attr("id"),f=u.draggable.parent().parent().jqGrid("getRowData",f),!t.dropbyname){var s=0,c={},e,l=n("#"+this.id).jqGrid("getGridParam","colModel");try{for(h in f)f.hasOwnProperty(h)&&l[s]&&(e=l[s].name,c[e]=f[h]),s++;f=c}catch(a){}}u.helper.dropped=!0,t.beforedrop&&n.isFunction(t.beforedrop)&&(e=t.beforedrop.call(this,r,u,f,n("#"+i.id),n(this)),typeof e!="undefined"&&e!==null&&typeof e=="object"&&(f=e)),u.helper.dropped&&(t.autoid&&(n.isFunction(t.autoid)?o=t.autoid.call(this,f):(o=Math.ceil(Math.random()*1e3),o=t.autoidprefix+o)),n("#"+this.id).jqGrid("addRowData",o,f,t.droppos)),t.ondrop&&n.isFunction(t.ondrop)&&t.ondrop.call(this,r,u,f)}}},t.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{activeClass:"ui-state-active",hoverClass:"ui-state-hover"},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dropbyname:!1,droppos:"first",autoid:!0,autoidprefix:"dnd_"},t||{}),t.connectWith)for(t.connectWith=t.connectWith.split(","),t.connectWith=n.map(t.connectWith,function(t){return n.trim(t)}),n.data(i,"dnd",t),i.p.reccount=="0"||i.p.jqgdnd||u(),i.p.jqgdnd=!0,r=0;r<t.connectWith.length;r++)n(t.connectWith[r]).droppable(n.isFunction(t.drop)?t.drop.call(n(i),t):t.drop)})},gridResize:function(t){return this.each(function(){var g=this;g.grid&&n.fn.resizable&&(t=n.extend({},t||{}),t.alsoResize?(t._alsoResize_=t.alsoResize,delete t.alsoResize):t._alsoResize_=!1,t.stop&&n.isFunction(t.stop)?(t._stop_=t.stop,delete t.stop):t._stop_=!1,t.stop=function(i,r){n(g).jqGrid("setGridParam",{height:n("#gview_"+g.p.id+" .ui-jqgrid-bdiv").height()}),n(g).jqGrid("setGridWidth",r.size.width,t.shrinkToFit),t._stop_&&t._stop_.call(g,i,r)},t.alsoResize=t._alsoResize_?eval("("+("{'#gview_"+g.p.id+" .ui-jqgrid-bdiv':true,'"+t._alsoResize_+"':true}")+")"):n(".ui-jqgrid-bdiv","#gview_"+g.p.id),delete t._alsoResize_,n("#gbox_"+g.p.id).resizable(t))})}})}(t)}),define("jquery-layout",["jquery"],function(n){(function(n){var f=Math.min,t=Math.max,u=Math.floor,i=function(t){return n.type(t)==="string"},r=function(Instance,a_fn){function g(n){return n}var i,c,fn;if(n.isArray(a_fn))for(i=0,c=a_fn.length;i<c;i++){fn=a_fn[i];try{i(fn)&&(fn=eval(fn)),n.isFunction(fn)&&g(fn)(Instance)}catch(ex){}}};n.layout={version:"1.3.rc30.7",revision:.033007,browser:{mozilla:!!n.browser.mozilla,webkit:!!n.browser.webkit||!!n.browser.safari,msie:!!n.browser.msie,isIE6:n.browser.msie&&n.browser.version==6,boxModel:n.support.boxModel!==!1||!n.browser.msie,version:n.browser.version},effects:{slide:{all:{duration:"fast"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},drop:{all:{duration:"slow"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},scale:{all:{duration:"fast"}},blind:{},clip:{},explode:{},fade:{},fold:{},puff:{},size:{all:{easing:"swing"}}},config:{optionRootKeys:"effects,panes,north,south,west,east,center".split(","),allPanes:"north,south,west,east,center".split(","),borderPanes:"north,south,west,east".split(","),oppositeEdge:{north:"south",south:"north",east:"west",west:"east"},offscreenCSS:{left:"-99999px",right:"auto"},offscreenReset:"offscreenReset",hidden:{visibility:"hidden"},visible:{visibility:"visible"},resizers:{cssReq:{position:"absolute",padding:0,margin:0,fontSize:"1px",textAlign:"left",overflow:"hidden"},cssDemo:{background:"#DDD",border:"none"}},togglers:{cssReq:{position:"absolute",display:"block",padding:0,margin:0,overflow:"hidden",textAlign:"center",fontSize:"1px",cursor:"pointer",zIndex:1},cssDemo:{background:"#AAA"}},content:{cssReq:{position:"relative"},cssDemo:{overflow:"auto",padding:"10px"},cssDemoPane:{overflow:"hidden",padding:0}},panes:{cssReq:{position:"absolute",margin:0},cssDemo:{padding:"10px",background:"#FFF",border:"1px solid #BBB",overflow:"auto"}},north:{side:"top",sizeType:"Height",dir:"horz",cssReq:{top:0,bottom:"auto",left:0,right:0,width:"auto"}},south:{side:"bottom",sizeType:"Height",dir:"horz",cssReq:{top:"auto",bottom:0,left:0,right:0,width:"auto"}},east:{side:"right",sizeType:"Width",dir:"vert",cssReq:{left:"auto",right:0,top:"auto",bottom:"auto",height:"auto"}},west:{side:"left",sizeType:"Width",dir:"vert",cssReq:{left:0,right:"auto",top:"auto",bottom:"auto",height:"auto"}},center:{dir:"center",cssReq:{left:"auto",right:"auto",top:"auto",bottom:"auto",height:"auto",width:"auto"}}},callbacks:{},getParentPaneElem:function(t){var u=n(t),f=u.data("layout")||u.data("parentLayout"),i,r;if(f){if(i=f.container,i.data("layoutPane"))return i;if(r=i.closest("."+n.layout.defaults.panes.paneClass),r.data("layoutPane"))return r}return null},getParentPaneInstance:function(t){var i=n.layout.getParentPaneElem(t);return i?i.data("layoutPane"):null},getParentLayoutInstance:function(t){var i=n.layout.getParentPaneElem(t);return i?i.data("parentLayout"):null},getEventObject:function(n){return typeof n=="object"&&n.stopPropagation?n:null},parsePaneName:function(t){var i=n.layout.getEventObject(t);return i?(i.stopPropagation(),n(this).data("layoutEdge")):t},plugins:{draggable:!!n.fn.draggable,effects:{core:!!n.effects,slide:n.effects&&(n.effects.slide||n.effects.effect.slide)}},onCreate:[],onLoad:[],onReady:[],onDestroy:[],onUnload:[],afterOpen:[],afterClose:[],scrollbarWidth:function(){return window.scrollbarWidth||n.layout.getScrollbarSize("width")},scrollbarHeight:function(){return window.scrollbarHeight||n.layout.getScrollbarSize("height")},getScrollbarSize:function(t){var i=n('<div style="position: absolute; top: -10000px; left: -10000px; width: 100px; height: 100px; overflow: scroll;"><\/div>').appendTo("body"),r={width:i.css("width")-i[0].clientWidth,height:i.height()-i[0].clientHeight};return i.remove(),window.scrollbarWidth=r.width,window.scrollbarHeight=r.height,t.match(/^(width|height)$/)?r[t]:r},showInvisibly:function(n,t){if(n&&n.length&&(t||n.css("display")==="none")){var i=n[0].style,r={display:i.display||"",visibility:i.visibility||""};return n.css({display:"block",visibility:"hidden"}),r}return{}},getElementDimensions:function(i,r){var u={css:{},inset:{}},f=u.css,o={bottom:0},s=n.layout.cssNum,h=i.offset(),c,l,e;return u.offsetLeft=h.left,u.offsetTop=h.top,r||(r={}),n.each("Left,Right,Top,Bottom".split(","),function(t,s){c=f["border"+s]=n.layout.borderWidth(i,s),l=f["padding"+s]=n.layout.cssNum(i,"padding"+s),e=s.toLowerCase(),u.inset[e]=r[e]>=0?r[e]:l,o[e]=u.inset[e]+c}),f.width=i.css("width"),f.height=i.height(),f.top=s(i,"top",!0),f.bottom=s(i,"bottom",!0),f.left=s(i,"left",!0),f.right=s(i,"right",!0),u.outerWidth=i.outerWidth(),u.outerHeight=i.outerHeight(),u.innerWidth=t(0,u.outerWidth-o.left-o.right),u.innerHeight=t(0,u.outerHeight-o.top-o.bottom),u.layoutWidth=i.innerWidth(),u.layoutHeight=i.innerHeight(),u},getElementStyles:function(n,t){for(var u={},s=n[0].style,c=t.split(","),l="Top,Bottom,Left,Right".split(","),a="Color,Style,Width".split(","),i,r,h,e,o,f=0;f<c.length;f++)if(i=c[f],i.match(/(border|padding|margin)$/))for(e=0;e<4;e++)if(r=l[e],i==="border")for(o=0;o<3;o++)h=a[o],u[i+r+h]=s[i+r+h];else u[i+r]=s[i+r];else u[i]=s[i];return u},cssWidth:function(i,r){if(r<=0)return 0;if(!n.layout.browser.boxModel)return r;var u=n.layout.borderWidth,f=n.layout.cssNum,e=r-u(i,"Left")-u(i,"Right")-f(i,"paddingLeft")-f(i,"paddingRight");return t(0,e)},cssHeight:function(i,r){if(r<=0)return 0;if(!n.layout.browser.boxModel)return r;var u=n.layout.borderWidth,f=n.layout.cssNum,e=r-u(i,"Top")-u(i,"Bottom")-f(i,"paddingTop")-f(i,"paddingBottom");return t(0,e)},cssNum:function(t,i,r){t.jquery||(t=n(t));var f=n.layout.showInvisibly(t),u=n.css(t[0],i,!0),e=r&&u=="auto"?u:Math.round(parseFloat(u)||0);return t.css(f),e},borderWidth:function(t,i){t.jquery&&(t=t[0]);var r="border"+i.substr(0,1).toUpperCase()+i.substr(1);return n.css(t,r+"Style",!0)==="none"?0:Math.round(parseFloat(n.css(t,r+"Width",!0))||0)},isMouseOverElem:function(t,i){var r=n(i||this),e=r.offset(),o=e.top,s=e.left,h=s+r.outerWidth(),c=o+r.outerHeight(),u=t.pageX,f=t.pageY;return n.layout.browser.msie&&u<0&&f<0||u>=s&&u<=h&&f>=o&&f<=c},msg:function(t,i,r,u){function h(){var i=n.support.fixedPosition?"fixed":"absolute",t=n('<div id="layoutLogger" style="position: '+i+'; top: 5px; z-index: 999999; max-width: 25%; overflow: hidden; border: 1px solid #000; border-radius: 5px; background: #FBFBFB; box-shadow: 0 2px 10px rgba(0,0,0,0.3);"><div style="font-size: 13px; font-weight: bold; padding: 5px 10px; background: #F6F6F6; border-radius: 5px 5px 0 0; cursor: move;"><span style="float: right; padding-left: 7px; cursor: pointer;" title="Remove Console" onclick="$(this).closest(\'#layoutLogger\').remove()">X<\/span>Layout console.log<\/div><ul style="font-size: 13px; font-weight: none; list-style: none; margin: 0; padding: 0 0 2px;"><\/ul><\/div>').appendTo("body");return t.css("left",n(window).width()-t.outerWidth()-5),n.ui.draggable&&t.draggable({handle:":first-child"}),t}var o,f,s,e;n.isPlainObject(t)&&window.debugData?(typeof i=="string"?(u=r,r=i):typeof r=="object"&&(u=r,r=null),o=r||"log( <object> )",f=n.extend({sort:!1,returnHTML:!1,display:!1},u),i===!0||f.display?debugData(t,o,f):window.console&&console.log(debugData(t,o,f))):i?alert(t):window.console?console.log(t):(s="#layoutLogger",e=n(s),e.length||(e=h()),e.children("ul").append('<li style="padding: 4px 10px; margin: 0; border-top: 1px solid #CCC;">'+t.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")+"<\/li>"))}},n.layout.defaults={name:"",containerClass:"ui-layout-container",inset:null,scrollToBookmarkOnLoad:!0,resizeWithWindow:!0,resizeWithWindowDelay:200,resizeWithWindowMaxDelay:0,maskPanesEarly:!1,onresizeall_start:null,onresizeall_end:null,onload_start:null,onload_end:null,onunload_start:null,onunload_end:null,initPanes:!0,showErrorMessages:!0,showDebugMessages:!1,zIndex:null,zIndexes:{pane_normal:0,content_mask:1,resizer_normal:2,pane_sliding:100,pane_animate:1e3,resizer_drag:1e4},errors:{pane:"pane",selector:"selector",addButtonError:"Error Adding Button \n\nInvalid ",containerMissing:"UI Layout Initialization Error\n\nThe specified layout-container does not exist.",centerPaneMissing:"UI Layout Initialization Error\n\nThe center-pane element does not exist.\n\nThe center-pane is a required element.",noContainerHeight:"UI Layout Initialization Warning\n\nThe layout-container \"CONTAINER\" has no height.\n\nTherefore the layout is 0-height and hence 'invisible'!",callbackError:"UI Layout Callback Error\n\nThe EVENT callback is not a valid function."},panes:{applyDemoStyles:!1,closable:!0,resizable:!0,slidable:!0,initClosed:!1,initHidden:!1,contentSelector:".ui-layout-content",contentIgnoreSelector:".ui-layout-ignore",findNestedContent:!1,paneClass:"ui-layout-pane",resizerClass:"ui-layout-resizer",togglerClass:"ui-layout-toggler",buttonClass:"ui-layout-button",minSize:0,maxSize:0,spacing_open:6,spacing_closed:6,togglerLength_open:50,togglerLength_closed:50,togglerAlign_open:"center",togglerAlign_closed:"center",togglerContent_open:"",togglerContent_closed:"",resizerDblClickToggle:!0,autoResize:!0,autoReopen:!0,resizerDragOpacity:1,maskContents:!1,maskObjects:!1,maskZindex:null,resizingGrid:!1,livePaneResizing:!1,liveContentResizing:!1,liveResizingTolerance:1,sliderCursor:"pointer",slideTrigger_open:"click",slideTrigger_close:"mouseleave",slideDelay_open:300,slideDelay_close:300,hideTogglerOnSlide:!1,preventQuickSlideClose:n.layout.browser.webkit,preventPrematureSlideClose:!1,tips:{Open:"Open",Close:"Close",Resize:"Resize",Slide:"Slide Open",Pin:"Pin",Unpin:"Un-Pin",noRoomToOpen:"Not enough room to show this panel.",minSizeWarning:"Panel has reached its minimum size",maxSizeWarning:"Panel has reached its maximum size"},showOverflowOnHover:!1,enableCursorHotkey:!0,customHotkeyModifier:"SHIFT",fxName:"slide",fxSpeed:null,fxSettings:{},fxOpacityFix:!0,animatePaneSizing:!1,children:null,containerSelector:"",initChildren:!0,destroyChildren:!0,resizeChildren:!0,triggerEventsOnLoad:!1,triggerEventsDuringLiveResize:!0,onshow_start:null,onshow_end:null,onhide_start:null,onhide_end:null,onopen_start:null,onopen_end:null,onclose_start:null,onclose_end:null,onresize_start:null,onresize_end:null,onsizecontent_start:null,onsizecontent_end:null,onswap_start:null,onswap_end:null,ondrag_start:null,ondrag_end:null},north:{paneSelector:".ui-layout-north",size:"auto",resizerCursor:"n-resize",customHotkey:""},south:{paneSelector:".ui-layout-south",size:"auto",resizerCursor:"s-resize",customHotkey:""},east:{paneSelector:".ui-layout-east",size:200,resizerCursor:"e-resize",customHotkey:""},west:{paneSelector:".ui-layout-west",size:200,resizerCursor:"w-resize",customHotkey:""},center:{paneSelector:".ui-layout-center",minWidth:0,minHeight:0}},n.layout.optionsMap={layout:"name,instanceKey,stateManagement,effects,inset,zIndexes,errors,zIndex,scrollToBookmarkOnLoad,showErrorMessages,maskPanesEarly,outset,resizeWithWindow,resizeWithWindowDelay,resizeWithWindowMaxDelay,onresizeall,onresizeall_start,onresizeall_end,onload,onunload".split(","),center:"paneClass,contentSelector,contentIgnoreSelector,findNestedContent,applyDemoStyles,triggerEventsOnLoad,showOverflowOnHover,maskContents,maskObjects,liveContentResizing,containerSelector,children,initChildren,resizeChildren,destroyChildren,onresize,onresize_start,onresize_end,onsizecontent,onsizecontent_start,onsizecontent_end".split(","),noDefault:"paneSelector,resizerCursor,customHotkey".split(",")},n.layout.transformData=function(t,i){var o=i?{panes:{},center:{}}:{},r,s,h,u,e,f,c;if(typeof t!="object")return o;for(s in t)for(r=o,e=t[s],h=s.split("__"),c=h.length-1,f=0;f<=c;f++)u=h[f],f===c?r[u]=n.isPlainObject(e)?n.layout.transformData(e):e:(r[u]||(r[u]={}),r=r[u]);return o},n.layout.backwardCompatibility={map:{applyDefaultStyles:"applyDemoStyles",childOptions:"children",initChildLayout:"initChildren",destroyChildLayout:"destroyChildren",resizeChildLayout:"resizeChildren",resizeNestedLayout:"resizeChildren",resizeWhileDragging:"livePaneResizing",resizeContentWhileDragging:"liveContentResizing",triggerEventsWhileDragging:"triggerEventsDuringLiveResize",maskIframesOnResize:"maskContents",useStateCookie:"stateManagement.enabled","cookie.autoLoad":"stateManagement.autoLoad","cookie.autoSave":"stateManagement.autoSave","cookie.keys":"stateManagement.stateKeys","cookie.name":"stateManagement.cookie.name","cookie.domain":"stateManagement.cookie.domain","cookie.path":"stateManagement.cookie.path","cookie.expires":"stateManagement.cookie.expires","cookie.secure":"stateManagement.cookie.secure",noRoomToOpenTip:"tips.noRoomToOpen",togglerTip_open:"tips.Close",togglerTip_closed:"tips.Open",resizerTip:"tips.Resize",sliderTip:"tips.Slide"},renameOptions:function(t){function o(n,i){for(var f=n.split("."),o=f.length-1,r={branch:t,key:f[o]},e=0,u;e<o;e++)u=f[e],r.branch=r.branch[u]==undefined?i?r.branch[u]={}:{}:r.branch[u];return r}var e=n.layout.backwardCompatibility.map,i,r,u,f;for(f in e)i=o(f),u=i.branch[i.key],u!==undefined&&(r=o(e[f],!0),r.branch[r.key]=u,delete i.branch[i.key])},renameAllOptions:function(t){var i=n.layout.backwardCompatibility.renameOptions;return i(t),t.defaults&&(typeof t.panes!="object"&&(t.panes={}),n.extend(!0,t.panes,t.defaults),delete t.defaults),t.panes&&i(t.panes),n.each(n.layout.config.allPanes,function(n,r){t[r]&&i(t[r])}),t}},n.fn.layout=function(e){function nf(t){var i;if(!t||(i=t.keyCode,i<33))return!0;var v={38:"north",40:"south",37:"west",39:"east"},p=t.altKey,e=t.shiftKey,f=t.ctrlKey,y=f&&i>=37&&i<=40,l,u,a,r;return(y&&s[v[i]].enableCursorHotkey?r=v[i]:(f||e)&&n.each(h.borderPanes,function(n,t){return l=s[t],u=l.customHotkey,a=l.customHotkeyModifier,(e&&a=="SHIFT"||f&&a=="CTRL"||f&&e)&&u&&i===(isNaN(u)||u<=9?u.toUpperCase().charCodeAt(0):u)?(r=t,!1):void 0}),!r||!c[r]||!s[r].closable||o[r].isHidden)?!0:(bt(r),t.stopPropagation(),t.returnValue=!1,!1)}function nu(t){var r,f,u;if(b()&&(this&&this.tagName&&(t=this),i(t)?r=c[t]:n(t).data("layoutRole")?r=n(t):n(t).parents().each(function(){if(n(this).data("layoutRole"))return r=n(this),!1}),r&&r.length)){if(f=r.data("layoutEdge"),u=o[f],u.cssSaved&&ai(f),u.isSliding||u.isResizing||u.isClosed){u.cssSaved=!1;return}var e={zIndex:s.zIndexes.resizer_normal+1},l={},v=r.css("overflow"),a=r.css("overflowX"),y=r.css("overflowY");v!="visible"&&(l.overflow=v,e.overflow="visible"),a&&!a.match(/(visible|auto)/)&&(l.overflowX=a,e.overflowX="visible"),y&&!y.match(/(visible|auto)/)&&(l.overflowY=a,e.overflowY="visible"),u.cssSaved=l,r.css(e),n.each(h.allPanes,function(n,t){t!=f&&ai(t)})}}function ai(t){var r;if(b()&&(this&&this.tagName&&(t=this),i(t)?r=c[t]:n(t).data("layoutRole")?r=n(t):n(t).parents().each(function(){if(n(this).data("layoutRole"))return r=n(this),!1}),r&&r.length)){var f=r.data("layoutEdge"),u=o[f],e=u.cssSaved||{};u.isSliding||u.isResizing||r.css("zIndex",s.zIndexes.pane_normal),r.css(e),u.cssSaved=!1}}var st=n.layout.browser,h=n.layout.config,it=n.layout.cssWidth,rt=n.layout.cssHeight,nt=n.layout.getElementDimensions,ti=n.layout.getElementStyles,vi=n.layout.getEventObject,w=n.layout.parsePaneName,s=n.extend(!0,{},n.layout.defaults),tf=s.effects=n.extend(!0,{},n.layout.effects),o={id:"layout"+n.now(),initialized:!1,paneResizing:!1,panesSliding:{},container:{innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0,layoutWidth:0,layoutHeight:0},north:{childIdx:0},south:{childIdx:0},east:{childIdx:0},west:{childIdx:0},center:{childIdx:0}},ft={north:null,south:null,east:null,west:null,center:null},d={data:{},set:function(n,t,i){d.clear(n),d.data[n]=setTimeout(t,i)},clear:function(n){var t=d.data;t[n]&&(clearTimeout(t[n]),delete t[n])}},ht=function(t,i,r){var u=s;return(u.showErrorMessages&&!r||r&&u.showDebugMessages)&&n.layout.msg(u.name+" / "+t,i!==!1),!1},v=function(evtName,pane,skipBoundEvents){function g(n){return n}var hasPane=pane&&i(pane),s=hasPane?o[pane]:o,o=hasPane?s[pane]:s,lName=s.name,lng=evtName+(evtName.match(/_/)?"":"_end"),shrt=lng.match(/_end$/)?lng.substr(0,lng.length-4):"",fn=o[lng]||o[shrt],retVal="NC",args=[],$P;if(hasPane||n.type(pane)!=="boolean"||(skipBoundEvents=pane,pane=""),fn)try{i(fn)&&(fn.match(/,/)?(args=fn.split(","),fn=eval(args[0])):fn=eval(fn)),n.isFunction(fn)&&(retVal=args.length?g(fn)(args[1]):hasPane?g(fn)(pane,c[pane],s,o,lName):g(fn)(y,s,o,lName))}catch(ex){ht(s.errors.callbackError.replace(/EVENT/,n.trim((pane||"")+" "+lng)),!1)}return skipBoundEvents||retVal===!1||(hasPane?($P=c[pane],o=s[pane],s=o[pane],$P.triggerHandler("layoutpane"+lng,[pane,$P,s,o,lName]),shrt&&$P.triggerHandler("layoutpane"+shrt,[pane,$P,s,o,lName])):(a.triggerHandler("layout"+lng,[y,s,o,lName]),shrt&&a.triggerHandler("layout"+shrt,[y,s,o,lName]))),(hasPane&&evtName==="onresize_end"||evtName==="onsizecontent_end")&&dr(pane+"",!0),retVal},ur=function(n){if(!st.mozilla){var t=c[n];o[n].tagName==="IFRAME"?t.css(h.hidden).css(h.visible):t.find("IFRAME").css(h.hidden).css(h.visible)}},fr=function(n,t){var i=h[n].dir=="horz"?rt:it;return i(c[n],t)},ui=function(n){var i=c[n],r=h[n].dir,t={minWidth:1001-it(i,1e3),minHeight:1001-rt(i,1e3)};return r==="horz"&&(t.minSize=t.minHeight),r==="vert"&&(t.minSize=t.minWidth),t},rf=function(t,r,u){var f=t,e;i(t)?f=c[t]:t.jquery||(f=n(t)),e=it(f,r),f.css({width:e}),e>0?u&&f.data("autoHidden")&&f.innerHeight()>0&&(f.show().data("autoHidden",!1),st.mozilla||f.css(h.hidden).css(h.visible)):u&&!f.data("autoHidden")&&f.hide().data("autoHidden",!0)},tu=function(t,r,u){var f=t,e;i(t)?f=c[t]:t.jquery||(f=n(t)),e=rt(f,r),f.css({height:e,visibility:"visible"}),e>0&&f.innerWidth()>0?u&&f.data("autoHidden")&&(f.show().data("autoHidden",!1),st.mozilla||f.css(h.hidden).css(h.visible)):u&&!f.data("autoHidden")&&f.hide().data("autoHidden",!0)},ct=function(t,r,f){var v,y;if(f||(f=h[t].dir),i(r)&&r.match(/%/)&&(r=r==="100%"?-1:parseInt(r,10)/100),r===0)return 0;if(r>=1)return parseInt(r,10);if(v=s,y=0,f=="horz"?y=l.innerHeight-(c.north?v.north.spacing_open:0)-(c.south?v.south.spacing_open:0):f=="vert"&&(y=l.innerWidth-(c.west?v.west.spacing_open:0)-(c.east?v.east.spacing_open:0)),r===-1)return y;if(r>0)return u(y*r);if(t=="center")return 0;var e=f==="horz"?"height":"width",o=c[t],a=e==="height"?tt[t]:!1,p=n.layout.showInvisibly(o),w=o.css(e),b=a?a.css(e):0;return o.css(e,"auto"),a&&a.css(e,"auto"),r=e==="height"?o.outerHeight():o.outerWidth(),o.css(e,w).css(p),a&&a.css(e,b),r},lt=function(n,t){var i=c[n],u=s[n],r=o[n],f=t?u.spacing_open:0,e=t?u.spacing_closed:0;return!i||r.isHidden?0:r.isClosed||r.isSliding&&t?e:h[n].dir==="horz"?i.outerHeight()+f:i.outerWidth()+f},ut=function(n,i){if(b()){var u=s[n],e=o[n],tt=h[n],a=tt.dir,vt=tt.sizeType.toLowerCase(),ft=i!=undefined?i:e.isSliding,yt=c[n],et=u.spacing_open,nt=h.oppositeEdge[n],v=o[nt],y=c[nt],ot=!y||v.isVisible===!1||v.isSliding?0:a=="horz"?y.outerHeight():y.outerWidth(),st=(!y||v.isHidden?0:s[nt][v.isClosed!==!1?"spacing_closed":"spacing_open"])||0,ht=a=="horz"?l.innerHeight:l.innerWidth,it=ui("center"),lt=a=="horz"?t(s.center.minHeight,it.minHeight):t(s.center.minWidth,it.minWidth),at=ht-et-(ft?0:ct("center",lt,a)+ot+st),p=e.minSize=t(ct(n,u.minSize),ui(n).minSize),w=e.maxSize=f(u.maxSize?ct(n,u.maxSize):1e5,at),r=e.resizerPosition={},k=l.inset.top,d=l.inset.left,rt=l.innerWidth,ut=l.innerHeight,g=u.spacing_open;switch(n){case"north":r.min=k+p,r.max=k+w;break;case"west":r.min=d+p,r.max=d+w;break;case"south":r.min=k+ut-w-g,r.max=k+ut-p-g;break;case"east":r.min=d+rt-w-g,r.max=d+rt-p-g}}},iu=function(){var n={top:lt("north",!0),bottom:lt("south",!0),left:lt("west",!0),right:lt("east",!0),width:0,height:0};return n.width=l.innerWidth-n.left-n.right,n.height=l.innerHeight-n.bottom-n.top,n.top+=l.inset.top,n.bottom+=l.inset.bottom,n.left+=l.inset.left,n.right+=l.inset.right,n},yi=function(t,i){var f=n(t),a=f.data("layoutRole"),v=f.data("layoutEdge"),w=s[v],r=w[a+"Class"],e="-"+v,y="-open",o="-closed",h="-sliding",u="-hover ",c=f.hasClass(r+o)?o:y,p=c===o?y:o,l=r+u+(r+e+u)+(r+c+u)+(r+e+c+u);return i&&(l+=r+p+u+(r+e+p+u)),a=="resizer"&&f.hasClass(r+h)&&(l+=r+h+u+(r+e+h+u)),n.trim(l)},pi=function(t,i){var r=n(i||this);t&&r.data("layoutRole")==="toggler"&&t.stopPropagation(),r.addClass(yi(r))},et=function(t,i){var r=n(i||this);r.removeClass(yi(r,!0))},er=function(){var t=n(this).data("layoutEdge"),i=o[t];i.isClosed||i.isResizing||o.paneResizing||(n.fn.disableSelection&&n("body").disableSelection(),s.maskPanesEarly&&ii(t))},or=function(t,i){var r=i||this,u=n(r).data("layoutEdge"),f=u+"ResizerLeave";d.clear(u+"_openSlider"),d.clear(f),i?o.paneResizing||(n.fn.enableSelection&&n("body").enableSelection(),s.maskPanesEarly&&oi()):d.set(f,function(){or(t,r)},200)},ru=function(){eu();var i=s,t=o;return(t.creatingLayout=!0,r(y,n.layout.onCreate),!1===v("onload_start"))?"cancel":(fu(),lr(),n(window).bind("unload."+k,cr),r(y,n.layout.onLoad),i.initPanes&&fi(),delete t.creatingLayout,o.initialized)},b=function(){return o.initialized||o.creatingLayout?!0:fi()},fi=function(t){var i=s,u;return a.is(":visible")?ar("center").length?(o.creatingLayout=!0,n.extend(l,nt(a,i.inset)),ou(),i.scrollToBookmarkOnLoad&&(u=self.location,u.hash&&u.replace(u.hash)),y.hasParentLayout?i.resizeWithWindow=!1:i.resizeWithWindow&&n(window).bind("resize."+k,uu),delete o.creatingLayout,o.initialized=!0,r(y,n.layout.onReady),v("onload_end"),!0):ht(i.errors.centerPaneMissing):(!t&&st.webkit&&a[0].tagName==="BODY"&&setTimeout(function(){fi(!0)},50),!1)},wi=function(t,i){var r=w.call(this,t),f=c[r];if(f){var h=tt[r],l=o[r],e=s[r],a=s.stateManagement||{},u=i?e.children=i:e.children;if(n.isPlainObject(u))u=[u];else if(!u||!n.isArray(u))return;n.each(u,function(t,i){if(n.isPlainObject(i)){var u=i.containerSelector?f.find(i.containerSelector):h||f;u.each(function(){var f=n(this),t=f.data("layout");if(!t){if(sr({container:f,options:i},l),a.includeChildren&&o.stateData[r]){var s=o.stateData[r].children||{},e=s[i.instanceKey],u=i.stateManagement||(i.stateManagement={autoLoad:!0});u.autoLoad===!0&&e&&(u.autoSave=!1,u.includeChildren=!0,u.autoLoad=n.extend(!0,{},e))}t=f.layout(i),t&&ei(r,t)}})}})}},sr=function(n,t){var f=n.container,r=n.options,u=r.stateManagement,i=r.instanceKey||f.data("layoutInstanceKey");return i||(i=(u&&u.cookie?u.cookie.name:"")||r.name),i=i?i.replace(/[^\w-]/gi,"_").replace(/_{2,}/g,"_"):"layout"+ ++t.childIdx,r.instanceKey=i,f.data("layoutInstanceKey",i),i},ei=function(t,i){var f=c[t],r=ft[t],e=o[t],u;n.isPlainObject(r)&&(n.each(r,function(n,t){t.destroyed&&delete r[n]}),n.isEmptyObject(r)&&(r=ft[t]=null)),i||r||(i=f.data("layout")),i&&(i.hasParentLayout=!0,u=i.options,sr(i,e),r||(r=ft[t]={}),r[u.instanceKey]=i.container.data("layout")),y[t].children=ft[t],i||wi(t)},uu=function(){var t=s,n=Number(t.resizeWithWindowDelay);n<10&&(n=100),d.clear("winResize"),d.set("winResize",function(){d.clear("winResize"),d.clear("winResizeRepeater");var n=nt(a,t.inset);(n.innerWidth!==l.innerWidth||n.innerHeight!==l.innerHeight)&&dt()},n),d.data.winResizeRepeater||hr()},hr=function(){var n=Number(s.resizeWithWindowMaxDelay);n>0&&d.set("winResizeRepeater",function(){hr(),dt()},n)},cr=function(){var t=s;v("onunload_start"),r(y,n.layout.onUnload),v("onunload_end")},fu=function(){var c=a[0],i=n("html"),tt=l.tagName=c.tagName,it=l.id=c.id,rt=l.className=c.className,t=s,f=t.name,ut="position,margin,padding,border",e="layoutCSS",v={},p="hidden",o=a.data("parentLayout"),h=a.data("layoutEdge"),w=o&&h,u=n.layout.cssNum,b,r,d,g;l.selector=a.selector.split(".slice")[0],l.ref=(t.name?t.name+" layout / ":"")+tt+(it?"#"+it:rt?".["+rt+"]":""),l.isBody=tt==="BODY",w||l.isBody||(b=a.closest("."+n.layout.defaults.panes.paneClass),o=b.data("parentLayout"),h=b.data("layoutEdge"),w=o&&h),a.data({layout:y,layoutContainer:k}).addClass(t.containerClass),d={destroy:"",initPanes:"",resizeAll:"resizeAll",resize:"resizeAll"};for(f in d)a.bind("layout"+f.toLowerCase()+"."+k,y[d[f]||f]);w&&(y.hasParentLayout=!0,o.refreshChildren(h,y)),a.data(e)||(l.isBody?(a.data(e,n.extend(ti(a,ut),{height:a.css("height"),overflow:a.css("overflow"),overflowX:a.css("overflowX"),overflowY:a.css("overflowY")})),i.data(e,n.extend(ti(i,"padding"),{height:"auto",overflow:i.css("overflow"),overflowX:i.css("overflowX"),overflowY:i.css("overflowY")}))):a.data(e,ti(a,ut+",top,bottom,left,right,width,height,overflow,overflowX,overflowY")));try{v={overflow:p,overflowX:p,overflowY:p},a.css(v),t.inset&&!n.isPlainObject(t.inset)&&(r=parseInt(t.inset,10)||0,t.inset={top:r,bottom:r,left:r,right:r}),l.isBody?(t.outset?n.isPlainObject(t.outset)||(r=parseInt(t.outset,10)||0,t.outset={top:r,bottom:r,left:r,right:r}):t.outset={top:u(i,"paddingTop"),bottom:u(i,"paddingBottom"),left:u(i,"paddingLeft"),right:u(i,"paddingRight")},i.css(v).css({height:"100%",border:"none",padding:0,margin:0}),st.isIE6?(a.css({width:"100%",height:"100%",border:"none",padding:0,margin:0,position:"relative"}),t.inset||(t.inset=nt(a).inset)):(a.css({width:"auto",height:"auto",margin:0,position:"absolute"}),a.css(t.outset)),n.extend(l,nt(a,t.inset))):(g=a.css("position"),g&&g.match(/(fixed|absolute|relative)/)||a.css("position","relative"),a.is(":visible")&&(n.extend(l,nt(a,t.inset)),l.innerHeight<1&&ht(t.errors.noContainerHeight.replace(/CONTAINER/,l.ref)))),u(a,"minWidth")&&a.parent().css("overflowX","auto"),u(a,"minHeight")&&a.parent().css("overflowY","auto")}catch(ft){}},lr=function(t){t=t?t.split(","):h.borderPanes,n.each(t,function(t,i){var r=s[i];if(r.enableCursorHotkey||r.customHotkey)return n(document).bind("keydown."+k,nf),!1})},eu=function(){function p(t){var i=s[t],r=s.panes;i.fxSettings||(i.fxSettings={}),r.fxSettings||(r.fxSettings={}),n.each(["_open","_close","_size"],function(u,f){var o="fxName"+f,h="fxSpeed"+f,c="fxSettings"+f,e=i[o]=i[o]||r[o]||i.fxName||r.fxName||"none";e!=="none"&&s.effects[e]&&n.effects&&(n.effects[e]||n.effects.effect[e])||(e=i[o]="none");var l=s.effects[e]||{},a=l.all||null,v=l[t]||null;i[h]=i[h]||r[h]||i.fxSpeed||r.fxSpeed||null,i[c]=n.extend(!0,{},a,v,r.fxSettings,i.fxSettings,r[c],i[c])}),delete i.fxName,delete i.fxSpeed,delete i.fxSettings}var r,v,i,a,f,o,u,y,l,c;if(e=n.layout.transformData(e,!0),e=n.layout.backwardCompatibility.renameAllOptions(e),!n.isEmptyObject(e.panes)){for(r=n.layout.optionsMap.noDefault,f=0,o=r.length;f<o;f++)i=r[f],delete e.panes[i];for(r=n.layout.optionsMap.layout,f=0,o=r.length;f<o;f++)i=r[f],delete e.panes[i]}r=n.layout.optionsMap.layout,y=n.layout.config.optionRootKeys;for(i in e)a=e[i],n.inArray(i,y)<0&&n.inArray(i,r)<0&&(e.panes[i]||(e.panes[i]=n.isPlainObject(a)?n.extend(!0,{},a):a),delete e[i]);n.extend(!0,s,e),n.each(h.allPanes,function(t,f){if(h[f]=n.extend(!0,{},h.panes,h[f]),v=s.panes,u=s[f],f==="center")for(r=n.layout.optionsMap.center,t=0,o=r.length;t<o;t++)i=r[t],e.center[i]||!e.panes[i]&&u[i]||(u[i]=v[i]);else u=s[f]=n.extend(!0,{},v,u),p(f),u.resizerClass||(u.resizerClass="ui-layout-resizer"),u.togglerClass||(u.togglerClass="ui-layout-toggler");u.paneClass||(u.paneClass="ui-layout-pane")}),l=e.zIndex,c=s.zIndexes,l>0&&(c.pane_normal=l,c.content_mask=t(l+1,c.content_mask),c.resizer_normal=t(l+2,c.resizer_normal)),delete s.panes},ar=function(n){var t=s[n].paneSelector,i;return t.substr(0,1)==="#"?a.find(t).eq(0):(i=a.children(t).eq(0),i.length?i:a.children("form:first").children(t).eq(0))},ou=function(t){w(t),n.each(h.allPanes,function(n,t){vr(t,!0)}),bi(),n.each(h.borderPanes,function(n,t){c[t]&&o[t].isVisible&&(ut(t),vt(t))}),pt("center"),n.each(h.allPanes,function(n,t){yr(t)})},vr=function(n,i){var ut,d,a;if(i||b()){var u=s[n],e=o[n],v=h[n],p=v.dir,st=e.fx,ht=u.spacing_open||0,ot=n==="center",w={},r=c[n],l,g,nt;if(r?di(n,!1,!0,!1):tt[n]=!1,r=c[n]=ar(n),!r.length){c[n]=!1;return}r.data("layoutCSS")||(ut="position,top,left,bottom,right,width,height,overflow,zIndex,display,backgroundColor,padding,margin,border",r.data("layoutCSS",ti(r,ut))),y[n]={name:n,pane:c[n],content:tt[n],options:s[n],state:o[n],children:ft[n]},r.data({parentLayout:y,layoutPane:y[n],layoutEdge:n,layoutRole:"pane"}).css(v.cssReq).css("zIndex",s.zIndexes.pane_normal).css(u.applyDemoStyles?v.cssDemo:{}).addClass(u.paneClass+" "+u.paneClass+"-"+n).bind("mouseenter."+k,pi).bind("mouseleave."+k,et),d={hide:"",show:"",toggle:"",close:"",open:"",slideOpen:"",slideClose:"",slideToggle:"",size:"sizePane",sizePane:"sizePane",sizeContent:"",sizeHandles:"",enableClosable:"",disableClosable:"",enableSlideable:"",disableSlideable:"",enableResizable:"",disableResizable:"",swapPanes:"swapPanes",swap:"swapPanes",move:"swapPanes",removePane:"removePane",remove:"removePane",createChildren:"",resizeChildren:"",resizeAll:"resizeAll",resizeLayout:"resizeAll"};for(a in d)r.bind("layoutpane"+a.toLowerCase()+"."+k,y[d[a]||a]);ki(n,!1),ot||(l=e.size=ct(n,u.size),g=ct(n,u.minSize)||1,nt=ct(n,u.maxSize)||1e5,l>0&&(l=t(f(l,nt),g)),e.autoResize=u.autoResize,e.isClosed=!1,e.isSliding=!1,e.isResizing=!1,e.isHidden=!1,e.pins||(e.pins=[])),e.tagName=r[0].tagName,e.edge=n,e.noRoom=!1,e.isVisible=!0,pr(n),p==="horz"?w.height=rt(r,l):p==="vert"&&(w.width=it(r,l)),r.css(w),p!="horz"&&pt(n,!0),u.initClosed&&u.closable&&!u.initHidden?at(n,!0,!0):u.initHidden||u.initClosed?gi(n):e.noRoom||r.css("display","block"),r.css("visibility","visible"),u.showOverflowOnHover&&r.hover(nu,ai),o.initialized&&(bi(n),lr(n),yr(n))}},yr=function(n){var t=c[n],r=o[n],i=s[n];t&&(t.data("layout")&&ei(n,t.data("layout")),r.isVisible&&(o.initialized?dt():gt(n),i.triggerEventsOnLoad?v("onresize_end",n):dr(n,!0)),i.initChildren&&i.children&&wi(n))},pr=function(t){t=t?t.split(","):h.borderPanes,n.each(t,function(n,t){var f=c[t],r=p[t],a=s[t],e=o[t],u=h[t].side,i={};if(f){switch(t){case"north":i.top=l.inset.top,i.left=l.inset.left,i.right=l.inset.right;break;case"south":i.bottom=l.inset.bottom,i.left=l.inset.left,i.right=l.inset.right;break;case"west":i.left=l.inset.left;break;case"east":i.right=l.inset.right}f.css(i),r&&e.isClosed?r.css(u,l.inset[u]):r&&!e.isHidden&&r.css(u,l.inset[u]+lt(t))}})},bi=function(t){t=t?t.split(","):h.borderPanes,n.each(t,function(t,i){var nt=c[i];if(p[i]=!1,g[i]=!1,nt){var r=s[i],u=o[i],tt=h[i],f=r.paneSelector.substr(0,1)==="#"?r.paneSelector.substr(1):"",v=r.resizerClass,w=r.togglerClass,it=u.isVisible?r.spacing_open:r.spacing_closed,b="-"+i,rt=u.isVisible?"-open":"-closed",d=y[i],e=d.resizer=p[i]=n("<div><\/div>"),l=d.toggler=r.closable?g[i]=n("<div><\/div>"):!1;!u.isVisible&&r.slidable&&e.attr("title",r.tips.Slide).css("cursor",r.sliderCursor),e.attr("id",f?f+"-resizer":"").data({parentLayout:y,layoutPane:y[i],layoutEdge:i,layoutRole:"resizer"}).css(h.resizers.cssReq).css("zIndex",s.zIndexes.resizer_normal).css(r.applyDemoStyles?h.resizers.cssDemo:{}).addClass(v+" "+v+b).hover(pi,et).hover(er,or).appendTo(a),r.resizerDblClickToggle&&e.bind("dblclick."+k,bt),l&&(l.attr("id",f?f+"-toggler":"").data({parentLayout:y,layoutPane:y[i],layoutEdge:i,layoutRole:"toggler"}).css(h.togglers.cssReq).css(r.applyDemoStyles?h.togglers.cssDemo:{}).addClass(w+" "+w+b).hover(pi,et).bind("mouseenter",er).appendTo(e),r.togglerContent_open&&n("<span>"+r.togglerContent_open+"<\/span>").data({layoutEdge:i,layoutRole:"togglerContent"}).data("layoutRole","togglerContent").data("layoutEdge",i).addClass("content content-open").css("display","none").appendTo(l),r.togglerContent_closed&&n("<span>"+r.togglerContent_closed+"<\/span>").data({layoutEdge:i,layoutRole:"togglerContent"}).addClass("content content-closed").css("display","none").appendTo(l),gr(i)),su(i),u.isVisible?tr(i):(nr(i),wt(i,!0))}}),ni()},ki=function(n,t){if(b()){var u=s[n],f=u.contentSelector,e=y[n],r=c[n],i;f&&(i=e.content=tt[n]=u.findNestedContent?r.find(f).eq(0):r.children(f).eq(0)),i&&i.length?(i.data("layoutRole","content"),i.data("layoutCSS")||i.data("layoutCSS",ti(i,"height")),i.css(h.content.cssReq),u.applyDemoStyles&&(i.css(h.content.cssDemo),r.css(h.content.cssDemoPane)),r.css("overflowX").match(/(scroll|auto)/)&&r.css("overflow","hidden"),o[n].content={},t!==!1&&gt(n)):e.content=tt[n]=!1}},su=function(t){var r=n.layout.plugins.draggable,i;t=t?t.split(","):h.borderPanes,n.each(t,function(t,u){var f=s[u];if(!r||!c[u]||!f.resizable)return f.resizable=!1,!0;var l=o[u],nt=s.zIndexes,tt=h[u],e=tt.dir=="horz"?"top":"left",ct=c[u],b=p[u],y=f.resizerClass,k=0,w,it,rt=y+"-drag",ft=y+"-"+u+"-drag",st=y+"-dragging",ht=y+"-"+u+"-dragging",et=y+"-dragging-limit",ot=y+"-"+u+"-dragging-limit",g=!1;l.isClosed||b.attr("title",f.tips.Resize).css("cursor",f.resizerCursor),b.draggable({containment:a[0],axis:tt.dir=="horz"?"y":"x",delay:0,distance:1,grid:f.resizingGrid,helper:"clone",opacity:f.resizerDragOpacity,addClasses:!1,zIndex:nt.resizer_drag,start:function(t,i){if(f=s[u],l=o[u],it=f.livePaneResizing,!1===v("ondrag_start",u))return!1;l.isResizing=!0,o.paneResizing=u,d.clear(u+"_closeSlider"),ut(u),w=l.resizerPosition,k=i.position[e],b.addClass(rt+" "+ft),g=!1,n("body").disableSelection(),ii(u)},drag:function(n,t){g||(t.helper.addClass(st+" "+ht).css({right:"auto",bottom:"auto"}).children().css("visibility","hidden"),g=!0,l.isSliding&&c[u].css("zIndex",nt.pane_sliding));var r=0;t.position[e]<w.min?(t.position[e]=w.min,r=-1):t.position[e]>w.max&&(t.position[e]=w.max,r=1),r?(t.helper.addClass(et+" "+ot),window.defaultStatus=r>0&&u.match(/(north|west)/)||r<0&&u.match(/(south|east)/)?f.tips.maxSizeWarning:f.tips.minSizeWarning):(t.helper.removeClass(et+" "+ot),window.defaultStatus=""),it&&Math.abs(t.position[e]-k)>=f.liveResizingTolerance&&(k=t.position[e],i(n,t,u))},stop:function(t,r){n("body").enableSelection(),window.defaultStatus="",b.removeClass(rt+" "+ft),l.isResizing=!1,o.paneResizing=!1,i(t,r,u,!0)}})}),i=function(n,t,i,r){var f=t.position,y=h[i],c=s[i],a=o[i],u,e;switch(i){case"north":u=f.top;break;case"west":u=f.left;break;case"south":u=l.layoutHeight-f.top-c.spacing_open;break;case"east":u=l.layoutWidth-f.left-c.spacing_open}if(e=u-l.inset[y.side],r)!1!==v("ondrag_end",i)&&li(i,e,!1,!0),oi(!0),a.isSliding&&ii(i);else{if(Math.abs(e-a.size)<c.liveResizingTolerance)return;li(i,e,!1,!0),hu()}}},wr=function(){var i=n(this),r=i.data("layoutMask"),t=o[r];t.tagName=="IFRAME"&&t.isVisible&&i.css({top:t.offsetTop,left:t.offsetLeft,width:t.outerWidth,height:t.outerHeight})},hu=function(){ot.each(wr)},ii=function(t,i){var l=h[t],r=["center"],e=s.zIndexes,c=n.extend({objectsOnly:!1,forSliding:o[t].isSliding},i),u,f;c.forSliding&&r.push(h.oppositeEdge[t]),l.dir==="horz"&&(r.push("west"),r.push("east")),n.each(r,function(n,t){f=o[t],u=s[t],f.isVisible&&(u.maskObjects||!c.objectsOnly&&u.maskContents)&&cu(t).each(function(){wr.call(this),this.style.zIndex=f.isSliding?e.pane_sliding+1:e.pane_normal+1,this.style.display="block"})})},oi=function(t){if(t||!o.paneResizing)ot.hide();else if(!t&&!n.isEmptyObject(o.panesSliding))for(var i=ot.length-1,u,r;i>=0;i--)r=ot.eq(i),u=r.data("layoutMask"),s[u].maskObjects||r.hide()},cu=function(t){for(var i=n([]),r,u=0,f=ot.length;u<f;u++)r=ot.eq(u),r.data("layoutMask")===t&&(i=i.add(r));return i.length?i:lu(t)},lu=function(t){var y=c[t],p=o[t],u=s[t],l=s.zIndexes,f=n([]),h,r,v,i,e;if(!u.maskContents&&!u.maskObjects)return f;for(e=0;e<(u.maskObjects?2:1);e++)h=u.maskObjects&&e==0,r=document.createElement(h?"iframe":"div"),v=n(r).data("layoutMask",t),r.className="ui-layout-mask ui-layout-mask-"+t,i=r.style,i.display="block",i.position="absolute",i.background="#FFF",h&&(r.frameborder=0,r.src="about:blank",i.opacity=0,i.filter="Alpha(Opacity='0')",i.border=0),p.tagName=="IFRAME"?(i.zIndex=l.pane_normal+1,a.append(r)):(v.addClass("ui-layout-mask-inside-pane"),i.zIndex=u.maskZindex||l.content_mask,i.top=0,i.left=0,i.width="100%",i.height="100%",y.append(r)),f=f.add(r),ot=ot.add(r);return f},au=function(t,i){var u,f;n(window).unbind("."+k),n(document).unbind("."+k),typeof t=="object"?w(t):i=t,a.clearQueue().removeData("layout").removeData("layoutContainer").removeClass(s.containerClass).unbind("."+k),ot.remove(),n.each(h.allPanes,function(n,t){di(t,!1,!0,i)}),u="layoutCSS",a.data(u)&&!a.data("layoutRole")&&a.css(a.data(u)).removeData(u),l.tagName==="BODY"&&(a=n("html")).data(u)&&a.css(a.data(u)).removeData(u),r(y,n.layout.onDestroy),cr();for(f in y)f.match(/^(container|options)$/)||delete y[f];return y.destroyed=!0,y},di=function(t,i,r,u){if(b()){var f=w.call(this,t),e=c[f],h=tt[f],a=p[f],v=g[f];e&&n.isEmptyObject(e.data())&&(e=!1),h&&n.isEmptyObject(h.data())&&(h=!1),a&&n.isEmptyObject(a.data())&&(a=!1),v&&n.isEmptyObject(v.data())&&(v=!1),e&&e.stop(!0,!0);var ut=s[f],ct=o[f],nt="layoutCSS",l=ft[f],it=n.isPlainObject(l)&&!n.isEmptyObject(l),lt=u!==undefined?u:ut.destroyChildren;if(it&&lt&&(n.each(l,function(n,t){t.destroyed||t.destroy(!0),t.destroyed&&delete l[n]}),n.isEmptyObject(l)&&(l=ft[f]=null,it=!1)),e&&i&&!it)e.remove();else if(e&&e[0]){var d=ut.paneClass,rt=d+"-"+f,et="-open",ot="-sliding",st="-closed",ht=[d,d+et,d+st,d+ot,rt,rt+et,rt+st,rt+ot];n.merge(ht,yi(e,!0)),e.removeClass(ht.join(" ")).removeData("parentLayout").removeData("layoutPane").removeData("layoutRole").removeData("layoutEdge").removeData("autoHidden").unbind("."+k),it&&h?(h.width(h.width()),n.each(l,function(n,t){t.resizeAll()})):h&&h.css(h.data(nt)).removeData(nt).removeData("layoutRole"),e.data("layout")||e.css(e.data(nt)).removeData(nt)}v&&v.remove(),a&&a.remove(),y[f]=c[f]=tt[f]=p[f]=g[f]=!1,ct={removed:!0},r||dt()}},si=function(n){var t=c[n],r=s[n],i=t[0].style;r.useOffscreenClose?(t.data(h.offscreenReset)||t.data(h.offscreenReset,{left:i.left,right:i.right}),t.css(h.offscreenCSS)):t.hide().removeData(h.offscreenReset)},br=function(n){var i=c[n],f=s[n],u=h.offscreenCSS,r=i.data(h.offscreenReset),t=i[0].style;i.show().removeData(h.offscreenReset),f.useOffscreenClose&&r&&(t.left==u.left&&(t.left=r.left),t.right==u.right&&(t.right=r.right))},gi=function(n,t){if(b()){var i=w.call(this,n),f=s[i],r=o[i],e=c[i],u=p[i];e&&!r.isHidden&&(o.initialized&&!1===v("onhide_start",i)||(r.isSliding=!1,delete o.panesSliding[i],u&&u.hide(),!o.initialized||r.isClosed?(r.isClosed=!0,r.isHidden=!0,r.isVisible=!1,o.initialized||si(i),pt(h[i].dir==="horz"?"":"center"),(o.initialized||f.triggerEventsOnLoad)&&v("onhide_end",i)):(r.isHiding=!0,at(i,!1,t))))}},hi=function(n,t,i,r){if(b()){var u=w.call(this,n),h=s[u],f=o[u],e=c[u],l=p[u];e&&f.isHidden&&!1!==v("onshow_start",u)&&(f.isShowing=!0,f.isSliding=!1,delete o.panesSliding[u],t===!1?at(u,!0):kt(u,!1,i,r))}},bt=function(n,t){if(b()){var r=vi(n),i=w.call(this,n),u=o[i];r&&r.stopImmediatePropagation(),u.isHidden?hi(i):u.isClosed?kt(i,!!t):at(i)}},vu=function(n){var i=c[n],t=o[n];si(n),t.isClosed=!0,t.isVisible=!1},at=function(n,t,i,r){function nt(){f.isMoving=!1,wt(u,!0);var n=h.oppositeEdge[u];o[n].noRoom&&(ut(n),vt(n)),!r&&(o.initialized||e.triggerEventsOnLoad)&&(l||v("onclose_end",u),l&&v("onshow_end",u),y&&v("onhide_end",u))}var u=w.call(this,n);if(!o.initialized&&c[u]){vu(u);return}if(b()){var k=c[u],it=p[u],rt=g[u],e=s[u],f=o[u],ft=h[u],d,l,y,tt;a.queue(function(n){if(!k||!e.closable&&!f.isShowing&&!f.isHiding||!t&&f.isClosed&&!f.isShowing)return n();var r=!f.isShowing&&!1===v("onclose_start",u);if(l=f.isShowing,y=f.isHiding,tt=f.isSliding,delete f.isShowing,delete f.isHiding,r)return n();d=!i&&!f.isClosed&&e.fxName_close!="none",f.isMoving=!0,f.isClosed=!0,f.isVisible=!1,y?f.isHidden=!0:l&&(f.isHidden=!1),f.isSliding?ri(u,!1):pt(h[u].dir==="horz"?"":"center",!1),nr(u),d?(ci(u,!0),k.hide(e.fxName_close,e.fxSettings_close,e.fxSpeed_close,function(){ci(u,!1),f.isClosed&&nt(),n()})):(si(u),nt(),n())})}},nr=function(t){var k=c[t],y=p[t],u=g[t],f=s[t],d=o[t],w=h[t].side,i=f.resizerClass,e=f.togglerClass,r="-"+t,a="-open",b="-sliding",v="-closed";y.css(w,l.inset[w]).removeClass(i+a+" "+i+r+a).removeClass(i+b+" "+i+r+b).addClass(i+v+" "+i+r+v),f.resizable&&n.layout.plugins.draggable&&y.draggable("disable").removeClass("ui-state-disabled").css("cursor","default").attr("title",""),u&&(u.removeClass(e+a+" "+e+r+a).addClass(e+v+" "+e+r+v).attr("title",f.tips.Open),u.children(".content-open").hide(),u.children(".content-closed").css("display","block")),rr(t,!1),o.initialized&&ni()},kt=function(n,t,i,r){function d(){f.isMoving=!1,ur(u),f.isSliding||pt(h[u].dir=="vert"?"center":"",!1),tr(u)}if(b()){var u=w.call(this,n),l=c[u],nt=p[u],tt=g[u],e=s[u],f=o[u],it=h[u],y,k;a.queue(function(n){if(!l||!e.resizable&&!e.closable&&!f.isShowing||f.isVisible&&!f.isSliding)return n();if(f.isHidden&&!f.isShowing){n(),hi(u,!0);return}f.autoResize&&f.size!=e.size?yt(u,e.size,!0,!0,!0):ut(u,t);var o=v("onopen_start",u);if(o==="abort")return n();if(o!=="NC"&&ut(u,t),f.minSize>f.maxSize)return rr(u,!1),!r&&e.tips.noRoomToOpen&&alert(e.tips.noRoomToOpen),n();t?ri(u,!0):f.isSliding?ri(u,!1):e.slidable&&wt(u,!1),f.noRoom=!1,vt(u),k=f.isShowing,delete f.isShowing,y=!i&&f.isClosed&&e.fxName_open!="none",f.isMoving=!0,f.isVisible=!0,f.isClosed=!1,k&&(f.isHidden=!1),y?(ci(u,!0),l.show(e.fxName_open,e.fxSettings_open,e.fxSpeed_open,function(){ci(u,!1),f.isVisible&&d(),n()})):(br(u),d(),n())})}},tr=function(t,i){var tt=c[t],f=p[t],a=g[t],u=s[t],y=o[t],it=h[t].side,r=u.resizerClass,w=u.togglerClass,e="-"+t,b="-open",k="-closed",d="-sliding";f.css(it,l.inset[it]+lt(t)).removeClass(r+k+" "+r+e+k).addClass(r+b+" "+r+e+b),y.isSliding?f.addClass(r+d+" "+r+e+d):f.removeClass(r+d+" "+r+e+d),et(0,f),u.resizable&&n.layout.plugins.draggable?f.draggable("enable").css("cursor",u.resizerCursor).attr("title",u.tips.Resize):y.isSliding||f.css("cursor","default"),a&&(a.removeClass(w+k+" "+w+e+k).addClass(w+b+" "+w+e+b).attr("title",u.tips.Close),et(0,a),a.children(".content-closed").hide(),a.children(".content-open").css("display","block")),rr(t,!y.isSliding),n.extend(y,nt(tt)),o.initialized&&(ni(),gt(t,!0)),!i&&(o.initialized||u.triggerEventsOnLoad)&&tt.is(":visible")&&(v("onopen_end",t),y.isShowing&&v("onshow_end",t),o.initialized&&v("onresize_end",t))},kr=function(n){function f(){r.isClosed?r.isMoving||kt(t,!0):ri(t,!0)}if(b()){var i=vi(n),t=w.call(this,n),r=o[t],u=s[t].slideDelay_open;i&&i.stopImmediatePropagation(),r.isClosed&&i&&i.type==="mouseenter"&&u>0?d.set(t+"_openSlider",f,u):f()}},ir=function(i){function h(){u.isClosed?ri(r,!1):u.isMoving||at(r)}if(b()){var e=vi(i),r=w.call(this,i),f=s[r],u=o[r],l=u.isMoving?1e3:300;if(!u.isClosed&&!u.isResizing)if(f.slideTrigger_close==="click")h();else{if(f.preventQuickSlideClose&&u.isMoving)return;if(f.preventPrematureSlideClose&&e&&n.layout.isMouseOverElem(e,c[r]))return;e?d.set(r+"_closeSlider",h,t(f.slideDelay_close,l)):h()}}},yu=function(n){var t=w.call(this,n);bt(t,!0)},ci=function(n,t){var i=c[n],f=o[n],u=s[n],r=s.zIndexes;t?(ii(n,{objectsOnly:!0}),i.css({zIndex:r.pane_animate}),n=="south"?i.css({top:l.inset.top+l.innerHeight-i.outerHeight()}):n=="east"&&i.css({left:l.inset.left+l.innerWidth-i.outerWidth()})):(oi(),i.css({zIndex:f.isSliding?r.pane_sliding:r.pane_normal}),n=="south"?i.css({top:"auto"}):n!="east"||i.css("left").match(/\-99999/)||i.css({left:"auto"}),st.msie&&u.fxOpacityFix&&u.fxName_open!="slide"&&i.css("filter")&&i.css("opacity")==1&&i[0].style.removeAttribute("filter"))},wt=function(n,t){var i=s[n],f=c[n],u=p[n],r=i.slideTrigger_open.toLowerCase();u&&(!t||i.slidable)&&(r.match(/mouseover/)?r=i.slideTrigger_open="mouseenter":r.match(/(click|dblclick|mouseenter)/)||(r=i.slideTrigger_open="click"),i.resizerDblClickToggle&&r.match(/click/)&&u[t?"unbind":"bind"]("dblclick."+k,bt),u[t?"bind":"unbind"](r+"."+k,kr).css("cursor",t?i.sliderCursor:"default").attr("title",t?i.tips.Slide:""))},ri=function(n,t){function v(t){d.clear(n+"_closeSlider"),t.stopPropagation()}var i=s[n],a=o[n],y=h[n],f=s.zIndexes,r=i.slideTrigger_close.toLowerCase(),e=t?"bind":"unbind",l=c[n],u=p[n];d.clear(n+"_closeSlider"),t?(a.isSliding=!0,o.panesSliding[n]=!0,wt(n,!1)):(a.isSliding=!1,delete o.panesSliding[n]),l.css("zIndex",t?f.pane_sliding:f.pane_normal),u.css("zIndex",t?f.pane_sliding+2:f.resizer_normal),r.match(/(click|mouseleave)/)||(r=i.slideTrigger_close="mouseleave"),u[e](r,ir),r==="mouseleave"&&(l[e]("mouseleave."+k,ir),u[e]("mouseenter."+k,v),l[e]("mouseenter."+k,v)),t?r!=="click"||i.resizable||(u.css("cursor",t?i.sliderCursor:"default"),u.attr("title",t?i.tips.Close:"")):d.clear(n+"_closeSlider")},vt=function(t,i,r,u){var y=s[t],f=o[t],a=h[t],k=c[t],e=p[t],b=a.dir==="vert",v=!1,w;(t==="center"||b&&f.noVerticalRoom)&&(v=f.maxHeight>=0,v&&f.noRoom?(br(t),e&&e.show(),f.isVisible=!0,f.noRoom=!1,b&&(f.noVerticalRoom=!1),ur(t)):v||f.noRoom||(si(t),e&&e.hide(),f.isVisible=!1,f.noRoom=!0)),t==="center"||(f.minSize<=f.maxSize?(v=!0,f.size>f.maxSize?yt(t,f.maxSize,r,!0,u):f.size<f.minSize?yt(t,f.minSize,r,!0,u):e&&f.isVisible&&k.is(":visible")&&(w=f.size+l.inset[a.side],n.layout.cssNum(e,a.side)!=w&&e.css(a.side,w)),f.noRoom&&(f.wasOpen&&y.closable?y.autoReopen?kt(t,!1,!0,!0):f.noRoom=!1:hi(t,f.wasOpen,!0,!0))):f.noRoom||(f.noRoom=!0,f.wasOpen=!f.isClosed&&!f.isSliding,f.isClosed||(y.closable?at(t,!0,!0):gi(t,!0))))},li=function(n,t,i,r,u){if(b()){var f=w.call(this,n),h=s[f],e=o[f],c=u||h.livePaneResizing&&!e.isResizing;e.autoResize=!1,yt(f,t,i,r,c)}},yt=function(i,r,u,e,y){function lt(){for(var c=it==="width"?g.outerWidth():g.outerHeight(),e=[{pane:k,count:1,target:r,actual:c,correct:r===c,attempt:r,cssSize:rt}],f=e[0],i={},a="Inaccurate size after resizing the "+k+"-pane.",s;!f.correct;){if(i={pane:k,count:f.count+1,target:r},i.attempt=f.actual>r?t(0,f.attempt-(f.actual-r)):t(0,f.attempt+(r-f.actual)),i.cssSize=fr(k,i.attempt),g.css(it,i.cssSize),i.actual=it=="width"?g.outerWidth():g.outerHeight(),i.correct=r===i.actual,e.length===1&&(ht(a,!1,!0),ht(f,!1,!0)),ht(i,!1,!0),e.length>3)break;e.push(i),f=e[e.length-1]}d.size=r,n.extend(d,nt(g)),d.isVisible&&g.is(":visible")&&(et&&et.css(ot,r+l.inset[ot]),gt(k)),!u&&!st&&o.initialized&&d.isVisible&&v("onresize_end",k),u||(d.isSliding||pt(h[k].dir=="horz"?"":"center",st,y),ni()),s=h.oppositeEdge[k],r<ft&&o[s].noRoom&&(ut(s),vt(s,!1,u)),e.length>1&&ht(a+"\nSee the Error Console for details.",!0,!0)}if(b()){var k=w.call(this,i),tt=s[k],d=o[k],g=c[k],et=p[k],ot=h[k].side,it=h[k].sizeType.toLowerCase(),st=d.isResizing&&!tt.triggerEventsDuringLiveResize,at=e!==!0&&tt.animatePaneSizing,ft,rt;a.queue(function(i){if(ut(k),ft=d.size,r=ct(k,r),r=t(r,ct(k,tt.minSize)),r=f(r,d.maxSize),r<d.minSize){i(),vt(k,!1,u);return}if(!y&&r===ft)return i();if(!u&&o.initialized&&d.isVisible&&v("onresize_start",k),rt=fr(k,r),at&&g.is(":visible")){var c=n.layout.effects.size[k]||n.layout.effects.size.all,l=tt.fxSettings_size.easing||c.easing,e=s.zIndexes,h={};h[it]=rt+"px",d.isMoving=!0,g.css({zIndex:e.pane_animate}).show().animate(h,tt.fxSpeed_size,l,function(){g.css({zIndex:d.isSliding?e.pane_sliding:e.pane_normal}),d.isMoving=!1,lt(),i()})}else g.css(it,rt),g.is(":visible")?lt():(d.size=r,n.extend(d,nt(g))),i()})}},pt=function(i,r,u){i=(i?i:"east,west,center").split(","),n.each(i,function(i,f){var ot;if(c[f]){var ht=s[f],e=o[f],h=c[f],ct=p[f],lt=f=="center",d=!0,a={},g=n.layout.showInvisibly(h),y=iu();if(n.extend(e,nt(h)),f==="center"){if(!u&&e.isVisible&&y.width===e.outerWidth&&y.height===e.outerHeight)return h.css(g),!0;if(n.extend(e,ui(f),{maxWidth:y.width,maxHeight:y.height}),a=y,a.width=it(h,a.width),a.height=rt(h,a.height),d=a.width>=0&&a.height>=0,!o.initialized&&ht.minWidth>y.width){var w=ht.minWidth-e.outerWidth,tt=s.east.minSize||0,ut=s.west.minSize||0,b=o.east.size,k=o.west.size,ft=b,et=k;if(w>0&&o.east.isVisible&&b>tt&&(ft=t(b-tt,b-w),w-=b-ft),w>0&&o.west.isVisible&&k>ut&&(et=t(k-ut,k-w),w-=k-et),w===0){b&&b!=tt&&yt("east",ft,!0,!0,u),k&&k!=ut&&yt("west",et,!0,!0,u),pt("center",r,u),h.css(g);return}}}else{if(e.isVisible&&!e.noVerticalRoom&&n.extend(e,nt(h),ui(f)),!u&&!e.noVerticalRoom&&y.height===e.outerHeight)return h.css(g),!0;a.top=y.top,a.bottom=y.bottom,a.height=rt(h,y.height),e.maxHeight=a.height,d=e.maxHeight>=0,d||(e.noVerticalRoom=!0)}if(d?(!r&&o.initialized&&v("onresize_start",f),h.css(a),f!=="center"&&ni(f),!e.noRoom||e.isClosed||e.isHidden||vt(f),e.isVisible&&(n.extend(e,nt(h)),o.initialized&&gt(f))):!e.noRoom&&e.isVisible&&vt(f),h.css(g),!e.isVisible)return!0;f==="center"&&(ot=st.isIE6||!st.boxModel,c.north&&(ot||o.north.tagName=="IFRAME")&&c.north.css("width",it(c.north,l.innerWidth)),c.south&&(ot||o.south.tagName=="IFRAME")&&c.south.css("width",it(c.south,l.innerWidth))),!r&&o.initialized&&v("onresize_end",f)}})},dt=function(t){var f=l.innerWidth,e=l.innerHeight,y,p,u,i,r;if(w(t),a.is(":visible")){if(!o.initialized){fi();return}if(n.extend(l,nt(a,s.inset)),l.outerHeight){if(t===!0&&pr(),!1===v("onresizeall_start"))return!1;y=l.innerHeight<e,p=l.innerWidth<f,n.each(["south","north","east","west"],function(n,t){c[t]&&(i=s[t],r=o[t],r.autoResize&&r.size!=i.size?yt(t,i.size,!0,!0,!0):(ut(t),vt(t,!1,!0,!0)))}),pt("",!0,!0),ni(),n.each(h.allPanes,function(n,t){(u=c[t],u)&&o[t].isVisible&&v("onresize_end",t)}),v("onresizeall_end")}}},dr=function(t,i){var r=w.call(this,t),u;s[r].resizeChildren&&(i||ei(r),u=ft[r],n.isPlainObject(u)&&n.each(u,function(n,t){t.resizeAll()}))},gt=function(i,r){if(b()){var u=w.call(this,i);u=u?u.split(","):h.allPanes,n.each(u,function(n,i){function a(n){return t(e.css.paddingBottom,parseInt(n.css("marginBottom"),10)||0)}function y(){var e=s[i].contentIgnoreSelector,t=f.nextAll().not(".ui-layout-mask").not(e||":lt(0)"),r=t.filter(":visible"),n=r.filter(":last");u={top:f[0].offsetTop,height:f.outerHeight(),numFooters:t.length,hiddenFooters:t.length-r.length,spaceBelow:0},u.spaceAbove=u.top,u.bottom=u.top+u.height,u.spaceBelow=n.length?n[0].offsetTop+n.outerHeight()-u.bottom+a(n):a(f)}var h=c[i],f=tt[i],p=s[i],e=o[i],u=e.content,l;if(!h||!f||!h.is(":visible"))return!0;(f.length||(ki(i,!1),f))&&!1!==v("onsizecontent_start",i)&&((!e.isMoving&&!e.isResizing||p.liveContentResizing||r||u.top==undefined)&&(y(),u.hiddenFooters>0&&h.css("overflow")==="hidden"&&(h.css("overflow","visible"),y(),h.css("overflow","hidden"))),l=e.innerHeight-(u.spaceAbove-e.css.paddingTop)-(u.spaceBelow-e.css.paddingBottom),f.is(":visible")&&u.height==l||(tu(f,l,!0),u.height=l),o.initialized&&v("onsizecontent_end",i))})}},ni=function(t){var r=w.call(this,t);r=r?r.split(","):h.borderPanes,n.each(r,function(t,r){var b=s[r],y=o[r],tt=c[r],e=p[r],f=g[r],k,ot,st,ht;if(tt&&e){var ct=h[r].dir,ut=y.isClosed?"_closed":"_open",d=b["spacing"+ut],nt=b["togglerAlign"+ut],v=b["togglerLength"+ut],a,ft,w;if(d===0){e.hide();return}if(y.noRoom||y.isHidden||e.show(),ct==="horz"?(a=l.innerWidth,y.resizerLength=a,ft=n.layout.cssNum(tt,"left"),e.css({width:it(e,a),height:rt(e,d),left:ft>-9999?ft:l.inset.left})):(a=tt.outerHeight(),y.resizerLength=a,e.css({height:rt(e,a),width:it(e,d),top:l.inset.top+lt("north",!0)})),et(b,e),f){if(v===0||y.isSliding&&b.hideTogglerOnSlide){f.hide();return}if(f.show(),!(v>0)||v==="100%"||v>a)v=a,w=0;else if(i(nt))switch(nt){case"top":case"left":w=0;break;case"bottom":case"right":w=a-v;break;case"middle":case"center":default:w=u((a-v)/2)}else ot=parseInt(nt,10),w=nt>=0?ot:a-v+ot;ct==="horz"?(st=it(f,v),f.css({width:st,height:rt(f,d),left:w,top:0}),f.children(".content").each(function(){k=n(this),k.css("marginLeft",u((st-k.outerWidth())/2))})):(ht=rt(f,v),f.css({height:ht,width:it(f,d),top:w,left:0}),f.children(".content").each(function(){k=n(this),k.css("marginTop",u((ht-k.outerHeight())/2))})),et(0,f)}!o.initialized&&(b.initHidden||y.noRoom)&&(e.hide(),f&&f.hide())}})},gr=function(n){if(b()){var t=w.call(this,n),r=g[t],i=s[t];r&&(i.closable=!0,r.bind("click."+k,function(n){n.stopPropagation(),bt(t)}).css("visibility","visible").css("cursor","pointer").attr("title",o[t].isClosed?i.tips.Open:i.tips.Close).show())}},pu=function(n,t){if(b()){var i=w.call(this,n),r=g[i];r&&(s[i].closable=!1,o[i].isClosed&&kt(i,!1,!0),r.unbind("."+k).css("visibility",t?"hidden":"visible").css("cursor","default").attr("title",""))}},wu=function(n){if(b()){var t=w.call(this,n),i=p[t];i&&i.data("draggable")&&(s[t].slidable=!0,o[t].isClosed&&wt(t,!0))}},bu=function(n){if(b()){var t=w.call(this,n),i=p[t];i&&(s[t].slidable=!1,o[t].isSliding?at(t,!1,!0):(wt(t,!1),i.css("cursor","default").attr("title",""),et(null,i[0])))}},ku=function(n){if(b()){var i=w.call(this,n),t=p[i],r=s[i];t&&t.data("draggable")&&(r.resizable=!0,t.draggable("enable"),o[i].isClosed||t.css("cursor",r.resizerCursor).attr("title",r.tips.Resize))}},du=function(n){if(b()){var i=w.call(this,n),t=p[i];t&&t.data("draggable")&&(s[i].resizable=!1,t.draggable("disable").css("cursor","default").attr("title",""),et(null,t[0]))}},gu=function(i,r){function k(t){var i=c[t],r=tt[t];return i?{pane:t,P:i?i[0]:!1,C:r?r[0]:!1,state:n.extend(!0,{},o[t]),options:n.extend(!0,{},s[t])}:!1}function d(i,r){if(i){var w=i.P,b=i.C,k=i.pane,f=h[r],g=n.extend(!0,{},o[r]),u=s[r],e={resizerCursor:u.resizerCursor},d,v;n.each("fxName,fxSpeed,fxSettings".split(","),function(n,t){e[t+"_open"]=u[t+"_open"],e[t+"_close"]=u[t+"_close"],e[t+"_size"]=u[t+"_size"]}),c[r]=n(w).data({layoutPane:y[r],layoutEdge:r}).css(h.hidden).css(f.cssReq),tt[r]=b?n(b):!1,s[r]=n.extend(!0,{},i.options,e),o[r]=n.extend(!0,{},i.state),d=new RegExp(u.paneClass+"-"+k,"g"),w.className=w.className.replace(d,u.paneClass+"-"+r),bi(r),f.dir!=h[k].dir?(v=a[r]||0,ut(r),v=t(v,o[r].minSize),li(r,v,!0,!0)):p[r].css(f.side,l.inset[f.side]+(o[r].isVisible?lt(r):0)),i.state.isVisible&&!g.isVisible?tr(r,!0):(nr(r),wt(r,!0)),i=null}}var u;if(b()){if(u=w.call(this,i),o[u].edge=r,o[r].edge=u,!1===v("onswap_start",u)||!1===v("onswap_start",r)){o[u].edge=u,o[r].edge=r;return}var f=k(u),e=k(r),a={};a[u]=f?f.state.size:0,a[r]=e?e.state.size:0,c[u]=!1,c[r]=!1,o[u]={},o[r]={},g[u]&&g[u].remove(),g[r]&&g[r].remove(),p[u]&&p[u].remove(),p[r]&&p[r].remove(),p[u]=p[r]=g[u]=g[r]=!1,d(f,r),d(e,u),f=e=a=null,c[u]&&c[u].css(h.visible),c[r]&&c[r].css(h.visible),dt(),v("onswap_end",u),v("onswap_end",r);return}},rr=function(t,i){n.layout.plugins.buttons&&n.each(o[t].pins,function(r,u){n.layout.buttons.setPinState(y,n(u),t,i)})},a=n(this).eq(0);if(!a.length)return ht(s.errors.containerMissing);if(a.data("layoutContainer")&&a.data("layout"))return a.data("layout");var c={},tt={},p={},g={},ot=n([]),l=o.container,k=o.id,y={options:s,state:o,container:a,panes:c,contents:tt,resizers:p,togglers:g,hide:gi,show:hi,toggle:bt,open:kt,close:at,slideOpen:kr,slideClose:ir,slideToggle:yu,setSizeLimits:ut,_sizePane:yt,sizePane:li,sizeContent:gt,swapPanes:gu,showMasks:ii,hideMasks:oi,initContent:ki,addPane:vr,removePane:di,createChildren:wi,refreshChildren:ei,enableClosable:gr,disableClosable:pu,enableSlidable:wu,disableSlidable:bu,enableResizable:ku,disableResizable:du,allowOverflow:nu,resetOverflow:ai,destroy:au,initPanes:b,resizeAll:dt,runCallbacks:v,hasParentLayout:!1,children:ft,north:!1,south:!1,west:!1,east:!1,center:!1};return ru()==="cancel"?null:y},n(function(){var t=n.layout.browser;t.msie&&(t.boxModel=n.support.boxModel)})})(n),function(n){n.ui||(n.ui={}),n.ui.cookie={acceptsCookies:!!navigator.cookieEnabled,read:function(t){for(var u=document.cookie,f=u?u.split(";"):[],r,i=0,e=f.length;i<e;i++)if(r=n.trim(f[i]).split("="),r[0]==t)return decodeURIComponent(r[1]);return null},write:function(n,t,i){var e="",r="",o=!1,f=i||{},u=f.expires;u&&u.toUTCString?r=u:(u===null||typeof u=="number")&&(r=new Date,u>0?r.setDate(r.getDate()+u):(r.setFullYear(1970),o=!0)),r&&(e+=";expires="+r.toUTCString()),f.path&&(e+=";path="+f.path),f.domain&&(e+=";domain="+f.domain),f.secure&&(e+=";secure"),document.cookie=n+"="+(o?"":encodeURIComponent(t))+e},clear:function(t){n.ui.cookie.write(t,"",{expires:-1})}},n.cookie||(n.cookie=function(t,i,r){var u=n.ui.cookie;if(i===null)u.clear(t);else{if(i===undefined)return u.read(t);u.write(t,i,r)}}),n.layout.plugins.stateManagement=!0,n.layout.config.optionRootKeys.push("stateManagement"),n.layout.defaults.stateManagement={enabled:!1,autoSave:!0,autoLoad:!0,includeChildren:!0,stateKeys:"north.size,south.size,east.size,west.size,north.isClosed,south.isClosed,east.isClosed,west.isClosed,north.isHidden,south.isHidden,east.isHidden,west.isHidden",cookie:{name:"",domain:"",path:"",expires:"",secure:!1}},n.layout.optionsMap.layout.push("stateManagement"),n.layout.state={saveCookie:function(t,i,r){var u=t.options,f=u.stateManagement,e=n.extend(!0,{},f.cookie,r||null),o=t.state.stateData=t.readState(i||f.stateKeys);return n.ui.cookie.write(e.name||u.name||"Layout",n.layout.state.encodeJSON(o),e),n.extend(!0,{},o)},deleteCookie:function(t){var i=t.options;n.ui.cookie.clear(i.stateManagement.cookie.name||i.name||"Layout")},readCookie:function(t){var i=t.options,r=n.ui.cookie.read(i.stateManagement.cookie.name||i.name||"Layout");return r?n.layout.state.decodeJSON(r):{}},loadCookie:function(t){var i=n.layout.state.readCookie(t);return i&&(t.state.stateData=n.extend(!0,{},i),t.loadState(i)),i},loadState:function(t,i,r){var u,o,s,h,f,c,e,l;(i=n.layout.transformData(i),n.isPlainObject(i)&&!n.isEmptyObject(i))&&(t.state.stateData=i,u=n.extend(!0,{},i),n.each(n.layout.config.allPanes,function(n,t){u[t]&&delete u[t].children}),n.extend(!0,t.options,u),!1)&&(console.data(i,"loadState - stateData"),r=n.extend({animate:!0,children:!1},r),e=!r.animate,l="stateManagement",t.state.initialized&&n.each(n.layout.config.borderPanes,function(n,r){(c=t.state[r],f=i[r],typeof f=="object")&&(u=f.size,h=f.initClosed,s=f.initHidden,o=c.isVisible,c.autoResize=f.autoResize,o||t._sizePane(r,u,!1,!1,!1),s===!0?t.hide(r,e):h===!1?t.open(r,!1,e):h===!0?t.close(r,!1,e):s===!1&&t.show(r,!1,e),o&&t._sizePane(r,u,!1,!1,e))}))},readState:function(t,i){var l,k;n.type(i)==="string"&&(i={keys:i}),i||(i={});var y=t.options.stateManagement,p=i.includeChildren,d=p!==undefined?p:y.includeChildren,r=i.stateKeys||y.stateKeys,w={isClosed:"initClosed",isHidden:"initHidden"},a=t.state,b=n.layout.config.allPanes,e={},v,u,f,h,o,c,s;for(n.isArray(r)&&(r=r.join(",")),r=r.replace(/__/g,".").split(","),l=0,k=r.length;l<k;l++)(v=r[l].split("."),u=v[0],f=v[1],n.inArray(u,b)<0)||(h=a[u][f],h!=undefined)&&(f=="isClosed"&&a[u].isSliding&&(h=!0),(e[u]||(e[u]={}))[w[f]?w[f]:f]=h);return d&&n.each(b,function(i,r){c=t.children[r],o=a.stateData[r],n.isPlainObject(c)&&!n.isEmptyObject(c)&&(s=e[r]||(e[r]={}),s.children||(s.children={}),n.each(c,function(t,i){i.state.initialized?s.children[t]=n.layout.state.readState(i):o&&o.children&&o.children[t]&&(s.children[t]=n.extend(!0,{},o.children[t]))}))}),e},encodeJSON:function(t){function i(t){var o=[],s=0,u,r,f,e=n.isArray(t);for(u in t)r=t[u],f=typeof r,f=="string"?r='"'+r+'"':f=="object"&&(r=i(r)),o[s++]=(e?"":'"'+u+'":')+r;return(e?"[":"{")+o.join(",")+(e?"]":"}")}return i(t)},decodeJSON:function(str){try{return n.parseJSON?n.parseJSON(str):window.eval("("+str+")")||{}}catch(e){return{}}},_create:function(t){var i=n.layout.state,f=t.options,r=f.stateManagement,u;if(n.extend(t,{readCookie:function(){return i.readCookie(t)},deleteCookie:function(){i.deleteCookie(t)},saveCookie:function(n,r){return i.saveCookie(t,n,r)},loadCookie:function(){return i.loadCookie(t)},loadState:function(n,r){i.loadState(t,n,r)},readState:function(n){return i.readState(t,n)},encodeJSON:i.encodeJSON,decodeJSON:i.decodeJSON}),t.state.stateData={},r.autoLoad)if(n.isPlainObject(r.autoLoad))n.isEmptyObject(r.autoLoad)||t.loadState(r.autoLoad);else if(r.enabled)if(n.isFunction(r.autoLoad)){u={};try{u=r.autoLoad(t,t.state,t.options,t.options.name||"")}catch(e){}u&&n.isPlainObject(u)&&!n.isEmptyObject(u)&&t.loadState(u)}else t.loadCookie()},_unload:function(t){var i=t.options.stateManagement;if(i.enabled&&i.autoSave)if(n.isFunction(i.autoSave))try{i.autoSave(t,t.state,t.options,t.options.name||"")}catch(r){}else t.saveCookie()}},n.layout.onCreate.push(n.layout.state._create),n.layout.onUnload.push(n.layout.state._unload),n.layout.plugins.buttons=!0,n.layout.defaults.autoBindCustomButtons=!1,n.layout.optionsMap.layout.push("autoBindCustomButtons"),n.layout.buttons={init:function(t){var r="ui-layout-button-",u=t.options.name||"",i;n.each("toggle,open,close,pin,toggle-slide,open-slide".split(","),function(f,e){n.each(n.layout.config.borderPanes,function(f,o){n("."+r+e+"-"+o).each(function(){i=n(this).data("layoutName")||n(this).attr("layoutName"),(i==undefined||i===u)&&t.bindButton(this,e,o)})})})},get:function(t,i,r,u){var e=n(i),f=t.options,s=f.errors.addButtonError,o;return e.length?n.inArray(r,n.layout.config.borderPanes)<0?(n.layout.msg(s+" "+f.errors.pane+": "+r,!0),e=n("")):(o=f[r].buttonClass+"-"+u,e.addClass(o+" "+o+"-"+r).data("layoutName",f.name)):n.layout.msg(s+" "+f.errors.selector+": "+i,!0),e},bind:function(t,i,r,u){var f=n.layout.buttons;switch(r.toLowerCase()){case"toggle":f.addToggle(t,i,u);break;case"open":f.addOpen(t,i,u);break;case"close":f.addClose(t,i,u);break;case"pin":f.addPin(t,i,u);break;case"toggle-slide":f.addToggle(t,i,u,!0);break;case"open-slide":f.addOpen(t,i,u,!0)}return t},addToggle:function(t,i,r,u){return n.layout.buttons.get(t,i,r,"toggle").click(function(n){t.toggle(r,!!u),n.stopPropagation()}),t},addOpen:function(t,i,r,u){return n.layout.buttons.get(t,i,r,"open").attr("title",t.options[r].tips.Open).click(function(n){t.open(r,!!u),n.stopPropagation()}),t},addClose:function(t,i,r){return n.layout.buttons.get(t,i,r,"close").attr("title",t.options[r].tips.Close).click(function(n){t.close(r),n.stopPropagation()}),t},addPin:function(t,i,r){var f=n.layout.buttons,e=f.get(t,i,r,"pin"),u;return e.length&&(u=t.state[r],e.click(function(i){f.setPinState(t,n(this),r,u.isSliding||u.isClosed),u.isSliding||u.isClosed?t.open(r):t.close(r),i.stopPropagation()}),f.setPinState(t,e,r,!u.isClosed&&!u.isSliding),u.pins.push(i)),t},setPinState:function(n,t,i,r){var e=t.attr("pin");if(!e||r!==(e=="down")){var u=n.options[i],f=u.buttonClass+"-pin",o=f+"-"+i,s=f+"-up "+o+"-up",h=f+"-down "+o+"-down";t.attr("pin",r?"down":"up").attr("title",r?u.tips.Unpin:u.tips.Pin).removeClass(r?s:h).addClass(r?h:s)}},syncPinBtns:function(t,i,r){n.each(t.state[i].pins,function(u,f){n.layout.buttons.setPinState(t,n(f),i,r)})},_load:function(t){var i=n.layout.buttons,r,u;for(n.extend(t,{bindButton:function(n,r,u){return i.bind(t,n,r,u)},addToggleBtn:function(n,r,u){return i.addToggle(t,n,r,u)},addOpenBtn:function(n,r,u){return i.addOpen(t,n,r,u)},addCloseBtn:function(n,r){return i.addClose(t,n,r)},addPinBtn:function(n,r){return i.addPin(t,n,r)}}),r=0;r<4;r++)u=n.layout.config.borderPanes[r],t.state[u].pins=[];t.options.autoBindCustomButtons&&i.init(t)},_unload:function(){}},n.layout.onLoad.push(n.layout.buttons._load),n.layout.plugins.browserZoom=!0,n.layout.defaults.browserZoomCheckInterval=1e3,n.layout.optionsMap.layout.push("browserZoomCheckInterval"),n.layout.browserZoom={_init:function(t){n.layout.browserZoom.ratio()!==!1&&n.layout.browserZoom._setTimer(t)},_setTimer:function(t){if(!t.destroyed){var i=t.options,r=t.state,u=t.hasParentLayout?5e3:Math.max(i.browserZoomCheckInterval,100);setTimeout(function(){if(!t.destroyed&&i.resizeWithWindow){var u=n.layout.browserZoom.ratio();u!==r.browserZoom&&(r.browserZoom=u,t.resizeAll()),n.layout.browserZoom._setTimer(t)}},u)}},ratio:function(){function f(n,t){return(parseInt(n,10)/parseInt(t,10)*100).toFixed()}var o=window,t=screen,r=document,h=r.documentElement||r.body,i=n.layout.browser,c=i.version,e,u,s;return i.msie&&c>8||!i.msie?!1:t.deviceXDPI&&t.systemXDPI?f(t.deviceXDPI,t.systemXDPI):i.webkit&&(e=r.body.getBoundingClientRect)?f(e.left-e.right,r.body.offsetWidth):i.webkit&&(u=o.outerWidth)?f(u,o.innerWidth):(u=t.width)&&(s=h.clientWidth)?f(u,s):!1}},n.layout.onReady.push(n.layout.browserZoom._init)}(n)}),define("RepositoryBrowser",["jquery","Class","PubSub","repository-browser-i18n-"+(window&&window.__DEPS__&&window.__DEPS__.lang||"en"),"jstree","jqgrid","jquery-layout"],function(n,t,i,r){function v(n){n.each(function(){u(this).attr("unselectable","on").css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}).each(function(){this.onselectstart=function(){return!1}})})}function y(n){switch(n){case"folder":return"folder";case"document":return"document";default:return""}}function p(){return++f}function s(n,t){n._cachedRepositoryObjects[t.uid]=t}function h(n,t){return n._cachedRepositoryObjects[t]}function c(n){return n.find("a:first").attr("data-repo-obj")}function l(t,i){var u=p(),o=!1===t.hasMoreItems||"folder"!==t.baseType?null:"closed",f=null,r,e,h;if(t.children)for(o="open",f=[],r=0;r<t.children.length;r++)e=l(t.children[r],i),f.push(e),s(i,e.resource);return h=n.extend(t,{uid:u,loaded:!1}),{state:o,resource:h,children:f,attr:{rel:t.type,"data-repo-obj":u},data:{title:t.name,icon:y(t.baseType),attr:{"data-repo-obj":u}}}}var u=n,e=[],o=0,f=(new Date).getTime(),a={repositoryManager:null,repositoryFilter:[],objectTypeFilter:[],renditionFilter:["cmis:none"],filter:["url"],element:null,isFloating:!1,verticalPadding:100,horizontalPadding:50,maxHeight:1e3,minHeight:400,minWidth:400,maxWidth:1200,treeWidth:300,listWidth:"auto",pageSize:8,adaptPageSize:!1,rowHeight:32,rootPath:"",rootFolderId:"aloha",columns:{icon:{title:"",width:30,sortable:!1,resizable:!1},name:{title:"Name",width:200,sorttype:"text"},url:{title:"URL",width:220,sorttype:"text"},preview:{title:"Preview",width:150,sorttype:"text"}},i18n:{Browsing:"Browsing",Close:"Close","in":"in","Input search text...":"Input search text...",numerous:"numerous",of:"of","Repository Browser":"Repository Browser",Search:"Search","Searching for":"Searching for",Viewing:"Viewing"}};return t.extend({_cachedRepositoryObjects:{},_searchQuery:null,_orderBy:null,_prefilledValue:null,$_grid:null,$_tree:null,$_list:null,_isOpened:!0,_constructor:function(){this.init.apply(this,arguments)},init:function(n){n=u.extend({},a,n,{i18n:r}),n.element&&0!==n.element.length||(n.isFloating=!0,n.element=this._createOverlay()),n.maxWidth<n.minWidth&&(n.maxWidth=n.minWidth),u.extend(this,n),this._prefilledValue=this._i18n("Input search text..."),this._cachedRepositoryObjects={},this._searchQuery=null,this._orderBy=null,this._pagingCount=null,this._pagingOffset=0,this._pagingBtns={first:null,end:null,next:null,prev:null},this._initializeUI(),e.push(this),i.pub("repository-browser.initialized",{data:this})},_i18n:function(n){return this.i18n[n]||n},_initializeUI:function(){this.element.attr("data-repository-browser",++f),this.element.width(this.maxWidth),this.$_grid=this._createGrid(this.element).resize(),this._setInitialHeight(),this.$_tree=this._createTree(this.$_grid.find(".ui-layout-west")),this.$_list=this._createList(this.$_grid.find(".ui-layout-center"));var n=this,t=this.treeWidth/5;this.$_grid.layout({enableCursorHotkey:!1,west__size:this.treeWidth-1,west__minSize:this.treeWidth-t,west__maxSize:this.treeWidth+t,center__size:"auto",paneClass:"ui-layout-pane",resizerClass:"ui-layout-resizer",togglerClass:"ui-layout-toggler",onresize:function(t,i){"center"===t&&n.$_list.setGridWidth(i.width())}}).sizePane("west",this.treeWidth),v(this.$_grid),this._preloadImages(),u(function(){u(window).resize(function(){n._onWindowResized()})}),this.element.mousedown(function(){u.each(e,function(n){this.element.css("z-index",99999+n)}),u(this).css("z-index",99999+e.length+1)}),u(".repository-browser-grid").css("width",this.maxWidth),this.close(),this._adaptPageSize()},_setInitialHeight:function(){var n=this.maxHeight-u(window).height()+this.verticalPadding,t=n>0?Math.max(this.minHeight,this.maxHeight-n):this.maxHeight;this.$_grid.height(t)},_onWindowResized:function(){var t=this.maxWidth-u(window).width()+this.horizontalPadding,i,n,r=t>0?Math.max(this.minWidth,this.maxWidth-t):this.maxWidth;this.element.width(r),this.$_grid.width(r),this._setInitialHeight(),i=this.$_grid.find(".repository-browser-tree-header"),this.$_tree.height(this.$_grid.height()-i.outerHeight(!0)),n=this.$_grid.find(".ui-layout-center"),n.find(".ui-jqgrid-bdiv").height(this.$_grid.height()-(n.find(".ui-jqgrid-titlebar").height()+n.find(".ui-jqgrid-hdiv").height()+n.find(".ui-jqgrid-pager").height())),this._adaptPageSize()&&this._currentFolder&&this._fetchItems(this._currentFolder)},_preloadImages:function(){for(var r=this.rootPath+"img/",n=["arrow-000-medium.png","arrow-180.png","arrow-315-medium.png","arrow-stop-180.png","arrow-stop.png","arrow.png","control-stop-square-small.png","folder-horizontal-open.png","folder-open.png","magnifier-left.png","page.png","picture.png","sort-alphabet-descending.png","sort-alphabet.png"],t=n.length,i;t;)i=document.createElement("img"),i.src=r+n[--t]},_processRepoResponse:function(n,t,i){typeof t=="function"&&(i=t,t=undefined);for(var r=this,o=[],h=r._currentFolder&&r._currentFolder.id,e=null,u,f=0;f<n.length;f++)u=l(n[f],r),o.push(u),s(r,u.resource),h===u.resource.id&&(e=u.resource);i(o,t),e&&window.setTimeout(function(){r.$_tree.jstree("select_node",'li[data-repo-obj="'+e.uid+'"]')},0)},_fetchRepoRoot:function(n){this._currentFolder||(this._currentFolder=this.getSelectedFolder()),this.repositoryManager&&this.getRepoChildren({inFolderId:this.rootFolderId,repositoryFilter:this.repositoryFilter},n)},_getObjectFromCache:function(n){if(n&&n.length){var t=n.find("a:first").attr("data-repo-obj");return this._cachedRepositoryObjects[t]}return null},_onTreeNodeSelected:function(n,t){if(!t.args[0].context){var i=this,r=h(i,c(t.rslt.obj));r&&(i._pagingOffset=0,i._currentFolder=r,i._clearSearch(),i._fetchItems(r),i.folderSelected(r))}},_createTree:function(t){var i=u('<div class="repository-browser-tree">'),f=u('<div class="repository-browser-tree-header repository-browser-grab-handle">'+this._i18n("Repository Browser")+"<\/div>"),r;return t.append(f,i),i.height(this.$_grid.height()-f.outerHeight(!0)),i.bind("loaded.jstree",function(){n(this).find(">ul>li:first").css("padding-top",5),n(this).find('li[rel="repository"]:first').each(function(n,t){i.jstree("open_node",t)})}),r=this,i.bind("select_node.jstree",function(n,t){r._onTreeNodeSelected(n,t)}),i.bind("open_node.jstree",function(n,t){r.folderOpened(t.rslt.obj)}),i.bind("close_node.jstree",function(n,t){r.folderClosed(t.rslt.obj)}),i.jstree({types:this.types,rootFolderId:this.rootFolderId,plugins:["themes","json_data","ui","types"],core:{animation:250},themes:{url:this.rootPath+"css/jstree.css",dots:!0,icons:!0,theme:"browser"},json_data:{data:function(n,t){r.repositoryManager?(r.jstree_callback=t,r._fetchSubnodes(n,t)):t()},correct_state:!0},ui:{select_limit:1}}),i},_createGrid:function(n){var t=u('<div class="repository-browser-grid\t\t\t\t             repository-browser-shadow\t\t\t\t\t\t\t repository-browser-rounded-top">\t\t\t\t\t<div class="ui-layout-west"><\/div>\t\t\t\t\t<div class="ui-layout-center"><\/div>\t\t\t\t<\/div>');return n.append(t),t},_createList:function(n){var i=u('<table id="repository-browser-list-'+ ++f+'" class="repository-browser-list"><\/table>'),o=[{name:"id",sorttype:"int",firstsortorder:"asc",hidden:!0}],s=[""],r,t,e;return u.each(this.columns,function(n,t){s.push(t.title||"&nbsp;"),o.push({name:n,width:t.width,sortable:t.sortable,sorttype:t.sorttype,resizable:t.resizable,fixed:t.fixed})}),r="repository-browser-list-page-"+ ++f,n.append(i,u('<div id="'+r+'">')),i.jqGrid({datatype:"local",width:n.width(),shrinkToFit:!0,colNames:s,colModel:o,caption:"&nbsp;",altRows:!0,altclass:"repository-browser-list-altrow",resizeclass:"repository-browser-list-resizable",pager:"#"+r,viewrecords:!0,onPaging:function(){},loadError:function(){},ondblClickRow:function(){},gridComplete:function(){},loadComplete:function(){}}),n.find(".ui-jqgrid-bdiv").height(this.$_grid.height()-(n.find(".ui-jqgrid-titlebar").height()+n.find(".ui-jqgrid-hdiv").height()+n.find(".ui-jqgrid-pager").height())),t=this,i.click(function(){t.rowClicked.apply(t,arguments)}),n.find(".ui-pg-button").unbind().find(">span.ui-icon").each(function(){var n=this.className.match(/ui\-icon\-seek\-([a-z]+)/)[1];t._pagingBtns[n]=u(this).parent().addClass("ui-state-disabled").click(function(){u(this).hasClass("ui-state-disabled")||t._doPaging(n)})}),n.find(".ui-pg-input").parent().hide(),n.find(".ui-separator").parent().css("opacity",0).first().hide(),this._createTitlebar(n),e=i[0].p,n.find(".ui-jqgrid-view tr:first th div").each(function(n){!1!==e.colModel[n].sortable&&(u(this).css("cursor","pointer"),u(this).unbind().click(function(i){i.stopPropagation(),t._sortList(e.colModel[n],this)}))}),i},_clearSearch:function(){var n=this.$_grid.find(".repository-browser-search-field");n.val(this._prefilledValue).addClass("repository-browser-search-field-empty"),this._searchQuery=null},_createTitlebar:function(n){var t=n.find(".ui-jqgrid-titlebar"),f=u('<div class="repository-browser-btns">\t\t\t\t\t<input type="text" class="repository-browser-search-field" />\t\t\t\t\t<span class="repository-browser-btn repository-browser-search-btn">\t\t\t\t\t\t<span class="repository-browser-search-icon"><\/span>\t\t\t\t\t<\/span>\t\t\t\t\t<span class="repository-browser-btn repository-browser-close-btn">'+this._i18n("Close")+'<\/span>\t\t\t\t\t<div class="repository-browser-clear"><\/div>\t\t\t\t<\/div>'),i=this,r;t.addClass("repository-browser-grab-handle").append(f),t.find(".repository-browser-search-btn").html(this._i18n("Search")).click(function(){i._triggerSearch()}),r=t.find(".repository-browser-search-field"),this._clearSearch(),r.keypress(function(n){13===n.keyCode&&i._triggerSearch()}),r.focus(function(){u(this).val()===i._prefilledValue&&u(this).val("").removeClass("repository-browser-search-field-empty")}),r.blur(function(){u(this).val()===""&&i._clearSearch()}),t.find(".repository-browser-close-btn").click(function(){i.close()}),t.find(".repository-browser-btn").mousedown(function(){u(this).addClass("repository-browser-pressed")}).mouseup(function(){u(this).removeClass("repository-browser-pressed")})},_triggerSearch:function(){var t=this.$_grid.find("input.repository-browser-search-field"),n=t.val();(u(t).hasClass("aloha-browser-search-field-empty")||""===n)&&(n=null),this._pagingOffset=0,this._searchQuery=n,this._fetchItems(this._currentFolder)},_sortList:function(n,t){this.$_grid.find("span.ui-grid-ico-sort").addClass("ui-state-disabled"),n.sortorder="asc"===n.sortorder?"desc":"asc",u(t).find("span.s-ico").show().find(".ui-icon-"+n.sortorder).removeClass("ui-state-disabled"),this._setSortOrder(n.name,n.sortorder),this._fetchItems(this._currentFolder)},_doPaging:function(n){switch(n){case"first":this._pagingOffset=0;break;case"end":this._pagingOffset=this._pagingCount%this.pageSize==0?this._pagingCount-this.pageSize:this._pagingCount-this._pagingCount%this.pageSize;break;case"next":this._pagingOffset+=this.pageSize;break;case"prev":this._pagingOffset-=this.pageSize,this._pagingOffset<0&&(this._pagingOffset=0)}this._fetchItems(this._currentFolder)},_setSortOrder:function(n,t){var u={},f=!1,i=this._orderBy||[],e,o,r;for(u[n]=t||"asc",r=0;r<i.length;++r){e=i[r];for(o in e)if(e.hasOwnProperty(o)&&o===n){i.splice(r,1),i.unshift(u),f=!0;break}if(f)break}f&&i.unshift(u),this._orderBy=i},_listItems:function(n){for(var r=this.$_list.clearGridData(),i,t=0;t<n.length;t++)i=n[t].resource,r.addRowData(i.uid,u.extend({id:i.id},this.renderRowCols(i)))},handleTimeout:function(){},_processItems:function(n,t){var r,i,f,e;this._pagingCount=t&&u.isNumeric(t.numItems)?t.numItems:null,this.$_grid.find(".loading").hide(),this.$_list.show(),this._listItems(n),r="ui-state-disabled",i=this._pagingBtns,this._pagingOffset<=0?i.first.add(i.prev).addClass(r):i.first.add(i.prev).removeClass(r),u.isNumeric(this._pagingCount)?this._pagingOffset+this.pageSize>=this._pagingCount?i.end.add(i.next).addClass(r):i.end.add(i.next).removeClass(r):(i.end.addClass(r),n.length<=this.pageSize?i.next.addClass(r):i.next.removeClass(r)),0===n.length&&0===this._pagingOffset?(f=0,e=0):(f=this._pagingOffset+1,e=f+n.length-1),this.$_grid.find(".ui-paging-info").html(this._i18n("Viewing")+" "+f+" - "+e+" "+this._i18n("of")+" "+(u.isNumeric(this._pagingCount)?this._pagingCount:this._i18n("numerous"))),t&&t.timeout&&this.handleTimeout()},_createOverlay:function(){var t,n;return 0===u(".repository-browser-modal-overlay").length&&u("body").append('<div class="repository-browser-modal-overlay" style="top: -99999px; z-index: 99999;"><\/div>'),t=this,u(".repository-browser-modal-overlay").click(function(){t.close()}),n=u('<div class="repository-browser-modal-window" style="top: -99999px; z-index: 99999;">'),u("body").append(n),n},_fetchSubnodes:function(n,t){var i,r;if(-1===n)this._fetchRepoRoot(t);else for(i=0;i<n.length;i++)r=this._getObjectFromCache(n.eq(i)),r&&this.fetchChildren(r,t)},getRepoChildren:function(n,t){if(this.repositoryManager){var i=this;this.repositoryManager.getChildren(n,function(n){i._processRepoResponse(n,t)})}},queryRepository:function(n,t){if(this.repositoryManager){var i=this;this.repositoryManager.query(n,function(n){i._processRepoResponse(n.results>0?n.items:[],{numItems:n.numItems,hasMoreItems:n.hasMoreItems,timeout:n.timeout},t)})}},renderRowCols:function(n){var t={};return u.each(this.columns,function(i){switch(i){case"icon":t.icon='<div class="repository-browser-icon repository-browser-icon-'+n.type+'"><\/div>';break;default:t[i]=n[i]||"--"}}),t},onSelect:function(){},fetchChildren:function(n,t){if((!0===n.hasMoreItems||"folder"===n.baseType)&&!1===n.loaded){var i=this;this.getRepoChildren({inFolderId:n.id,repositoryId:n.repositoryId},function(r){i._cachedRepositoryObjects[n.uid].loaded=!0,typeof t=="function"&&t(r)})}},rowClicked:function(n){var i=u(n.target).parent("tr"),r,t;if(i.length){r=i.attr("id"),t=this._cachedRepositoryObjects[r];this.onSelect(t);return t}return null},getFieldOfHeader:function(n){return n.find("div.ui-jqgrid-sortable").attr("id").replace("jqgh_","")},_fetchItems:function(n){var t,i;n&&(t=typeof this._searchQuery=="string",this.$_list.setCaption(typeof this._searchQuery=="string"?this._i18n("Searching for")+' "'+this._searchQuery+'" '+this._i18n("in")+" "+n.name:this._i18n("Browsing")+": "+n.name),this.$_list.hide(),this.$_grid.find(".loading").show(),i=this,this.queryRepository({repositoryId:n.repositoryId,inFolderId:n.id,queryString:this._searchQuery,orderBy:this._orderBy,skipCount:this._pagingOffset,maxItems:this.pageSize,objectTypeFilter:this.objectTypeFilter,renditionFilter:this.renditionFilter,filter:this.filter,recursive:t},function(n,t){i._processItems(n,t)}))},setObjectTypeFilter:function(n){this.objectTypeFilter=typeof n=="string"?[n]:n},getObjectTypeFilter:function(){return this.objectTypeFilter},show:function(){this.open()},open:function(){var n,t;this._isOpened||(this._isOpened=!0,n=this.element,this.isFloating?(u(".repository-browser-modal-overlay").stop().css({top:0,left:0}).show(),n.stop().show(),this._onWindowResized(),this.$_grid.resize(),t=u(window),n.css({left:this.horizontalPadding/2,top:this.verticalPadding/2}).draggable({handle:n.find(".repository-browser-grab-handle")}),this.$_grid.css({marginTop:0,opacity:0}).animate({marginTop:0,opacity:1},1500,"easeOutExpo",function(){u.browser.msie&&u(this).add(n).css("filter","progid:DXImageTransform.Microsoft.gradient(enabled=false)")})):(n.stop().show().css({opacity:1,filter:"progid:DXImageTransform.Microsoft.gradient(enabled=false)"}),this._onWindowResized(),this.$_grid.resize()),++o)},close:function(){this._isOpened&&(this._isOpened=!1,this.element.fadeOut(250,function(){u(this).css("top",0).hide(),(0===o||0==--o)&&u(".repository-browser-modal-overlay").hide()}))},refresh:function(){this._currentFolder&&this._fetchItems(this._currentFolder)},folderOpened:function(n){var t=this,i=h(t,c(n));i&&t.repositoryManager.folderOpened(i)},folderClosed:function(n){var t=this._getObjectFromCache(n);t&&this.repositoryManager&&this.repositoryManager.folderClosed(t)},folderSelected:function(n){this.repositoryManager&&this.repositoryManager.folderSelected(n)},getSelectedFolder:function(){if(this.repositoryManager&&typeof this.repositoryManager.getSelectedFolder=="function")return this.repositoryManager.getSelectedFolder()},_adaptPageSize:function(){var t,n,i;return!this.adaptPageSize||!this.$_list||!this.rowHeight?!1:(i=this.$_grid.find(".ui-jqgrid-bdiv"),t=i.innerHeight()-20,t?(n=Math.floor(t/this.rowHeight),n<=0&&(n=1),n!==this.pageSize?(this.pageSize=n,!0):!1):!1)}})}),define("repository-browser-i18n-de",[],function(){return{Browsing:"Durchsuchen",Close:"Schließen","in":"in","Input search text...":"Suchtext einfügen...",numerous:"zahlreiche",of:"von","Repository Browser":"Repository Browser",Search:"Suchen","Searching for":"Suche nach",Viewing:"Anzeige","button.switch-metaview.tooltip":"Zwischen Metaansicht und normaler Ansicht umschalten"}}),define("repository-browser-i18n-en",[],function(){return{Browsing:"Browsing",Close:"Close","in":"in","Input search text...":"Input search text...",numerous:"numerous",of:"of","Repository Browser":"Repository Browser",Search:"Search","Searching for":"Searching for",Viewing:"Viewing","button.switch-metaview.tooltip":"Switch between meta and normal view"}}),define("linkbrowser/nls/i18n",{root:{"button.addlink.tooltip":"Insert Link","button.removelink.tooltip":"Remove Link","newlink.defaulttext":"New Link","floatingmenu.tab.link":"Link"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("linkbrowser/linkbrowser-plugin",["aloha","jquery","aloha/plugin","aloha/pluginmanager","ui/ui","ui/button","link/link-plugin","RepositoryBrowser","i18n!linkbrowser/nls/i18n","i18n!aloha/nls/i18n"],function(n,t,i,r,u,f,e,o,s){var h=o.extend({init:function(t){this._super(t);var i=this;this._linkBrowserButton=u.adopt("linkBrowser",f,{tooltip:s.t("button.addlink.tooltip"),icon:"aloha-icon-tree",scope:"Aloha.continuoustext",click:function(){i.show()}}),this._linkBrowserButton.hide(),this.url=n.getAlohaUrl()+"/../plugins/extra/linkbrowser/",n.bind("aloha-link-selected",function(){i._linkBrowserButton.show()}),n.bind("aloha-link-unselected",function(){i._linkBrowserButton.hide()})},onSelect:function(t){e.hrefField.setItem(t);var i=n.Selection.getRangeObject(),r=i.startContainer=i.endContainer,u=i.startOffset=i.endOffset;i.select(),i.startContainer=i.endContainer=r,i.startOffset=i.endOffset=u,i.select(),n.trigger("aloha-link-selected-in-linkbrowser",t),this.close()},renderRowCols:function(n){var i={},r=this.url,u="__page__",f=n.id.match(/(\d+)\./);return t.each(this.columns,function(t){switch(t){case"icon":i.icon='<div class="aloha-browser-icon\t\t\t\t\t\taloha-browser-icon-'+u+'"><\/div>';break;case"translations":if(!n.renditions)break;for(var o=n.renditions,e=o.length,s=[],f;e>0;--e)f=o[e],f.kind=="translation"&&s.push('<img src="'+r+"img/flags/"+f.language+'.png"\t\t\t\t\t\t\t\t\t  alt="'+f.language+'"\t\t\t\t\t\t\t\t\t  title="'+f.filename+'" />');i.translations=s.join("");break;case"language":i.language=n.language;break;default:i[t]=n[t]||"--"}}),i}});return i.create("linkbrowser",{dependencies:["link"],browser:null,init:function(){var t={repositoryManager:n.RepositoryManager,repositoryFilter:[],objectTypeFilter:["website","file","image","language"],renditionFilter:["*"],filter:["language"],columns:{icon:{title:"",width:30,sortable:!1,resizable:!1},name:{title:"Name",width:320,sorttype:"text"},language:{title:"",width:30,sorttype:"text"},translations:{title:"",width:350,sorttype:"text"}},rootPath:n.settings.baseUrl+"/vendor/repository-browser/"};this.browser=new h(t)}})}),define("imagebrowser/nls/i18n",{root:{"button.addimage.tooltip":"Insert Image","button.removeimage.tooltip":"Remove Image","newimage.defaulttext":"New Image","floatingmenu.tab.img":"Image"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("imagebrowser/imagebrowser-plugin",["aloha","jquery","aloha/plugin","aloha/pluginmanager","ui/ui","ui/button","image/image-plugin","RepositoryBrowser","i18n!imagebrowser/nls/i18n","i18n!aloha/nls/i18n"],function(n,t,i,r,u,f,e,o,s){var h=o.extend({init:function(t){this._super(t);var i=this;this._imageBrowserButton=u.adopt("imageBrowser",f,{tooltip:s.t("button.addimage.tooltip"),icon:"aloha-icon-tree",scope:"Aloha.continuoustext","class":"aloha-imagebrowser-button",click:function(){i.open()}}),this._imageBrowserButton.show(!1),this.url=n.getAlohaUrl()+"/../plugins/extra/imagebrowser/",n.bind("aloha-image-selected",function(){i._imageBrowserButton.show(!0)}),n.bind("aloha-image-unselected",function(){i._imageBrowserButton.show(!1)})},onSelect:function(n){n.type.match("image")!==null&&(e.ui.imgSrcField.setItem(n),e.resetSize(),this.close())},listItems:function(n){var i=this,r=this.list.clearGridData();t.each(n,function(){var n=this.resource;n.type.match("image")!==null&&r.addRowData(n.uid,t.extend({id:n.id},i.renderRowCols(n)))})},renderRowCols:function(n){var i={},r=this.url,u=n.id.match(/(\d+)\./);return t.each(this.columns,function(t){switch(t){case"icon":if(!n.renditions)break;n.renditions.length===1&&n.renditions[0].kind==="thumbnail"&&(i.icon='<img width="'+n.renditions[0].width+'" height="'+n.renditions[0].height+' " src="'+n.renditions[0].url+'"/>');break;default:i[t]=n[t]||"--"}}),i}});return i.create("imagebrowser",{dependencies:["image"],browser:null,init:function(){var t={repositoryManager:n.RepositoryManager,repositoryFilter:[],objectTypeFilter:["image"],renditionFilter:["*"],filter:["language"],columns:{icon:{title:"",width:75,sortable:!1,resizable:!1},name:{title:"Name",width:320,sorttype:"text"}},rootPath:n.settings.baseUrl+"/vendor/repository-browser/"};this.browser=new h(t)}})}),define("ui/menuButton",["jquery","ui/component","ui/utils","jqueryui"],function(n,t,i){function u(t,r){var e=[];return n.each(r,function(r,o){var s=n("<li>"),h;s.append(n("<a>",{href:"javascript:void 0",html:i.makeButtonLabelWithIcon(o)})),o.click&&s.data("aloha-ui-menubutton-select",function(){t(),o.click()}),o.menu&&(h=n("<ul>").appendTo(s),h.append(u(f(h,t),o.menu))),e.push(s[0])}),e}function f(t,i){return i=i||n.noop,function(){t.blur().hide(),t.parent().removeClass("aloha-ui-menubutton-pressed"),i()}}function e(n,t){var i=t.item.data("aloha-ui-menubutton-select");i&&i(n,t),n.preventDefault()}var r=t.extend({init:function(){this.element=r.makeMenuButton(this)}});return r.makeMenuButton=function(t){function l(n){n.hide().parent().removeClass("aloha-ui-menubutton-pressed")}var o=n("<div>",{"class":"aloha-ui-menubutton-container"}),s=i.makeButtonElement({"class":"aloha-ui-menubutton-expand"}),r=n("<ul>",{"class":"aloha-ui-menubutton-menu"}),h=null,c=null;return(n.browser.msie&&o.addClass("aloha-ui-menubutton-iehack"),t.click?(h=i.makeButton(i.makeButtonElement({"class":"aloha-ui-menubutton-action"}),t).click(t.click),i.makeButton(s,{},!0),c=n("<div>").buttonset().append(h).append(s)):i.makeButton(s,t,!0).addClass("aloha-ui-menubutton-single"),!t.menu)?o.append(h):(s.click(function(){if(o.addClass("aloha-ui-menubutton-pressed"),t.siblingContainer&&t.siblingContainer.find(".aloha-ui-menubutton-menu").each(function(){this!==r[0]&&l(n(this))}),r.is(":visible")){l(r);return}return r.show().position({my:"left top",at:"left bottom",of:h||s}),n(document).bind("click",function(t){n(this).unbind(t),r.hide(),o.removeClass("aloha-ui-menubutton-pressed")}),!1}),o.append(c||s).append(r),r.append(u(f(r),t.menu)),r.hide().menu({select:e}),o)},r}),define("ribbon/ribbon-plugin",["jquery","aloha/plugin","ui/menuButton","ui/utils","jqueryui"],function(n,t,i,r){return t.create("ribbon",{init:function(){var t;if(this.settings.enable||typeof this.settings.enable=="undefined"){t=this,this._visible=!1,this._toolbar=n("<div>",{"class":"aloha-ribbon-toolbar ui-menubar ui-widget-header ui-helper-clearfix"});var i=r.makeButtonElement({"class":"aloha-ribbon-in"}).button().hide().click(function(){t._toolbar.animate({left:0}),n("body").animate({paddingTop:30}),i.hide()}).appendTo(this._toolbar),f=r.makeButtonElement({"class":"aloha-ribbon-out"}).button().click(function(){t._toolbar.animate({left:-t._toolbar.outerWidth()+i.outerWidth()+10}),n("body").animate({paddingTop:0}),i.show()}).appendTo(this._toolbar),u=n("<div>",{"class":"aloha aloha-ribbon"}).appendTo("body");this._icon=n("<div>").prependTo(this._toolbar),this.setIcon(""),this._toolbar.appendTo(u),n("body").css({position:"relative",paddingTop:30})}},setIcon:function(n){this._icon&&this._icon.attr("class","aloha-ribbon-icon "+n)},addButton:function(t){this._toolbar&&(t=n.extend({},t,{siblingContainer:this._toolbar}),this._toolbar.append(i.makeMenuButton(t)))},hide:function(){this._toolbar&&(this._toolbar.hide(),this._visible=!1)},show:function(){this._toolbar&&(this._toolbar.show(),this._visible=!0)},isVisible:function(){return this._visible}})}),define("wai-lang/nls/i18n",{root:{"floatingmenu.tab.wai-lang":"Language annotation","button.add-wai-lang-remove.tooltip":"Remove language annotation","button.add-wai-lang.tooltip":"Add language annotation"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("wai-lang/languages",["aloha","jquery","flag-icons/flag-icons-plugin","aloha/console","wai-lang/wai-lang-plugin"],function(n,t,i,r){var u=t.Deferred();return new(n.AbstractRepository.extend({languageCodes:[],locale:"de",iso:"iso639-1",flags:!1,_constructor:function(){this._super("wai-languages")},init:function(){var i=this,t=n.require("wai-lang/wai-lang-plugin"),r=n.settings.locale,f=t.iso639;r!=="de"&&(this.locale="en"),f!=="iso639-1"&&(this.iso="iso639-2"),this.flags=t.flags,this.repositoryName="WaiLanguages",n.require(["wai-lang/"+this.iso+"-"+this.locale],function(n){i.storeLanguageCodes(n),u.resolve()})},markObject:function(){},errorHandler:function(n){r.log("error",this,"Error while loading languages. "+n)},storeLanguageCodes:function(r){var u=this,f=n.getPluginUrl("wai-lang");t.each(r,function(t,r){var e=r;e.id=t,e.repositoryId=u.repositoryId,e.type="language",u.flags&&(e.url=e.flag?i.path+"/img/flags/"+e.flag+".png":f+"/img/button.png"),u.languageCodes.push(new n.RepositoryDocument(e))})},_searchInLanguageCodes:function(n,i){for(var s=new RegExp("^"+n.queryString,"i"),f=[],e,o,u,r=0;r<this.languageCodes.length;++r)u=this.languageCodes[r],e=!n.queryString||u.name.match(s),o=!n.objectTypeFilter||!n.objectTypeFilter.length||t.inArray(u.type,n.objectTypeFilter)>-1,e&&o&&f.push(u);i.call(this,f)},query:function(n,t){var i=this;u.done(function(){i._searchInLanguageCodes(n,t)})},getObjectById:function(n,t){for(var r,i=0;i<this.languageCodes.length;++i)if(r=this.languageCodes[i],r.id===n){t.call(this,[r]);break}}}))}),define("wai-lang/wai-lang-plugin",["aloha","jquery","aloha/plugin","ui/ui","ui/scopes","ui/button","ui/toggleButton","ui/port-helper-attribute-field","i18n!wai-lang/nls/i18n","i18n!aloha/nls/i18n","wai-lang/languages"],function(n,t,i,r,u,f,e,o,s){var c="aloha-wai-lang",l=window.GENTICS,h;return i.create("wai-lang",{config:["span"],iso639:"iso639-1",flags:!1,objectTypeFilter:["language"],hotKey:{insertAnnotation:s.t("insertAnnotation","ctrl+shift+l")},init:function(){this.settings.objectTypeFilter&&(this.objectTypeFilter=this.settings.objectTypeFilter),this.settings.hotKey&&t.extend(!0,this.hotKey,this.settings.hotKey),this.flags=this.settings.flags==="true"||this.settings.flags===!0||this.settings.flags==="1"||this.settings.flags===1?!0:!1,this.settings.iso639&&(this.iso639=this.settings.iso639),this.createButtons(),this.subscribeEvents(),this.bindInteractions()},subscribeEvents:function(){var i=this;n.bind("aloha-editable-activated",function(){var r;if(r=i.getEditableConfig(n.activeEditable.obj),t.inArray("span",r)!==-1)i._wailangButton.show();else{i._wailangButton.hide();return}}),n.bind("aloha-selection-changed",function(n,t){var r=i._foundLangMarkupAtSelection=i.findLangMarkup(t);r?(i._wailangButton.setState(!0),u.setScope("wai-lang"),h.setTargetObject(r,"lang")):(i._wailangButton.setState(!1),i._foundLangMarkupAtSelection=!1,h.setTargetObject(null))})},createButtons:function(){var n=this;this._wailangButton=r.adopt("wailang",e,{tooltip:s.t("button.add-wai-lang.tooltip"),icon:"aloha-icon aloha-icon-wai-lang",scope:"Aloha.continuoustext",click:function(){n.addRemoveMarkupToSelection()}}),u.createScope("wai-lang","Aloha.continuoustext"),h=o({name:"wailangfield",width:320,valueField:"id",minChars:1,scope:"wai-lang"}),this.flags?h.setTemplate('<div class="aloha-wai-lang-img-item"><img class="aloha-wai-lang-img" src="{url}" /><div class="aloha-wai-lang-label-item">{name} ({id})<\/div><\/div>'):h.setTemplate('<div class="aloha-wai-lang-img-item"><div class="aloha-wai-lang-label-item">{name} ({id})<\/div><\/div>'),h.setObjectTypeFilter(this.objectTypeFilter),this._removewailangButton=r.adopt("removewailang",f,{tooltip:s.t("button.add-wai-lang-remove.tooltip"),icon:"aloha-icon aloha-icon-wai-lang-remove",scope:"wai-lang",click:function(){n.removeLangMarkup()}})},findLangMarkup:function(i){return(i=i||n.Selection.getRangeObject(),n.activeEditable)?i.findMarkup(function(){return t(this).hasClass(c)||t(this).is("[lang]")},n.activeEditable.obj):null},findLanguageMarkup:function(t){return(t=t||n.Selection.getRangeObject(),n.activeEditable)?t.findMarkup(function(){return this.nodeName==="SPAN"},n.activeEditable.obj):null},removeLangMarkup:function(){var t=n.Selection.getRangeObject(),i=this.findLangMarkup(t);i&&(l.Utils.Dom.removeFromDOM(i,t,!0),t.select(),u.setScope("Aloha.continuoustext"),h.setTargetObject(null))},bindInteractions:function(){function i(n){n.obj.bind("keydown",t.hotKey.insertAnnotation,function(){t.insertLanguageAnnotation()}),n.obj.find("span[lang]").each(function(){t.makeVisible(this)})}var t=this;h.addListener("blur",function(){this.getValue()||t.removeMarkup()}),n.bind("aloha-editable-created",function(n,t){i(t)})},insertLanguageAnnotation:function(){if(typeof this.findLangMarkup=="function")return this.findLangMarkup()?(h.foreground(),h.focus()):this.addMarkupToSelection(),!1},makeVisible:function(n){var i=t(n);i.addClass(c),i.attr("data-gentics-aloha-repository","wai-languages"),i.attr("data-gentics-aloha-object-id",i.attr("lang"))},formatLanguageSpan:function(){if(n.activeEditable){var t=n.Selection.getRangeObject();this.findLanguageMarkup(t)?this.removeMarkup():this.insertMarkup()}},addRemoveMarkupToSelection:function(){this._foundLangMarkupAtSelection?this.removeLangMarkup():this.addMarkupToSelection(!1)},addMarkupToSelection:function(){var i=n.Selection.getRangeObject();this.findLangMarkup(i)||(h.foreground(),u.setScope("wai-lang"),i.isCollapsed()&&l.Utils.Dom.extendToWord(i),i.isCollapsed()||l.Utils.Dom.addMarkup(i,t('<span class="'+c+'"><\/span>'),!1),i.select(),h.focus())},removeMarkup:function(){var i=this.findLangMarkup(),t;i&&(t=n.Selection.getRangeObject(),l.Utils.Dom.removeFromDOM(i,t,!0),t.select())},makeClean:function(n){n.find("span[lang]").each(function(){t(this).removeClass(c),t(this).removeAttr("data-gentics-aloha-repository"),t(this).removeAttr("data-gentics-aloha-object-id"),t(this).attr("xml:lang",t(this).attr("lang"))})}})}),define("headerids/nls/i18n",{root:{"headerids.label.target":"Target","headerids.button.reset":"Reset","headerids.button.set":"Set",internal_hyperlink:"Internal Hyperlink"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("headerids/headerids-plugin",["jquery","aloha/plugin","i18n!headerids/nls/i18n","i18n!aloha/nls/i18n"],function(n,t,i){function u(){var t=[],i=o;return e.each(arguments,function(){t.push("."+(this==""?i:i+"-"+this))}),n.trim(t.join(" "))}function r(){var t=[],i=o;return e.each(arguments,function(){t.push(this==""?i:i+"-"+this)}),n.trim(t.join(" "))}var e=n,s=window.GENTICS,f=window.Aloha,o="aloha-headerids";return t.create("headerids",{_constructor:function(){this._super("headerids")},config:["true"],init:function(){var n=this;f.bind("aloha-editable-activated",function(t,i){n.check(i.editable.obj)}),f.bind("aloha-editable-deactivated",function(t,i){n.check(i.editable.obj)}),f.bind("aloha-plugins-loaded",function(){n.initSidebar(f.Sidebar.right)})},check:function(t){var i=this,r=i.getEditableConfig(t);if(n.inArray("true",r)===-1)return!1;n(t).find("h1, h2, h3, h4, h5, h6").not(".aloha-customized").each(function(){i.processH(this)})},processH:function(t){var i=this;n(t).attr("id",i.sanitize(n(t).text()))},sanitize:function(n){return n.replace(/[^a-z0-9]+/gi,"_")},initSidebar:function(t){var f=this;f.sidebar=t,t.addPanel({id:r("sidebar-panel"),title:i.t("internal_hyperlink"),content:"",expanded:!0,activeOn:"h1, h2, h3, h4, h5, h6",onInit:function(){var t=this,e=this.setContent('<label class="'+r("label")+'" for="'+r("input")+'">'+i.t("headerids.label.target")+'<\/label><input id="'+r("input")+'" class="'+r("input")+'" type="text" name="value"/> <button class="'+r("reset-button")+'">'+i.t("headerids.button.reset")+'<\/button><button class="'+r("set-button")+'">'+i.t("headerids.button.set")+"<\/button>").content;e.find(u("set-button")).click(function(){var i=t.content;n(t.effective).attr("id",n(u("input")).val()),n(t.effective).addClass("aloha-customized")}),e.find(u("reset-button")).click(function(){var i=t.content;f.processH(t.effective),n(t.effective).removeClass("aloha-customized"),t.content.find(u("input")).val(t.effective.attr("id"))})},onActivate:function(n){var t=this;t.effective=n,t.content.find(u("input")).val(n.attr("id"))}}),t.show()},makeClean:function(n){this.check(n)}})}),define("metaview/nls/i18n",{root:{"button.switch-metaview.tooltip":"Switch between meta and normal view"},ca:!0,de:!0,mk:!0,"pt-br":!0,ru:!0,uk:!0,"zh-hans":!0}),define("metaview/metaview-plugin",["aloha/plugin","ui/ui","ui/toggleButton","i18n!metaview/nls/i18n","i18n!aloha/nls/i18n","jquery"],function(n,t,i,r,u,f){var o=window.GENTICS,e=window.Aloha;return n.create("metaview",{_constructor:function(){this._super("metaview")},config:["metaview"],init:function(){var n=this;this.createButtons(),e.bind("aloha-editable-activated",function(){var t;if(t=n.getEditableConfig(e.activeEditable.obj),f.type(t)==="array"&&f.inArray("enabled",t)!==-1&&f(e.activeEditable.obj).addClass("aloha-metaview"),f.type(t)==="array"&&f.inArray("metaview",t)!==-1)n._toggleMetaViewButton.show(!0);else{n._toggleMetaViewButton.show(!1);return}f(e.activeEditable.obj).hasClass("aloha-metaview")?n._toggleMetaViewButton.setState(!0):n._toggleMetaViewButton.setState(!1)}),e.bind("aloha-editable-deactivated",function(){var t;t=n.getEditableConfig(e.activeEditable.obj),f(e.activeEditable.obj).removeClass("aloha-metaview"),f(e.activeEditable.obj).hasClass("aloha-metaview")?n._toggleMetaViewButton.setState(!0):n._toggleMetaViewButton.setState(!1)})},buttonClick:function(){f(e.activeEditable.obj).hasClass("aloha-metaview")?(f(e.activeEditable.obj).removeClass("aloha-metaview"),this._toggleMetaViewButton.setState(!1)):(f(e.activeEditable.obj).addClass("aloha-metaview"),this._toggleMetaViewButton.setState(!0))},createButtons:function(){var n=this;this._toggleMetaViewButton=t.adopt("toggleMetaView",i,{tooltip:r.t("button.switch-metaview.tooltip"),icon:"aloha-icon aloha-icon-metaview",scope:"Aloha.continuoustext",click:function(){n.buttonClick()}})}})}),define("listenforcer/listenforcer-plugin",["aloha","jquery","aloha/plugin","aloha/console"],function(n,t,i,r){function u(n,i){var e,r,o,u,s;if(t.inArray(n[0],f)!==-1){if(n.find(".aloha-end-br").remove(),e=!1,n.find("li").each(function(){if(t.trim(t(this).text())!=="")return e=!0,!1}),e||n.html(i),r=n.find(">ul,>ol"),o=r.length,o>1)for(s=t(r[0]),u=1;u<o;++u)s.append(t(r[u]).find(">li")),t(r[u]).remove();n.find(">*:not(ul,ol)").remove()}}var f=[];return i.create("listenforcer",{_constructor:function(){this._super("listenforcer")},init:function(){for(var o=this,e=this.settings.editables||[],i,s=e.length,f=0;f<s;f++)i=e[f],typeof i=="string"||i.nodeName||i instanceof t?t(i).each(function(){o.addEditableToEnforcementList(this)}):r.warn("Aloha List Enforcer Plugin",'Object "'+i.toString()+'" can not be used as a jQuery selector with which to register an editable to be list enforced.');n.bind("aloha-editable-activated",function(n,t){u(t.editable.obj,"<ul><li><br /><\/li><\/ul>")}),n.bind("aloha-editable-deactivated",function(n,t){u(t.editable.obj,"")}),n.bind("aloha-smart-content-changed",function(t,i){n.activeEditable&&n.activeEditable.isActive===!0&&u(i.editable.obj,"<ul><li><br /><\/li><\/ul>")})},addEditableToEnforcementList:function(n){n&&f.push(n)}})}),Aloha._load&&Aloha._load()})();

if("undefined"==typeof Ektron){Ektron={};}if("undefined"==typeof Ektron.JSON){Ektron.JSON={};}var JSON;if(!JSON){JSON={};}(function(){function f(n){return n<10?"0"+n:n;}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);}if(typeof rep==="function"){value=rep.call(holder,key,value);}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null";}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null";}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v;}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v;}}if(typeof Ektron.JSON.stringify!=="function"){Ektron.JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" ";}}else{if(typeof space==="string"){indent=space;}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify");}return str("",{"":value});};}if(typeof Ektron.JSON.parse!=="function"){Ektron.JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){if(!(text.length>0)){return text;}j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j;}throw new SyntaxError("JSON.parse");};}}());
(function(){Ektron.Xml=function Xml(settings){settings=settings||{};var me=this;var m_srcPath=settings.srcPath||"";var m_ajaxPath=settings.ajaxPath||settings.srcPath||"";this.onexception=settings.onexception;this.loadXml=Xml_loadXml;this.loadXslt=Xml_loadXslt;this.xslTransform=Xml_xslTransform;this.validateXml=Xml_validateXml;this.validateXsd=Xml_validateXsd;this.ajaxTransform=Xml_ajaxTransform;this.ajaxValidation=Xml_ajaxValidation;this.resolveSrcPath=Xml_resolveSrcPath;this.fixXml=Xml_fixXml;this.indentXml=Xml_indentXml;function Xml_loadXml(xml,onexception){try{if(typeof xml!="string"){return null;}if(xml.length<=2){return null;}var bIsUrl=isUrl(xml);if(bIsUrl&&s_cacheXml[xml]){return s_cacheXml[xml];}var xmlDoc=Sarissa.getDomDocument();if("string"==typeof xmlDoc||null==xmlDoc){throw new ReferenceError("Unable to create XML DOM Document");}xmlDoc.async=false;var strErrMsg="";if(bIsUrl){var url=this.resolveSrcPath(xml);if(typeof xmlDoc.load!="undefined"){xmlDoc.load(url);}else{var xmlHttp=getXmlHttp();xmlHttp.open("GET",url,false);xmlHttp.send(null);xmlDoc=Ektron.Xml.parseXml(xmlHttp.responseText,Ektron.OnException.returnException);}}else{var fixed={};var bDone=false;while(!bDone){bDone=true;xmlDoc=Ektron.Xml.parseXml(xml,Ektron.OnException.returnException);if("string"==typeof xmlDoc){strErrMsg=xmlDoc;if($ektron.browser.msie){if(fixed.illegalChars!=true&&(strErrMsg.indexOf("invalid character")>=0||strErrMsg.indexOf("tags were not closed")>=0)){xml=m_fixIllegalCharacters(xml);fixed.illegalChars=true;bDone=false;}else{if(fixed.namespacePrefix!=true&&strErrMsg.indexOf("undeclared namespace prefix")>=0){xml=m_fixUndeclaredNamespacePrefixes(xml);fixed.namespacePrefix=true;bDone=false;}else{if(fixed.comments!=true&&strErrMsg.indexOf("Incorrect syntax was used in a comment")>=0){xml=m_fixComments(xml);fixed.comments=true;bDone=false;}else{if(fixed.entityNames!=true&&(strErrMsg.indexOf("semi colon")>=0||strErrMsg.indexOf("name was started with an invalid character")>=0||strErrMsg.indexOf("undefined entity")>=0)){xml=m_fixUnknownEntityNames(xml);fixed.entityNames=true;bDone=false;}}}}}else{if($ektron.browser.mozilla){if(fixed.wellFormed!=true&&(strErrMsg.indexOf("not well-formed")>=0||strErrMsg.indexOf("no element found")>=0||strErrMsg.indexOf("undefined entity")>=0)){xml=m_fixIllegalCharacters(xml);xml=m_fixComments(xml);xml=m_fixUnknownEntityNames(xml);fixed.wellFormed=true;bDone=false;}else{if(fixed.namespacePrefix!=true&&strErrMsg.indexOf("prefix not bound to a namespace")>=0){xml=m_fixUndeclaredNamespacePrefixes(xml);fixed.namespacePrefix=true;bDone=false;}}}else{if($ektron.browser.safari){if(fixed.illegalChars!=true&&(strErrMsg.indexOf("PCDATA invalid")>=0||strErrMsg.indexOf("internal error")>=0||strErrMsg.indexOf("out of allowed range")>=0)){xml=m_fixIllegalCharacters(xml);fixed.illegalChars=true;bDone=false;}else{if(fixed.namespacePrefix!=true&&strErrMsg.indexOf("Namespace prefix")>=0){xml=m_fixUndeclaredNamespacePrefixes(xml);fixed.namespacePrefix=true;bDone=false;}else{if(fixed.comments!=true&&(strErrMsg.indexOf("double-hyphen")>=0||strErrMsg.indexOf("Comment not terminated")>=0)){xml=m_fixComments(xml);fixed.comments=true;bDone=false;}else{if(fixed.entityNames!=true&&(strErrMsg.indexOf("EntityRef")>=0||(strErrMsg.indexOf("Entity")>=0&&strErrMsg.indexOf("not defined")>=0))){xml=m_fixUnknownEntityNames(xml);fixed.entityNames=true;bDone=false;}}}}}else{if($ektron.browser.opera){if(fixed.allKnown!=true){xml=this.fixXml(xml);fixed.allKnown=true;bDone=false;}}}}}if(bDone){if(fixed.missingRoot!=true){xml="<root>"+xml+"</root>";fixed.missingRoot=true;bDone=false;}}}}}var strErrMsg=(("string"==typeof xmlDoc)?xmlDoc:Sarissa.getParseErrorText(xmlDoc));if(strErrMsg!=Sarissa.PARSED_OK){throw new Error(strErrMsg+"\n\nXML:\n"+xml);}if(bIsUrl){s_cacheXml[xml]=xmlDoc;}return xmlDoc;}catch(ex){return Ektron.OnException(this,onexception,ex,arguments);}}function Xml_loadXslt(xslt,onexception){try{if(typeof xslt!="string"){return null;}if(xslt.length<=2){return null;}var bIsUrl=isUrl(xslt);if(bIsUrl&&s_cacheXslt[xslt]){return s_cacheXslt[xslt];}var xslDoc=Sarissa.getXsltDocument();if("string"==typeof xslDoc||null==xslDoc){throw new ReferenceError("Unable to create XSLT DOM Document");}xslDoc.async=false;if(bIsUrl){var url=this.resolveSrcPath(xslt);if(typeof xslDoc.load!="undefined"){xslDoc.load(url);}else{var xmlHttp=getXmlHttp();xmlHttp.open("GET",url,false);xmlHttp.send(null);xslDoc=Ektron.Xml.parseXml(xmlHttp.responseText,Ektron.OnException.throwException);}}else{if(xsltMustBeUrl(xslt)){throw new RangeError("XSLT string documents cannot contain document(''), xsl:include, or xsl:import");}if(typeof xslDoc.loadXML!="undefined"){xslDoc.loadXML(xslt);}else{xslDoc=Ektron.Xml.parseXml(xslt,Ektron.OnException.throwException);}}var strErrMsg=(("string"==typeof xslDoc)?xslDoc:Sarissa.getParseErrorText(xslDoc));if(strErrMsg!=Sarissa.PARSED_OK){throw new Error(strErrMsg);}if(bIsUrl){s_cacheXslt[xslt]=xslDoc;}return xslDoc;}catch(ex){return Ektron.OnException(this,onexception,ex,arguments);}}function Xml_xslTransform(xml,xslt,args,onexception){try{if("undefined"==typeof XSLTProcessor){return this.ajaxTransform(xml,xslt,args);}var bIsUrl=isUrl(xslt);if(!bIsUrl&&xml.indexOf("<root")!=0&&xslt.indexOf('ektdesignns_role="root"')>-1&&xslt.indexOf("<xsl:stylesheet")==0){bIsUrl=true;}if(m_ajaxPath&&bIsUrl){return this.ajaxTransform(xml,xslt,args);}else{if(!bIsUrl&&(xsltMustBeUrl(xslt)||xsltUsesExtObj(xslt))){return this.ajaxTransform(xml,xslt,args);}else{xml=$ektron.trim(xml);var bRootTagAdded=false;xml=xml.replace(/\xAB/g,"&amp;#171;").replace(/\xBB/g,"&amp;#187;");var xmlDoc=this.loadXml(xml);if("string"==typeof xmlDoc){return xmlDoc;}if(null==xmlDoc){throw new Error("Unable to load XML document");}var processor=null;if(bIsUrl&&s_cacheXslProc[xslt]){processor=s_cacheXslProc[xslt];processor.clearParameters();}else{var xsltDoc=this.loadXslt(xslt);if("string"==typeof xsltDoc){return xsltDoc;}if(null==xsltDoc){throw new Error("Unable to load XSLT document");}processor=new XSLTProcessor();processor.importStylesheet(xsltDoc);if(bIsUrl){s_cacheXslProc[xslt]=processor;}}processor.setParameter("","currentDate",Ektron.Xml.serializeDate(new Date()));if(args){for(var i=0;i<args.length;i++){processor.setParameter("",args[i].name,args[i].value);}}var newDoc=null;try{if("html"==processor.outputMethod){newDoc=processor.transformToFragment(xmlDoc,window.document);if("string"==typeof newDoc){return newDoc;}if(null==newDoc.firstChild){return"";}var container=window.document.createElement("div");container.appendChild(newDoc.firstChild);result=container.innerHTML;}else{var ownerDoc=Sarissa.getDomDocument();newDoc=processor.transformToFragment(xmlDoc,ownerDoc);if("string"==typeof newDoc){return newDoc;}result=Ektron.Xml.serializeXml(newDoc);}}catch(ex){return this.ajaxTransform(xml,xslt,args);}if(bRootTagAdded){result=result.replace(/^<root>/i,"").replace(/<\/root>$/i,"");}result=result.replace(/&amp;#171;/g,"&#171;").replace(/&amp;#187;/g,"&#187;");if($ektron.browser.opera){result=result.replace(/^<result>/,"").replace(/<\/result>$/,"");}result=result.replace(/<transformiix:result[^>]*>/,"").replace("</transformiix:result>","");result=result.replace(/xslout:/g,"xsl:");result=result.replace(/<\?[^\?]*\?>/,"");result=result.replace(/xpathLiteralString(.*?)gnirtSlaretiLhtapx/g,function(s,p1){if(p1.indexOf("'")>=0){return"concat('"+p1.replace(/\'/g,"',&quot;'&quot;,'")+"')";}else{return"'"+p1+"'";}});return result;}}}catch(ex){return Ektron.OnException(this,onexception,ex,arguments);}}Xml_xslTransform.onexception=function(ex,args){if(document.cookie&&document.cookie.indexOf("Xml_xslTransform.onexception=true")>-1){var msg=Ektron.OnException.exceptionMessage(ex);msg=msg.replace(/\&lt;br ?\/?\&gt;/gi,"\n");if($ektron.htmlDecode){msg=$ektron.htmlDecode(msg);}msg="XSLT Transformation Error\n"+msg+"\n";if(args&&args.length>0){msg+="XML:\n"+args[0]+"\n";}if(args&&args.length>1){msg+="XSLT:\n"+args[1]+"\n";}alert(msg);}if(args&&args.length>0){return args[0];}};function Xml_validateXml(xml,xsd,nsuri,onexception){try{if(isUrl(xml)){xml=this.resolveSrcPath(xml);}var schemas=new Array();var namespaces=new Array();if("string"==typeof xsd&&"string"==typeof nsuri){if(isUrl(xsd)){schemas[0]=this.resolveSrcPath(xsd);}else{schemas[0]=xsd;}namespaces[0]=nsuri;}else{if("object"==typeof xsd&&"object"==typeof nsuri&&xsd&&nsuri&&xsd.length==nsuri.length){for(var i=0;i<xsd.length;i++){if(isUrl(xsd[i])){schemas[i]=this.resolveSrcPath(xsd[i]);}else{schemas[i]=xsd[i];}namespaces[i]=nsuri[i];}}else{throw new TypeError("'xsd' and 'nsuri' must be strings (for single schema) or array (for multiple schemas)");}}return this.ajaxValidation(xml,schemas,namespaces);}catch(ex){return Ektron.OnException(this,onexception,ex,arguments);}}function Xml_validateXsd(xsd,onexception){try{if(isUrl(xsd)){xsd=this.resolveSrcPath(xsd);}return this.ajaxValidation("",[xsd],["http://www.w3.org/2001/XMLSchema"]);}catch(ex){return Ektron.OnException(this,onexception,ex,arguments);}}function Xml_ajaxTransform(xml,xslt,args,onexception){try{if(isUrl(xml)){xml=this.resolveSrcPath(xml);}if(isUrl(xslt)){xslt=this.resolveSrcPath(xslt);}var strArgs="";if(args){for(var i=0;i<args.length;i++){strArgs+="&arg"+i+"="+encodeURIComponent(args[i].name+"="+args[i].value);}}var url=m_ajaxPath+"ekajaxtransform.aspx";var sessionid=$ektron(".ektronsessionidfield").val();var xid=$ektron("[name=xid]").val();if(!(xid>0)){xid=$ektron("[name=xml_collection_id]").val();}var xmlHttp=getXmlHttp();xmlHttp.open("POST",url,false);xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xmlHttp.send("xml="+encodeURIComponent(xml)+"&sessionid="+sessionid+"&xid="+xid+"&xslt="+encodeURIComponent(xslt)+strArgs);var output=$ektron.trim(xmlHttp.responseText);if(output.indexOf("XmlExceptionMessage")>-1||output.indexOf("ekAjaxTransformError")>-1){var matchResult=output.match(/<body[^>]*>([\w\W]*?)<\/body>/);if(matchResult&&matchResult.length>=2){throw new Error(matchResult[1]);}else{return output;}}return output;}catch(ex){return Ektron.OnException(this,onexception,ex,arguments);}}Xml_ajaxTransform.onexception=Ektron.OnException.throwException;function Xml_ajaxValidation(xml,schemas,namespaces,onexception){try{var strSchemas="";for(var i=0;i<schemas.length;i++){strSchemas+="&xsd"+i+"="+encodeURIComponent(schemas[i])+"&nsuri"+i+"="+encodeURIComponent(namespaces[i]);}var url=m_ajaxPath+"ekajaxvalidation.aspx";var xmlHttp=getXmlHttp();xmlHttp.open("POST",url,false);xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xmlHttp.send("xml="+encodeURIComponent(xml)+strSchemas);var response=$ektron.trim(xmlHttp.responseText);var ary=response.match(/<body><div>([\w\W\r\n]*)<\/div><\/body>/);msg=(ary&&ary.length>=2?ary[1]:"");if(0==msg.length){return null;}else{return(msg.split("\n\n\n"));}}catch(ex){return Ektron.OnException(this,onexception,ex,arguments);}}Xml_ajaxValidation.onexception=Ektron.OnException.throwException;function Xml_resolveSrcPath(url){url=url.replace(/.*(\[|%5B)srcpath(\]|%5D)\/?/i,m_srcPath);url=url.replace(/.*(\[|%5B)eWebEditProPath(\]|%5D)\/?/i,m_srcPath);return url;}function Xml_fixXml(xml,onexception){try{xml=m_fixIllegalCharacters(xml);xml=m_fixUndeclaredNamespacePrefixes(xml);xml=m_fixComments(xml);xml=m_fixUnknownEntityNames(xml);}catch(ex){return Ektron.OnException(this,onexception,ex,arguments);}return xml;}function Xml_indentXml(xml,onexception){try{var strIndent="";xml=xml.replace(/(<\!\-\-[\w\W]*?\-\->)|(<\!\[CDATA\[[\w\W]*?\]\]>)|(<\/[^>]+>)|(<[^>]+\/>)|(<[^>]+><\/[^>]+>)|(<[^>]+>)|([^<]+)/g,function($0_match,$1_comment,$2_cdata,$3_closingTag,$4_emptyShortNotation,$5_emptyLongNotation,$6_openingTag,$7_textNode){if($1_comment||$2_cdata){return $0_match+"\n";}else{if($3_closingTag){if(strIndent.length>0){strIndent=strIndent.substring(0,strIndent.length-2);}return strIndent+$0_match+"\n";}else{if($7_textNode){var retLine=$ektron.trim($7_textNode);if(retLine.length>0){retLine=strIndent+retLine+"\n";}return retLine;}else{var retLine=strIndent+$0_match+"\n";if($6_openingTag){strIndent+="  ";}return retLine;}}}});}catch(ex){return Ektron.OnException(this,onexception,ex,arguments);}return xml;}Ektron.RegExp.illegalXmlCharacters=/[^\x09\x0A\x0D\x20-\uD7FF\uE000-\uFFFD]/g;function m_fixIllegalCharacters(xml){return xml.replace(Ektron.RegExp.illegalXmlCharacters,"");}Ektron.Xml.namespaces={asp:"http://schemas.microsoft.com/ASPNET/20",cms:"urn:Ektron.Cms.Controls",admin:"http://webns.net/mvcb/",atom:"http://www.w3.org/2005/Atom",content:"http://purl.org/rss/1.0/modules/content/",dc:"http://purl.org/dc/elements/1.1/",foaf:"http://xmlns.com/foaf/0.1/",opml:"http://www.opml.org/spec2",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",msxsl:"urn:schemas-microsoft-com:xslt",math:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",its:"http://www.w3.org/2005/11/its",htm:"http://www.w3.org/1999/xhtml",html:"http://www.w3.org/1999/xhtml",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xforms:"http://www.w3.org/2002/xforms",xs:"http://www.w3.org/2001/XMLSchema",xsd:"http://www.w3.org/2001/XMLSchema",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsl:"http://www.w3.org/1999/XSL/Transform"};function m_fixUndeclaredNamespacePrefixes(xml){var strNamespaces="";var prefixes={};function savePrefix($0_match,$1_prefix){try{prefixes[$1_prefix]=true;}catch(ex){}return $0_match;}xml.replace(/<(\w+):\w+/g,savePrefix);xml.replace(/\s(\w+):\w+=(?=[^<>]*>)/g,savePrefix);for(var p in prefixes){if(p!="xml"&&p!="xmlns"){var re=new RegExp("xmlns:"+p+"=");if(!re.test(xml)){var ns=Ektron.Xml.namespaces[p]||("urn:unknown:"+p);strNamespaces+=" xmlns:"+p+'="'+ns+'"';}}}if(strNamespaces.length>0){xml="<root"+strNamespaces+">"+xml+"</root>";}return xml;}function m_fixComments(xml){xml=xml.replace(/<\!--[\-]+/,"<!\x2D\x2D");xml=xml.replace(/--[\-]+>/,"\x2D\x2D>");xml=xml.replace(/(<\!--)([\w\W]*?)(-->)/g,function($0_match,$1_open,$2_data,$3_close){return $1_open+$2_data.replace(/-{2,}/g,function($0_match){return $0_match.replace(/-/g,"=");})+$3_close;});return xml;}function m_fixUnknownEntityNames(xml){function protectAmp($0_match,$1_open,$2_data,$3_close){return $1_open+$2_data.replace(/&/g,"ektTempAmp")+$3_close;}xml=xml.replace(Ektron.RegExp.Entity.entityName,function($0_match,$1_name){var codePoint=Ektron.Xml.htmlEntity[$1_name];if(codePoint){return"&#"+codePoint+";";}else{return $0_match;}});xml=xml.replace(/(<\!--)([\w\W]*?)(-->)/g,protectAmp);xml=xml.replace(/(<\!\[CDATA\[)([\w\W]*?)(\]\]>)/g,protectAmp);xml=xml.replace(/&(?!#|amp;|lt;|gt;|quot;|apos;)/g,"&amp;");xml=xml.replace(/ektTempAmp/g,"&");return xml;}};if(document.cookie&&document.cookie.indexOf("Ektron.Xml.onexception=true")>-1){Ektron.Xml.onexception=function(ex,args){var msg=Ektron.OnException.exceptionMessage(ex);msg=msg.replace(/\&lt;br ?\/?\&gt;/gi,"\n");if($ektron.htmlDecode){msg=$ektron.htmlDecode(msg);}alert(msg);};}Ektron.Xml.parseXml=function parseXml(xml,onexception){try{if(!s_domParser){s_domParser=new DOMParser();}var xmlDoc=s_domParser.parseFromString(xml,"text/xml");var strErrMsg=Sarissa.getParseErrorText(xmlDoc);if(Ektron.OnException.returnException==onexception&&strErrMsg!=Sarissa.PARSED_OK){return strErrMsg;}if(xml&&strErrMsg!=Sarissa.PARSED_OK){throw new Error(strErrMsg);}return xmlDoc;}catch(ex){return Ektron.OnException(this,onexception,ex,arguments);}};if(Ektron.OnException!=null&&Ektron.OnException.returnValue!=null){Ektron.Xml.parseXml.onexception=Ektron.OnException.returnValue(null);}var s_domParser=null;Ektron.Xml.ensureWelFormed=function ensureWelFormed(xml){if(typeof xml!="string"){return"";}if(0==xml.length){return"";}if(/^<\?xml version\=\"1\.0\"\?>/.test(xml)){xml=xml.substring(21);}xml=xml.replace(/<([a-zA-Z1-6:]+)([^>]*)\/>/g,function($0_tag,$1_tagName,$2_attrs){var tagNotation=Ektron.Xml.htmlTagCount[$1_tagName];if(2==tagNotation){return"<"+$1_tagName+$2_attrs+"></"+$1_tagName+">";}else{if(1==tagNotation){return"<"+$1_tagName+$ektron.rtrim($2_attrs)+" />";}else{return $0_tag;}}});return xml;};Ektron.Xml.serializeXml=function serializeXml(xmlDoc){if(!s_xmlSerializer){s_xmlSerializer=new XMLSerializer();}var xml=s_xmlSerializer.serializeToString(xmlDoc);return this.ensureWelFormed(xml);};var s_xmlSerializer=null;Ektron.Xml.htmlTagCount={a:2,abbr:2,acronym:2,address:2,applet:2,area:1,b:2,base:1,basefont:1,bdo:2,bgsound:2,big:2,blink:2,blockquote:2,body:2,br:1,button:2,caption:2,center:2,cite:2,code:2,col:1,colgroup:2,comment:2,dd:2,del:2,dfn:2,dir:2,div:2,dl:2,dt:2,em:2,embed:2,fieldset:2,font:2,form:2,frame:1,frameset:2,h1:2,h2:2,h3:2,h4:2,h5:2,h6:2,head:2,hr:1,html:2,i:2,iframe:2,img:1,input:1,ins:2,isindex:1,kbd:2,keygen:1,label:2,legend:2,li:2,link:1,listing:2,map:2,marquee:2,menu:2,meta:1,nobr:2,noembed:2,noframes:2,noscript:2,object:2,ol:2,optgroup:2,option:2,p:2,param:1,plaintext:2,pre:2,q:2,rb:2,rbc:2,rp:2,rt:2,rtc:2,ruby:2,s:2,samp:2,script:2,select:2,small:2,span:2,strike:2,strong:2,style:2,sub:2,sup:2,table:2,tbody:2,td:2,textarea:2,tfoot:2,th:2,thead:2,title:2,tr:2,tt:2,u:2,ul:2,"var":2,wbr:2,xml:2,xmp:2,"xs:minLength":2,"xs:fractionDigits":2,"xs:minInclusive":2,"xs:maxInclusive":2};Ektron.Xml.htmlEntity={nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,copy:169,ordf:170,laquo:171,not:172,shy:173,reg:174,macr:175,deg:176,plusmn:177,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,sup1:185,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,Agrave:192,Aacute:193,Acirc:194,Atilde:195,Auml:196,Aring:197,AElig:198,Ccedil:199,Egrave:200,Eacute:201,Ecirc:202,Euml:203,Igrave:204,Iacute:205,Icirc:206,Iuml:207,ETH:208,Ntilde:209,Ograve:210,Oacute:211,Ocirc:212,Otilde:213,Ouml:214,times:215,Oslash:216,Ugrave:217,Uacute:218,Ucirc:219,Uuml:220,Yacute:221,THORN:222,szlig:223,agrave:224,aacute:225,acirc:226,atilde:227,auml:228,aring:229,aelig:230,ccedil:231,egrave:232,eacute:233,ecirc:234,euml:235,igrave:236,iacute:237,icirc:238,iuml:239,eth:240,ntilde:241,ograve:242,oacute:243,ocirc:244,otilde:245,ouml:246,divide:247,oslash:248,ugrave:249,uacute:250,ucirc:251,uuml:252,yacute:253,thorn:254,yuml:255,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,circ:710,tilde:732,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,permil:8240,lsaquo:8249,rsaquo:8250,euro:8364,fnof:402,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,bull:8226,hellip:8230,prime:8242,Prime:8243,oline:8254,frasl:8260,weierp:8472,image:8465,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830};Ektron.RegExp.Entity.entityName=/&(\w+);/g;Ektron.Xml.serializeXhtml=function serializeXhtml(nodes){if(!Ektron.String){throw new ReferenceError("Ektron.Xml.serializeXhtml depends on Ektron.String. Please include ektron.string.js.");}if(!nodes){return"";}var m_uniqueIds={};var m_sb=new Ektron.String();if(11==nodes.nodeType){nodes=nodes.childNodes;}if(nodes.length>=0&&"undefined"==typeof nodes.nodeType){if(nodes.length>0){var node=nodes[0];if("undefined"==typeof node){throw m_invalidNodesArgumentError(nodes);}for(var i=0;i<nodes.length;i++){node=nodes[i];if(node){if("undefined"==typeof node.nodeType){throw m_invalidNodesArgumentError(nodes);}m_appendNodeXhtml(node);}}}}else{if("undefined"==typeof nodes.nodeType){throw m_invalidNodesArgumentError(nodes);}m_appendNodeXhtml(nodes);}return m_sb.toString();function m_invalidNodesArgumentError(nodes){return new TypeError(Ektron.String.format("Error in Ektron.Xml.serializeXhtml: 'nodes' must be a Node or array of Node. 'nodes' is of type '{0}'.",typeof nodes));}function m_appendNodeXhtml(node){if(node.uniqueID){if(m_uniqueIds[node.uniqueID]){return;}else{m_uniqueIds[node.uniqueID]=true;}}switch(node.nodeType){case 1:if(node.tagName.charAt(0)=="/"){return;}var name=m_nodeName(node);if("!"==name){m_sb.append(node.text);return;}m_sb.append("<"+name);if(document.all){if("img"==name){var oImg=node.ownerDocument.createElement("IMG");oImg.mergeAttributes(node);if(oImg.width){for(var i=0;i<node.attributes.length;i++){if("width"==node.attributes[i].name){node.setAttribute("width",oImg.width);break;}}}if(oImg.height){for(var i=0;i<node.attributes.length;i++){if("height"==node.attributes[i].name){node.setAttribute("height",oImg.height);break;}}}}else{if("area"==name){if(node.shape){m_sb.append(' shape="'+node.shape.toLowerCase()+'"');}if(node.coords){m_sb.append(' coords="'+node.getAttribute("coords")+'"');}if(node.href){var cleanedHref=node.href.replace("about:blank","");m_sb.append(' href="'+cleanedHref+'"');}if(node.shape){node.removeAttribute("shape",0);}if(node.coords){node.removeAttribute("coords",0);}if(node.href){node.removeAttribute("href",0);}}}}var bSkipChecked=false;var bSkipSelected=false;if("input"==name&&"string"==typeof node.value){node.setAttribute("value",node.value);}if("boolean"==typeof node.defaultChecked){if(node.checked){node.setAttribute("checked",node.checked);m_sb.append(' checked="checked"');bSkipChecked=true;}}if("boolean"==typeof node.defaultSelected){if(node.selected){node.setAttribute("selected",node.selected);m_sb.append(' selected="selected"');bSkipSelected=true;}}var attrs=node.attributes;var numAttrs=attrs.length;for(var i=0;i<numAttrs;i++){var attrName=attrs[i].name.toLowerCase();if("img"==name&&"complete"==attrName){continue;}if(bSkipChecked&&"checked"==attrName){continue;}if(bSkipSelected&&"selected"==attrName){continue;}m_appendAttributeXhtml(attrs[i],node);}switch(name){case"script":m_sb.append(">");m_sb.append(node.text);m_sb.append("</script>");break;case"textarea":m_sb.append(">");m_sb.append($ektron.htmlEncodeText(node.value));m_sb.append("</textarea>");break;case"title":case"style":case"comment":case"noscript":m_sb.append(">");m_sb.append(node.innerHTML);m_sb.append("</"+name+">");break;default:if(node.hasChildNodes()||2==Ektron.Xml.htmlTagCount[name]){m_sb.append(">");var cs=node.childNodes;var numChildren=cs.length;for(var i=0;i<numChildren;i++){m_appendNodeXhtml(cs[i]);}if(0==numChildren&&("p"==name||"td"==name)){m_sb.append("&#160;");}m_sb.append("</"+name+">");}else{m_sb.append(" />");}break;}break;case 3:m_sb.append($ektron.htmlEncodeText(node.nodeValue));break;case 4:m_sb.append("<![CDATA[\n");m_sb.append(node.nodeValue);m_sb.append("\n]]>");break;case 8:var commentValue=node.text;if(!node.text&&node.nodeValue){commentValue="<!--"+node.nodeValue+"-->";}m_sb.append(commentValue);if(/(^<\?xml)|(^<\!DOCTYPE)/.test(commentValue)){m_sb.append("\n");}break;}}function m_appendAttributeXhtml(oAttrNode,oElementNode){var name=m_nodeName(oAttrNode);switch(name){case"selected":if(oElementNode.selected){m_sb.append(' selected="selected"');}return;case"checked":if(oElementNode.checked){m_sb.append(' checked="checked"');}return;case"disabled":if(oElementNode.disabled){m_sb.append(' disabled="disabled"');}return;case"style":if(!oAttrNode.specified){return;}m_sb.append(' style="');m_sb.append($ektron.htmlEncode(oElementNode.style.cssText));m_sb.append('"');return;case"name":if(oElementNode.tagName!="A"||!oElementNode.name){if(!oAttrNode.specified){return;}}break;case"type":break;case"value":break;default:if(!oAttrNode.specified){return;}if(/^jquery\d+/i.test(name)){return;}else{if(/^\{/.test(name)||/\}$/.test(name)){return;}else{if(/^propdescname$/i.test(name)){name="name";}}}break;}var value=oAttrNode.nodeValue;if(!value||!isNaN(value)){value=oElementNode.getAttribute(oAttrNode.nodeName);}if(!value){return;}m_sb.append(" "+name+'="');m_sb.append($ektron.htmlEncode(value));m_sb.append('"');}function m_nodeName(node){if(node.scopeName&&node.scopeName!="HTML"){return node.scopeName+":"+node.nodeName;}else{if(node.expando){return node.nodeName;}else{return node.nodeName.toLowerCase();}}}};Ektron.Xml.isDate=function isDate(xmlDate){return(/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}$/.test(xmlDate));};Ektron.Xml.parseDate=function parseDate(xmlDate,onexception){if(null==xmlDate||""==xmlDate){return null;}try{if(!/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}/.test(xmlDate)){throw new RangeError("xmlDate must be in ISO-8601 format YYYY-MM-DD.");}return new Date(xmlDate.substring(0,4),xmlDate.substring(5,7)-1,xmlDate.substring(8,10));}catch(ex){return Ektron.OnException(this,onexception,ex,arguments);}};if(Ektron.OnException!=null&&Ektron.OnException.returnValue!=null){Ektron.Xml.parseDate.onexception=Ektron.OnException.returnValue(null);}Ektron.Xml.serializeDate=function serializeDate(date){if(!(date instanceof Date)){return"";}var yyyy=date.getFullYear()+"";var mm=(date.getMonth()+1)+"";if(1==mm.length){mm="0"+mm;}var dd=date.getDate()+"";if(1==dd.length){dd="0"+dd;}return yyyy+"-"+mm+"-"+dd;};var s_cacheXml=[];var s_cacheXslt=[];var s_cacheXslProc=[];Ektron.Xml.UnitTest_cacheXslProc=s_cacheXslProc;function getXmlHttp(){try{return new XMLHttpRequest();}catch(ex){}try{return new ActiveXObject("Msxml2.XMLHTTP");}catch(ex){}try{return new ActiveXObject("Microsoft.XMLHTTP");}catch(ex){throw new ReferenceError("Your browser does not support AJAX!");}}function xsltMustBeUrl(xslt){return(xslt.indexOf("document('')")>=0||xslt.indexOf("xsl:include")>=0||xslt.indexOf("xsl:import")>=0);}Ektron.Xml.UnitTest_xsltMustBeUrl=xsltMustBeUrl;function xsltUsesParam(xslt){return(xslt.indexOf("xsl:param")>=0);}function xsltUsesExtObj(xslt){return(xslt.indexOf("ektron:extension-object")>=0);}function isUrl(s){return(s?(-1==s.indexOf("<")&&-1==s.indexOf("\n")&&/\w[\.\?\/]\w/.test(s)):false);}function Sarissa(){}Sarissa.VERSION="0.9.9.6-Ektron";Sarissa.PARSED_OK="Document contains no parsing errors";Sarissa.PARSED_EMPTY="Document is empty";Sarissa.PARSED_UNKNOWN_ERROR="Not well-formed or other error";Sarissa.IS_ENABLED_TRANSFORM_NODE=false;Sarissa.REMOTE_CALL_FLAG="gr.abiss.sarissa.REMOTE_CALL_FLAG";Sarissa._lastUniqueSuffix=0;Sarissa._getUniqueSuffix=function(){return Sarissa._lastUniqueSuffix++;};Sarissa._SARISSA_IEPREFIX4XSLPARAM="";Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION=document.implementation&&true;Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.createDocument;Sarissa._SARISSA_HAS_DOM_FEATURE=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.hasFeature;Sarissa._SARISSA_IS_MOZ=Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT&&Sarissa._SARISSA_HAS_DOM_FEATURE;Sarissa._SARISSA_IS_SAFARI=navigator.userAgent.toLowerCase().indexOf("safari")!=-1||navigator.userAgent.toLowerCase().indexOf("konqueror")!=-1;Sarissa._SARISSA_IS_SAFARI_OLD=Sarissa._SARISSA_IS_SAFARI&&(parseInt((navigator.userAgent.match(/AppleWebKit\/(\d+)/)||{})[1],10)<420);Sarissa._SARISSA_IS_IE=document.all&&window.ActiveXObject&&navigator.userAgent.toLowerCase().indexOf("msie")>-1&&navigator.userAgent.toLowerCase().indexOf("opera")==-1;Sarissa._SARISSA_IS_GT_IE9=Sarissa._SARISSA_IS_IE&&(navigator.userAgent.toLowerCase().indexOf("msie 9")>-1||navigator.userAgent.toLowerCase().indexOf("msie 10")>-1);Sarissa._SARISSA_IS_OPERA=navigator.userAgent.toLowerCase().indexOf("opera")!=-1;if(!window.Node||!Node.ELEMENT_NODE){Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12};}if(Sarissa._SARISSA_IS_SAFARI_OLD){HTMLHtmlElement=document.createElement("html").constructor;Node=HTMLElement={};HTMLElement.prototype=HTMLHtmlElement.__proto__.__proto__;HTMLDocument=Document=document.constructor;var x=new DOMParser();XMLDocument=x.constructor;Element=x.parseFromString("<Single />","text/xml").documentElement.constructor;x=null;}if(typeof XMLDocument=="undefined"&&typeof Document!="undefined"){XMLDocument=Document;}if(Sarissa._SARISSA_IS_IE){Sarissa._SARISSA_IEPREFIX4XSLPARAM="xsl:";var _SARISSA_DOM_PROGID="";var _SARISSA_XMLHTTP_PROGID="";var _SARISSA_DOM_XMLWRITER="";Sarissa.pickRecentProgID=function(idList){var bFound=false,e;var o2Store;for(var i=0;i<idList.length&&!bFound;i++){try{var oDoc=new ActiveXObject(idList[i]);o2Store=idList[i];bFound=true;}catch(objException){e=objException;}}if(!bFound){throw"Could not retrieve a valid progID of Class: "+idList[idList.length-1]+". (original exception: "+e+")";}idList=null;return o2Store;};_SARISSA_DOM_PROGID=null;_SARISSA_THREADEDDOM_PROGID=null;_SARISSA_XSLTEMPLATE_PROGID=null;_SARISSA_XMLHTTP_PROGID=null;XMLHttpRequest=function(){if(!_SARISSA_XMLHTTP_PROGID){_SARISSA_XMLHTTP_PROGID=Sarissa.pickRecentProgID(["Msxml2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"]);}return new ActiveXObject(_SARISSA_XMLHTTP_PROGID);};Sarissa.getDomDocument=function(sUri,sName){if(!_SARISSA_DOM_PROGID){try{_SARISSA_DOM_PROGID=Sarissa.pickRecentProgID(["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"]);}catch(e){_SARISSA_DOM_PROGID="noActiveX";}}var oDoc=_SARISSA_DOM_PROGID=="noActiveX"?document.createElement("xml"):new ActiveXObject(_SARISSA_DOM_PROGID);try{oDoc.validateOnParse=false;oDoc.resolveExternals="false";oDoc.setProperty("ProhibitDTD",false);}catch(e){}oDoc.resolveExternals=true;if(sName){var prefix="";if(sUri){if(sName.indexOf(":")>1){prefix=sName.substring(0,sName.indexOf(":"));sName=sName.substring(sName.indexOf(":")+1);}else{prefix="a"+Sarissa._getUniqueSuffix();}}if(sUri){oDoc.loadXML("<"+prefix+":"+sName+" xmlns:"+prefix+'="'+sUri+'" />');}else{oDoc.loadXML("<"+sName+" />");}}return oDoc;};Sarissa.getXsltDocument=function(sUri,sName){if(!_SARISSA_THREADEDDOM_PROGID){_SARISSA_THREADEDDOM_PROGID=Sarissa.pickRecentProgID(["MSXML2.FreeThreadedDOMDocument.6.0","MSXML2.FreeThreadedDOMDocument.4.0","MSXML2.FreeThreadedDOMDocument.5.0","MSXML2.FreeThreadedDOMDocument.3.0"]);}var oDoc=new ActiveXObject(_SARISSA_THREADEDDOM_PROGID);Sarissa.setXpathNamespaces(oDoc,"xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");oDoc.resolveExternals=true;if("MSXML2.FreeThreadedDOMDocument.6.0"==_SARISSA_THREADEDDOM_PROGID){oDoc.setProperty("AllowDocumentFunction",true);oDoc.setProperty("AllowXsltScript",true);oDoc.setProperty("ProhibitDTD",false);}if(sName){var prefix="";if(sUri){if(sName.indexOf(":")>1){prefix=sName.substring(0,sName.indexOf(":"));sName=sName.substring(sName.indexOf(":")+1);}else{prefix="a"+Sarissa._getUniqueSuffix();}}if(sUri){oDoc.loadXML("<"+prefix+":"+sName+" xmlns:"+prefix+'="'+sUri+'" />');}else{oDoc.loadXML("<"+sName+" />");}}return oDoc;};Sarissa.getParseErrorText=function(oDoc){var parseErrorText=Sarissa.PARSED_OK;if(oDoc&&oDoc.parseError&&oDoc.parseError.errorCode&&oDoc.parseError.errorCode!=0){parseErrorText="XML Parsing Error: "+oDoc.parseError.reason+"\nLocation: "+oDoc.parseError.url+"\nLine Number "+oDoc.parseError.line+", Column "+oDoc.parseError.linepos+":\n"+oDoc.parseError.srcText+"\n";for(var i=0;i<oDoc.parseError.linepos;i++){parseErrorText+="-";}parseErrorText+="^\n";}else{if(oDoc.documentElement===null){parseErrorText=Sarissa.PARSED_EMPTY;}}return parseErrorText;};Sarissa.setXpathNamespaces=function(oDoc,sNsSet){oDoc.setProperty("SelectionLanguage","XPath");oDoc.setProperty("SelectionNamespaces",sNsSet);};XSLTProcessor=function(){if(!_SARISSA_XSLTEMPLATE_PROGID){_SARISSA_XSLTEMPLATE_PROGID=Sarissa.pickRecentProgID(["Msxml2.XSLTemplate.6.0","MSXML2.XSLTemplate.3.0"]);}this.template=new ActiveXObject(_SARISSA_XSLTEMPLATE_PROGID);this.processor=null;};XSLTProcessor.prototype.importStylesheet=function(xslDoc){if(!_SARISSA_THREADEDDOM_PROGID){_SARISSA_THREADEDDOM_PROGID=Sarissa.pickRecentProgID(["MSXML2.FreeThreadedDOMDocument.6.0","MSXML2.FreeThreadedDOMDocument.3.0"]);}xslDoc.setProperty("SelectionLanguage","XPath");xslDoc.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var converted=new ActiveXObject(_SARISSA_THREADEDDOM_PROGID);try{converted.resolveExternals=true;converted.setProperty("AllowDocumentFunction",true);converted.setProperty("AllowXsltScript",true);}catch(e){}if(xslDoc.url&&xslDoc.selectSingleNode("//xsl:*[local-name() = 'import' or local-name() = 'include']")!=null){converted.async=false;converted.load(xslDoc.url);}else{converted.loadXML(xslDoc.xml);}converted.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var output=converted.selectSingleNode("//xsl:output");if(output){this.outputMethod=output.getAttribute("method");}else{delete this.outputMethod;}this.template.stylesheet=converted;this.processor=this.template.createProcessor();this.paramsSet=[];};XSLTProcessor.prototype.transformToDocument=function(sourceDoc){if(!_SARISSA_DOM_PROGID){_SARISSA_DOM_PROGID=Sarissa.pickRecentProgID(["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"]);}var outDoc;if(_SARISSA_THREADEDDOM_PROGID){this.processor.input=sourceDoc;outDoc=new ActiveXObject(_SARISSA_DOM_PROGID);this.processor.output=outDoc;this.processor.transform();return outDoc;}else{if(!_SARISSA_DOM_XMLWRITER){_SARISSA_DOM_XMLWRITER=Sarissa.pickRecentProgID(["Msxml2.MXXMLWriter.6.0","Msxml2.MXXMLWriter.3.0","MSXML2.MXXMLWriter","MSXML.MXXMLWriter","Microsoft.XMLDOM"]);}this.processor.input=sourceDoc;outDoc=new ActiveXObject(_SARISSA_DOM_XMLWRITER);this.processor.output=outDoc;this.processor.transform();var oDoc=new ActiveXObject(_SARISSA_DOM_PROGID);oDoc.loadXML(outDoc.output+"");return oDoc;}};XSLTProcessor.prototype.transformToFragment=function(sourceDoc,ownerDoc){if(!_SARISSA_DOM_PROGID){_SARISSA_DOM_PROGID=Sarissa.pickRecentProgID(["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"]);}this.processor.input=sourceDoc;this.processor.transform();var s=this.processor.output;var f=ownerDoc.createDocumentFragment();var container;if(this.outputMethod=="text"){f.appendChild(ownerDoc.createTextNode(s));}else{if(ownerDoc.body&&ownerDoc.body.innerHTML){container=ownerDoc.createElement("div");container.innerHTML=s;while(container.hasChildNodes()){f.appendChild(container.firstChild);}}else{var oDoc=new ActiveXObject(_SARISSA_DOM_PROGID);if(s.substring(0,5)=="<?xml"){s=s.substring(s.indexOf("?>")+2);}var xml="".concat("<my>",s,"</my>");oDoc.loadXML(xml);container=oDoc.documentElement;while(container.hasChildNodes()){f.appendChild(container.firstChild);}}}return f;};XSLTProcessor.prototype.setParameter=function(nsURI,name,value){value=value?value:"";if(nsURI){this.processor.addParameter(name,value,nsURI);}else{this.processor.addParameter(name,value);}nsURI=""+(nsURI||"");if(!this.paramsSet[nsURI]){this.paramsSet[nsURI]=[];}this.paramsSet[nsURI][name]=value;};XSLTProcessor.prototype.getParameter=function(nsURI,name){nsURI=""+(nsURI||"");if(this.paramsSet[nsURI]&&this.paramsSet[nsURI][name]){return this.paramsSet[nsURI][name];}else{return null;}};XSLTProcessor.prototype.clearParameters=function(){for(var nsURI in this.paramsSet){for(var name in this.paramsSet[nsURI]){if(nsURI!=""){this.processor.addParameter(name,"",nsURI);}else{this.processor.addParameter(name,"");}}}this.paramsSet=[];};}else{if(Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT){Sarissa.__handleLoad__=function(oDoc){Sarissa.__setReadyState__(oDoc,4);};_sarissa_XMLDocument_onload=function(){Sarissa.__handleLoad__(this);};Sarissa.__setReadyState__=function(oDoc,iReadyState){oDoc.readyState=iReadyState;oDoc.readystate=iReadyState;if(oDoc.onreadystatechange!=null&&typeof oDoc.onreadystatechange=="function"){oDoc.onreadystatechange();}};Sarissa.getDomDocument=function(sUri,sName){var oDoc=document.implementation.createDocument(sUri?sUri:null,sName?sName:null,null);if(!oDoc.onreadystatechange){oDoc.onreadystatechange=null;}if(!oDoc.readyState){oDoc.readyState=0;}oDoc.addEventListener("load",_sarissa_XMLDocument_onload,false);return oDoc;};Sarissa.getXsltDocument=Sarissa.getDomDocument;if(window.XMLDocument){}else{if(Sarissa._SARISSA_HAS_DOM_FEATURE&&window.Document&&!Document.prototype.load&&document.implementation.hasFeature("LS","3.0")){Sarissa.getDomDocument=function(sUri,sName){var oDoc=document.implementation.createDocument(sUri?sUri:null,sName?sName:null,null);return oDoc;};}else{Sarissa.getDomDocument=function(sUri,sName){var oDoc=document.implementation.createDocument(sUri?sUri:null,sName?sName:null,null);if(oDoc&&(sUri||sName)&&!oDoc.documentElement){oDoc.appendChild(oDoc.createElementNS(sUri,sName));}return oDoc;};Sarissa.getXsltDocument=Sarissa.getDomDocument;}}}}if(!window.DOMParser||Sarissa._SARISSA_IS_GT_IE9){if(Sarissa._SARISSA_IS_SAFARI){DOMParser=function(){};DOMParser.prototype.parseFromString=function(sXml,contentType){var xmlhttp=new XMLHttpRequest();xmlhttp.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(sXml),false);xmlhttp.send(null);return xmlhttp.responseXML;};}else{if(Sarissa.getDomDocument&&Sarissa.getDomDocument()&&Sarissa.getDomDocument(null,"bar").xml){DOMParser=function(){};DOMParser.prototype.parseFromString=function(sXml,contentType){var doc=Sarissa.getDomDocument();try{doc.validateOnParse=false;doc.setProperty("ProhibitDTD",false);}catch(e){}doc.loadXML(sXml);return doc;};}}}if((typeof(document.importNode)=="undefined")&&Sarissa._SARISSA_IS_IE){try{document.importNode=function(oNode,bChildren){var tmp;if(oNode.nodeName=="#text"){return document.createTextNode(oNode.data);}else{if(oNode.nodeName=="tbody"||oNode.nodeName=="tr"){tmp=document.createElement("table");}else{if(oNode.nodeName=="td"){tmp=document.createElement("tr");}else{if(oNode.nodeName=="option"){tmp=document.createElement("select");}else{tmp=document.createElement("div");}}}if(bChildren){tmp.innerHTML=oNode.xml?oNode.xml:oNode.outerHTML;}else{tmp.innerHTML=oNode.xml?oNode.cloneNode(false).xml:oNode.cloneNode(false).outerHTML;}return tmp.getElementsByTagName("*")[0];}};}catch(e){}}if(!Sarissa.getParseErrorText){Sarissa.getParseErrorText=function(oDoc){var parseErrorText=Sarissa.PARSED_OK;if((!oDoc)||(!oDoc.documentElement)){parseErrorText=Sarissa.PARSED_EMPTY;}else{if(oDoc.documentElement.tagName=="parsererror"){parseErrorText=oDoc.documentElement.firstChild.data;parseErrorText+="\n"+oDoc.documentElement.firstChild.nextSibling.firstChild.data;}else{if(oDoc.getElementsByTagName("parsererror").length>0){var parsererror=oDoc.getElementsByTagName("parsererror")[0];parseErrorText=Sarissa.getText(parsererror,true)+"\n";}else{if(oDoc.parseError&&oDoc.parseError.errorCode!=0){parseErrorText=Sarissa.PARSED_UNKNOWN_ERROR;}}}}return parseErrorText;};}Sarissa.getText=function(oNode,deep){var s="";var nodes=oNode.childNodes;if(oNode.nodeType==Node.ATTRIBUTE_NODE&&nodes.length==0){return oNode.value;}for(var i=0;i<nodes.length;i++){var node=nodes[i];var nodeType=node.nodeType;if(nodeType==Node.TEXT_NODE||nodeType==Node.CDATA_SECTION_NODE){s+=node.data;}else{if(deep===true&&(nodeType==Node.ELEMENT_NODE||nodeType==Node.DOCUMENT_NODE||nodeType==Node.DOCUMENT_FRAGMENT_NODE)){s+=Sarissa.getText(node,true);}}}return s;};if(!window.XMLSerializer&&Sarissa.getDomDocument&&Sarissa.getDomDocument("","foo",null).xml){XMLSerializer=function(){};}if(!window.XMLSerializer.serializeToString&&Sarissa.getDomDocument&&Sarissa.getDomDocument("","foo",null).xml){XMLSerializer.prototype.serializeToString=function(oNode){return oNode.xml;};}else{if(Sarissa._SARISSA_IS_GT_IE9&&window.XMLSerializer){IE9XMLSerializer=XMLSerializer;XMLSerializer=function(){this._oldSerializer=new IE9XMLSerializer();};XMLSerializer.prototype.serializeToString=function(oNode){if(typeof(oNode)=="object"&&"xml" in oNode){return oNode.xml;}else{return this._oldSerializer.serializeToString(oNode);}};}}Sarissa.stripTags=function(s){return s?s.replace(/<[^>]+>/g,""):s;};Sarissa.clearChildNodes=function(oNode){while(oNode.firstChild){oNode.removeChild(oNode.firstChild);}};Sarissa.copyChildNodes=function(nodeFrom,nodeTo,bPreserveExisting){if(Sarissa._SARISSA_IS_SAFARI&&nodeTo.nodeType==Node.DOCUMENT_NODE){nodeTo=nodeTo.documentElement;}if((!nodeFrom)||(!nodeTo)){throw"Both source and destination nodes must be provided";}if(!bPreserveExisting){Sarissa.clearChildNodes(nodeTo);}var ownerDoc=nodeTo.nodeType==Node.DOCUMENT_NODE?nodeTo:nodeTo.ownerDocument;var nodes=nodeFrom.childNodes;var i;if(typeof(ownerDoc.importNode)!="undefined"){for(i=0;i<nodes.length;i++){nodeTo.appendChild(ownerDoc.importNode(nodes[i],true));}}else{for(i=0;i<nodes.length;i++){nodeTo.appendChild(nodes[i].cloneNode(true));}}};Sarissa.moveChildNodes=function(nodeFrom,nodeTo,bPreserveExisting){if((!nodeFrom)||(!nodeTo)){throw"Both source and destination nodes must be provided";}if(!bPreserveExisting){Sarissa.clearChildNodes(nodeTo);}var nodes=nodeFrom.childNodes;if(nodeFrom.ownerDocument==nodeTo.ownerDocument){while(nodeFrom.firstChild){nodeTo.appendChild(nodeFrom.firstChild);}}else{var ownerDoc=nodeTo.nodeType==Node.DOCUMENT_NODE?nodeTo:nodeTo.ownerDocument;var i;if(typeof(ownerDoc.importNode)!="undefined"){for(i=0;i<nodes.length;i++){nodeTo.appendChild(ownerDoc.importNode(nodes[i],true));}}else{for(i=0;i<nodes.length;i++){nodeTo.appendChild(nodes[i].cloneNode(true));}}Sarissa.clearChildNodes(nodeFrom);}};Sarissa.xmlize=function(anyObject,objectName,indentSpace,skipEscape){indentSpace=indentSpace?indentSpace:"";var s=indentSpace+"<"+objectName+">";var isLeaf=false;if(!(anyObject instanceof Object)||anyObject instanceof Number||anyObject instanceof String||anyObject instanceof Boolean||anyObject instanceof Date){s+=(skipEscape?Sarissa.escape(anyObject):anyObject);isLeaf=true;}else{s+="\n";var isArrayItem=anyObject instanceof Array;for(var name in anyObject){if(anyObject[name] instanceof Function){continue;}s+=Sarissa.xmlize(anyObject[name],(isArrayItem?'array-item key="'+name+'"':name),indentSpace+"   ");}s+=indentSpace;}return(s+=(objectName.indexOf(" ")!=-1?"</array-item>\n":"</"+objectName+">\n"));};Sarissa.escape=function(sXml){return sXml.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");};Sarissa.unescape=function(sXml){return sXml.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");};Sarissa.getFunctionName=function(oFunc){if(!oFunc||(typeof oFunc!="function")){throw"The value of parameter 'oFunc' must be a function";}if(oFunc.name){return oFunc.name;}var sFunc=oFunc.toString();alert("sFunc: "+sFunc);var name=sFunc.substring(sFunc.indexOf("function")+8,sFunc.indexOf("("));if(!name||name.length==0||name==" "){name="SarissaAnonymous"+Sarissa._getUniqueSuffix();window[name]=oFunc;}return name;};Sarissa.setRemoteJsonCallback=function(url,callback,callbackParam){if(!callbackParam){callbackParam="callback";}var callbackFunctionName=Sarissa.getFunctionName(callback);var id="sarissa_json_script_id_"+Sarissa._getUniqueSuffix();var oHead=document.getElementsByTagName("head")[0];var scriptTag=document.createElement("script");scriptTag.type="text/javascript";scriptTag.id=id;scriptTag.onload=function(){};if(url.indexOf("?")!=-1){url+=("&"+callbackParam+"="+callbackFunctionName);}else{url+=("?"+callbackParam+"="+callbackFunctionName);}scriptTag.src=url;oHead.appendChild(scriptTag);return id;};if(Sarissa._SARISSA_HAS_DOM_FEATURE&&document.implementation.hasFeature("XPath","3.0")){SarissaNodeList=function(i){this.length=i;};SarissaNodeList.prototype=[];SarissaNodeList.prototype.constructor=Array;SarissaNodeList.prototype.item=function(i){return(i<0||i>=this.length)?null:this[i];};SarissaNodeList.prototype.expr="";if(window.XMLDocument&&(!XMLDocument.prototype.setProperty)){XMLDocument.prototype.setProperty=function(x,y){};}Sarissa.setXpathNamespaces=function(oDoc,sNsSet){oDoc._sarissa_useCustomResolver=true;var namespaces=sNsSet.indexOf(" ")>-1?sNsSet.split(" "):[sNsSet];oDoc._sarissa_xpathNamespaces=[];for(var i=0;i<namespaces.length;i++){var ns=namespaces[i];var colonPos=ns.indexOf(":");var assignPos=ns.indexOf("=");if(colonPos>0&&assignPos>colonPos+1){var prefix=ns.substring(colonPos+1,assignPos);var uri=ns.substring(assignPos+2,ns.length-1);oDoc._sarissa_xpathNamespaces[prefix]=uri;}else{throw"Bad format on namespace declaration(s) given";}}};XMLDocument.prototype._sarissa_useCustomResolver=false;XMLDocument.prototype._sarissa_xpathNamespaces=[];XMLDocument.prototype.selectNodes=function(sExpr,contextNode,returnSingle){var nsDoc=this;var nsresolver;if(this._sarissa_useCustomResolver){nsresolver=function(prefix){var s=nsDoc._sarissa_xpathNamespaces[prefix];if(s){return s;}else{throw"No namespace URI found for prefix: '"+prefix+"'";}};}else{nsresolver=this.createNSResolver(this.documentElement);}var result=null;if(!returnSingle){var oResult=this.evaluate(sExpr,(contextNode?contextNode:this),nsresolver,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);var nodeList=new SarissaNodeList(oResult.snapshotLength);nodeList.expr=sExpr;for(var i=0;i<nodeList.length;i++){nodeList[i]=oResult.snapshotItem(i);}result=nodeList;}else{result=this.evaluate(sExpr,(contextNode?contextNode:this),nsresolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;}return result;};Element.prototype.selectNodes=function(sExpr){var doc=this.ownerDocument;if(doc.selectNodes){return doc.selectNodes(sExpr,this);}else{throw"Method selectNodes is only supported by XML Elements";}};XMLDocument.prototype.selectSingleNode=function(sExpr,contextNode){var ctx=contextNode?contextNode:null;return this.selectNodes(sExpr,ctx,true);};Element.prototype.selectSingleNode=function(sExpr){var doc=this.ownerDocument;if(doc.selectSingleNode){return doc.selectSingleNode(sExpr,this);}else{throw"Method selectNodes is only supported by XML Elements";}};Sarissa.IS_ENABLED_SELECT_NODES=true;}Ektron.Xml.UnitTest_Sarissa=Sarissa;})();
